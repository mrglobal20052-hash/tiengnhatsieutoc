<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 17: Cảm giác & Đánh giá</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 17: Cảm giác & Đánh giá</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">返す</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">かえす</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Trả lại</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 17 (N4 - N3)</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (N4 - N3) ---
        const grammarRepo = {
            "ga_shimasu": { title: "Có (Cảm giác)", formula: "N + がする", desc: "N4: Diễn tả cảm giác về âm thanh, mùi, vị (tiếng ồn, mùi thơm, vị lạ...).", ex: "いい匂いがします。" },
            "sugimasu": { title: "Quá...", formula: "V(bỏ masu)/A + すぎる", desc: "N4: Diễn tả mức độ vượt quá giới hạn (ăn quá nhiều, quá nóng...).", ex: "食べすぎました。" },
            "node": { title: "Vì/Do (Lý do)", formula: "Thể thường + ので", desc: "N4: Nêu lý do khách quan, nhẹ nhàng hơn 'kara'.", ex: "雨なので、行きません。" },
            "no_wa": { title: "Việc...", formula: "Vる + のは + Adj", desc: "N4: Danh từ hóa động từ để làm chủ ngữ (đánh giá, nhận xét).", ex: "泳ぐのは楽しいです。" },
            "sou_da_visual": { title: "Trông có vẻ", formula: "V(bỏ masu)/A(bỏ i/na) + そうだ", desc: "N4: Phỏng đoán dựa trên thị giác (sắp mưa, trông ngon...).", ex: "おいしそうです。" },
            "te_form_cause": { title: "Vì (Nguyên nhân)", formula: "Vて / Aくて / Nで", desc: "N4: Chỉ nguyên nhân dẫn đến kết quả (thường là cảm xúc hoặc trạng thái).", ex: "ニュースを聞いて、びっくりしました。" },
            "yasui_nikui": { title: "Dễ/Khó", formula: "V(bỏ masu) + やすい / にくい", desc: "N4: Diễn tả tính chất dễ hoặc khó thực hiện của hành động.", ex: "このペンは書きやすいです。" }
        };

        // --- 2. VOCABULARY DATA (Day 17) ---
        const vocabData = [
            { "STT": 1, "Kanji": "返す", "Nghĩa": "Trả lại", "Furigana": "かえす", "type": "verb", "conv": { "polite": "借りた本は返しにくいです。", "pVi": "Sách mượn khó trả lại.", "casual": "借りた本、返しにくい。", "cVi": "Sách mượn khó trả thật.", "gIds": ["yasui_nikui"] } },
            { "STT": 2, "Kanji": "譲る", "Nghĩa": "Nhường", "Furigana": "ゆずる", "type": "verb", "conv": { "polite": "席を譲るのは優しいことです。", "pVi": "Việc nhường chỗ là một điều tử tế.", "casual": "席譲るのって優しいね。", "cVi": "Nhường chỗ tốt bụng ghê.", "gIds": ["no_wa"] } },
            { "STT": 3, "Kanji": "(が)助かる", "Nghĩa": "Được cứu/Đỡ", "Furigana": "たすかる", "type": "verb", "conv": { "polite": "あなたが助けてくれたので、助かりました。", "pVi": "Vì bạn đã giúp đỡ, tôi đã được cứu.", "casual": "君が助けてくれたんで、助かった。", "cVi": "May nhờ cậu giúp mà tớ thoát nạn.", "gIds": ["node"] } },
            { "STT": 4, "Kanji": "助ける", "Nghĩa": "Giúp đỡ", "Furigana": "たすける", "type": "verb", "conv": { "polite": "困っている人を助けるのはいいことです。", "pVi": "Giúp đỡ người gặp khó khăn là điều tốt.", "casual": "困ってる人助けるの、いいことだよ。", "cVi": "Giúp người khác là tốt mà.", "gIds": ["no_wa"] } },
            { "STT": 5, "Kanji": "虐める", "Nghĩa": "Bắt nạt", "Furigana": "いじめる", "type": "verb", "conv": { "polite": "弱い人をいじめるのは悪いことです。", "pVi": "Bắt nạt người yếu là điều xấu.", "casual": "弱い人いじめるの、悪いことだ。", "cVi": "Bắt nạt kẻ yếu là xấu tính.", "gIds": ["no_wa"] } },
            { "STT": 6, "Kanji": "騙す", "Nghĩa": "Lừa gạt", "Furigana": "だます", "type": "verb", "conv": { "polite": "人を騙すのはよくないです。", "pVi": "Lừa đảo người khác là không tốt.", "casual": "人騙すの、よくないよ。", "cVi": "Lừa người khác là không tốt đâu.", "gIds": ["no_wa"] } },
            { "STT": 7, "Kanji": "独身", "Nghĩa": "Độc thân", "Furigana": "どくしん", "type": "noun", "conv": { "polite": "彼は独身なので、自由です。", "pVi": "Anh ấy độc thân nên tự do.", "casual": "彼、独身なんで自由だ。", "cVi": "Hắn độc thân nên tự do lắm.", "gIds": ["node"] } },
            { "STT": 8, "Kanji": "女神", "Nghĩa": "Nữ thần", "Furigana": "めがみ", "type": "noun", "conv": { "polite": "女神はとても美しいそうです。", "pVi": "Nữ thần trông có vẻ rất đẹp.", "casual": "女神、めっちゃ美しいそう。", "cVi": "Nữ thần trông đẹp tuyệt.", "gIds": ["sou_da_visual"] } },
            { "STT": 9, "Kanji": "付き合う", "Nghĩa": "Hẹn hò", "Furigana": "つきあう", "type": "verb", "conv": { "polite": "彼女と付き合うのは楽しいです。", "pVi": "Hẹn hò với cô ấy thật vui.", "casual": "彼女と付き合うの楽しい。", "cVi": "Hẹn hò với cổ vui lắm.", "gIds": ["no_wa"] } },
            { "STT": 10, "Kanji": "盗む", "Nghĩa": "Ăn trộm", "Furigana": "ぬすむ", "type": "verb", "conv": { "polite": "お金を盗むのは犯罪です。", "pVi": "Ăn trộm tiền là tội phạm.", "casual": "お金盗むの犯罪だよ。", "cVi": "Trộm tiền là phạm pháp đấy.", "gIds": ["no_wa"] } },
            { "STT": 11, "Kanji": "留守中", "Nghĩa": "Khi vắng nhà", "Furigana": "るすちゅう", "type": "noun", "conv": { "polite": "留守中に泥棒が入ったので、警察を呼びました。", "pVi": "Vì có kẻ trộm vào nhà khi vắng nhà, tôi đã gọi cảnh sát.", "casual": "留守中に泥棒入ったんで、警察呼んだ。", "cVi": "Trộm vào lúc vắng nhà nên tớ báo công an rồi.", "gIds": ["node"] } },
            { "STT": 12, "Kanji": "(が)刺さる", "Nghĩa": "Mắc/Hóc", "Furigana": "ささる", "type": "verb", "conv": { "polite": "魚の骨が喉に刺さって、痛いです。", "pVi": "Xương cá bị mắc vào cổ họng, đau quá.", "casual": "骨刺さって、痛い。", "cVi": "Hóc xương đau quá.", "gIds": ["te_form_cause"] } },
            { "STT": 13, "Kanji": "刺す", "Nghĩa": "Đâm/Chích", "Furigana": "さす", "type": "verb", "conv": { "polite": "蚊に刺されて、痒いです。", "pVi": "Bị muỗi đốt, ngứa quá.", "casual": "蚊に刺されて痒い。", "cVi": "Muỗi đốt ngứa điên.", "gIds": ["te_form_cause"] } },
            { "STT": 14, "Kanji": "殺す", "Nghĩa": "Giết", "Furigana": "ころす", "type": "verb", "conv": { "polite": "人を殺すのはいけません。", "pVi": "Không được giết người.", "casual": "人殺すのいけない。", "cVi": "Cấm giết người.", "gIds": ["no_wa"] } },
            { "STT": 15, "Kanji": "振る", "Nghĩa": "Vẫy", "Furigana": "ふる", "type": "verb", "conv": { "polite": "友達に手を振って、別れました。", "pVi": "Tôi đã vẫy tay chào tạm biệt bạn.", "casual": "手振って別れた。", "cVi": "Vẫy tay chào rồi.", "gIds": ["te_form_cause"] } },
            { "STT": 16, "Kanji": "捲る", "Nghĩa": "Xắn/Lật", "Furigana": "めくる", "type": "verb", "conv": { "polite": "袖を捲るのは簡単です。", "pVi": "Xắn tay áo rất dễ.", "casual": "袖捲るの簡単。", "cVi": "Xắn tay áo dễ ợt.", "gIds": ["no_wa"] } },
            { "STT": 17, "Kanji": "(が)隠れる", "Nghĩa": "Ẩn nấp", "Furigana": "かくれる", "type": "verb", "conv": { "polite": "彼は木の後ろに隠れています。", "pVi": "Anh ấy đang ẩn nấp sau cái cây.", "casual": "彼、木の後ろに隠れてる。", "cVi": "Hắn đang núp sau cây kìa.", "gIds": [] } },
            { "STT": 18, "Kanji": "隠す", "Nghĩa": "Che giấu", "Furigana": "かくす", "type": "verb", "conv": { "polite": "秘密を隠すのは難しいです。", "pVi": "Che giấu bí mật rất khó.", "casual": "秘密隠すの難しい。", "cVi": "Giấu bí mật khó lắm.", "gIds": ["no_wa"] } },
            { "STT": 19, "Kanji": "(が)埋まる", "Nghĩa": "Bị lấp", "Furigana": "うまる", "type": "verb", "conv": { "polite": "穴が埋まっています。", "pVi": "Cái hố đang bị lấp.", "casual": "穴埋まってる。", "cVi": "Hố bị lấp rồi.", "gIds": [] } },
            { "STT": 20, "Kanji": "埋める", "Nghĩa": "Chôn/Lấp", "Furigana": "うめる", "type": "verb", "conv": { "polite": "穴を埋めるのは大変です。", "pVi": "Việc chôn lấp cái hố rất vất vả.", "casual": "穴埋めるの大変。", "cVi": "Lấp hố mệt lắm.", "gIds": ["no_wa"] } },
            { "STT": 21, "Kanji": "(が)詰まる", "Nghĩa": "Đầy/Tắc", "Furigana": "つまる", "type": "verb", "conv": { "polite": "箱に本が詰まっているので、重いです。", "pVi": "Vì sách đầy trong hộp nên nặng.", "casual": "本詰まってるんで重い。", "cVi": "Sách đầy hộp nên nặng trịch.", "gIds": ["node"] } },
            { "STT": 22, "Kanji": "詰める", "Nghĩa": "Nhét", "Furigana": "つめる", "type": "verb", "conv": { "polite": "箱に本を詰めるのは大変です。", "pVi": "Việc nhét sách vào hộp rất vất vả.", "casual": "本詰めるの大変。", "cVi": "Nhét sách vào hộp mệt ghê.", "gIds": ["no_wa"] } },
            { "STT": 23, "Kanji": "開く", "Nghĩa": "Mở (tự)", "Furigana": "ひらく", "type": "verb", "conv": { "polite": "ドアが開いているので、入ってください。", "pVi": "Vì cửa đang mở, xin mời vào.", "casual": "ドア開いてるんで入って。", "cVi": "Cửa mở đấy, vào đi.", "gIds": ["node"] } },
            { "STT": 24, "Kanji": "閉じる", "Nghĩa": "Đóng (tự)", "Furigana": "とじる", "type": "verb", "conv": { "polite": "ドアが閉まっているので、開けてください。", "pVi": "Vì cửa đang đóng, xin hãy mở ra.", "casual": "ドア閉まってるんで開けて。", "cVi": "Cửa đóng rồi, mở ra hộ cái.", "gIds": ["node"] } },
            { "STT": 25, "Kanji": "(が)飛ぶ", "Nghĩa": "Bay", "Furigana": "とぶ", "type": "verb", "conv": { "polite": "鳥が飛んでいるのが見えます。", "pVi": "Tôi có thể nhìn thấy chim đang bay.", "casual": "鳥飛んでるの見える。", "cVi": "Thấy chim bay kìa.", "gIds": [] } },
            { "STT": 26, "Kanji": "飛ばす", "Nghĩa": "Phóng/Bắn", "Furigana": "とばす", "type": "verb", "conv": { "polite": "紙飛行機を飛ばすのは楽しいです。", "pVi": "Phóng máy bay giấy thật vui.", "casual": "紙飛行機飛ばすの楽しい。", "cVi": "Phóng máy bay giấy vui phết.", "gIds": ["no_wa"] } },
            { "STT": 27, "Kanji": "見かける", "Nghĩa": "Tình cờ gặp", "Furigana": "みかける", "type": "verb", "conv": { "polite": "昔の友達を見かけるのは嬉しいです。", "pVi": "Việc tình cờ gặp bạn cũ thật vui.", "casual": "昔の友達見かけるの嬉しい。", "cVi": "Tình cờ gặp bạn cũ vui ghê.", "gIds": ["no_wa"] } },
            { "STT": 28, "Kanji": "確かめる", "Nghĩa": "Xác nhận", "Furigana": "たしかめる", "type": "verb", "conv": { "polite": "情報を確かめるのは時間がかかります。", "pVi": "Việc xác nhận thông tin tốn thời gian.", "casual": "情報確かめるの時間かかる。", "cVi": "Check thông tin lâu lắm.", "gIds": ["no_wa"] } },
            { "STT": 29, "Kanji": "試す", "Nghĩa": "Thử", "Furigana": "ためす", "type": "verb", "conv": { "polite": "新しい料理を試すのは面白いです。", "pVi": "Thử món ăn mới thật thú vị.", "casual": "新しい料理試すの面白い。", "cVi": "Thử món mới hay phết.", "gIds": ["no_wa"] } },
            { "STT": 30, "Kanji": "洋服", "Nghĩa": "Âu phục", "Furigana": "ようふく", "type": "noun", "conv": { "polite": "この洋服は洗いにくいです。", "pVi": "Bộ quần áo này khó giặt.", "casual": "この洋服洗いにくい。", "cVi": "Bộ này khó giặt ghê.", "gIds": ["yasui_nikui"] } },
            { "STT": 31, "Kanji": "繰り返す", "Nghĩa": "Lặp lại", "Furigana": "くりかえす", "type": "verb", "conv": { "polite": "毎日同じことを繰り返すのは大変です。", "pVi": "Việc lặp lại cùng một việc mỗi ngày thật vất vả.", "casual": "毎日同じこと繰り返すの大変。", "cVi": "Lặp đi lặp lại mệt thật.", "gIds": ["no_wa"] } },
            { "STT": 32, "Kanji": "体操する", "Nghĩa": "Tập thể dục", "Furigana": "たいそうする", "type": "verb", "conv": { "polite": "毎日体操するのは健康にいいです。", "pVi": "Việc tập thể dục mỗi ngày tốt cho sức khỏe.", "casual": "毎日体操するの健康にいい。", "cVi": "Tập thể dục tốt cho sức khỏe.", "gIds": ["no_wa"] } },
            { "STT": 33, "Kanji": "訳す", "Nghĩa": "Dịch", "Furigana": "やくす", "type": "verb", "conv": { "polite": "この文章を日本語に訳すのは難しいです。", "pVi": "Việc dịch đoạn văn này sang tiếng Nhật rất khó.", "casual": "これ訳すの難しい。", "cVi": "Dịch cái này khó lắm.", "gIds": ["no_wa"] } },
            { "STT": 34, "Kanji": "進行する", "Nghĩa": "Tiến hành", "Furigana": "しんこうする", "type": "verb", "conv": { "polite": "会議は順調に進行しています。", "pVi": "Cuộc họp đang tiến triển thuận lợi.", "casual": "会議、順調に進行してる。", "cVi": "Họp hành suôn sẻ.", "gIds": [] } },
            { "STT": 35, "Kanji": "(が)間違う", "Nghĩa": "Bị sai", "Furigana": "まちがう", "type": "verb", "conv": { "polite": "答えが間違っているので、直してください。", "pVi": "Vì câu trả lời bị sai, xin hãy sửa lại.", "casual": "答え間違ってるんで直して。", "cVi": "Sai rồi, sửa đi.", "gIds": ["node"] } },
            { "STT": 36, "Kanji": "間違える", "Nghĩa": "Làm sai", "Furigana": "まちがえる", "type": "verb", "conv": { "polite": "答えを間違えて、残念です。", "pVi": "Làm sai câu trả lời, thật đáng tiếc.", "casual": "答え間違えて残念。", "cVi": "Tiếc ghê, làm sai mất rồi.", "gIds": ["te_form_cause"] } },
            { "STT": 37, "Kanji": "許す", "Nghĩa": "Tha thứ", "Furigana": "ゆるす", "type": "verb", "conv": { "polite": "彼を許すのは難しいです。", "pVi": "Việc tha thứ cho anh ấy rất khó.", "casual": "彼許すの難しい。", "cVi": "Khó mà tha cho hắn được.", "gIds": ["no_wa"] } },
            { "STT": 38, "Kanji": "謝る", "Nghĩa": "Xin lỗi", "Furigana": "あやまる", "type": "verb", "conv": { "polite": "友達に謝るのは勇気がいります。", "pVi": "Việc xin lỗi bạn bè cần sự dũng cảm.", "casual": "謝るの勇気いる。", "cVi": "Xin lỗi cũng cần dũng khí đấy.", "gIds": ["no_wa"] } },
            { "STT": 39, "Kanji": "(が)慣れる", "Nghĩa": "Quen", "Furigana": "なれる", "type": "verb", "conv": { "polite": "日本の生活に慣れているので、大丈夫です。", "pVi": "Vì đã quen với cuộc sống ở Nhật, nên không sao.", "casual": "慣れてるんで大丈夫。", "cVi": "Quen rồi nên ko sao.", "gIds": ["node"] } },
            { "STT": 40, "Kanji": "慣らす", "Nghĩa": "Làm quen", "Furigana": "ならす", "type": "verb", "conv": { "polite": "体を慣らすのは大切です。", "pVi": "Việc làm quen cơ thể rất quan trọng.", "casual": "体慣らすの大切。", "cVi": "Khởi động quan trọng lắm.", "gIds": ["no_wa"] } },
            { "STT": 41, "Kanji": "立つ", "Nghĩa": "Đứng", "Furigana": "たつ", "type": "verb", "conv": { "polite": "ドアの前に立っているので、入れません。", "pVi": "Vì đang đứng trước cửa nên không thể vào.", "casual": "立ってるんで入れない。", "cVi": "Đứng đó sao mà vào được.", "gIds": ["node"] } },
            { "STT": 42, "Kanji": "立てる", "Nghĩa": "Dựng", "Furigana": "たてる", "type": "verb", "conv": { "polite": "箸を立てるのは簡単です。", "pVi": "Dựng đũa rất dễ.", "casual": "箸立てるの簡単。", "cVi": "Cắm đũa dễ ợt.", "gIds": ["no_wa"] } },
            { "STT": 43, "Kanji": "(が)建つ", "Nghĩa": "Được xây", "Furigana": "たつ", "type": "verb", "conv": { "polite": "新しいビルが建っているので、賑やかです。", "pVi": "Vì tòa nhà mới đang được xây nên rất náo nhiệt.", "casual": "ビル建ってるんで賑やか。", "cVi": "Đang xây nhà nên ồn ào lắm.", "gIds": ["node"] } },
            { "STT": 44, "Kanji": "建てる", "Nghĩa": "Xây", "Furigana": "たてる", "type": "verb", "conv": { "polite": "新しい家を建てるのは夢です。", "pVi": "Xây một ngôi nhà mới là ước mơ.", "casual": "家建てるの夢だ。", "cVi": "Xây nhà là mơ ước đấy.", "gIds": ["no_wa"] } },
            { "STT": 45, "Kanji": "(が)育つ", "Nghĩa": "Lớn lên", "Furigana": "そだつ", "type": "verb", "conv": { "polite": "子供が大きく育っています。", "pVi": "Con cái đang lớn lên rất nhiều.", "casual": "子供、大きく育ってる。", "cVi": "Bọn trẻ lớn nhanh thật.", "gIds": [] } },
            { "STT": 46, "Kanji": "育てる", "Nghĩa": "Nuôi dạy", "Furigana": "そだてる", "type": "verb", "conv": { "polite": "子供を育てるのは大変です。", "pVi": "Nuôi dạy con cái rất vất vả.", "casual": "子供育てるの大変。", "cVi": "Nuôi con cực lắm.", "gIds": ["no_wa"] } },
            { "STT": 47, "Kanji": "(が)生える", "Nghĩa": "Mọc", "Furigana": "はえる", "type": "verb", "conv": { "polite": "歯が生えているので、痛いです。", "pVi": "Vì răng đang mọc nên đau.", "casual": "歯が生えてるんで痛い。", "cVi": "Đang mọc răng nên đau.", "gIds": ["node"] } },
            { "STT": 48, "Kanji": "生やす", "Nghĩa": "Nuôi (râu)", "Furigana": "はやす", "type": "verb", "conv": { "polite": "髪を伸ばすのは時間がかかります。", "pVi": "Việc để tóc dài tốn thời gian.", "casual": "髪伸ばすの時間かかる。", "cVi": "Nuôi tóc lâu lắm.", "gIds": ["no_wa"] } },
            { "STT": 49, "Kanji": "(が)汚れる", "Nghĩa": "Bị bẩn", "Furigana": "よごれる", "type": "verb", "conv": { "polite": "服が汚れているので、洗ってください。", "pVi": "Vì quần áo bị bẩn, xin hãy giặt.", "casual": "服汚れてるんで洗って。", "cVi": "Áo bẩn rồi, giặt đi.", "gIds": ["node"] } },
            { "STT": 50, "Kanji": "汚す", "Nghĩa": "Làm bẩn", "Furigana": "よごす", "type": "verb", "conv": { "polite": "服を汚して、ごめんなさい。", "pVi": "Xin lỗi vì đã làm bẩn quần áo.", "casual": "服汚してごめん。", "cVi": "Sorry làm bẩn áo rồi.", "gIds": ["te_form_cause"] } },
            { "STT": 51, "Kanji": "(が)壊れる", "Nghĩa": "Bị hỏng", "Furigana": "こわれる", "type": "verb", "conv": { "polite": "パソコンが壊れているので、使えません。", "pVi": "Vì máy tính bị hỏng nên không thể sử dụng.", "casual": "パソコン壊れてるんで使えない。", "cVi": "Máy hỏng rồi không dùng được đâu.", "gIds": ["node"] } },
            { "STT": 52, "Kanji": "壊す", "Nghĩa": "Làm hỏng", "Furigana": "こわす", "type": "verb", "conv": { "polite": "パソコンを壊して、悲しいです。", "pVi": "Làm hỏng máy tính, thật buồn.", "casual": "パソコン壊して悲しい。", "cVi": "Làm hỏng máy buồn ghê.", "gIds": ["te_form_cause"] } },
            { "STT": 53, "Kanji": "(が)割れる", "Nghĩa": "Bị vỡ", "Furigana": "われる", "type": "verb", "conv": { "polite": "グラスが割れているので、気をつけてください。", "pVi": "Vì ly đang vỡ, xin hãy cẩn thận.", "casual": "グラス割れてるんで気をつけて。", "cVi": "Ly vỡ đấy, cẩn thận.", "gIds": ["node"] } },
            { "STT": 54, "Kanji": "割る", "Nghĩa": "Làm vỡ", "Furigana": "わる", "type": "verb", "conv": { "polite": "グラスを割って、ごめんなさい。", "pVi": "Xin lỗi vì đã làm vỡ ly.", "casual": "グラス割ってごめん。", "cVi": "Sorry làm vỡ ly.", "gIds": ["te_form_cause"] } },
            { "STT": 55, "Kanji": "(が)折れる", "Nghĩa": "Gãy", "Furigana": "おれる", "type": "verb", "conv": { "polite": "鉛筆が折れているので、書けません。", "pVi": "Vì bút chì bị gãy nên không thể viết.", "casual": "鉛筆折れてるんで書けない。", "cVi": "Bút gãy rồi không viết được.", "gIds": ["node"] } },
            { "STT": 56, "Kanji": "折る", "Nghĩa": "Bẻ gãy", "Furigana": "おる", "type": "verb", "conv": { "polite": "鉛筆を折って、ごめんなさい。", "pVi": "Xin lỗi vì đã làm gãy bút chì.", "casual": "鉛筆折ってごめん。", "cVi": "Sorry làm gãy bút.", "gIds": ["te_form_cause"] } },
            { "STT": 57, "Kanji": "(が)破れる", "Nghĩa": "Rách", "Furigana": "やぶれる", "type": "verb", "conv": { "polite": "服が破れているので、新しいのを買います。", "pVi": "Vì quần áo bị rách nên tôi sẽ mua cái mới.", "casual": "服破れてるんで新しいの買う。", "cVi": "Áo rách rồi nên mua cái mới.", "gIds": ["node"] } },
            { "STT": 58, "Kanji": "破る", "Nghĩa": "Xé rách", "Furigana": "やぶる", "type": "verb", "conv": { "polite": "紙を破って、ごめんなさい。", "pVi": "Xin lỗi vì đã xé rách giấy.", "casual": "紙破ってごめん。", "cVi": "Sorry xé rách giấy.", "gIds": ["te_form_cause"] } },
            { "STT": 59, "Kanji": "(が)曲がる", "Nghĩa": "Cong/Rẽ", "Furigana": "まがる", "type": "verb", "conv": { "polite": "道が曲がっているので、気をつけてください。", "pVi": "Vì đường cong, xin hãy cẩn thận.", "casual": "道曲がってるんで気をつけて。", "cVi": "Đường cong đấy, cẩn thận.", "gIds": ["node"] } },
            { "STT": 60, "Kanji": "曲げる", "Nghĩa": "Gập/Bẻ", "Furigana": "まげる", "type": "verb", "conv": { "polite": "腕を曲げるのは難しいです。", "pVi": "Việc gập tay rất khó.", "casual": "腕曲げるの難しい。", "cVi": "Gập tay khó lắm.", "gIds": ["no_wa"] } },
            { "STT": 61, "Kanji": "(が)外れる", "Nghĩa": "Tuột ra", "Furigana": "はずれる", "type": "verb", "conv": { "polite": "ボタンが外れているので、直してください。", "pVi": "Vì nút áo bị rơi ra, xin hãy sửa lại.", "casual": "ボタン外れてるんで直して。", "cVi": "Tuột cúc rồi, sửa đi.", "gIds": ["node"] } },
            { "STT": 62, "Kanji": "外す", "Nghĩa": "Tháo ra", "Furigana": "はずす", "type": "verb", "conv": { "polite": "ボタンを外して、ごめんなさい。", "pVi": "Xin lỗi vì đã làm rơi nút áo.", "casual": "ボタン外してごめん。", "cVi": "Sorry làm tuột cúc.", "gIds": ["te_form_cause"] } },
            { "STT": 63, "Kanji": "(が)揺れる", "Nghĩa": "Rung", "Furigana": "ゆれる", "type": "verb", "conv": { "polite": "地震で建物が揺れているので、怖いです。", "pVi": "Vì tòa nhà đang bị rung do động đất nên đáng sợ.", "casual": "地震で建物揺れてるんで怖い。", "cVi": "Động đất nhà rung sợ quá.", "gIds": ["node"] } },
            { "STT": 64, "Kanji": "揺らす", "Nghĩa": "Làm rung", "Furigana": "ゆらす", "type": "verb", "conv": { "polite": "赤ちゃんを揺らすのは難しいです。", "pVi": "Việc rung em bé rất khó.", "casual": "赤ちゃん揺らすの難しい。", "cVi": "Rung em bé khó phết.", "gIds": ["no_wa"] } },
            { "STT": 65, "Kanji": "(が)流れる", "Nghĩa": "Chảy", "Furigana": "ながれる", "type": "verb", "conv": { "polite": "川が流れているので、泳げません。", "pVi": "Vì sông đang chảy nên không thể bơi.", "casual": "川流れてるんで泳げない。", "cVi": "Sông chảy xiết ko bơi được đâu.", "gIds": ["node"] } },
            { "STT": 66, "Kanji": "流す", "Nghĩa": "Xả (nước)", "Furigana": "ながす", "type": "verb", "conv": { "polite": "水を流して、掃除してください。", "pVi": "Xin hãy xả nước và dọn dẹp.", "casual": "水流して掃除して。", "cVi": "Xả nước dọn đi.", "gIds": ["te_kudasai"] } },
            { "STT": 67, "Kanji": "都心", "Nghĩa": "Trung tâm", "Furigana": "としん", "type": "noun", "conv": { "polite": "都心に住むのは便利です。", "pVi": "Việc sống ở trung tâm thành phố rất tiện lợi.", "casual": "都心に住むの便利だ。", "cVi": "Sống trung tâm tiện thật.", "gIds": ["no_wa"] } },
            { "STT": 68, "Kanji": "(が)濡れる", "Nghĩa": "Ướt", "Furigana": "ぬれる", "type": "verb", "conv": { "polite": "服が濡れているので、着替えましょう。", "pVi": "Vì quần áo bị ướt, chúng ta hãy thay đồ.", "casual": "服濡れてるんで着替えよう。", "cVi": "Áo ướt rồi thay thôi.", "gIds": ["node"] } },
            { "STT": 69, "Kanji": "濡らす", "Nghĩa": "Làm ướt", "Furigana": "ぬらす", "type": "verb", "conv": { "polite": "服を濡らして、ごめんなさい。", "pVi": "Xin lỗi vì đã làm ướt quần áo.", "casual": "服濡らしてごめん。", "cVi": "Sorry làm ướt áo.", "gIds": ["te_form_cause"] } },
            { "STT": 70, "Kanji": "迷う", "Nghĩa": "Lạc đường", "Furigana": "まよう", "type": "verb", "conv": { "polite": "道に迷って、困っています。", "pVi": "Vì lạc đường nên tôi đang gặp khó khăn.", "casual": "道迷って困ってる。", "cVi": "Lạc đường khổ quá.", "gIds": ["te_form_cause"] } },
            { "STT": 71, "Kanji": "悩む", "Nghĩa": "Phiền não", "Furigana": "なやむ", "type": "verb", "conv": { "polite": "悩んでいるので、相談したいです。", "pVi": "Vì đang phiền muộn, tôi muốn được tư vấn.", "casual": "悩んでるんで相談したい。", "cVi": "Đang sầu, muốn tâm sự chút.", "gIds": ["node"] } },
            { "STT": 72, "Kanji": "慌てる", "Nghĩa": "Vội vàng", "Furigana": "あわてる", "type": "verb", "conv": { "polite": "慌てて、忘れ物をしました。", "pVi": "Vì luống cuống, tôi đã quên đồ.", "casual": "慌てて忘れ物した。", "cVi": "Cuống quá quên đồ luôn.", "gIds": ["te_form_cause"] } },
            { "STT": 73, "Kanji": "(が)覚める", "Nghĩa": "Tỉnh giấc", "Furigana": "さめる", "type": "verb", "conv": { "polite": "朝早く目が覚めて、嬉しいです。", "pVi": "Vì tỉnh giấc sớm vào buổi sáng nên tôi vui.", "casual": "朝早く目が覚めて嬉しい。", "cVi": "Dậy sớm thấy vui ghê.", "gIds": ["te_form_cause"] } },
            { "STT": 74, "Kanji": "覚ます", "Nghĩa": "Đánh thức", "Furigana": "さます", "type": "verb", "conv": { "polite": "子供を起こして、学校へ行かせます。", "pVi": "Tôi đánh thức con và cho đi học.", "casual": "子供起こして学校行かせる。", "cVi": "Gọi con dậy đi học.", "gIds": [] } },
            { "STT": 75, "Kanji": "夜中", "Nghĩa": "Nửa đêm", "Furigana": "よなか", "type": "time", "conv": { "polite": "夜中に目が覚めて、眠れません。", "pVi": "Vì tỉnh giấc giữa đêm nên không ngủ được.", "casual": "夜中目覚めて眠れない。", "cVi": "Tỉnh giữa đêm chả ngủ lại được.", "gIds": ["te_form_cause"] } },
            { "STT": 76, "Kanji": "(が)眠る", "Nghĩa": "Ngủ", "Furigana": "ねむる", "type": "verb", "conv": { "polite": "夜中に眠っているのは難しいです。", "pVi": "Việc ngủ giữa đêm rất khó.", "casual": "夜中眠ってるの難しい。", "cVi": "Ngủ lại giữa đêm khó thật.", "gIds": ["no_wa"] } },
            { "STT": 77, "Kanji": "緊張する", "Nghĩa": "Căng thẳng", "Furigana": "きんちょうする", "type": "verb", "conv": { "polite": "試験の前はいつも緊張しています。", "pVi": "Trước kỳ thi tôi luôn căng thẳng.", "casual": "試験前いつも緊張してる。", "cVi": "Trước khi thi lúc nào cũng run.", "gIds": [] } },
            { "STT": 78, "Kanji": "祈る", "Nghĩa": "Cầu nguyện", "Furigana": "いのる", "type": "verb", "conv": { "polite": "毎日家族の健康を祈っています。", "pVi": "Hàng ngày tôi đang cầu nguyện cho sức khỏe của gia đình.", "casual": "毎日家族の健康祈ってる。", "cVi": "Ngày nào cũng cầu cho cả nhà khỏe mạnh.", "gIds": [] } },
            { "STT": 79, "Kanji": "祝う", "Nghĩa": "Chúc mừng", "Furigana": "いわう", "type": "verb", "conv": { "polite": "友達の誕生日を祝うのは楽しいです。", "pVi": "Việc chúc mừng sinh nhật bạn bè thật vui.", "casual": "友達の誕生日祝うの楽しい。", "cVi": "Chúc mừng sinh nhật bạn vui phết.", "gIds": ["no_wa"] } },
            { "STT": 80, "Kanji": "感じる", "Nghĩa": "Cảm thấy", "Furigana": "かんじる", "type": "verb", "conv": { "polite": "寒さを感じているので、コートを着ます。", "pVi": "Vì đang cảm thấy lạnh nên tôi mặc áo khoác.", "casual": "寒さ感じてるんでコート着る。", "cVi": "Lạnh quá mặc áo khoác vào.", "gIds": ["node"] } },
            { "STT": 81, "Kanji": "濃い", "Nghĩa": "Đậm", "Furigana": "こい", "type": "adj_i", "conv": { "polite": "濃いコーヒーが好きなので、毎日飲みます。", "pVi": "Vì thích cà phê đậm nên tôi uống mỗi ngày.", "casual": "濃いコーヒー好きなんで毎日飲む。", "cVi": "Thích cà phê đậm nên ngày nào cũng uống.", "gIds": ["node"] } },
            { "STT": 82, "Kanji": "薄い", "Nghĩa": "Nhạt", "Furigana": "うすい", "type": "adj_i", "conv": { "polite": "薄い味が好きなので、このスープは美味しいです。", "pVi": "Vì thích vị nhạt nên món súp này ngon.", "casual": "薄い味好きなんで、このスープ美味しい。", "cVi": "Thích nhạt nên thấy súp này ngon.", "gIds": ["node"] } },
            { "STT": 83, "Kanji": "酸っぱい", "Nghĩa": "Chua", "Furigana": "すっぱい", "type": "adj_i", "conv": { "polite": "酸っぱいレモンは苦手なので、食べません。", "pVi": "Vì chanh chua khó ăn nên tôi không ăn.", "casual": "酸っぱいレモン苦手なんで食べない。", "cVi": "Chanh chua tớ chịu, không ăn đâu.", "gIds": ["node"] } },
            { "STT": 84, "Kanji": "臭い", "Nghĩa": "Hôi", "Furigana": "くさい", "type": "adj_i", "conv": { "polite": "ゴミ箱が臭いので、捨ててください。", "pVi": "Vì thùng rác hôi, xin hãy vứt đi.", "casual": "ゴミ箱臭いんで捨てて。", "cVi": "Thùng rác hôi quá, vứt đi.", "gIds": ["node"] } },
            { "STT": 85, "Kanji": "可笑しい", "Nghĩa": "Kỳ quặc", "Furigana": "おかしい", "type": "adj_i", "conv": { "polite": "変な音が聞こえます。おかしいです。", "pVi": "Nghe thấy tiếng lạ. Thật kỳ quặc.", "casual": "変な音聞こえる。おかしい。", "cVi": "Tiếng gì lạ thế. Dị thật.", "gIds": ["ga_shimasu"] } },
            { "STT": 86, "Kanji": "格好いい", "Nghĩa": "Ngầu", "Furigana": "かっこいい", "type": "adj_i", "conv": { "polite": "彼は格好いいので、人気があります。", "pVi": "Vì anh ấy đẹp trai nên được yêu thích.", "casual": "彼かっこいいんで人気ある。", "cVi": "Hắn đẹp trai nên hot lắm.", "gIds": ["node"] } },
            { "STT": 87, "Kanji": "旨い", "Nghĩa": "Ngon/Giỏi", "Furigana": "うまい", "type": "adj_i", "conv": { "polite": "料理が上手なので、いつも作っています。", "pVi": "Vì nấu ăn giỏi nên tôi luôn nấu.", "casual": "料理上手なんでいつも作ってる。", "cVi": "Nấu ăn ngon nên toàn tự nấu.", "gIds": ["node"] } }
        ];

        // --- 3. KANJI DETAILS (Tips & Mnemonics) ---
        const kanjiDetails = {
            "返": { hanviet: "PHẢN", mean: "Trả lại", on: "ヘン", kun: "かえ.す", radicals: "Xước (⻌) + Phản (反)", tipImg: "Phản đối rồi bỏ đi.", tipSoundOn: "**Hen**ji hồi âm.", tipSoundKun: "**Kae**su trả lại.", words: [{w:"返します (かえします)", m:"Trả lại"}, {w:"返事 (へんじ)", m:"Hồi âm"}] },
            "譲": { hanviet: "NHƯỢNG", mean: "Nhường", on: "ジョウ", kun: "ゆず.る", radicals: "Ngôn (言) + Tương (襄)", tipImg: "Lời nói khiêm nhường.", tipSoundOn: "**Jou**ho nhượng bộ.", tipSoundKun: "**Yuzu**ru nhường.", words: [{w:"譲ります (ゆずります)", m:"Nhường"}] },
            "助": { hanviet: "TRỢ", mean: "Giúp đỡ", on: "ジョ", kun: "たす.ける", radicals: "Lực (力) + Thả (且)", tipImg: "Dùng sức và giúp đỡ.", tipSoundOn: "**Jo**shu trợ thủ.", tipSoundKun: "**Tasu**keru giúp.", words: [{w:"助かります (たすかります)", m:"Được giúp"}, {w:"助けます (たすけます)", m:"Giúp đỡ"}] },
            "虐": { hanviet: "NGƯỢC", mean: "Ngược đãi", on: "ギャク", kun: "いじ.める", radicals: "Hổ (虍)", tipImg: "Hổ ngược đãi người.", tipSoundOn: "**Gyaku**tai ngược đãi.", tipSoundKun: "**Iji**meru bắt nạt.", words: [{w:"虐めます (いじめます)", m:"Bắt nạt"}] },
            "騙": { hanviet: "PHIẾN", mean: "Lừa gạt", on: "ヘン", kun: "だま.す", radicals: "Mã (馬) + Biển (扁)", tipImg: "Ngựa nhỏ lừa người.", tipSoundOn: "**Dama**su lừa.", tipSoundKun: "**Dama**su lừa gạt.", words: [{w:"騙します (だまします)", m:"Lừa gạt"}] },
            "独": { hanviet: "ĐỘC", mean: "Một mình", on: "ドク", kun: "ひと.り", radicals: "Khuyển (犭) + Trùng (虫)", tipImg: "Con chó bị con sâu cắn một mình.", tipSoundOn: "**Doku**shin độc thân.", tipSoundKun: "**Hito**ri một mình.", words: [{w:"独身 (どくしん)", m:"Độc thân"}] },
            "神": { hanviet: "THẦN", mean: "Thần thánh", on: "シン", kun: "かみ", radicals: "Kỳ (礻) + Thân (申)", tipImg: "Thần nói.", tipSoundOn: "**Shin**kei thần kinh.", tipSoundKun: "**Mega**mi nữ thần.", words: [{w:"女神 (めがみ)", m:"Nữ thần"}, {w:"神社 (じんじゃ)", m:"Đền thờ"}] },
            "付": { hanviet: "PHÓ", mean: "Gắn vào", on: "フ", kun: "つ.く", radicals: "Nhân (亻) + Thốn (寸)", tipImg: "Người trao tấc lòng.", tipSoundOn: "Ki**fu** quyên góp.", tipSoundKun: "**Tsu**kiau hẹn hò.", words: [{w:"付き合います (つきあいます)", m:"Hẹn hò"}] },
            "盗": { hanviet: "ĐẠO", mean: "Trộm cướp", on: "トウ", kun: "ぬす.む", radicals: "Mãnh (皿) + Thứ (次)", tipImg: "Lấy trộm đồ thứ trong đĩa.", tipSoundOn: "Gou**tou** cường đạo.", tipSoundKun: "**Nusu**mu ăn trộm.", words: [{w:"盗みます (ぬすみます)", m:"Ăn trộm"}] },
            "留": { hanviet: "LƯU", mean: "Lưu lại", on: "リュウ", kun: "と.める", radicals: "Điền (田) + Mâu (卯)", tipImg: "Ở lại ruộng.", tipSoundOn: "**Ru**su vắng nhà.", tipSoundKun: "**To**meru dừng.", words: [{w:"留守中 (るすちゅう)", m:"Khi vắng nhà"}, {w:"留学 (りゅうがく)", m:"Du học"}] },
            "守": { hanviet: "THỦ", mean: "Bảo vệ/Giữ", on: "シュ", kun: "まも.る", radicals: "Miên (宀) + Thốn (寸)", tipImg: "Trong nhà giữ tấc đất.", tipSoundOn: "Ru**su** vắng nhà.", tipSoundKun: "**Mamo**ru bảo vệ.", words: [{w:"留守 (るす)", m:"Vắng nhà"}, {w:"守ります (まもります)", m:"Tuân thủ"}] },
            "刺": { hanviet: "THÍCH", mean: "Đâm/Chọc", on: "シ", kun: "さ.す", radicals: "Đao (刂) + Thích (刺 - phần trái)", tipImg: "Dùng dao đâm.", tipSoundOn: "**Shi**geki kích thích.", tipSoundKun: "**Sa**su đâm/đốt.", words: [{w:"刺さります (ささります)", m:"Mắc/Hóc"}, {w:"刺します (さします)", m:"Đâm/Đốt"}] },
            "殺": { hanviet: "SÁT", mean: "Giết", on: "サツ", kun: "ころ.す", radicals: "Thù (殳) + Sát (杀)", tipImg: "Tay cầm thù giết.", tipSoundOn: "**Satsu**jin sát nhân.", tipSoundKun: "**Koro**su giết.", words: [{w:"殺します (ころします)", m:"Giết"}] },
            "振": { hanviet: "CHẤN", mean: "Vẫy/Rung", on: "シン", kun: "ふ.る", radicals: "Thủ (扌) + Thần (辰)", tipImg: "Tay làm chấn động.", tipSoundOn: "**Shin**dou chấn động.", tipSoundKun: "**Fu**ru vẫy.", words: [{w:"振ります (ふります)", m:"Vẫy tay"}] },
            "捲": { hanviet: "QUYỂN", mean: "Cuộn/Xắn", on: "ケン", kun: "めく.る", radicals: "Thủ (扌) + Quyển (卷)", tipImg: "Tay cuộn tròn.", tipSoundOn: "**Ken** quyển.", tipSoundKun: "**Meku**ru xắn/lật.", words: [{w:"捲ります (めくります)", m:"Xắn/Lật"}] },
            "隠": { hanviet: "ẨN", mean: "Ẩn nấp", on: "イン", kun: "かく.す", radicals: "Phụ (阝)", tipImg: "Nấp sau gò đất.", tipSoundOn: "**In**kyo ẩn cư.", tipSoundKun: "**Kaku**reru ẩn nấp.", words: [{w:"隠れます (かくれます)", m:"Ẩn nấp"}, {w:"隠します (かくします)", m:"Che giấu"}] },
            "埋": { hanviet: "MAI", mean: "Chôn/Lấp", on: "マイ", kun: "う.める", radicals: "Thổ (土) + Lý (里)", tipImg: "Chôn dưới đất trong làng.", tipSoundOn: "**Mai**sou mai táng.", tipSoundKun: "**U**meru chôn.", words: [{w:"埋める (うめる)", m:"Chôn"}, {w:"埋まる (うまる)", m:"Bị chôn"}] },
            "詰": { hanviet: "CẬT", mean: "Nhét/Bí", on: "キツ", kun: "つ.める", radicals: "Ngôn (言) + Cát (吉)", tipImg: "Nói lời tốt đẹp khi bị bí.", tipSoundOn: "**Kitsu**mon cật vấn.", tipSoundKun: "**Tsu**meru nhét.", words: [{w:"詰める (つめる)", m:"Nhét"}, {w:"缶詰 (かんづめ)", m:"Đồ hộp"}] },
            "開": { hanviet: "KHAI", mean: "Mở", on: "カイ", kun: "ひら.く", radicals: "Môn (門)", tipImg: "Hai tay mở cổng.", tipSoundOn: "**Kai**hou mở cửa.", tipSoundKun: "**Hira**ku mở.", words: [{w:"開く (ひらく)", m:"Mở"}, {w:"開始 (かいし)", m:"Bắt đầu"}] },
            "閉": { hanviet: "BẾ", mean: "Đóng", on: "ヘイ", kun: "と.じる", radicals: "Môn (門) + Tài (才)", tipImg: "Đóng cửa tài năng.", tipSoundOn: "**Hei**kai bế mạc.", tipSoundKun: "**To**jiru đóng.", words: [{w:"閉じる (とじる)", m:"Đóng"}, {w:"閉店 (へいてん)", m:"Đóng cửa"}] },
            "飛": { hanviet: "PHI", mean: "Bay", on: "ヒ", kun: "と.ぶ", radicals: "Phi (飛)", tipImg: "Con chim đang bay lên.", tipSoundOn: "**Hi**kouki máy bay.", tipSoundKun: "**To**bu bay.", words: [{w:"飛ぶ (とぶ)", m:"Bay"}, {w:"飛行機 (ひこうき)", m:"Máy bay"}] },
            "見": { hanviet: "KIẾN", mean: "Nhìn", on: "ケン", kun: "み.る", radicals: "Mục (目)", tipImg: "Mắt trên chân đi kiến tập.", tipSoundOn: "**Ken**gaku kiến tập.", tipSoundKun: "**Mi**ru nhìn.", words: [{w:"見かける (みかける)", m:"Bắt gặp"}, {w:"見物 (けんぶつ)", m:"Tham quan"}] },
            "確": { hanviet: "XÁC", mean: "Chính xác", on: "カク", kun: "たし.か", radicals: "Thạch (石)", tipImg: "Hòn đá cứng xác thực.", tipSoundOn: "**Kaku**nin xác nhận.", tipSoundKun: "**Tashi**ka chính xác.", words: [{w:"確かめる (たしかめる)", m:"Xác nhận"}, {w:"正確 (せいかく)", m:"Chính xác"}] },
            "試": { hanviet: "THÍ", mean: "Thử", on: "シ", kun: "ため.す", radicals: "Ngôn (言) + Thức (式)", tipImg: "Lời nói theo thức là thi thử.", tipSoundOn: "**Shi**ai trận đấu.", tipSoundKun: "**Tame**su thử.", words: [{w:"試す (ためす)", m:"Thử"}, {w:"試験 (しけん)", m:"Kỳ thi"}] },
            "洋": { hanviet: "DƯƠNG", mean: "Đại dương/Tây", on: "ヨウ", kun: "", radicals: "Thủy (氵) + Dương (羊)", tipImg: "Con dê uống nước đại dương.", tipSoundOn: "**You**fuku âu phục.", tipSoundKun: "", words: [{w:"洋服 (ようふく)", m:"Âu phục"}, {w:"西洋 (せいよう)", m:"Phương Tây"}] },
            "繰": { hanviet: "TAO", mean: "Kéo tơ/Lặp lại", on: "ソ", kun: "く.る", radicals: "Mịch (糸) + Sào (巢)", tipImg: "Kéo tơ từ tổ (巢).", tipSoundOn: "", tipSoundKun: "**Ku**rikaesu lặp lại.", words: [{w:"繰り返す (くりかえす)", m:"Lặp lại"}] },
            "体": { hanviet: "THỂ", mean: "Cơ thể", on: "タイ", kun: "からだ", radicals: "Nhân (亻) + Bản (本)", tipImg: "Người (亻) là gốc (本) của cơ thể.", tipSoundOn: "**Tai**sou thể dục.", tipSoundKun: "**Karada** cơ thể.", words: [{w:"体操 (たいそう)", m:"Thể dục"}, {w:"体力 (たいりょく)", m:"Thể lực"}] },
            "操": { hanviet: "THAO", mean: "Thao tác", on: "ソウ", kun: "あやつ.る", radicals: "Thủ (扌) + Sào (喿)", tipImg: "Tay (扌) cầm sào (喿) thao tác.", tipSoundOn: "Tai**sou** thể dục.", tipSoundKun: "**Ayatsu**ru điều khiển.", words: [{w:"体操 (たいそう)", m:"Thể dục"}, {w:"操作 (そうさ)", m:"Thao tác"}] },
            "訳": { hanviet: "DỊCH", mean: "Dịch/Lý do", on: "ヤク", kun: "わけ", radicals: "Ngôn (言) + Xích (尺)", tipImg: "Lời nói (言) thước tấc (尺) là dịch.", tipSoundOn: "Hon**yaku** biên dịch.", tipSoundKun: "**Wake** lý do.", words: [{w:"訳す (やくす)", m:"Dịch"}, {w:"言い訳 (いいわけ)", m:"Viện cớ"}] },
            "進": { hanviet: "TIẾN", mean: "Tiến lên", on: "シン", kun: "すす.む", radicals: "Xước (⻌) + Chuy (隹)", tipImg: "Chim (隹) bay đi (⻌) tiến lên.", tipSoundOn: "**Shin**kou tiến hành.", tipSoundKun: "**Susu**mu tiến lên.", words: [{w:"進行 (しんこう)", m:"Tiến hành"}, {w:"進化 (しんか)", m:"Tiến hóa"}] },
            "間": { hanviet: "GIAN", mean: "Ở giữa", on: "カン", kun: "あいだ, ま", radicals: "Môn (門) + Nhật (日)", tipImg: "Mặt trời ở giữa cửa.", tipSoundOn: "Ji**kan** thời gian.", tipSoundKun: "**Ma**chigau nhầm.", words: [{w:"間違う (まちがう)", m:"Sai/Nhầm"}, {w:"時間 (じかん)", m:"Thời gian"}] },
            "違": { hanviet: "VI", mean: "Sai khác", on: "イ", kun: "ちが.う", radicals: "Xước (⻌) + Vi (韋)", tipImg: "Đi (⻌) trái (韋) đường là sai.", tipSoundOn: "**I**han vi phạm.", tipSoundKun: "**Chiga**u khác.", words: [{w:"間違う (まちがう)", m:"Nhầm lẫn"}, {w:"違い (ちがい)", m:"Sự khác biệt"}] },
            "許": { hanviet: "HỨA", mean: "Tha thứ/Cho phép", on: "キョ", kun: "ゆる.す", radicals: "Ngôn (言) + Ngọ (午)", tipImg: "Lời nói (言) lúc ngọ (午) là hứa.", tipSoundOn: "**Kyo**ka cho phép.", tipSoundKun: "**Yuru**su tha thứ.", words: [{w:"許す (ゆるす)", m:"Tha thứ"}, {w:"許可 (きょか)", m:"Sự cho phép"}] },
            "謝": { hanviet: "TẠ", mean: "Cảm tạ/Tạ lỗi", on: "シャ", kun: "あやま.る", radicals: "Ngôn (言) + Xạ (射)", tipImg: "Lời nói (言) bắn (射) ra để tạ lỗi.", tipSoundOn: "Kan**sha** cảm tạ.", tipSoundKun: "**Ayama**ru xin lỗi.", words: [{w:"謝る (あやまる)", m:"Xin lỗi"}, {w:"感謝 (かんしゃ)", m:"Cảm tạ"}] },
            "慣": { hanviet: "QUÁN", mean: "Quen", on: "カン", kun: "な.れる", radicals: "Tâm (忄) + Quán (貫)", tipImg: "Tâm (忄) quán (貫) triệt thói quen.", tipSoundOn: "Shuu**kan** tập quán.", tipSoundKun: "**Na**reru quen.", words: [{w:"慣れる (なれる)", m:"Làm quen"}, {w:"習慣 (しゅうかん)", m:"Tập quán"}] },
            "立": { hanviet: "LẬP", mean: "Đứng", on: "リツ", kun: "た.つ", radicals: "Lập (立)", tipImg: "Người đứng trên đất.", tipSoundOn: "Kou**ritsu** công lập.", tipSoundKun: "**Ta**tsu đứng.", words: [{w:"立つ (たつ)", m:"Đứng"}, {w:"立てる (たてる)", m:"Dựng"}] },
            "建": { hanviet: "KIẾN", mean: "Xây dựng", on: "ケン", kun: "た.てる", radicals: "Dẫn (廴) + Duật (聿)", tipImg: "Tay cầm bút vẽ bản đồ xây dựng.", tipSoundOn: "**Ken**chiku kiến trúc.", tipSoundKun: "**Ta**teru xây.", words: [{w:"建てる (たてる)", m:"Xây"}, {w:"建つ (たつ)", m:"Được xây"}] },
            "育": { hanviet: "DỤC", mean: "Nuôi dạy", on: "イク", kun: "そだ.つ", radicals: "Nhục (月)", tipImg: "Nuôi con lớn bằng thịt.", tipSoundOn: "Kyou**iku** giáo dục.", tipSoundKun: "**Soda**tsu lớn lên.", words: [{w:"育つ (そだつ)", m:"Lớn lên"}, {w:"育てる (そだてる)", m:"Nuôi dạy"}] },
            "生": { hanviet: "SINH", mean: "Sinh sống/Mọc", on: "セイ", kun: "は.える, は.やす", radicals: "Sinh (生)", tipImg: "Cây nảy mầm.", tipSoundOn: "**Sei**katsu sinh hoạt.", tipSoundKun: "**Ha**eru mọc.", words: [{w:"生える (はえる)", m:"Mọc"}, {w:"生やす (はやす)", m:"Để mọc (râu)"}] },
            "汚": { hanviet: "Ô", mean: "Bẩn", on: "オ", kun: "よご.れる", radicals: "Thủy (氵) + Khuy (亏)", tipImg: "Nước đọng ở số 5 là bẩn.", tipSoundOn: "**O**sen ô nhiễm.", tipSoundKun: "**Yogo**reru bị bẩn.", words: [{w:"汚れる (よごれる)", m:"Bị bẩn"}, {w:"汚す (よごす)", m:"Làm bẩn"}] },
            "壊": { hanviet: "HOẠI", mean: "Hỏng", on: "カイ", kun: "こわ.れる", radicals: "Thổ (土)", tipImg: "Đất (土) bị hoại.", tipSoundOn: "Ha**kai** phá hoại.", tipSoundKun: "**Kowa**reru hỏng.", words: [{w:"壊れる (こわれる)", m:"Hỏng"}, {w:"壊す (こわす)", m:"Làm hỏng"}] },
            "割": { hanviet: "CÁT", mean: "Vỡ/Chia", on: "カツ", kun: "わ.れる", radicals: "Đao (刂) + Hại (害)", tipImg: "Dùng dao (刂) cắt hại (害) vật.", tipSoundOn: "Bun**katsu** phân cắt.", tipSoundKun: "**Wa**reru vỡ.", words: [{w:"割れる (われる)", m:"Vỡ"}, {w:"割る (わる)", m:"Đập vỡ"}] },
            "折": { hanviet: "CHIẾT", mean: "Bẻ/Gấp", on: "セツ", kun: "お.れる", radicals: "Thủ (扌) + Cân (斤)", tipImg: "Tay (扌) cầm rìu (斤) bẻ gãy.", tipSoundOn: "Kos**setsu** gãy xương.", tipSoundKun: "**O**reru gãy.", words: [{w:"折れる (おれる)", m:"Gãy"}, {w:"折る (おる)", m:"Bẻ gãy"}] },
            "破": { hanviet: "PHÁ", mean: "Rách/Phá", on: "ハ", kun: "やぶ.れる", radicals: "Thạch (石) + Bì (皮)", tipImg: "Đá (石) làm rách da (皮).", tipSoundOn: "**Ha**kai phá hoại.", tipSoundKun: "**Yabu**reru rách.", words: [{w:"破れる (やぶれる)", m:"Rách"}, {w:"破る (やぶる)", m:"Xé rách"}] },
            "曲": { hanviet: "KHÚC", mean: "Cong/Rẽ", on: "キョク", kun: "ま.がる", radicals: "Điền (田)", tipImg: "Ruộng bị uốn cong.", tipSoundOn: "**Kyoku** ca khúc.", tipSoundKun: "**Ma**garu cong.", words: [{w:"曲がる (まがる)", m:"Cong/Rẽ"}, {w:"曲げる (まげる)", m:"Gập/Bẻ"}] },
            "外": { hanviet: "NGOẠI", mean: "Ngoài", on: "ガイ", kun: "はず.れる", radicals: "Tịch (夕) + Bốc (卜)", tipImg: "Tối bói ngoài đường.", tipSoundOn: "**Gai**koku nước ngoài.", tipSoundKun: "**Hazu**reru tuột ra.", words: [{w:"外れる (はずれる)", m:"Tuột ra"}, {w:"外す (はずす)", m:"Tháo ra"}] },
            "揺": { hanviet: "DAO", mean: "Rung/Lắc", on: "ヨウ", kun: "ゆ.れる", radicals: "Thủ (扌)", tipImg: "Tay (扌) dao (瑶) động.", tipSoundOn: "Dou**you** dao động.", tipSoundKun: "**Yu**reru rung.", words: [{w:"揺れる (ゆれる)", m:"Rung"}, {w:"揺らす (ゆらす)", m:"Làm rung"}] },
            "流": { hanviet: "LƯU", mean: "Chảy", on: "リュウ", kun: "なが.れる", radicals: "Thủy (氵)", tipImg: "Nước (氵) chảy lưu (充) thông.", tipSoundOn: "**Ryuu**kou lưu hành.", tipSoundKun: "**Naga**reru chảy.", words: [{w:"流れる (ながれる)", m:"Chảy"}, {w:"流す (ながす)", m:"Xả nước"}] },
            "都": { hanviet: "ĐÔ", mean: "Đô thị", on: "ト", kun: "みやこ", radicals: "Phụ (阝) + Giả (者)", tipImg: "Người (者) ở gò đất (阝) lập đô.", tipSoundOn: "**To**kai đô hội.", tipSoundKun: "**Miyako** kinh đô.", words: [{w:"都心 (としん)", m:"Trung tâm"}, {w:"都市 (とし)", m:"Đô thị"}] },
            "心": { hanviet: "TÂM", mean: "Tim/Tâm", on: "シン", kun: "こころ", radicals: "Tâm (心)", tipImg: "Hình trái tim.", tipSoundOn: "**Shin**pai lo lắng.", tipSoundKun: "**Kokoro** tim.", words: [{w:"都心 (としん)", m:"Trung tâm"}, {w:"心 (こころ)", m:"Trái tim"}] },
            "濡": { hanviet: "NHU", mean: "Ướt", on: "ジュ", kun: "ぬ.れる", radicals: "Thủy (氵) + Nhu (需)", tipImg: "Nước (氵) làm nhu (需) cầu ẩm ướt.", tipSoundOn: "", tipSoundKun: "**Nu**reru ướt.", words: [{w:"濡れる (ぬれる)", m:"Ướt"}, {w:"濡らす (ぬらす)", m:"Làm ướt"}] },
            "迷": { hanviet: "MÊ", mean: "Lạc/Mê", on: "メイ", kun: "まよ.う", radicals: "Xước (⻌) + Mễ (米)", tipImg: "Gạo (米) làm người đi (⻌) lạc lối.", tipSoundOn: "**Mei**waku phiền hà.", tipSoundKun: "**Mayo**u lạc.", words: [{w:"迷う (まよう)", m:"Lạc đường"}] },
            "悩": { hanviet: "NÃO", mean: "Phiền não", on: "ノウ", kun: "なや.む", radicals: "Tâm (忄)", tipImg: "Tâm (忄) não nề.", tipSoundOn: "Ku**nou** khổ não.", tipSoundKun: "**Naya**mu phiền muộn.", words: [{w:"悩む (なやむ)", m:"Phiền não"}] },
            "慌": { hanviet: "HOẢNG", mean: "Vội vàng", on: "コウ", kun: "あわ.てる", radicals: "Tâm (忄) + Hoang (荒)", tipImg: "Tâm (忄) hoang (荒) mang vội vã.", tipSoundOn: "**Kou**kotsu hoảng hốt.", tipSoundKun: "**Awa**teru vội vàng.", words: [{w:"慌てる (あわてる)", m:"Vội vàng"}] },
            "覚": { hanviet: "GIÁC", mean: "Tỉnh/Nhớ", on: "カク", kun: "さ.める, さ.ます", radicals: "Kiến (見)", tipImg: "Nhìn sáng suốt.", tipSoundOn: "Kan**kaku** cảm giác.", tipSoundKun: "**Sa**meru tỉnh.", words: [{w:"覚める (さめる)", m:"Tỉnh giấc"}, {w:"覚ます (さます)", m:"Đánh thức"}] },
            "夜": { hanviet: "DẠ", mean: "Đêm", on: "ヤ", kun: "よる", radicals: "Tịch (夕)", tipImg: "Người đứng dưới mái nhà buổi đêm.", tipSoundOn: "**Ya**kan dạ quang.", tipSoundKun: "**Yoru** đêm.", words: [{w:"夜中 (よなか)", m:"Nửa đêm"}, {w:"夜 (よる)", m:"Buổi tối"}] },
            "緊": { hanviet: "KHẨN", mean: "Khẩn cấp", on: "キン", kun: "", radicals: "Mịch (糸) + Kiên (臣)", tipImg: "Dây (糸) buộc chặt bề tôi (臣) lại (又).", tipSoundOn: "**Kin**chou căng thẳng.", tipSoundKun: "", words: [{w:"緊張 (きんちょう)", m:"Căng thẳng"}, {w:"緊急 (きんきゅう)", m:"Khẩn cấp"}] },
            "張": { hanviet: "TRƯƠNG", mean: "Căng/Kéo", on: "チョウ", kun: "は.る", radicals: "Cung (弓) + Trường (長)", tipImg: "Cung dài căng ra.", tipSoundOn: "Kin**chou** căng thẳng.", tipSoundKun: "**Ha**ru căng.", words: [{w:"緊張 (きんちょう)", m:"Căng thẳng"}, {w:"張り紙 (はりがみ)", m:"Giấy dán"}] },
            "祈": { hanviet: "KỲ", mean: "Cầu nguyện", on: "キ", kun: "いの.る", radicals: "Kỳ (礻) + Cân (斤)", tipImg: "Thần đất cầm rìu cầu nguyện.", tipSoundOn: "**Ki**gan kỳ nguyện.", tipSoundKun: "**Ino**ru cầu.", words: [{w:"祈る (いのる)", m:"Cầu nguyện"}] },
            "祝": { hanviet: "CHÚC", mean: "Chúc mừng", on: "シュク", kun: "いわ.う", radicals: "Kỳ (礻) + Huynh (兄)", tipImg: "Anh trai (兄) cầu chúc thần (礻).", tipSoundOn: "**Shuku**jitsu ngày lễ.", tipSoundKun: "**Iwa**u chúc mừng.", words: [{w:"祝う (いわう)", m:"Chúc mừng"}] },
            "感": { hanviet: "CẢM", mean: "Cảm giác", on: "カン", kun: "かん.じる", radicals: "Tâm (心) + Hàm (咸)", tipImg: "Tâm (心) cảm động (咸).", tipSoundOn: "**Kan**dou cảm động.", tipSoundKun: "**Kan**jiru cảm thấy.", words: [{w:"感じる (かんじる)", m:"Cảm thấy"}] },
            "濃": { hanviet: "NÙNG", mean: "Đậm", on: "ノウ", kun: "こ.い", radicals: "Thủy (氵) + Nông (農)", tipImg: "Nước (氵) làm nông (農) đậm đà.", tipSoundOn: "**Nou**kou nồng hậu.", tipSoundKun: "**Koi** đậm.", words: [{w:"濃い (こい)", m:"Đậm"}] },
            "薄": { hanviet: "BẠC", mean: "Nhạt/Mỏng", on: "ハク", kun: "うす.い", radicals: "Thảo (艹)", tipImg: "Cỏ mọc mỏng.", tipSoundOn: "Haku**mei** bạc mệnh.", tipSoundKun: "**Usu**i nhạt.", words: [{w:"薄い (うすい)", m:"Nhạt/Mỏng"}] },
            "酸": { hanviet: "TOAN", mean: "Chua/Axit", on: "サン", kun: "す.っぱい", radicals: "Dậu (酉) + Tuấn (夋)", tipImg: "Rượu (酉) tuấn (夋) bị chua.", tipSoundOn: "**San**so oxy.", tipSoundKun: "**Su**ppai chua.", words: [{w:"酸っぱい (すっぱい)", m:"Chua"}] },
            "臭": { hanviet: "XÚ", mean: "Hôi", on: "シュウ", kun: "くさ.い", radicals: "Tự (自) + Khuyển (犬)", tipImg: "Tự mình ngửi thấy chó hôi.", tipSoundOn: "Aku**shuu** ác xú.", tipSoundKun: "**Kusa**i hôi.", words: [{w:"臭い (くさい)", m:"Hôi"}] },
            "可": { hanviet: "KHẢ", mean: "Có thể", on: "カ", kun: "", radicals: "Khẩu (口) + Đinh (丁)", tipImg: "Miệng nói đinh ninh là có thể.", tipSoundOn: "**Ka**nou khả năng.", tipSoundKun: "**O**kashii buồn cười.", words: [{w:"可笑しい (おかしい)", m:"Kỳ quặc"}, {w:"可能 (かのう)", m:"Khả năng"}] },
            "笑": { hanviet: "TIẾU", mean: "Cười", on: "ショウ", kun: "わら.う", radicals: "Trúc (竹) + Yểu (夭)", tipImg: "Trúc cười yểu điệu.", tipSoundOn: "Bi**shou** mỉm cười.", tipSoundKun: "**Wara**u cười.", words: [{w:"可笑しい (おかしい)", m:"Buồn cười"}] },
            "格": { hanviet: "CÁCH", mean: "Hạng/Cách", on: "カク", kun: "", radicals: "Mộc (木)", tipImg: "Cây mỗi loại một cách.", tipSoundOn: "**Kak**ko dáng vẻ.", tipSoundKun: "", words: [{w:"格好 (かっこう)", m:"Vẻ bề ngoài/Ngầu"}] },
            "好": { hanviet: "HẢO", mean: "Thích", on: "コウ", kun: "す.き", radicals: "Nữ (女) + Tử (子)", tipImg: "Mẹ thích con.", tipSoundOn: "**Kou**butsu món tủ.", tipSoundKun: "Kak**ko**ii ngầu.", words: [{w:"格好いい (かっこいい)", m:"Ngầu"}] },
            "旨": { hanviet: "CHỈ", mean: "Ngon", on: "シ", kun: "う ま.い", radicals: "Chỉ (匕) + Cam (甘)", tipImg: "Thìa múc đồ ngọt.", tipSoundOn: "Shu**shi** chủ ý.", tipSoundKun: "**Uma**i ngon/giỏi.", words: [{w:"旨い (うまい)", m:"Ngon/Giỏi"}] },
            "親": { hanviet: "THÂN", mean: "Thân", on: "シン", kun: "した.しい", radicals: "Kiến (見)", tipImg: "Đứng trên cây nhìn người thân.", tipSoundOn: "**Shin**setsu tốt bụng.", tipSoundKun: "**Shita**shii thân thiết.", words: [{w:"親しい (したしい)", m:"Thân thiết"}] },
            "詳": { hanviet: "TƯỜNG", mean: "Chi tiết", on: "ショウ", kun: "くわ.しい", radicals: "Ngôn (言) + Dương (羊)", tipImg: "Lời nói (言) về con dê (羊) chi tiết.", tipSoundOn: "**Shou**sai chi tiết.", tipSoundKun: "**Kuwa**shii tường tận.", words: [{w:"詳しい (くわしい)", m:"Chi tiết"}] },
            "細": { hanviet: "TẾ", mean: "Nhỏ", on: "サイ", kun: "こま.かい", radicals: "Mịch (糸)", tipImg: "Sợi chỉ nhỏ.", tipSoundOn: "Shou**sai** chi tiết.", tipSoundKun: "**Koma**kai nhỏ nhặt.", words: [{w:"細かい (こまかい)", m:"Chi tiết/Nhỏ"}] },
            "浅": { hanviet: "THIỂN", mean: "Nông", on: "セン", kun: "あさ.い", radicals: "Thủy (氵) + Tàn (戋)", tipImg: "Nước (氵) còn lại tàn (戋) dư là nông.", tipSoundOn: "**Sen**paku nông cạn.", tipSoundKun: "**Asa**i nông.", words: [{w:"浅い (あさい)", m:"Nông"}] },
            "硬": { hanviet: "NGẠNH", mean: "Cứng", on: "コウ", kun: "かた.い", radicals: "Thạch (石) + Canh (更)", tipImg: "Đá (石) canh (更) thật cứng.", tipSoundOn: "**Kou**ka tiền xu.", tipSoundKun: "**Kata**i cứng.", words: [{w:"硬い (かたい)", m:"Cứng"}] },
            "温": { hanviet: "ÔN", mean: "Ấm/Nguội", on: "オン", kun: "ぬる.い", radicals: "Thủy (氵)", tipImg: "Nước ấm.", tipSoundOn: "**On**do nhiệt độ.", tipSoundKun: "**Nuru**i nguội.", words: [{w:"温い (ぬるい)", m:"Nguội"}] },
            "眩": { hanviet: "HUYỄN", mean: "Chói", on: "ゲン", kun: "まぶ.しい", radicals: "Mục (目) + Huyền (玄)", tipImg: "Mắt (目) nhìn huyền (玄) ảo chói lóa.", tipSoundOn: "**Gen**waku mê hoặc.", tipSoundKun: "**Mabu**shii chói.", words: [{w:"眩しい (まぶしい)", m:"Chói"}] },
            "蒸": { hanviet: "CHƯNG", mean: "Hấp/Oi", on: "ジョウ", kun: "む.す", radicals: "Thảo (艹) + Thủy (水)", tipImg: "Nấu cỏ và nước bốc hơi.", tipSoundOn: "**Jou**hatsu bốc hơi.", tipSoundKun: "**Mu**shiatsui oi bức.", words: [{w:"蒸し暑い (むしあつい)", m:"Oi bức"}] },
            "潔": { hanviet: "KHIẾT", mean: "Sạch", on: "ケツ", kun: "", radicals: "Thủy (氵)", tipImg: "Nước sạch khiết.", tipSoundOn: "Sei**ketsu** sạch sẽ.", tipSoundKun: "", words: [{w:"清潔 (せいけつ)", m:"Sạch sẽ"}] },
            "清": { hanviet: "THANH", mean: "Thanh khiết", on: "セイ", kun: "", radicals: "Thủy (氵) + Thanh (青)", tipImg: "Nước (氵) xanh (青) thanh khiết.", tipSoundOn: "**Sei**ketsu sạch.", tipSoundKun: "", words: [{w:"清潔 (せいけつ)", m:"Sạch sẽ"}] },
            "鮮": { hanviet: "TIÊN", mean: "Tươi", on: "セン", kun: "", radicals: "Ngư (魚) + Dương (羊)", tipImg: "Cá (魚) và dê (羊) đều tươi.", tipSoundOn: "Shin**sen** tươi.", tipSoundKun: "", words: [{w:"新鮮 (しんせん)", m:"Tươi"}] },
            "豊": { hanviet: "PHONG", mean: "Phong phú", on: "ホウ", kun: "ゆた.か", radicals: "Đậu (豆)", tipImg: "Hạt đậu phong phú.", tipSoundOn: "**Hou**fu phong phú.", tipSoundKun: "**Yuta**ka giàu có.", words: [{w:"豊か (ゆたか)", m:"Giàu có"}] },
            "派": { hanviet: "PHÁI", mean: "Phái/Đẹp", on: "ハ", kun: "", radicals: "Thủy (氵)", tipImg: "Dòng nước chia phái.", tipSoundOn: "Rip**pa** tuyệt vời.", tipSoundKun: "", words: [{w:"立派 (りっぱ)", m:"Tuyệt vời"}] },
            "重": { hanviet: "TRỌNG", mean: "Nặng/Quan trọng", on: "ジュウ", kun: "", radicals: "Lý (里)", tipImg: "Ngàn ngôi làng rất nặng.", tipSoundOn: "**Juu**you quan trọng.", tipSoundKun: "", words: [{w:"重要 (じゅうよう)", m:"Quan trọng"}] },
            "必": { hanviet: "TẤT", mean: "Tất yếu/Cần", on: "ヒツ", kun: "", radicals: "Tâm (心)", tipImg: "Tâm bị gạch chéo là tất yếu.", tipSoundOn: "**Hitsu**you cần thiết.", tipSoundKun: "", words: [{w:"必要 (ひつよう)", m:"Cần thiết"}] },
            "勿": { hanviet: "VẬT", mean: "Chớ/Đừng", on: "モチ, ブツ", kun: "", radicals: "Bao (勹)", tipImg: "Bao bọc vật.", tipSoundOn: "**Mot**tainai lãng phí.", tipSoundKun: "", words: [{w:"勿体無い (もったいない)", m:"Lãng phí"}] },
            "凄": { hanviet: "THÊ", mean: "Ghê gớm", on: "セイ", kun: "すご.い", radicals: "Băng (冫) + Thê (妻)", tipImg: "Vợ (妻) lạnh lùng (冫) thật ghê gớm.", tipSoundOn: "**Sei**zetsu thê lương.", tipSoundKun: "**Sugo**i tuyệt/ghê.", words: [{w:"凄い (すごい)", m:"Tuyệt vời/Kinh khủng"}] },
            "酷": { hanviet: "KHỐC", mean: "Tàn khốc", on: "コク", kun: "ひど.い", radicals: "Dậu (酉) + Cáo (告)", tipImg: "Uống rượu (酉) rồi cáo (告) giác tàn khốc.", tipSoundOn: "Zan**koku** tàn khốc.", tipSoundKun: "**Hido**i tồi tệ.", words: [{w:"酷い (ひどい)", m:"Tồi tệ/Kinh khủng"}] }
        };

        // --- 4. APP LOGIC (Standard Day 1 Logic) ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
