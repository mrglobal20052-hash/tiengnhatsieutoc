<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 4: Địa điểm & Đồ vật</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 4: Địa điểm & Đồ vật</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">PLACE</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">スーパー</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">スーパー</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Siêu thị</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 4 (N5 - N3)</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (N5 - N3) ---
        const grammarRepo = {
            "de_place": { title: "Tại (Nơi chốn)", formula: "N(địa điểm) + で + V", desc: "N5: Hành động diễn ra tại địa điểm nào đó.", ex: "スーパーで買い物をします。" },
            "ni_iku": { title: "Đi để làm gì", formula: "V(bỏ masu)/N + に行く", desc: "N5: Đi đâu đó với mục đích cụ thể.", ex: "デパートへ靴を買いに行きます。" },
            "wo_kaimasu": { title: "Mua cái gì", formula: "N + を + 買う", desc: "N5: Hành động mua vật N.", ex: "新しいパソコンを買いました。" },
            "te_kudasai": { title: "Hãy làm gì", formula: "Vてください", desc: "N5: Yêu cầu lịch sự.", ex: "ここに名前を書いてください。" },
            "mashou": { title: "Cùng làm nhé", formula: "Vましょう", desc: "N5: Rủ rê, đề nghị.", ex: "公園へ行きましょう。" },
            "tai": { title: "Muốn làm", formula: "Vたい", desc: "N5: Mong muốn của bản thân.", ex: "冷たい水を飲みたいです。" },
            "te_iru": { title: "Đang/Trạng thái", formula: "Vている", desc: "N5/N4: Hành động đang diễn ra hoặc kết quả trạng thái (mặc quần áo, sống...).", ex: "眼鏡をかけています。" },
            "wa_doko": { title: "Ở đâu", formula: "N + は + どこですか", desc: "N5: Hỏi vị trí.", ex: "トイレはどこですか。" },
            "de_method": { title: "Bằng cách nào", formula: "N(phương tiện) + で", desc: "N5: Phương tiện, cách thức di chuyển/thực hiện.", ex: "バスで学校へ行きます。" },
            "adverb": { title: "Phó từ (Tính từ)", formula: "Adj(i)く / Adj(na)に + V", desc: "N5/N4: Biến tính từ thành phó từ bổ nghĩa cho động từ.", ex: "早く起きます。" },
            "tari_tari": { title: "Làm những việc như...", formula: "Vたり Vたり します", desc: "N4: Liệt kê hành động đại diện.", ex: "本を読んだり、テレビを見たりします。" },
            "ndesu": { title: "Giải thích/Nhấn mạnh", formula: "V/Adj + んです", desc: "N4: Giải thích lý do, tình huống hoặc nhấn mạnh sự quan tâm.", ex: "お腹が痛いんです。" },
            "te_kuru": { title: "Đi rồi về", formula: "Vてくる", desc: "N4: Đi làm gì đó rồi quay lại.", ex: "ちょっと行ってくる。" },
            "ga_aru": { title: "Có (sở hữu/tồn tại)", formula: "N + が ある", desc: "N5: Có đồ vật, sự việc.", ex: "時間があります。" },
            "nan_de": { title: "Tại sao/Bằng gì", formula: "何で", desc: "N5: Hỏi lý do hoặc phương tiện.", ex: "何で来ましたか。" },
            "sou_da": { title: "Có vẻ (Thị giác)", formula: "Adj(bỏ i/na) + そう", desc: "N4: Phỏng đoán dựa trên vẻ bề ngoài.", ex: "おいしそうです。" },
            "wa_desu": { title: "Cấu trúc định danh", formula: "N1 は N2 です", desc: "N5: N1 là N2.", ex: "これはペンです。" },
            "yori": { title: "So sánh hơn", formula: "N1 は N2 より Adj", desc: "N5: N1 tính chất hơn N2.", ex: "車は自転車より速いです。" },
            "shi_shi": { title: "Vừa...vừa... (Liệt kê)", formula: "～し、～し", desc: "N4: Liệt kê lý do, tính chất.", ex: "安くて、おいしいです。" },
            "ta_form": { title: "Quá khứ ngắn", formula: "Vた", desc: "N5: Dùng trong văn nói thân mật kể chuyện quá khứ.", ex: "昨日、映画見た？" },
            "te_mo": { title: "Cho dù/Cũng được", formula: "Vても", desc: "N4: Nhượng bộ hoặc cho phép.", ex: "食べてもいいです。" },
            "nagara": { title: "Vừa...vừa...", formula: "V(bỏ masu) + ながら", desc: "N4: Hai hành động song song.", ex: "歩きながら話す。" },
            "volitional": { title: "Thể ý định", formula: "Vよう", desc: "N4: Rủ rê thân mật.", ex: "帰ろう！" },
            "te_simau": { title: "Lỡ/Hoàn thành", formula: "Vてしまう", desc: "N4: Hối tiếc vì lỡ làm hoặc làm xong hết.", ex: "食べてしまった。" }
        };

        // --- 2. VOCABULARY DATA (Day 4: Places & Things) ---
        const vocabData = [
            { "STT": 1, "Kanji": "", "Nghĩa": "Siêu thị", "Furigana": "スーパー", "type": "place", "conv": { "polite": "スーパーで野菜を買います。", "pVi": "Tôi mua rau ở siêu thị.", "casual": "スーパーで野菜買う。", "cVi": "Mua rau ở siêu thị.", "gIds": ["de_place", "wo_kaimasu"] } },
            { "STT": 2, "Kanji": "", "Nghĩa": "Nhà hàng", "Furigana": "レストラン", "type": "place", "conv": { "polite": "いいレストランを知っていますか。", "pVi": "Bạn có biết nhà hàng nào ngon không?", "casual": "いいレストラン知ってる？", "cVi": "Biết quán nào ngon không?", "gIds": ["te_iru"] } },
            { "STT": 3, "Kanji": "店", "Nghĩa": "Cửa hàng", "Furigana": "みせ", "type": "place", "conv": { "polite": "あの店に入りましょう。", "pVi": "Chúng ta cùng vào cửa hàng kia đi.", "casual": "あの店入ろう。", "cVi": "Vào quán kia đi.", "gIds": ["mashou", "volitional"] } },
            { "STT": 4, "Kanji": "病院", "Nghĩa": "Bệnh viện", "Furigana": "びょういん", "type": "place", "conv": { "polite": "病気ですから、病院へ行きます。", "pVi": "Vì bị ốm nên tôi đi bệnh viện.", "casual": "病気だから、病院行く。", "cVi": "Ốm nên đi viện đây.", "gIds": ["ndesu"] } },
            { "STT": 5, "Kanji": "銀行", "Nghĩa": "Ngân hàng", "Furigana": "ぎんこう", "type": "place", "conv": { "polite": "銀行でお金を借ります。", "pVi": "Tôi vay tiền ở ngân hàng.", "casual": "銀行でお金借りる。", "cVi": "Vay tiền ngân hàng.", "gIds": ["de_place"] } },
            { "STT": 6, "Kanji": "交番", "Nghĩa": "Đồn cảnh sát", "Furigana": "こうばん", "type": "place", "conv": { "polite": "交番で道を聞きました。", "pVi": "Tôi đã hỏi đường ở đồn cảnh sát.", "casual": "交番で道聞いた。", "cVi": "Hỏi đường ở đồn cảnh sát rồi.", "gIds": ["de_place", "ta_form"] } },
            { "STT": 7, "Kanji": "美術館", "Nghĩa": "Bảo tàng mỹ thuật", "Furigana": "びじゅつかん", "type": "place", "conv": { "polite": "美術館へ絵を見に行きます。", "pVi": "Tôi đi bảo tàng để xem tranh.", "casual": "美術館へ絵を見に行く。", "cVi": "Đi bảo tàng xem tranh.", "gIds": ["ni_iku"] } },
            { "STT": 8, "Kanji": "図書館", "Nghĩa": "Thư viện", "Furigana": "としょかん", "type": "place", "conv": { "polite": "図書館で本を借ります。", "pVi": "Tôi mượn sách ở thư viện.", "casual": "図書館で本借りる。", "cVi": "Mượn sách thư viện.", "gIds": ["de_place"] } },
            { "STT": 9, "Kanji": "公園", "Nghĩa": "Công viên", "Furigana": "こうえん", "type": "place", "conv": { "polite": "公園を散歩しましょう。", "pVi": "Cùng đi dạo công viên nào.", "casual": "公園散歩しよう。", "cVi": "Đi dạo công viên đi.", "gIds": ["mashou", "volitional"] } },
            { "STT": 10, "Kanji": "映画館", "Nghĩa": "Rạp phim", "Furigana": "えいがかん", "type": "place", "conv": { "polite": "映画館で映画を見たいです。", "pVi": "Tôi muốn xem phim ở rạp.", "casual": "映画館で映画見たい。", "cVi": "Muốn ra rạp xem phim.", "gIds": ["tai", "de_place"] } },
            { "STT": 11, "Kanji": "庭", "Nghĩa": "Vườn", "Furigana": "にわ", "type": "place", "conv": { "polite": "庭に花があります。", "pVi": "Trong vườn có hoa.", "casual": "庭に花がある。", "cVi": "Trong vườn có hoa kìa.", "gIds": ["ga_aru"] } },
            { "STT": 12, "Kanji": "夏休み", "Nghĩa": "Kì nghỉ hè", "Furigana": "なつやすみ", "type": "time", "conv": { "polite": "夏休みはどこへ行きますか。", "pVi": "Nghỉ hè bạn sẽ đi đâu?", "casual": "夏休み、どこ行く？", "cVi": "Nghỉ hè đi đâu?", "gIds": ["wa_doko"] } },
            { "STT": 13, "Kanji": "〜階", "Nghĩa": "Tầng ~", "Furigana": "かい", "type": "noun", "conv": { "polite": "私の部屋は３階です。", "pVi": "Phòng tôi ở tầng 3.", "casual": "私の部屋、３階だよ。", "cVi": "Phòng tớ tầng 3.", "gIds": ["wa_desu"] } },
            { "STT": 14, "Kanji": "何階", "Nghĩa": "Tầng mấy?", "Furigana": "なんがい", "type": "noun", "conv": { "polite": "お部屋は何階ですか。", "pVi": "Phòng bạn ở tầng mấy?", "casual": "部屋、何階？", "cVi": "Phòng tầng mấy?", "gIds": ["wa_desu"] } },
            { "STT": 15, "Kanji": "電車", "Nghĩa": "Tàu điện", "Furigana": "でんしゃ", "type": "vehicle", "conv": { "polite": "電車で会社へ行きます。", "pVi": "Tôi đi đến công ty bằng tàu điện.", "casual": "電車で会社行く。", "cVi": "Đi làm bằng tàu.", "gIds": ["de_method"] } },
            { "STT": 16, "Kanji": "飛行機", "Nghĩa": "Máy bay", "Furigana": "ひこうき", "type": "vehicle", "conv": { "polite": "飛行機に乗ったことがありますか。", "pVi": "Bạn đã từng đi máy bay chưa?", "casual": "飛行機乗ったことある？", "cVi": "Đi máy bay bao giờ chưa?", "gIds": ["koto_ga_aru"] } },
            { "STT": 17, "Kanji": "自転車", "Nghĩa": "Xe đạp", "Furigana": "じてんしゃ", "type": "vehicle", "conv": { "polite": "自転車を修理しました。", "pVi": "Tôi đã sửa xe đạp.", "casual": "自転車直した。", "cVi": "Sửa xe đạp rồi.", "gIds": ["ta_form"] } },
            { "STT": 18, "Kanji": "自動車", "Nghĩa": "Ô tô", "Furigana": "じどうしゃ", "type": "vehicle", "conv": { "polite": "自動車を持っています。", "pVi": "Tôi có ô tô.", "casual": "自動車持ってる。", "cVi": "Có ô tô đấy.", "gIds": ["te_iru"] } },
            { "STT": 19, "Kanji": "", "Nghĩa": "Xe buýt", "Furigana": "バス", "type": "vehicle", "conv": { "polite": "バスがなかなか来ません。", "pVi": "Xe buýt mãi mà không tới.", "casual": "バス、なかなか来ないね。", "cVi": "Xe buýt mãi chả thấy tới.", "gIds": ["te_iru"] } },
            { "STT": 20, "Kanji": "歩いて", "Nghĩa": "Đi bộ", "Furigana": "あるいて", "type": "noun", "conv": { "polite": "歩いて帰ります。", "pVi": "Tôi đi bộ về.", "casual": "歩いて帰る。", "cVi": "Đi bộ về đây.", "gIds": ["de_method"] } },
            { "STT": 21, "Kanji": "紙", "Nghĩa": "Giấy", "Furigana": "かみ", "type": "noun", "conv": { "polite": "紙に書いてください。", "pVi": "Xin hãy viết vào giấy.", "casual": "紙に書いて。", "cVi": "Viết vào giấy đi.", "gIds": ["te_kudasai"] } },
            { "STT": 22, "Kanji": "絵", "Nghĩa": "Tranh", "Furigana": "え", "type": "noun", "conv": { "polite": "きれいな絵ですね。", "pVi": "Bức tranh đẹp nhỉ.", "casual": "きれいな絵だね。", "cVi": "Tranh đẹp thế.", "gIds": ["wa_desu"] } },
            { "STT": 23, "Kanji": "箸", "Nghĩa": "Đũa", "Furigana": "はし", "type": "noun", "conv": { "polite": "箸で食べます。", "pVi": "Tôi ăn bằng đũa.", "casual": "箸で食べる。", "cVi": "Ăn bằng đũa.", "gIds": ["de_method"] } },
            { "STT": 24, "Kanji": "", "Nghĩa": "Cái kéo", "Furigana": "はさみ", "type": "noun", "conv": { "polite": "はさみを貸してください。", "pVi": "Hãy cho tôi mượn cái kéo.", "casual": "はさみ貸して。", "cVi": "Cho mượn kéo đi.", "gIds": ["te_kudasai"] } },
            { "STT": 25, "Kanji": "", "Nghĩa": "Con dao", "Furigana": "ナイフ", "type": "noun", "conv": { "polite": "ナイフで切ります。", "pVi": "Cắt bằng dao.", "casual": "ナイフで切る。", "cVi": "Cắt bằng dao.", "gIds": ["de_method"] } },
            { "STT": 26, "Kanji": "鉛筆", "Nghĩa": "Bút chì", "Furigana": "えんぴつ", "type": "noun", "conv": { "polite": "鉛筆を使います。", "pVi": "Tôi dùng bút chì.", "casual": "鉛筆使う。", "cVi": "Dùng bút chì.", "gIds": ["wo_kaimasu"] } },
            { "STT": 27, "Kanji": "", "Nghĩa": "Bút chì kim", "Furigana": "シャープペンシル", "type": "noun", "conv": { "polite": "シャーペンを持っていますか。", "pVi": "Bạn có bút chì kim không?", "casual": "シャーペン持ってる？", "cVi": "Có bút chì kim không?", "gIds": ["te_iru"] } },
            { "STT": 28, "Kanji": "", "Nghĩa": "Bút bi", "Furigana": "ボールペン", "type": "noun", "conv": { "polite": "ボールペンで書いてもいいですか。", "pVi": "Viết bằng bút bi có được không?", "casual": "ボールペンで書いてもいい？", "cVi": "Viết bằng bút bi được không?", "gIds": ["te_mo"] } },
            { "STT": 29, "Kanji": "", "Nghĩa": "Laptop", "Furigana": "パソコン", "type": "noun", "conv": { "polite": "新しいパソコンを買いたいです。", "pVi": "Tôi muốn mua laptop mới.", "casual": "新しいパソコン買いたい。", "cVi": "Muốn mua lap mới.", "gIds": ["tai", "wo_kaimasu"] } },
            { "STT": 30, "Kanji": "", "Nghĩa": "Máy tính", "Furigana": "コンピューター", "type": "noun", "conv": { "polite": "コンピューターが壊れました。", "pVi": "Máy tính bị hỏng rồi.", "casual": "コンピューター壊れた。", "cVi": "Máy tính hỏng rồi.", "gIds": ["ta_form"] } },
            { "STT": 31, "Kanji": "切ります", "Nghĩa": "Cắt", "Furigana": "きります", "type": "verb", "conv": { "polite": "紙を切ってください。", "pVi": "Hãy cắt giấy.", "casual": "紙切って。", "cVi": "Cắt giấy đi.", "gIds": ["te_kudasai"] } },
            { "STT": 32, "Kanji": "食事します", "Nghĩa": "Dùng bữa", "Furigana": "しょくじします", "type": "verb", "conv": { "polite": "一緒に食事しませんか。", "pVi": "Cùng dùng bữa không?", "casual": "一緒に食事しない？", "cVi": "Ăn cùng không?", "gIds": ["mashou"] } },
            { "STT": 33, "Kanji": "", "Nghĩa": "Làm thế nào", "Furigana": "どうやって", "type": "q_word", "conv": { "polite": "どうやって行きますか。", "pVi": "Đi bằng cách nào?", "casual": "どうやって行く？", "cVi": "Đi kiểu gì?", "gIds": ["nan_de"] } },
            { "STT": 34, "Kanji": "", "Nghĩa": "Táo", "Furigana": "りんご", "type": "food", "conv": { "polite": "りんごを食べたいです。", "pVi": "Tôi muốn ăn táo.", "casual": "りんご食べたい。", "cVi": "Muốn ăn táo.", "gIds": ["tai"] } },
            { "STT": 35, "Kanji": "", "Nghĩa": "Cam", "Furigana": "オレンジ", "type": "food", "conv": { "polite": "オレンジジュースを飲みます。", "pVi": "Tôi uống nước cam.", "casual": "オレンジジュース飲む。", "cVi": "Uống nước cam.", "gIds": ["wo_kaimasu"] } },
            { "STT": 36, "Kanji": "", "Nghĩa": "Quýt", "Furigana": "みかん", "type": "food", "conv": { "polite": "みかんはおいしいです。", "pVi": "Quýt ngon.", "casual": "みかん、うまい。", "cVi": "Quýt ngon đấy.", "gIds": ["wa_desu"] } },
            { "STT": 37, "Kanji": "葉", "Nghĩa": "Lá cây", "Furigana": "は", "type": "noun", "conv": { "polite": "木の葉が落ちました。", "pVi": "Lá cây đã rụng.", "casual": "木の葉が落ちた。", "cVi": "Lá rụng rồi.", "gIds": ["ta_form"] } },
            { "STT": 38, "Kanji": "花", "Nghĩa": "Hoa", "Furigana": "はな", "type": "noun", "conv": { "polite": "花を見に行きます。", "pVi": "Tôi đi ngắm hoa.", "casual": "花見に行く。", "cVi": "Đi ngắm hoa.", "gIds": ["ni_iku"] } },
            { "STT": 39, "Kanji": "お酒", "Nghĩa": "Rượu", "Furigana": "おさけ", "type": "food", "conv": { "polite": "お酒を飲みすぎました。", "pVi": "Tôi đã uống quá nhiều rượu.", "casual": "お酒飲みすぎた。", "cVi": "Uống nhiều quá rồi.", "gIds": ["ta_form"] } },
            { "STT": 40, "Kanji": "", "Nghĩa": "Nước ép", "Furigana": "ジュース", "type": "food", "conv": { "polite": "ジュースをください。", "pVi": "Cho tôi nước ép.", "casual": "ジュースちょうだい。", "cVi": "Cho xin ít nước ép.", "gIds": ["te_kudasai"] } },
            { "STT": 41, "Kanji": "", "Nghĩa": "Coca cola", "Furigana": "コーラ", "type": "food", "conv": { "polite": "コーラが好きです。", "pVi": "Tôi thích Coca.", "casual": "コーラ好き。", "cVi": "Thích Coca.", "gIds": ["wa_desu"] } },
            { "STT": 42, "Kanji": "", "Nghĩa": "Sữa", "Furigana": "ミルク", "type": "food", "conv": { "polite": "コーヒーにミルクを入れますか。", "pVi": "Bạn có cho sữa vào cà phê không?", "casual": "コーヒーにミルク入れる？", "cVi": "Cho sữa vào cà phê không?", "gIds": ["wo_kaimasu"] } },
            { "STT": 43, "Kanji": "水泳", "Nghĩa": "Bơi lội", "Furigana": "すいえい", "type": "activity", "conv": { "polite": "水泳を習っています。", "pVi": "Tôi đang học bơi.", "casual": "水泳習ってる。", "cVi": "Đang học bơi.", "gIds": ["te_iru"] } },
            { "STT": 44, "Kanji": "絵本", "Nghĩa": "Sách tranh", "Furigana": "えほん", "type": "noun", "conv": { "polite": "子供に絵本を読みます。", "pVi": "Tôi đọc sách tranh cho con.", "casual": "子供に絵本読む。", "cVi": "Đọc sách tranh cho con.", "gIds": ["wo_kaimasu"] } },
            { "STT": 45, "Kanji": "漫画", "Nghĩa": "Truyện tranh", "Furigana": "まんが", "type": "noun", "conv": { "polite": "漫画を読むのが好きです。", "pVi": "Tôi thích đọc truyện tranh.", "casual": "漫画読むの好き。", "cVi": "Thích đọc truyện tranh.", "gIds": ["wa_desu"] } },
            { "STT": 46, "Kanji": "小説", "Nghĩa": "Tiểu thuyết", "Furigana": "しょうせつ", "type": "noun", "conv": { "polite": "面白い小説を読みました。", "pVi": "Tôi đã đọc một cuốn tiểu thuyết thú vị.", "casual": "面白い小説読んだ。", "cVi": "Đọc cuốn tiểu thuyết hay phết.", "gIds": ["ta_form"] } },
            { "STT": 47, "Kanji": "人参", "Nghĩa": "Cà rốt", "Furigana": "にんじん", "type": "food", "conv": { "polite": "人参が嫌いです。", "pVi": "Tôi ghét cà rốt.", "casual": "人参嫌い。", "cVi": "Ghét cà rốt.", "gIds": ["wa_desu"] } },
            { "STT": 48, "Kanji": "", "Nghĩa": "Khoai tây", "Furigana": "じゃがいも", "type": "food", "conv": { "polite": "じゃがいもで料理を作ります。", "pVi": "Tôi nấu ăn bằng khoai tây.", "casual": "じゃがいもで料理作る。", "cVi": "Nấu bằng khoai tây.", "gIds": ["de_method"] } },
            { "STT": 49, "Kanji": "果物", "Nghĩa": "Hoa quả", "Furigana": "くだもの", "type": "food", "conv": { "polite": "果物をたくさん食べました。", "pVi": "Tôi đã ăn rất nhiều hoa quả.", "casual": "果物たくさん食べた。", "cVi": "Ăn nhiều hoa quả rồi.", "gIds": ["ta_form"] } },
            { "STT": 50, "Kanji": "色々", "Nghĩa": "Nhiều loại", "Furigana": "いろいろ", "type": "adj_na", "conv": { "polite": "色々な国へ行きたいです。", "pVi": "Tôi muốn đi nhiều nước khác nhau.", "casual": "色々な国へ行きたい。", "cVi": "Muốn đi nhiều nước.", "gIds": ["tai"] } },
            { "STT": 51, "Kanji": "", "Nghĩa": "Áo thun", "Furigana": "Tシャツ", "type": "noun", "conv": { "polite": "Tシャツを着ています。", "pVi": "Tôi đang mặc áo thun.", "casual": "Tシャツ着てる。", "cVi": "Đang mặc áo thun.", "gIds": ["te_iru"] } },
            { "STT": 52, "Kanji": "", "Nghĩa": "Chân váy", "Furigana": "スカート", "type": "noun", "conv": { "polite": "赤いスカートを履いています。", "pVi": "Tôi đang mặc chân váy đỏ.", "casual": "赤いスカート履いてる。", "cVi": "Đang mặc váy đỏ.", "gIds": ["te_iru"] } },
            { "STT": 53, "Kanji": "", "Nghĩa": "Smartphone", "Furigana": "スマホ", "type": "noun", "conv": { "polite": "スマホで写真を撮ります。", "pVi": "Tôi chụp ảnh bằng smartphone.", "casual": "スマホで写真撮る。", "cVi": "Chụp ảnh bằng điện thoại.", "gIds": ["de_method"] } },
            { "STT": 54, "Kanji": "山", "Nghĩa": "Núi", "Furigana": "やま", "type": "place", "conv": { "polite": "山に登りたいです。", "pVi": "Tôi muốn leo núi.", "casual": "山に登りたい。", "cVi": "Muốn leo núi.", "gIds": ["tai"] } },
            { "STT": 55, "Kanji": "川", "Nghĩa": "Sông", "Furigana": "かわ", "type": "place", "conv": { "polite": "川で泳ぎます。", "pVi": "Tôi bơi ở sông.", "casual": "川で泳ぐ。", "cVi": "Bơi ở sông.", "gIds": ["de_place"] } },
            { "STT": 56, "Kanji": "森", "Nghĩa": "Rừng", "Furigana": "もり", "type": "place", "conv": { "polite": "森の中を歩きます。", "pVi": "Tôi đi bộ trong rừng.", "casual": "森の中歩く。", "cVi": "Đi bộ trong rừng.", "gIds": ["o_particle"] } },
            { "STT": 57, "Kanji": "海", "Nghĩa": "Biển", "Furigana": "うみ", "type": "place", "conv": { "polite": "海へ行こう。", "pVi": "Cùng đi biển nào.", "casual": "海行こう。", "cVi": "Đi biển đi.", "gIds": ["volitional"] } },
            { "STT": 58, "Kanji": "空", "Nghĩa": "Bầu trời", "Furigana": "そら", "type": "place", "conv": { "polite": "空が青いです。", "pVi": "Bầu trời xanh.", "casual": "空が青いね。", "cVi": "Trời xanh nhỉ.", "gIds": ["wa_desu"] } },
            { "STT": 59, "Kanji": "天気", "Nghĩa": "Thời tiết", "Furigana": "てんき", "type": "noun", "conv": { "polite": "今日はいい天気ですね。", "pVi": "Hôm nay thời tiết đẹp nhỉ.", "casual": "今日いい天気だね。", "cVi": "Nay trời đẹp ha.", "gIds": ["wa_desu"] } },
            { "STT": 60, "Kanji": "赤い", "Nghĩa": "Đỏ", "Furigana": "あかい", "type": "adj_i", "conv": { "polite": "赤い車が好きです。", "pVi": "Tôi thích xe màu đỏ.", "casual": "赤い車好き。", "cVi": "Thích xe đỏ.", "gIds": ["wa_desu"] } },
            { "STT": 61, "Kanji": "青い", "Nghĩa": "Xanh dương", "Furigana": "あおい", "type": "adj_i", "conv": { "polite": "海は青いです。", "pVi": "Biển màu xanh.", "casual": "海は青いね。", "cVi": "Biển xanh thật.", "gIds": ["wa_desu"] } },
            { "STT": 62, "Kanji": "緑", "Nghĩa": "Xanh lá", "Furigana": "みどり", "type": "noun", "conv": { "polite": "緑のシャツを買いました。", "pVi": "Tôi đã mua áo sơ mi xanh lá.", "casual": "緑のシャツ買った。", "cVi": "Mua áo xanh lá rồi.", "gIds": ["ta_form"] } },
            { "STT": 63, "Kanji": "黄色い", "Nghĩa": "Vàng", "Furigana": "きいろい", "type": "adj_i", "conv": { "polite": "黄色い花が咲きました。", "pVi": "Hoa vàng đã nở.", "casual": "黄色い花咲いた。", "cVi": "Hoa vàng nở rồi.", "gIds": ["ta_form"] } },
            { "STT": 64, "Kanji": "黒い", "Nghĩa": "Đen", "Furigana": "くろい", "type": "adj_i", "conv": { "polite": "黒い猫がいます。", "pVi": "Có con mèo đen.", "casual": "黒い猫いる。", "cVi": "Có con mèo đen kìa.", "gIds": ["ga_aru"] } },
            { "STT": 65, "Kanji": "白い", "Nghĩa": "Trắng", "Furigana": "しろい", "type": "adj_i", "conv": { "polite": "白い雲が浮かんでいます。", "pVi": "Mây trắng đang trôi.", "casual": "白い雲浮かんでる。", "cVi": "Mây trắng bay kìa.", "gIds": ["te_iru"] } },
            { "STT": 66, "Kanji": "", "Nghĩa": "Hồng", "Furigana": "ピンク", "type": "noun", "conv": { "polite": "ピンクのドレスが可愛いです。", "pVi": "Cái váy hồng dễ thương.", "casual": "ピンクのドレス可愛い。", "cVi": "Váy hồng cute thế.", "gIds": ["wa_desu"] } },
            { "STT": 67, "Kanji": "", "Nghĩa": "Đẹp/Sạch", "Furigana": "きれい", "type": "adj_na", "conv": { "polite": "部屋をきれいにします。", "pVi": "Tôi dọn phòng sạch sẽ.", "casual": "部屋きれいにする。", "cVi": "Dọn phòng cho sạch.", "gIds": ["adverb"] } },
            { "STT": 68, "Kanji": "色", "Nghĩa": "Màu sắc", "Furigana": "いろ", "type": "noun", "conv": { "polite": "どんな色が好きですか。", "pVi": "Bạn thích màu gì?", "casual": "どんな色好き？", "cVi": "Thích màu gì?", "gIds": ["wa_desu"] } },
            { "STT": 69, "Kanji": "町", "Nghĩa": "Thị trấn", "Furigana": "まち", "type": "place", "conv": { "polite": "この町は静かです。", "pVi": "Thị trấn này yên tĩnh.", "casual": "この町静かだね。", "cVi": "Thị trấn này yên tĩnh ha.", "gIds": ["wa_desu"] } },
            { "STT": 70, "Kanji": "明るい", "Nghĩa": "Sáng sủa", "Furigana": "あかるい", "type": "adj_i", "conv": { "polite": "明るい部屋がいいです。", "pVi": "Tôi thích phòng sáng sủa.", "casual": "明るい部屋がいい。", "cVi": "Thích phòng sáng.", "gIds": ["wa_desu"] } },
            { "STT": 71, "Kanji": "真面目", "Nghĩa": "Nghiêm túc", "Furigana": "まじめ", "type": "adj_na", "conv": { "polite": "彼は真面目な学生です。", "pVi": "Anh ấy là học sinh nghiêm túc.", "casual": "彼、真面目だね。", "cVi": "Hắn nghiêm túc ghê.", "gIds": ["wa_desu"] } },
            { "STT": 72, "Kanji": "熱心", "Nghĩa": "Nhiệt tình", "Furigana": "ねっしん", "type": "adj_na", "conv": { "polite": "熱心に勉強します。", "pVi": "Tôi học tập nhiệt tình.", "casual": "熱心に勉強してる。", "cVi": "Học hành chăm chỉ (nhiệt tình) đấy.", "gIds": ["adverb"] } },
            { "STT": 73, "Kanji": "細かい", "Nghĩa": "Chi tiết", "Furigana": "こまかい", "type": "adj_i", "conv": { "polite": "細かいお金がありません。", "pVi": "Tôi không có tiền lẻ.", "casual": "細かいお金ない。", "cVi": "Không có tiền lẻ.", "gIds": ["wa_desu"] } },
            { "STT": 74, "Kanji": "", "Nghĩa": "Ngầu", "Furigana": "かっこいい", "type": "adj_i", "conv": { "polite": "あの車はかっこいいですね。", "pVi": "Cái xe kia ngầu nhỉ.", "casual": "あの車かっこいい！", "cVi": "Xe kia ngầu vãi!", "gIds": ["wa_desu"] } },
            { "STT": 75, "Kanji": "多い", "Nghĩa": "Nhiều", "Furigana": "おおい", "type": "adj_i", "conv": { "polite": "人が多いですね。", "pVi": "Đông người nhỉ.", "casual": "人多いな。", "cVi": "Đông người thế.", "gIds": ["wa_desu"] } },
            { "STT": 76, "Kanji": "少ない", "Nghĩa": "Ít", "Furigana": "すくない", "type": "adj_i", "conv": { "polite": "給料が少ないです。", "pVi": "Lương thấp (ít).", "casual": "給料少ない。", "cVi": "Lương bèo bọt.", "gIds": ["wa_desu"] } },
            { "STT": 77, "Kanji": "背が高い", "Nghĩa": "Cao (dáng)", "Furigana": "せがたかい", "type": "adj_i", "conv": { "polite": "彼は背が高いです。", "pVi": "Anh ấy cao.", "casual": "彼、背高いね。", "cVi": "Anh ấy cao thật.", "gIds": ["wa_desu"] } },
            { "STT": 78, "Kanji": "", "Nghĩa": "Náo nhiệt", "Furigana": "にぎやか", "type": "adj_na", "conv": { "polite": "お祭りはにぎやかでした。", "pVi": "Lễ hội rất náo nhiệt.", "casual": "お祭り、にぎやかだった。", "cVi": "Lễ hội đông vui phết.", "gIds": ["ta_form"] } },
            { "STT": 79, "Kanji": "静か", "Nghĩa": "Yên tĩnh", "Furigana": "しずか", "type": "adj_na", "conv": { "polite": "図書館は静かです。", "pVi": "Thư viện yên tĩnh.", "casual": "ここ、静かだね。", "cVi": "Chỗ này yên tĩnh ha.", "gIds": ["wa_desu"] } },
            { "STT": 80, "Kanji": "簡単", "Nghĩa": "Đơn giản", "Furigana": "かんたん", "type": "adj_na", "conv": { "polite": "この料理は簡単です。", "pVi": "Món này đơn giản.", "casual": "これ、簡単だよ。", "cVi": "Cái này dễ ợt.", "gIds": ["wa_desu"] } },
            { "STT": 81, "Kanji": "冷たい", "Nghĩa": "Lạnh (cảm giác)", "Furigana": "つめたい", "type": "adj_i", "conv": { "polite": "冷たい水を飲みます。", "pVi": "Tôi uống nước lạnh.", "casual": "冷たい水飲む。", "cVi": "Uống nước lạnh.", "gIds": ["wo_kaimasu"] } },
            { "STT": 82, "Kanji": "温かい", "Nghĩa": "Ấm (cảm giác)", "Furigana": "あたたかい", "type": "adj_i", "conv": { "polite": "温かいスープを飲みましょう。", "pVi": "Cùng uống súp ấm nào.", "casual": "温かいスープ飲もう。", "cVi": "Uống súp nóng đi.", "gIds": ["mashou"] } },
            { "STT": 83, "Kanji": "甘い", "Nghĩa": "Ngọt", "Furigana": "あまい", "type": "adj_i", "conv": { "polite": "このケーキは甘いです。", "pVi": "Cái bánh này ngọt.", "casual": "これ甘すぎ。", "cVi": "Cái này ngọt quá.", "gIds": ["wa_desu"] } },
            { "STT": 84, "Kanji": "辛い", "Nghĩa": "Cay", "Furigana": "からい", "type": "adj_i", "conv": { "polite": "辛いカレーが好きです。", "pVi": "Tôi thích cà ri cay.", "casual": "辛いカレー好き。", "cVi": "Thích cà ri cay.", "gIds": ["wa_desu"] } },
            { "STT": 85, "Kanji": "", "Nghĩa": "Chua", "Furigana": "すっぱい", "type": "adj_i", "conv": { "polite": "レモンはすっぱいです。", "pVi": "Chanh chua.", "casual": "レモンすっぱい！", "cVi": "Chanh chua quá!", "gIds": ["wa_desu"] } },
            { "STT": 86, "Kanji": "塩辛い", "Nghĩa": "Mặn", "Furigana": "しおからい", "type": "adj_i", "conv": { "polite": "スープが少し塩辛いです。", "pVi": "Súp hơi mặn.", "casual": "スープ、ちょっと塩辛い。", "cVi": "Súp hơi mặn.", "gIds": ["wa_desu"] } },
            { "STT": 87, "Kanji": "早い", "Nghĩa": "Sớm/Nhanh", "Furigana": "はやい", "type": "adj_i", "conv": { "polite": "早く起きます。", "pVi": "Tôi dậy sớm.", "casual": "早く起きる。", "cVi": "Dậy sớm.", "gIds": ["adverb"] } }
        ];

        const kanjiDetails = {
            "店": { hanviet: "ĐIẾM", mean: "Cửa hàng", on: "テン", kun: "みせ", radicals: "Nghiễm (广) + Chiếm (占)", tipImg: "Trong nhà (广) xem bói (占) để mở quán.", tipSound: "**Ten** (mười) cửa tiệm bán **mì xé** (mise).", words: [{w:"店 (みせ)", m:"Cửa hàng"}, {w:"店員 (てんいん)", m:"Nhân viên"}] },
            "病": { hanviet: "BỆNH", mean: "Ốm", on: "ビョウ", kun: "や.む", radicals: "Nạch (疒) + Bính (丙)", tipImg: "Người ốm nằm trên giường (疒) trong nhà (丙).", tipSound: "**Byou** bị bệnh khiến **ya** (da) dẻ xanh xao.", words: [{w:"病院 (びょういん)", m:"Bệnh viện"}, {w:"病気 (びょうき)", m:"Ốm"}] },
            "院": { hanviet: "VIỆN", mean: "Viện", on: "イン", kun: "", radicals: "Phụ (阝) + Hoàn (完)", tipImg: "Gò đất (阝) có mái nhà (宀) hoàn hảo (元).", tipSound: "**In** ấn giấy tờ trong viện.", words: [{w:"病院 (びょういん)", m:"Bệnh viện"}, {w:"入院 (にゅういん)", m:"Nhập viện"}] },
            "銀": { hanviet: "NGÂN", mean: "Bạc", on: "ギン", kun: "", radicals: "Kim (金) + Cấn (艮)", tipImg: "Kim loại (金) tốt (艮) là bạc.", tipSound: "**Gin** giữ bạc trong ngân hàng.", words: [{w:"銀行 (ぎんこう)", m:"Ngân hàng"}, {w:"水銀 (すいぎん)", m:"Thủy ngân"}] },
            "行": { hanviet: "HÀNH", mean: "Đi", on: "コウ", kun: "い.く", radicals: "Hành (行)", tipImg: "Bước chân đi.", tipSound: "Giao thông (**Kou**) tắc nghẽn nên phải **i** (đi) bộ.", words: [{w:"銀行 (ぎんこう)", m:"Ngân hàng"}, {w:"行きます (いきます)", m:"Đi"}] },
            "交": { hanviet: "GIAO", mean: "Giao nhau", on: "コウ", kun: "まじ.わる", radicals: "Đầu (亠) + Phụ (父)", tipImg: "Cha (父) đội nón đi giao lưu.", tipSound: "**Maji** (mà gì) giao thông (**Kou**) rắc rối thế.", words: [{w:"交番 (こうばん)", m:"Đồn cảnh sát"}, {w:"交通 (こうつう)", m:"Giao thông"}] },
            "番": { hanviet: "PHIÊN", mean: "Số, lượt", on: "バン", kun: "", radicals: "Biện (釆) + Điền (田)", tipImg: "Gạo (米) trên ruộng (田) được đánh số.", tipSound: "**Ban** ngày đánh số thứ tự.", words: [{w:"交番 (こうばん)", m:"Đồn cảnh sát"}, {w:"番号 (ばんごう)", m:"Số hiệu"}] },
            "美": { hanviet: "MỸ", mean: "Đẹp", on: "ビ", kun: "うつく.しい", radicals: "Dương (⺶) + Đại (大)", tipImg: "Con Dê (⺶) To (大) là đẹp.", tipSound: "**Utsu** (ú ụ) mà vẫn **bi** (bị) khen đẹp.", words: [{w:"美術館 (びじゅつかん)", m:"Bảo tàng mỹ thuật"}, {w:"美人 (びじん)", m:"Người đẹp"}] },
            "術": { hanviet: "THUẬT", mean: "Kỹ thuật", on: "ジュツ", kun: "", radicals: "Hành (行) + Thuật (朮)", tipImg: "Đi (彳) đường trồng cây (朮) là nghệ thuật.", tipSound: "**Jutsu** (nhẫn thuật) là kỹ thuật.", words: [{w:"美術館 (びじゅつかん)", m:"Bảo tàng"}, {w:"技術 (ぎじゅつ)", m:"Kỹ thuật"}] },
            "館": { hanviet: "QUÁN", mean: "Tòa nhà", on: "カン", kun: "やかた", radicals: "Thực (食) + Quan (官)", tipImg: "Nơi ăn uống (食) của quan (官) lại.", tipSound: "**Yakata** (nhà ca tá) mở **kan** (quán) ăn.", words: [{w:"美術館 (びじゅつかん)", m:"Bảo tàng"}, {w:"図書館 (としょかん)", m:"Thư viện"}] },
            "図": { hanviet: "ĐỒ", mean: "Bản đồ", on: "ズ, ト", kun: "はか.る", radicals: "Vi (囗)", tipImg: "Bản đồ trong khung.", tipSound: "**Haka** (hạ cả) bản đồ (**Zu**) xuống.", words: [{w:"図書館 (としょかん)", m:"Thư viện"}, {w:"地図 (ちず)", m:"Bản đồ"}] },
            "書": { hanviet: "THƯ", mean: "Viết", on: "ショ", kun: "か.く", radicals: "Duật (聿) + Nhật (日)", tipImg: "Tay cầm bút viết.", tipSound: "**Ka** (ca) hát hay viết thư (**Sho**) đều giỏi.", words: [{w:"図書館 (としょかん)", m:"Thư viện"}, {w:"辞書 (じしょ)", m:"Từ điển"}] },
            "公": { hanviet: "CÔNG", mean: "Công cộng", on: "コウ", kun: "おおやけ", radicals: "Bát (八) + Tư (厶)", tipImg: "Bát (八) riêng tư (ム) chia cho công chúng.", tipSound: "**Ooyake** (ô da kê) công viên (**Kou**) rộng quá.", words: [{w:"公園 (こうえん)", m:"Công viên"}, {w:"公務員 (こうむいん)", m:"Công chức"}] },
            "園": { hanviet: "VIÊN", mean: "Vườn", on: "エン", kun: "その", radicals: "Vi (囗) + Viên (袁)", tipImg: "Vùng đất (口) xa (袁) làm vườn.", tipSound: "**Sono** (xô nó) ra công viên (**En**).", words: [{w:"公園 (こうえん)", m:"Công viên"}, {w:"動物園 (どうぶつえん)", m:"Sở thú"}] },
            "映": { hanviet: "ÁNH", mean: "Chiếu", on: "エイ", kun: "うつ.る", radicals: "Nhật (日) + Ương (央)", tipImg: "Mặt trời (日) chiếu ở trung ương (央).", tipSound: "**Utsu** (ú ụ) xem phim điện ảnh (**Ei**ga).", words: [{w:"映画 (えいが)", m:"Phim"}, {w:"上映 (じょうえい)", m:"Trình chiếu"}] },
            "画": { hanviet: "HỌA", mean: "Tranh", on: "ガ, カク", kun: "", radicals: "Điền (田)", tipImg: "Ruộng (田) vẽ trong khung.", tipSound: "**Ga** (gà) cũng biết vẽ họa.", words: [{w:"映画館 (えいがかん)", m:"Rạp phim"}, {w:"計画 (けいかく)", m:"Kế hoạch"}] },
            "庭": { hanviet: "ĐÌNH", mean: "Sân vườn", on: "テイ", kun: "にわ", radicals: "Nghiễm (广) + Đình (廷)", tipImg: "Trong nhà (广) có sân đình (廷).", tipSound: "**Niwa** (nỉ hoa) mọc ở sân đình (**Tei**).", words: [{w:"庭 (にわ)", m:"Vườn"}, {w:"校庭 (こうてい)", m:"Sân trường"}] },
            "夏": { hanviet: "HẠ", mean: "Mùa hè", on: "カ", kun: "なつ", radicals: "Hạ (夂)", tipImg: "Trăm (百) người đi lại (夂) trong mùa hè.", tipSound: "**Natsu** (nát sự) mùa hè oi bức (**Ka**).", words: [{w:"夏休み (なつやすみ)", m:"Nghỉ hè"}, {w:"夏 (なつ)", m:"Mùa hè"}] },
            "休": { hanviet: "HƯU", mean: "Nghỉ", on: "キュウ", kun: "やす.む", radicals: "Nhân (亻) + Mộc (木)", tipImg: "Người (亻) dựa cây (木) nghỉ.", tipSound: "**Yasu** (da su) nghỉ hưu (**Kyuu**) rồi.", words: [{w:"夏休み (なつやすみ)", m:"Nghỉ hè"}, {w:"休日 (きゅうじつ)", m:"Ngày nghỉ"}] },
            "階": { hanviet: "GIAI", mean: "Tầng", on: "カイ", kun: "", radicals: "Phụ (阝) + Giai (皆)", tipImg: "Gò đất (阝) đều (皆) các tầng.", tipSound: "**Kai** (cai) quản các tầng.", words: [{w:"〜階 (かい)", m:"Tầng"}, {w:"階段 (かいだん)", m:"Cầu thang"}] },
            "電": { hanviet: "ĐIỆN", mean: "Điện", on: "デン", kun: "", radicals: "Vũ (雨)", tipImg: "Mưa (雨) có sét là điện.", tipSound: "**Den** (đen) thui vì mất điện.", words: [{w:"電車 (でんしゃ)", m:"Tàu điện"}, {w:"電話 (でんわ)", m:"Điện thoại"}] },
            "車": { hanviet: "XA", mean: "Xe", on: "シャ", kun: "くるま", radicals: "Xa (車)", tipImg: "Hình cái xe kéo.", tipSound: "**Kuruma** (cu rù mà) lái xe (**Sha**) hơi.", words: [{w:"電車 (でんしゃ)", m:"Tàu điện"}, {w:"自動車 (じどうしゃ)", m:"Ô tô"}] },
            "飛": { hanviet: "PHI", mean: "Bay", on: "ヒ", kun: "と.ぶ", radicals: "Phi (飛)", tipImg: "Con chim đang bay lên.", tipSound: "**To** (tô) màu máy bay phi (**Hi**) hành.", words: [{w:"飛行機 (ひこうき)", m:"Máy bay"}, {w:"飛ばす (とばす)", m:"Làm cho bay"}] },
            "機": { hanviet: "CƠ", mean: "Máy móc", on: "キ", kun: "はた", radicals: "Mộc (木) + Cơ (幾)", tipImg: "Cây (木) bên cạnh mấy (幾) cái máy.", tipSound: "**Hata** (hả ta) cái máy cơ khí (**Ki**) này lạ quá.", words: [{w:"飛行機 (ひこうき)", m:"Máy bay"}, {w:"機械 (きかい)", m:"Cơ khí"}] },
            "自": { hanviet: "TỰ", mean: "Tự mình", on: "ジ", kun: "みずか.ら", radicals: "Tự (自)", tipImg: "Mắt (目) có cái phẩy là tự.", tipSound: "**Mizuka** (mì dư cả) tự (**Ji**) mình ăn hết.", words: [{w:"自転車 (じてんしゃ)", m:"Xe đạp"}, {w:"自分 (じぶん)", m:"Bản thân"}] },
            "転": { hanviet: "CHUYỂN", mean: "Lăn", on: "テン", kun: "ころ.ぶ", radicals: "Xa (車) + Vân (云)", tipImg: "Xe (車) chở mây (云) chuyển động.", tipSound: "**Koro** (cô rô) bốt chuyển (**Ten**) động lăn tròn.", words: [{w:"自転車 (じてんしゃ)", m:"Xe đạp"}, {w:"運転 (うんてん)", m:"Lái xe"}] },
            "動": { hanviet: "ĐỘNG", mean: "Chuyển động", on: "ドウ", kun: "うご.く", radicals: "Lực (力) + Trọng (重)", tipImg: "Dùng sức (力) làm trọng (重) lượng di chuyển.", tipSound: "**Ugo** (ư gồ) lên xe chuyển động (**Dou**).", words: [{w:"自動車 (じどうしゃ)", m:"Ô tô"}, {w:"動物 (どうぶつ)", m:"Động vật"}] },
            "紙": { hanviet: "CHỈ", mean: "Giấy", on: "シ", kun: "かみ", radicals: "Mịch (糸) + Thị (氏)", tipImg: "Sợi chỉ (糸) làm thành giấy thị (氏).", tipSound: "**Kami** (ca mì) gói trong giấy chỉ (**Shi**).", words: [{w:"紙 (かみ)", m:"Giấy"}, {w:"手紙 (てがみ)", m:"Thư"}] },
            "絵": { hanviet: "HỘI", mean: "Tranh", on: "カイ", kun: "え", radicals: "Mịch (糸) + Hội (会)", tipImg: "Sợi chỉ (糸) hội (会) tụ thành tranh.", tipSound: "**E** (ê) nhìn bức tranh hội (**Kai**) họa kìa.", words: [{w:"絵 (え)", m:"Tranh"}, {w:"絵本 (えほん)", m:"Sách tranh"}] },
            "箸": { hanviet: "TRỨ", mean: "Đũa", on: "チョ", kun: "はし", radicals: "Trúc (竹) + Giả (者)", tipImg: "Trúc (竹) làm giả (者) đũa.", tipSound: "**Hashi** (hà sĩ) dùng đũa trứ (**Cho**) danh.", words: [{w:"箸 (はし)", m:"Đũa"}] },
            "切": { hanviet: "THIẾT", mean: "Cắt", on: "セツ", kun: "き.る", radicals: "Đao (刀) + Thất (七)", tipImg: "Bảy (七) con dao (刀) cắt.", tipSound: "**Ki** (kìa) thiết (**Setsu**) bị cắt đứt.", words: [{w:"切ります (きります)", m:"Cắt"}, {w:"親切 (しんせつ)", m:"Thân thiện"}] },
            "食": { hanviet: "THỰC", mean: "Ăn", on: "ショク", kun: "た.べる", radicals: "Thực (食)", tipImg: "Người tốt (艮) che mũ (人) ăn.", tipSound: "**Tabe** (ta bế) đi ăn thực (**Shoku**) phẩm.", words: [{w:"食事 (しょくじ)", m:"Bữa ăn"}, {w:"食べ物 (たべもの)", m:"Đồ ăn"}] },
            "事": { hanviet: "SỰ", mean: "Việc", on: "ジ", kun: "こと", radicals: "Quyết (亅)", tipImg: "Một (一) cái miệng (口) nói chuyện sử (史) sách.", tipSound: "**Koto** (cô tô) kể sự (**Ji**) việc.", words: [{w:"食事 (しょくじ)", m:"Bữa ăn"}, {w:"仕事 (しごと)", m:"Công việc"}] },
            "葉": { hanviet: "DIỆP", mean: "Lá", on: "ヨウ", kun: "は", radicals: "Thảo (艹)", tipImg: "Cỏ (艹) thế (世) gian là lá cây (木).", tipSound: "**Ha** (hả) cái lá diệp (**You**) lục này á?", words: [{w:"葉 (は)", m:"Lá cây"}, {w:"言葉 (ことば)", m:"Từ vựng"}] },
            "花": { hanviet: "HOA", mean: "Hoa", on: "カ", kun: "はな", radicals: "Thảo (艹) + Hóa (化)", tipImg: "Cỏ (艹) hóa (化) thành hoa.", tipSound: "**Hana** (ha na) là đóa hoa (**Ka**) đẹp.", words: [{w:"花 (はな)", m:"Hoa"}, {w:"花見 (はなみ)", m:"Ngắm hoa"}] },
            "酒": { hanviet: "TỬU", mean: "Rượu", on: "シュ", kun: "さけ", radicals: "Thủy (氵) + Dậu (酉)", tipImg: "Nước (氵) ủ trong bình dậu (酉) là rượu.", tipSound: "**Sake** (sa kê) là tửu (**Shu**) lầu.", words: [{w:"お酒 (おさけ)", m:"Rượu"}, {w:"日本酒 (にほんしゅ)", m:"Rượu Nhật"}] },
            "泳": { hanviet: "VỊNH", mean: "Bơi", on: "エイ", kun: "およ.ぐ", radicals: "Thủy (氵) + Vĩnh (永)", tipImg: "Nước (氵) chảy vĩnh (永) cửu.", tipSound: "**Oyo** (ô dô) bơi vịnh (**Ei**).", words: [{w:"水泳 (すいえい)", m:"Bơi lội"}, {w:"泳ぐ (およぐ)", m:"Bơi"}] },
            "本": { hanviet: "BẢN", mean: "Sách", on: "ホン", kun: "もと", radicals: "Mộc (木)", tipImg: "Gốc cây (木) đánh dấu.", tipSound: "**Moto** (mô tô) chở bản (**Hon**) sách.", words: [{w:"絵本 (えほん)", m:"Sách tranh"}, {w:"本 (ほん)", m:"Sách"}] },
            "漫": { hanviet: "MẠN", mean: "Tản mạn", on: "マン", kun: "", radicals: "Thủy (氵)", tipImg: "Nước (氵) tràn lên mắt (目) và tay (又).", tipSound: "**Man** (man) mác tản mạn.", words: [{w:"漫画 (まんが)", m:"Truyện tranh"}, {w:"散漫 (さんまん)", m:"Tản mạn"}] },
            "説": { hanviet: "THUYẾT", mean: "Giải thích", on: "セツ", kun: "と.く", radicals: "Ngôn (言) + Đoài (兌)", tipImg: "Lời nói (言) của anh trai (兄) là thuyết giáo (丷).", tipSound: "**To** (tô) vẽ lời giải thuyết (**Setsu**).", words: [{w:"小説 (しょうせつ)", m:"Tiểu thuyết"}, {w:"説明 (せつめい)", m:"Giải thích"}] },
            "人": { hanviet: "NHÂN", mean: "Người", on: "ジン", kun: "ひと", radicals: "Nhân (人)", tipImg: "Người đi.", tipSound: "**Hito** (hi to) là nhân (**Jin**) vật lớn.", words: [{w:"人参 (にんじん)", m:"Cà rốt"}, {w:"日本人 (にほんじん)", m:"Người Nhật"}] },
            "参": { hanviet: "THAM", mean: "Tham gia", on: "サン", kun: "まい.る", radicals: "ư (厶)", tipImg: "Ba (三) người to (大) tham gia.", tipSound: "**Mai** (mai) đi tham (**San**) gia nhé.", words: [{w:"人参 (にんじん)", m:"Cà rốt"}, {w:"参考 (さんこう)", m:"Tham khảo"}] },
            "果": { hanviet: "QUẢ", mean: "Quả", on: "カ", kun: "は.たす", radicals: "Mộc (木)", tipImg: "Cây (木) ra quả trên ruộng (田).", tipSound: "**Ha** (hả) kết quả (**Ka**) là vậy sao.", words: [{w:"果物 (くだもの)", m:"Hoa quả"}, {w:"結果 (けっか)", m:"Kết quả"}] },
            "物": { hanviet: "VẬT", mean: "Đồ vật", on: "ブツ", kun: "もの", radicals: "Ngưu (牛) + Vật (勿)", tipImg: "Con bò (牛) chê không (勿) phải đồ vật.", tipSound: "**Mono** (mô nô) là vật (**Butsu**) chất.", words: [{w:"果物 (くだもの)", m:"Hoa quả"}, {w:"買い物 (かいもの)", m:"Mua sắm"}] },
            "色": { hanviet: "SẮC", mean: "Màu", on: "ショク", kun: "いろ", radicals: "Sắc (色)", tipImg: "Màu sắc cái đuôi (巴).", tipSound: "**Iro** (y rô) màu sắc (**Shoku**) sặc sỡ.", words: [{w:"色 (いろ)", m:"Màu sắc"}, {w:"色々 (いろいろ)", m:"Nhiều loại"}] },
            "町": { hanviet: "ĐINH", mean: "Thị trấn", on: "チョウ", kun: "まち", radicals: "Điền (田) + Đinh (丁)", tipImg: "Ruộng (田) có đinh (丁) là thị trấn.", tipSound: "**Machi** (mà chi) cái đinh (**Chou**) này.", words: [{w:"町 (まち)", m:"Thị trấn"}, {w:"町長 (ちょうちょう)", m:"Thị trưởng"}] },
            "明": { hanviet: "MINH", mean: "Sáng", on: "メイ", kun: "あか.るい", radicals: "Nhật (日) + Nguyệt (月)", tipImg: "Nhật (日) Nguyệt (月) chiếu sáng.", tipSound: "**Aka** (a ca) minh (**Mei**) tinh tỏa sáng.", words: [{w:"明るい (あかるい)", m:"Sáng sủa"}, {w:"明日 (あした)", m:"Ngày mai"}] },
            "真": { hanviet: "CHÂN", mean: "Thật", on: "シン", kun: "ま", radicals: "Mục (目)", tipImg: "Mười (十) con mắt (目) nhìn chân thật.", tipSound: "**Ma** (ma) quỷ chân (**Shin**) thật.", words: [{w:"真面目 (まじめ)", m:"Nghiêm túc"}, {w:"写真 (しゃしん)", m:"Ảnh"}] },
            "面": { hanviet: "DIỆN", mean: "Mặt", on: "メン", kun: "おも", radicals: "Diện (面)", tipImg: "Mặt trong khung.", tipSound: "**Omo** (ô mô) diện (**Men**) mạo sáng ngời.", words: [{w:"真面目 (まじめ)", m:"Nghiêm túc"}, {w:"画面 (がめん)", m:"Màn hình"}] },
            "目": { hanviet: "MỤC", mean: "Mắt", on: "モク", kun: "め", radicals: "Mục (目)", tipImg: "Hình con mắt.", tipSound: "**Me** (mẹ) nhìn mục (**Moku**) lục.", words: [{w:"真面目 (まじめ)", m:"Nghiêm túc"}, {w:"目 (め)", m:"Mắt"}] },
            "熱": { hanviet: "NHIỆT", mean: "Nóng", on: "ネツ", kun: "あつ.い", radicals: "Hỏa (灬)", tipImg: "Thế lực (丸) đốt lửa (灬) rất nóng.", tipSound: "**Atsu** (a tự) mình thấy nhiệt (**Netsu**).", words: [{w:"熱心 (ねっしん)", m:"Nhiệt tình"}, {w:"熱 (ねつ)", m:"Sốt"}] },
            "心": { hanviet: "TÂM", mean: "Tim", on: "シン", kun: "こころ", radicals: "Tâm (心)", tipImg: "Hình trái tim.", tipSound: "**Kokoro** (cô cô rô) có tâm (**Shin**) hồn đẹp.", words: [{w:"熱心 (ねっしん)", m:"Nhiệt tình"}, {w:"心配 (しんぱい)", m:"Lo lắng"}] },
            "細": { hanviet: "TẾ", mean: "Nhỏ, chi tiết", on: "サイ", kun: "こま.かい", radicals: "Mịch (糸) + Điền (田)", tipImg: "Sợi chỉ (糸) trên ruộng (田) rất nhỏ.", tipSound: "**Koma** (cô mà) tinh tế (**Sai**) thế.", words: [{w:"細かい (こまかい)", m:"Chi tiết"}, {w:"細い (ほそい)", m:"Gầy"}] },
            "多": { hanviet: "ĐA", mean: "Nhiều", on: "タ", kun: "おお.い", radicals: "Tịch (夕)", tipImg: "Hai buổi tối (夕) là nhiều.", tipSound: "**Oo** (ô) đa (**Ta**) số là nhiều.", words: [{w:"多い (おおい)", m:"Nhiều"}, {w:"多忙 (たぼう)", m:"Rất bận"}] },
            "少": { hanviet: "THIỂU", mean: "Ít", on: "ショウ", kun: "すく.ない", radicals: "Tiểu (小)", tipImg: "Nhỏ (小) thêm một phẩy là ít.", tipSound: "**Suku** (su cu) thiểu (**Shou**) năng à.", words: [{w:"少ない (すくない)", m:"Ít"}, {w:"少し (すこし)", m:"Một chút"}] },
            "背": { hanviet: "BỐI", mean: "Lưng", on: "ハイ", kun: "せ", radicals: "Nhục (月) + Bắc (北)", tipImg: "Phía bắc (北) cơ thể là lưng (月).", tipSound: "**Se** (xe) chở bối (**Hai**) rối.", words: [{w:"背 (せ)", m:"Lưng/Chiều cao"}, {w:"背景 (はいけい)", m:"Bối cảnh"}] },
            "高": { hanviet: "CAO", mean: "Cao", on: "コウ", kun: "たか.い", radicals: "Cao (高)", tipImg: "Tòa tháp cao.", tipSound: "**Taka** (ta ca) hát cao (**Kou**) vút.", words: [{w:"背が高い (せがたかい)", m:"Dáng cao"}, {w:"高校 (こうこう)", m:"Cấp 3"}] },
            "賑": { hanviet: "CHẨN", mean: "Náo nhiệt", on: "シン", kun: "にぎ.やか", radicals: "Bối (貝) + Thần (辰)", tipImg: "Tiền (貝) làm chấn (辰) động náo nhiệt.", tipSound: "**Nigi** (nỉ gì) chấn (**Shin**) động thế.", words: [{w:"賑やか (にぎやか)", m:"Náo nhiệt"}] },
            "静": { hanviet: "TĨNH", mean: "Tĩnh", on: "セイ", kun: "しず.か", radicals: "Thanh (青) + Tranh (争)", tipImg: "Màu xanh (青) tranh chấp (争) trong tĩnh lặng.", tipSound: "**Shizu** (shi dư) yên tĩnh (**Sei**).", words: [{w:"静か (しずか)", m:"Yên tĩnh"}, {w:"冷静 (れいせい)", m:"Bình tĩnh"}] },
            "簡": { hanviet: "GIẢN", mean: "Đơn giản", on: "カン", kun: "", radicals: "Trúc (竹) + Gian (間)", tipImg: "Trúc (竹) ở gian (間) nhà đơn giản.", tipSound: "**Kan** (can) đảm sống đơn giản.", words: [{w:"簡単 (かんたん)", m:"Đơn giản"}] },
            "単": { hanviet: "ĐƠN", mean: "Đơn", on: "タン", kun: "", radicals: "Đơn (単)", tipImg: "Cái khiên đơn lẻ.", tipSound: "**Tan** (tan) tành đơn lẻ.", words: [{w:"簡単 (かんたん)", m:"Đơn giản"}, {w:"単語 (たんご)", m:"Từ vựng"}] },
            "冷": { hanviet: "LÃNH", mean: "Lạnh", on: "レイ", kun: "つめ.たい", radicals: "Băng (冫) + Lệnh (令)", tipImg: "Lệnh (令) băng (冫) giá.", tipSound: "**Tsume** (chư mê) lãnh (**Rei**) cung lạnh lẽo.", words: [{w:"冷たい (つめたい)", m:"Lạnh"}, {w:"冷蔵庫 (れいぞうこ)", m:"Tủ lạnh"}] },
            "温": { hanviet: "ÔN", mean: "Ấm", on: "オン", kun: "あたた.かい", radicals: "Thủy (氵) + Ôn (温)", tipImg: "Nước (氵) trong đĩa (皿) dưới trời nắng (日) thì ấm.", tipSound: "**Atata** (a ta ta) ôn (**On**) tồn ấm áp.", words: [{w:"温かい (あたたかい)", m:"Ấm áp"}, {w:"温度 (おんど)", m:"Nhiệt độ"}] },
            "甘": { hanviet: "CAM", mean: "Ngọt", on: "カン", kun: "あま.い", radicals: "Cam (甘)", tipImg: "Lưỡi nếm vị ngọt.", tipSound: "**Ama** (a ma) cam (**Kan**) chịu ngọt ngào.", words: [{w:"甘い (あまい)", m:"Ngọt"}, {w:"甘味料 (かんみりょう)", m:"Chất tạo ngọt"}] },
            "辛": { hanviet: "TÂN", mean: "Cay", on: "シン", kun: "から.い", radicals: "Tân (辛)", tipImg: "Đứng (立) mười (十) lần rất cay đắng.", tipSound: "**Kara** (ca ra) tân (**Shin**) khổ cay đắng.", words: [{w:"辛い (からい)", m:"Cay"}, {w:"香辛料 (こうしんりょう)", m:"Gia vị"}] },
            "塩": { hanviet: "DIÊM", mean: "Muối", on: "エン", kun: "しお", radicals: "Thổ (土)", tipImg: "Đất (土) có người nằm (亻) ăn muối trong đĩa (皿).", tipSound: "**Shio** (xi ô) diêm (**En**) dân làm muối.", words: [{w:"塩辛い (しおからい)", m:"Mặn"}, {w:"食塩 (しょくえん)", m:"Muối ăn"}] },
            "早": { hanviet: "TẢO", mean: "Sớm", on: "ソウ", kun: "はや.い", radicals: "Nhật (日) + Thập (十)", tipImg: "Mặt trời (日) trên mười (十) là sớm.", tipSound: "**Haya** (hay a) tảo (**Sou**) hôn sớm.", words: [{w:"早い (はやい)", m:"Sớm/Nhanh"}, {w:"早朝 (そうちょう)", m:"Sáng sớm"}] },
            "豚": { hanviet: "ĐỒN", mean: "Con lợn", on: "トン", kun: "ぶた", radicals: "Thỉ (豕) + Nhục (月)", tipImg: "Con lợn (豕) béo nhiều thịt (月).", tipSound: "**Buta** (bự tạ) ăn **ton** (tồn) kho.", words: [{w:"豚肉",m:"Thịt lợn"},{w:"子豚",m:"Lợn con"}] },
            "椅": { hanviet: "Y", mean: "Cái ghế", on: "イ", kun: "", radicals: "Mộc (木) + Kỳ (奇)", tipImg: "Cái ghế gỗ (木) hình kỳ lạ (奇).", tipSound: "**I** (y) như cái ghế.", words: [{w:"椅子",m:"Ghế"},{w:"車椅子",m:"Xe lăn"}] },
            "子": { hanviet: "TỬ", mean: "Con/Cái", on: "シ", kun: "こ", radicals: "Tử (子)", tipImg: "Đứa trẻ.", tipSound: "**Ko** (cô) tử (**Shi**) thương con.", words: [{w:"椅子",m:"Ghế"},{w:"子供",m:"Trẻ em"}] },
            "帽": { hanviet: "MẠO", mean: "Mũ", on: "ボウ", kun: "", radicals: "Cân (巾) + Mạo (冒)", tipImg: "Khăn (巾) trùm đầu mạo hiểm.", tipSound: "**Bou** (bô) đội đầu mạo hiểm.", words: [{w:"帽子",m:"Mũ"},{w:"脱帽",m:"Ngả mũ"}] },
            "靴": { hanviet: "OA", mean: "Giày", on: "カ", kun: "くつ", radicals: "Cách (革) + Hóa (化)", tipImg: "Da (革) biến hóa (化) thành giày.", tipSound: "**Kutsu** (cũ từ từ) chiếc giày oa (**Ka**) oa.", words: [{w:"靴下",m:"Tất"},{w:"長靴",m:"Ủng"}] },
            "鉛": { hanviet: "DUYÊN", mean: "Chì", on: "エン", kun: "なまり", radicals: "Kim (金) + Duyên (沿 - giản lược)", tipImg: "Kim loại mềm như chì.", tipSound: "**Namari** (nằm im) duyên (**En**) dáng.", words: [{w:"鉛筆",m:"Bút chì"}] },
            "筆": { hanviet: "BÚT", mean: "Bút lông", on: "ヒツ", kun: "ふで", radicals: "Trúc (竹) + Duật (聿)", tipImg: "Bút làm từ trúc.", tipSound: "**Fude** (phu đê) cầm bút (**Hitsu**) viết.", words: [{w:"鉛筆",m:"Bút chì"}] },
            "山": { hanviet: "SƠN", mean: "Núi", on: "サン", kun: "やま", radicals: "Sơn (山)", tipImg: "Hình ngọn núi.", tipSound: "**Yama** (ya ma) sơn (**San**) núi.", words: [{w:"富士山",m:"Núi Phú Sĩ"}] },
            "川": { hanviet: "XUYÊN", mean: "Sông", on: "セン", kun: "かわ", radicals: "Xuyên (川)", tipImg: "Dòng sông chảy.", tipSound: "**Kawa** (ca qua) sông xuyên (**Sen**) lục địa.", words: [{w:"川",m:"Sông"}] },
            "森": { hanviet: "SÂM", mean: "Rừng rậm", on: "シン", kun: "もり", radicals: "Mộc (木)", tipImg: "Ba cây thành rừng.", tipSound: "**Mori** (mở đi) vào sâm (**Shin**) lâm.", words: [{w:"森林",m:"Rừng rậm"}] },
            "海": { hanviet: "HẢI", mean: "Biển", on: "カイ", kun: "うみ", radicals: "Thủy (氵) + Mỗi (毎)", tipImg: "Mỗi ngày đều có nước biển.", tipSound: "**Umi** (u mê) hải (**Kai**) sản.", words: [{w:"海外",m:"Hải ngoại"}] },
            "空": { hanviet: "KHÔNG", mean: "Bầu trời", on: "クウ", kun: "そら", radicals: "Huyệt (穴) + Công (工)", tipImg: "Cái lỗ công nghiệp trống rỗng.", tipSound: "**Sora** (sợ ra) khoảng không (**Kuu**) gian.", words: [{w:"空港",m:"Sân bay"}] },
            "天": { hanviet: "THIÊN", mean: "Trời", on: "テン", kun: "あま", radicals: "Đại (大) + Nhất (一)", tipImg: "Người to lớn nhất là trời.", tipSound: "**Ama** (a ma) thiên (**Ten**) đình.", words: [{w:"天気",m:"Thời tiết"}] },
            "気": { hanviet: "KHÍ", mean: "Không khí", on: "キ", kun: "", radicals: "Khí (气) + Mễ (米)", tipImg: "Hơi gạo bốc lên.", tipSound: "**Ki** (kìa) không khí.", words: [{w:"元気",m:"Khỏe mạnh"}] },
            "赤": { hanviet: "XÍCH", mean: "Đỏ", on: "セキ", kun: "あか", radicals: "Xích (赤)", tipImg: "Màu đỏ rực rỡ.", tipSound: "**Aka** (a ca) xích (**Seki**) đỏ.", words: [{w:"赤ちゃん",m:"Em bé"}] },
            "青": { hanviet: "THANH", mean: "Xanh dương", on: "セイ", kun: "あお", radicals: "Thanh (青)", tipImg: "Màu xanh thanh khiết.", tipSound: "**Ao** (ảo) thanh (**Sei**) xuân.", words: [{w:"青年",m:"Thanh niên"}] },
            "緑": { hanviet: "LỤC", mean: "Xanh lá", on: "リョク", kun: "みどり", radicals: "Mịch (糸) + Lục (录)", tipImg: "Sợi chỉ màu lục.", tipSound: "**Midori** (mi đo ri) lục (**Ryoku**) lọi.", words: [{w:"緑色",m:"Màu xanh lá"}] },
            "黄": { hanviet: "HOÀNG", mean: "Vàng", on: "コウ", kun: "き", radicals: "Hoàng (黄)", tipImg: "Màu vàng hoàng gia.", tipSound: "**Ki** (kìa) hoàng (**Kou**) hậu.", words: [{w:"黄金",m:"Hoàng kim"}] },
            "黒": { hanviet: "HẮC", mean: "Đen", on: "コク", kun: "くろ", radicals: "Hắc (黒)", tipImg: "Màu đen hắc ám.", tipSound: "**Kuro** (cứ rò) hắc (**Koku**) ám.", words: [{w:"黒板",m:"Bảng đen"}] },
            "白": { hanviet: "BẠCH", mean: "Trắng", on: "ハク", kun: "しろ", radicals: "Bạch (白)", tipImg: "Màu trắng tinh khôi.", tipSound: "**Shiro** (si rô) bạch (**Haku**) kim.", words: [{w:"白鳥",m:"Thiên nga"}] }
        };

        // --- 4. APP LOGIC (Standard Day 1 Logic) ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id].formula).join("  /  ");
            e.innerHTML = ids.map(id => `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                // Updated to single tip sound
                document.getElementById('detailTipSound').innerHTML = fmt(d.tipSound || ''); 
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
