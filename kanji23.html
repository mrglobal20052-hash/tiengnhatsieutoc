<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AzaKanji - NgÃ y 23/24 (80 HÃ¡n Tá»±)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #f0f9ff; overflow-x: hidden; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .correct-anim { animation: pulse-green 0.5s; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
        
        .wrong-anim { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Tab Active State */
        .tab-active { background-color: #0369a1; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-inactive { background-color: #e0f2fe; color: #0c4a6e; }

        /* Stroke Grid Styles */
        .stroke-path { fill: none; stroke: #333; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; }
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); z-index: 0; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); z-index: 0; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-sky-700 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                    <i class="fas fa-torii-gate text-3xl text-yellow-400"></i>
                    <div>
                        <h1 class="text-xl font-bold uppercase tracking-wider">AZAKANJI</h1>
                        <p class="text-xs text-sky-200">Kanji siÃªu tá»‘c, há»c rá»™ng hiá»ƒu sÃ¢u</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 overflow-x-auto max-w-full pb-1 md:pb-0">
                    <div class="flex bg-sky-800 rounded-lg p-1">
                        <button onclick="switchTab('learn')" id="tab-learn" class="px-4 py-2 rounded-md text-sm font-bold transition whitespace-nowrap tab-active">
                            <i class="fas fa-book-open mr-2"></i>Há»c Táº­p
                        </button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="px-4 py-2 rounded-md text-sm font-bold transition whitespace-nowrap tab-inactive ml-1">
                            <i class="fas fa-gamepad mr-2"></i>Kiá»ƒm Tra
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 flex-grow" id="app-container">
        
        <!-- LEARN SECTION -->
        <div id="learn-section" class="fade-in">
            <div class="mb-6 bg-white p-4 rounded-xl shadow-sm border-l-4 border-sky-500 flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-1"><i class="fas fa-calendar-day text-sky-500 mr-2"></i>NgÃ y 23: 80 HÃ¡n Tá»± (N2-N1)</h3>
                    <p class="text-sm text-gray-600">Trá»«u tÆ°á»£ng, Ká»¹ thuáº­t & Tá»± nhiÃªn.</p>
                </div>
            </div>
            
            <div id="kanji-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Cards will be injected here -->
            </div>
        </div>

        <!-- QUIZ SECTION -->
        <div id="quiz-section" class="hidden fade-in max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                <div class="bg-gradient-to-r from-emerald-500 to-teal-600 p-6 text-white flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-bold"><i class="fas fa-puzzle-piece mr-2"></i>Thá»­ ThÃ¡ch NgÃ y 23</h2>
                        <p class="text-emerald-100 text-xs mt-1">Ã”n táº­p 80 chá»¯ vá»«a há»c</p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-emerald-200 uppercase font-bold">Äiá»ƒm sá»‘</div>
                        <div class="text-3xl font-bold" id="score-display">0</div>
                    </div>
                </div>
                
                <div class="p-6 md:p-8">
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                        <div id="quiz-progress" class="bg-emerald-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>

                    <div id="question-area" class="text-center mb-8">
                        <div class="text-gray-500 text-sm font-bold mb-4 uppercase tracking-wide">CÃ¢u há»i <span id="q-current">1</span> / <span id="q-total">10</span></div>
                        <div class="mb-4">
                            <span class="text-6xl kanji-font font-bold text-gray-800" id="quiz-kanji-display"></span>
                        </div>
                        <div class="text-lg text-gray-600 font-medium" id="quiz-question-text">HÃ¡n tá»± nÃ y cÃ³ nghÄ©a lÃ  gÃ¬?</div>
                    </div>

                    <div id="options-area" class="grid grid-cols-2 gap-4 mb-6">
                        <!-- Options injected here -->
                    </div>

                    <div id="feedback-area" class="hidden bg-gray-50 rounded-xl p-4 border border-gray-200 text-left animate-fade-in">
                        <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                        <p id="feedback-detail" class="text-gray-600 text-sm mb-3"></p>
                        <button onclick="nextQuestion()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-lg shadow transition">Tiáº¿p tá»¥c <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- STROKE ORDER MODAL -->
    <div id="stroke-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeStrokeModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl w-full modal-enter relative">
                <div class="bg-sky-600 px-4 py-3 flex justify-between items-center text-white">
                    <h3 class="font-bold text-lg"><i class="fas fa-pen-nib mr-2"></i>Táº­p Viáº¿t: <span id="stroke-modal-char" class="text-2xl ml-2 font-bold"></span></h3>
                    <button onclick="closeStrokeModal()" class="hover:text-gray-200 text-2xl">&times;</button>
                </div>
                <div class="p-4 md:p-6 bg-gray-50 max-h-[80vh] overflow-y-auto">
                    <div class="flex flex-col md:flex-row gap-6 md:gap-8 items-center md:items-start justify-center">
                        <div class="bg-white p-4 rounded-lg shadow border border-gray-200 text-center w-full md:w-auto">
                            <p class="text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider">MÃ´ phá»ng</p>
                            <div id="stroke-animation-container" class="w-40 h-40 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center">
                                <span class="text-gray-400 text-xs">Äang táº£i...</span>
                            </div>
                            <button onclick="replayStrokeAnimation()" class="mt-3 text-sm bg-sky-100 text-sky-700 px-4 py-2 rounded-full hover:bg-sky-200 transition w-full font-bold flex items-center justify-center"><i class="fas fa-redo mr-2"></i> Viáº¿t láº¡i</button>
                        </div>
                        <div class="flex-1 w-full">
                            <p class="text-xs text-gray-500 mb-3 font-bold uppercase tracking-wider text-center md:text-left">Thá»© tá»± nÃ©t</p>
                            <div id="stroke-grid-container" class="flex flex-wrap gap-2 justify-center md:justify-start"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA DAY 23 (80 Kanji N1/N2 - AzaKanji Method) ---
        const kanjiData = [
            // Abstract & Actions - 10
            { char: "ç¨¼", nghiaHV: "GIÃ", nghiaTV: "Kiáº¿m tiá»n", on: "ã‚«", kun: "ã‹ã›", ti: "LÃºa (**HÃ²a ç¦¾**) trá»“ng trong nhÃ  (**Gia å®¶**) Ä‘á»ƒ kiáº¿m tiá»n.", ta: "**Ca** (Ka) hÃ¡t **Ca SÃª** (Kasegu) kiáº¿m tiá»n.", examples: [{ w: "ç¨¼ã", r: "ã‹ã›ã", m: "Kiáº¿m tiá»n" }, { w: "ç¨¼åƒ", r: "ã‹ã©ã†", m: "Hoáº¡t Ä‘á»™ng" }] },
            { char: "æ‡", nghiaHV: "HOÃ€I", nghiaTV: "HoÃ i niá»‡m", on: "ã‚«ã‚¤", kun: "ãªã¤", ti: "Tim (**TÃ¢m å¿„**) nhá»› vá» Ã¡o (**Y è¡£**) máº¯t (**Má»¥c ç½’**) xÆ°a.", ta: "**Cai** (Kai) quáº£n **Na TÆ°** (Natsukashii) nhá»› nhung.", examples: [{ w: "æ‡ã‹ã—ã„", r: "ãªã¤ã‹ã—ã„", m: "Nhá»› tiáº¿c" }, { w: "æ‡ç–‘", r: "ã‹ã„ã", m: "HoÃ i nghi" }] },
            { char: "æ‹", nghiaHV: "QUáº¢I", nghiaTV: "Báº¯t cÃ³c", on: "ã‚«ã‚¤", kun: "-", ti: "Tay (**Thá»§ æ‰Œ**) cáº§m miá»‡ng (**Kháº©u å£**) Ä‘ao (**Äao åˆ€**) báº¯t cÃ³c.", ta: "**Cai** (Kai) trá»‹ káº» báº¯t cÃ³c.", examples: [{ w: "èª˜æ‹", r: "ã‚†ã†ã‹ã„", m: "Báº¯t cÃ³c" }, { w: "æ‹å¸¯", r: "ã‹ã„ãŸã„", m: "Mang theo tiá»n cÃ´ng trá»‘n" }] },
            { char: "åŠ¾", nghiaHV: "Háº¶C", nghiaTV: "Luáº­n tá»™i", on: "ã‚¬ã‚¤", kun: "-", ti: "Sá»©c (**Lá»±c åŠ›**) cá»§a lá»£n (**Há»£i äº¥**) luáº­n tá»™i.", ta: "**Gai** (Gai) gÃ³c Ä‘Ã n háº·c.", examples: [{ w: "å¼¾åŠ¾", r: "ã ã‚“ãŒã„", m: "Luáº­n tá»™i/ÄÃ n háº·c" }] },
            { char: "æ¦‚", nghiaHV: "KHÃI", nghiaTV: "Bao quÃ¡t", on: "ã‚¬ã‚¤", kun: "-", ti: "CÃ¢y (**Má»™c æœ¨**) Ä‘Ã£ (**KÃ­ æ—¢**) bao quÃ¡t.", ta: "**Gai** (Gai) gÃ³c khÃ¡i quÃ¡t.", examples: [{ w: "æ¦‚å¿µ", r: "ãŒã„ã­ã‚“", m: "KhÃ¡i niá»‡m" }, { w: "æ¦‚ç•¥", r: "ãŒã„ã‚Šã‚ƒã", m: "TÃ³m táº¯t" }] },
            { char: "æ¶¯", nghiaHV: "NHAI", nghiaTV: "Bá» báº¿n", on: "ã‚¬ã‚¤", kun: "-", ti: "NÆ°á»›c (**Thá»§y æ°µ**) bÃªn vÃ¡ch (**Nhai å“**) lÃ  bá» báº¿n.", ta: "**Gai** (Gai) gÃ³c sinh nhai.", examples: [{ w: "ç”Ÿæ¶¯", r: "ã—ã‚‡ã†ãŒã„", m: "Cuá»™c Ä‘á»i" }, { w: "å¤©æ¶¯", r: "ã¦ã‚“ãŒã„", m: "ChÃ¢n trá»i" }] },
            { char: "è©²", nghiaHV: "CAI", nghiaTV: "ÄÃ³/NÃªu trÃªn", on: "ã‚¬ã‚¤", kun: "-", ti: "Lá»i nÃ³i (**NgÃ´n è¨€**) cá»§a con lá»£n (**Há»£i äº¥**).", ta: "**Gai** (Gai) gÃ³c cai trá»‹.", examples: [{ w: "è©²å½“", r: "ãŒã„ã¨ã†", m: "TÆ°Æ¡ng á»©ng" }, { w: "å½“è©²", r: "ã¨ã†ãŒã„", m: "ThÃ­ch há»£p" }] },
            { char: "å£", nghiaHV: "VIÃŠN", nghiaTV: "HÃ ng rÃ o", on: "ã‚¨ãƒ³", kun: "ã‹ã", ti: "Äáº¥t (**Thá»• åœŸ**) tráº£i dÃ i (**CÄƒng äº˜**) lÃ m hÃ ng rÃ o.", ta: "**Em** (En) xÃ¢y **Ca Ki** (Kaki) hÃ ng rÃ o.", examples: [{ w: "å£æ ¹", r: "ã‹ãã­", m: "HÃ ng rÃ o" }, { w: "çŸ³å£", r: "ã„ã—ãŒã", m: "TÆ°á»ng Ä‘Ã¡" }] },
            { char: "åš‡", nghiaHV: "HÃCH", nghiaTV: "Dá»a náº¡t", on: "ã‚«ã‚¯", kun: "-", ti: "Miá»‡ng (**Kháº©u å£**) mÃ u Ä‘á» (**XÃ­ch èµ¤**) dá»a náº¡t.", ta: "**Ca CÆ°** (Kaku) dá»a náº¡t.", examples: [{ w: "å¨åš‡", r: "ã„ã‹ã", m: "Äe dá»a" }, { w: "åš‡æ€’", r: "ã‹ãã©", m: "Giáº­n dá»¯" }] },
            { char: "æ ¸", nghiaHV: "Háº CH", nghiaTV: "Háº¡t nhÃ¢n", on: "ã‚«ã‚¯", kun: "-", ti: "CÃ¢y (**Má»™c æœ¨**) cá»§a con lá»£n (**Há»£i äº¥**).", ta: "**Ca CÆ°** (Kaku) háº¡ch nhÃ¢n.", examples: [{ w: "æ ¸å¿ƒ", r: "ã‹ãã—ã‚“", m: "Trá»ng tÃ¢m" }, { w: "æ ¸å…µå™¨", r: "ã‹ãã¸ã„ã", m: "VÅ© khÃ­ háº¡t nhÃ¢n" }] },

            // Nature & Materials - 10
            { char: "æ®»", nghiaHV: "XÃC", nghiaTV: "Vá»/Lá»›p", on: "ã‚«ã‚¯", kun: "ã‹ã‚‰", ti: "Vá» tráº¥u (**XÃ¡c ã±¿**) bá»‹ Ä‘Ã¡nh (**PhÃ¹ æ®³**).", ta: "**Ca CÆ°** (Kaku) **Ca Ra** (Kara) vá».", examples: [{ w: "è²æ®»", r: "ã‹ã„ãŒã‚‰", m: "Vá» sÃ²" }, { w: "åœ°æ®»", r: "ã¡ã‹ã", m: "Vá» trÃ¡i Ä‘áº¥t" }] },
            { char: "å²³", nghiaHV: "NHáº C", nghiaTV: "NÃºi cao", on: "ã‚¬ã‚¯", kun: "ãŸã‘", ti: "NÃºi (**SÆ¡n å±±**) trÃªn Ä‘á»“i (**KhÃ¢u ä¸˜**).", ta: "**GÃ  CÆ°** (Gaku) leo nÃºi **Ta KÃª** (Take).", examples: [{ w: "å±±å²³", r: "ã•ã‚“ãŒã", m: "VÃ¹ng nÃºi" }, { w: "å²³", r: "ãŸã‘", m: "NÃºi cao" }] },
            { char: "æ½Ÿ", nghiaHV: "TÃCH", nghiaTV: "BÃ£i Ä‘áº¥t/Äáº§m", on: "ã‚»ã‚­", kun: "ã‹ãŸ", ti: "NÆ°á»›c (**Thá»§y æ°µ**) viáº¿t (**Táº£ å†™**) lÃªn bÃ£i Ä‘áº¥t.", ta: "PhÃ¢n **TÃ­ch** (Seki) **Ca Ta** (Kata) bÃ£i Ä‘áº¥t.", examples: [{ w: "å¹²æ½Ÿ", r: "ã²ãŒãŸ", m: "BÃ£i triá»u" }, { w: "æ–°æ½Ÿ", r: "ã«ã„ãŒãŸ", m: "Niigata" }] },
            { char: "å–", nghiaHV: "HÃT", nghiaTV: "QuÃ¡t máº¯ng", on: "ã‚«ãƒ„", kun: "-", ti: "Miá»‡ng (**Kháº©u å£**) khÃ¡t (**KhÃ¡t æ›·**) nÃªn quÃ¡t.", ta: "**Ca TÆ°** (Katsu) quÃ¡t máº¯ng.", examples: [{ w: "æå–", r: "ãã‚‡ã†ã‹ã¤", m: "Tá»‘ng tiá»n" }, { w: "ä¸€å–", r: "ã„ã£ã‹ã¤", m: "Tiáº¿ng quÃ¡t" }] },
            { char: "æ‹¬", nghiaHV: "QUÃT", nghiaTV: "Bao quÃ¡t", on: "ã‚«ãƒ„", kun: "-", ti: "Tay (**Thá»§ æ‰Œ**) lÆ°á»¡i (**Thiá»‡t èˆŒ**) bao quÃ¡t.", ta: "**Ca TÆ°** (Katsu) bao quÃ¡t.", examples: [{ w: "ç·æ‹¬", r: "ãã†ã‹ã¤", m: "Tá»•ng quÃ¡t" }, { w: "æ‹¬å¼§", r: "ã‹ã£ã“", m: "Dáº¥u ngoáº·c" }] },
            { char: "æ¸´", nghiaHV: "KHÃT", nghiaTV: "KhÃ¡t nÆ°á»›c", on: "ã‚«ãƒ„", kun: "ã‹ã‚", ti: "NÆ°á»›c (**Thá»§y æ°µ**) cáº¡n kiá»‡t, ngÆ°á»i ngá»“i (**Háº¡t æ›·**) khÃ¡t.", ta: "**Ca TÆ°** (Katsu) **Ca Wa** (Kawaku) khÃ¡t.", examples: [{ w: "æ¸‡æ°´", r: "ã‹ã£ã™ã„", m: "Thiáº¿u nÆ°á»›c" }, { w: "æ¸‡ã", r: "ã‹ã‚ã", m: "KhÃ¡t" }] },
            { char: "è¤", nghiaHV: "Háº T", nghiaTV: "MÃ u nÃ¢u", on: "ã‚«ãƒ„", kun: "-", ti: "Ão (**Y è¡¤**) cá»§a ngÆ°á»i ngá»“i (**Háº¡t æ›·**) mÃ u nÃ¢u.", ta: "**Ca TÆ°** (Katsu) mÃ u nÃ¢u.", examples: [{ w: "è¤è‰²", r: "ã‹ã£ã—ã‚‡ã", m: "MÃ u nÃ¢u" }] },
            { char: "è½„", nghiaHV: "Háº T", nghiaTV: "Cai quáº£n", on: "ã‚«ãƒ„", kun: "-", ti: "Xe (**Xa è»Š**) gÃ¢y háº¡i (**Háº¡i å®³**) cáº§n cai quáº£n.", ta: "**Ca TÆ°** (Katsu) cai quáº£n.", examples: [{ w: "ç®¡è½„", r: "ã‹ã‚“ã‹ã¤", m: "Tháº©m quyá»n" }, { w: "ç›´è½„", r: "ã¡ã‚‡ã£ã‹ã¤", m: "Trá»±c thuá»™c" }] },
            { char: "ä¸”", nghiaHV: "THáº¢", nghiaTV: "NgoÃ i ra", on: "ã‚·ãƒ§", kun: "ã‹", ti: "CÃ¡i ká»‡ sÃ¡ch.", ta: "**SÃ´** (Sho) diá»…n **Ca TÆ°** (Katsu) ngoÃ i ra.", examples: [{ w: "ä¸”ã¤", r: "ã‹ã¤", m: "VÃ /NgoÃ i ra" }, { w: "æš«ä¸”", r: "ã–ã‚“ã—ã‚‡", m: "Táº¡m thá»i" }] },
            { char: "ç¼¶", nghiaHV: "PHá»®U", nghiaTV: "CÃ¡i lon", on: "ã‚«ãƒ³", kun: "-", ti: "Ngá» (**Ngá» åˆ**) trÃªn nÃºi (**SÆ¡n å±±** - biáº¿n thá»ƒ).", ta: "**Can** (Kan) cÃ¡i lon.", examples: [{ w: "ç©ºãç¼¶", r: "ã‚ãã‹ã‚“", m: "Lon rá»—ng" }, { w: "ç¼¶è©°", r: "ã‹ã‚“ã¥ã‚", m: "Äá»“ há»™p" }] },

            // Society & Relationships - 10
            { char: "é™¥", nghiaHV: "HÃƒM", nghiaTV: "RÆ¡i vÃ o/Báº«y", on: "ã‚«ãƒ³", kun: "ãŠã¡ã„", ti: "VÃ¹ng Ä‘áº¥t (**Phá»¥ é˜**) cÅ© (**Cá»±u æ—§** - biáº¿n thá»ƒ) sá»¥p Ä‘á»•.", ta: "**Can** (Kan) Ä‘áº£m **Ã” Chi I** (Ochiiru) rÆ¡i vÃ o.", examples: [{ w: "æ¬ é™¥", r: "ã‘ã£ã‹ã‚“", m: "Khuyáº¿t Ä‘iá»ƒm" }, { w: "é™¥ã‚‹", r: "ãŠã¡ã„ã‚‹", m: "RÆ¡i vÃ o" }] },
            { char: "æ‚£", nghiaHV: "HOáº N", nghiaTV: "Bá»‡nh hoáº¡n", on: "ã‚«ãƒ³", kun: "ã‚ãšã‚‰", ti: "Tim (**TÃ¢m å¿ƒ**) bá»‹ xÃ¢u chuá»—i (**Trung ä¸²**) Ä‘au Ä‘á»›n.", ta: "**Can** (Kan) Ä‘áº£m **Wa DÆ° Ra** (Wazurau) bá»‹ bá»‡nh.", examples: [{ w: "æ‚£è€…", r: "ã‹ã‚“ã˜ã‚ƒ", m: "Bá»‡nh nhÃ¢n" }, { w: "æ‚£ã†", r: "ã‚ãšã‚‰ã†", m: "Bá»‹ bá»‡nh" }] },
            { char: "å ª", nghiaHV: "KHAM", nghiaTV: "Chá»‹u Ä‘á»±ng", on: "ã‚«ãƒ³", kun: "ãŸ", ti: "Äáº¥t (**Thá»• åœŸ**) ráº¥t tháº­m (**Tháº­m ç”š**) chá»‹u Ä‘á»±ng.", ta: "**Can** (Kan) Ä‘áº£m **Ta** (Taeru) chá»‹u Ä‘á»±ng.", examples: [{ w: "å ªå¿", r: "ã‹ã‚“ã«ã‚“", m: "KiÃªn nháº«n" }, { w: "å ªãˆã‚‹", r: "ãŸãˆã‚‹", m: "Chá»‹u Ä‘á»±ng" }] },
            { char: "æ£º", nghiaHV: "QUAN", nghiaTV: "Quan tÃ i", on: "ã‚«ãƒ³", kun: "-", ti: "CÃ¢y (**Má»™c æœ¨**) lÃ m quan (**Quan å®˜**) tÃ i.", ta: "**Can** (Kan) Ä‘áº£m náº±m quan tÃ i.", examples: [{ w: "æ£ºæ¡¶", r: "ã‹ã‚“ãŠã‘", m: "Quan tÃ i" }, { w: "ç´æ£º", r: "ã®ã†ã‹ã‚“", m: "KhÃ¢m liá»‡m" }] },
            { char: "æ¬¾", nghiaHV: "KHOáº¢N", nghiaTV: "Äiá»u khoáº£n", on: "ã‚«ãƒ³", kun: "-", ti: "NgÆ°á»i sá»¹ (**SÄ© å£«**) thá»ƒ hiá»‡n (**Thá»‹ ç¤º**) sá»± thiáº¿u thá»‘n (**Khiáº¿m æ¬ **).", ta: "**Can** (Kan) Ä‘áº£m Ä‘iá»u khoáº£n.", examples: [{ w: "å®šæ¬¾", r: "ã¦ã„ã‹ã‚“", m: "Äiá»u lá»‡" }, { w: "å€Ÿæ¬¾", r: "ã—ã‚ƒã£ã‹ã‚“", m: "Khoáº£n vay" }] },
            { char: "é–‘", nghiaHV: "NHÃ€N", nghiaTV: "NhÃ n rá»—i", on: "ã‚«ãƒ³", kun: "-", ti: "CÃ¢y (**Má»™c æœ¨**) trong cá»•ng (**MÃ´n é–€**) nhÃ n rá»—i.", ta: "**Can** (Kan) Ä‘áº£m an nhÃ n.", examples: [{ w: "é–‘é™", r: "ã‹ã‚“ã›ã„", m: "YÃªn tÄ©nh" }, { w: "å®‰é–‘", r: "ã‚ã‚“ã‹ã‚“", m: "An nhÃ n" }] },
            { char: "é‚„", nghiaHV: "HOÃ€N", nghiaTV: "Tráº£ láº¡i", on: "ã‚«ãƒ³", kun: "-", ti: "Äi (**SÆ°á»›c è¾¶**) vÃ²ng trÃ²n (**HoÃ n ç˜**).", ta: "**Can** (Kan) Ä‘áº£m hoÃ n tráº£.", examples: [{ w: "é‚„å…ƒ", r: "ã‹ã‚“ã’ã‚“", m: "HoÃ n tráº£" }, { w: "è¿”é‚„", r: "ã¸ã‚“ã‹ã‚“", m: "Tráº£ láº¡i" }] },
            { char: "è‰¦", nghiaHV: "Háº M", nghiaTV: "TÃ u chiáº¿n", on: "ã‚«ãƒ³", kun: "-", ti: "Thuyá»n (**Chu èˆŸ**) giÃ¡m (**GiÃ¡m ç›£**) sÃ¡t.", ta: "**Can** (Kan) Ä‘áº£m tÃ u chiáº¿n.", examples: [{ w: "è»è‰¦", r: "ãã‚“ã‹ã‚“", m: "TÃ u chiáº¿n" }, { w: "è‰¦éšŠ", r: "ã‹ã‚“ãŸã„", m: "Háº¡m Ä‘á»™i" }] },
            { char: "ç’°", nghiaHV: "HOÃ€N", nghiaTV: "VÃ²ng trÃ²n", on: "ã‚«ãƒ³", kun: "-", ti: "Vua (**VÆ°Æ¡ng ç‹**) máº¯t (**Má»¥c ç½’**) nhÃ¬n quáº§n Ã¡o (**Y è¡£**) vÃ²ng trÃ²n.", ta: "**Can** (Kan) Ä‘áº£m mÃ´i trÆ°á»ng.", examples: [{ w: "ç’°å¢ƒ", r: "ã‹ã‚“ãã‚‡ã†", m: "MÃ´i trÆ°á»ng" }, { w: "å¾ªç’°", r: "ã˜ã‚…ã‚“ã‹ã‚“", m: "Tuáº§n hoÃ n" }] },
            { char: "ç›£", nghiaHV: "GIÃM", nghiaTV: "GiÃ¡m sÃ¡t", on: "ã‚«ãƒ³", kun: "-", ti: "NgÆ°á»i (**NhÃ¢n äº»**) náº±m trÃªn Ä‘Ä©a (**MÃ£nh çš¿**) nhÃ¬n (**Tháº§n è‡£**).", ta: "**Can** (Kan) Ä‘áº£m giÃ¡m sÃ¡t.", examples: [{ w: "ç›£ç£", r: "ã‹ã‚“ã¨ã", m: "Äáº¡o diá»…n/HLV" }, { w: "ç›£è¦–", r: "ã‹ã‚“ã—", m: "GiÃ¡m sÃ¡t" }] },

            // Others - 10
            { char: "é‘‘", nghiaHV: "GIÃM", nghiaTV: "GÆ°Æ¡ng/Tháº©m Ä‘á»‹nh", on: "ã‚«ãƒ³", kun: "ã‹ã‚“ãŒ", ti: "Kim loáº¡i (**Kim é‡‘**) giÃ¡m (**GiÃ¡m ç›£**) sÃ¡t.", ta: "**Can** (Kan) Ä‘áº£m **Can Ga** (Kangamiru) xem xÃ©t.", examples: [{ w: "å›³é‘‘", r: "ãšã‹ã‚“", m: "Tá»« Ä‘iá»ƒn tranh" }, { w: "é‘‘è³", r: "ã‹ã‚“ã—ã‚‡ã†", m: "ThÆ°á»Ÿng thá»©c" }] },
            { char: "å«", nghiaHV: "HÃ€M", nghiaTV: "Bao gá»“m", on: "ã‚¬ãƒ³", kun: "ãµã", ti: "BÃ¢y giá» (**Kim ä»Š**) miá»‡ng (**Kháº©u å£**) ngáº­m.", ta: "**Gan** (Gan) lÃ¬ **PhÆ° CÆ°** (Fukumu) bao gá»“m.", examples: [{ w: "å«ã‚€", r: "ãµãã‚€", m: "Bao gá»“m" }, { w: "å«æœ‰", r: "ãŒã‚“ã‚†ã†", m: "Chá»©a Ä‘á»±ng" }] },
            { char: "å²©", nghiaHV: "NHAM", nghiaTV: "ÄÃ¡ táº£ng", on: "ã‚¬ãƒ³", kun: "ã„ã‚", ti: "NÃºi (**SÆ¡n å±±**) Ä‘Ã¡ (**Tháº¡ch çŸ³**).", ta: "**Gan** (Gan) lÃ¬ **I Wa** (Iwa) Ä‘Ã¡ táº£ng.", examples: [{ w: "å²©çŸ³", r: "ãŒã‚“ã›ã", m: "Äáº¥t Ä‘Ã¡" }, { w: "å²©", r: "ã„ã‚", m: "ÄÃ¡ táº£ng" }] },
            { char: "ä¼", nghiaHV: "Ká»¸", nghiaTV: "Ká»¹ ná»¯/TÃ i nghá»‡", on: "ã‚®", kun: "-", ti: "NgÆ°á»i (**NhÃ¢n äº»**) chi (**Chi æ”¯**) phá»‘i nghá»‡ thuáº­t.", ta: "**Ghi** (Gi) chÃ©p ká»¹ nghá»‡.", examples: [{ w: "æ­Œèˆä¼", r: "ã‹ã¶ã", m: "Ká»‹ch Kabuki" }] },
            { char: "å¥‡", nghiaHV: "Ká»²", nghiaTV: "Ká»³ láº¡", on: "ã‚­", kun: "-", ti: "NgÆ°á»i to lá»›n (**Äáº¡i å¤§**) cÃ³ kháº£ nÄƒng (**Kháº£ å¯**) ká»³ láº¡.", ta: "**Ki** (Ki) láº¡.", examples: [{ w: "å¥‡æ•°", r: "ãã™ã†", m: "Sá»‘ láº»" }, { w: "å¥‡è·¡", r: "ãã›ã", m: "Ká»³ tÃ­ch" }] },
            { char: "å¬‰", nghiaHV: "HI", nghiaTV: "Vui má»«ng", on: "ã‚­", kun: "ã†ã‚Œ", ti: "Phá»¥ ná»¯ (**Ná»¯ å¥³**) vui (**Há»‰ å–œ**) má»«ng.", ta: "**Ki** (Ki) láº¡ **U RÃª** (Ureshii) vui quÃ¡.", examples: [{ w: "å¬‰ã—ã„", r: "ã†ã‚Œã—ã„", m: "Vui má»«ng" }] },
            { char: "å¹¾", nghiaHV: "CÆ ", nghiaTV: "Bao nhiÃªu", on: "ã‚­", kun: "ã„ã", ti: "Hai sá»£i dÃ¢y nhá» (**YÃªu å¹º**) canh giá»¯ (**Thæˆ æˆ**) con ngÆ°á»i (**NhÃ¢n äºº**).", ta: "**Ki** (Ki) láº¡ **I CÆ°** (Iku) bao nhiÃªu.", examples: [{ w: "å¹¾ã¤", r: "ã„ãã¤", m: "Bao nhiÃªu" }, { w: "å¹¾ä½•å­¦", r: "ãã‹ãŒã", m: "HÃ¬nh há»c" }] },
            { char: "æ¯…", nghiaHV: "NGHá»Š", nghiaTV: "Cá»©ng ráº¯n", on: "ã‚­", kun: "-", ti: "Äá»©ng (**Láº­p ç«‹**) cáº§m lá»£n (**Thá»‰ è±•**) Ä‘Ã¡nh (**Phá»™c æ”µ**) kiÃªn nghá»‹.", ta: "**Ki** (Ki) láº¡ kiÃªn nghá»‹.", examples: [{ w: "æ¯…ç„¶", r: "ããœã‚“", m: "KiÃªn quyáº¿t" }] },
            { char: "æ±½", nghiaHV: "KHÃ", nghiaTV: "HÆ¡i nÆ°á»›c", on: "ã‚­", kun: "-", ti: "NÆ°á»›c (**Thá»§y æ°µ**) bá»‘c hÆ¡i (**KhÃ­ æ°—**).", ta: "**Ki** (Ki) láº¡ hÆ¡i nÆ°á»›c.", examples: [{ w: "æ±½è»Š", r: "ãã—ã‚ƒ", m: "TÃ u há»a hÆ¡i nÆ°á»›c" }, { w: "æ±½èˆ¹", r: "ãã›ã‚“", m: "TÃ u thá»§y cháº¡y báº±ng hÆ¡i nÆ°á»›c" }] },
            { char: "ç¥ˆ", nghiaHV: "Ká»²", nghiaTV: "Cáº§u nguyá»‡n", on: "ã‚­", kun: "ã„ã®", ti: "Tháº§n (**Ká»³ ç¤»**) cáº§m rÃ¬u (**CÃ¢n æ–¤**) cáº§u nguyá»‡n.", ta: "**Ki** (Ki) láº¡ **I NÃ´** (Inoru) cáº§u nguyá»‡n.", examples: [{ w: "ç¥ˆã‚‹", r: "ã„ã®ã‚‹", m: "Cáº§u nguyá»‡n" }, { w: "ç¥ˆé¡˜", r: "ããŒã‚“", m: "Kháº¥n nguyá»‡n" }] },

            // Extra - 10
            { char: "ç¨€", nghiaHV: "HI", nghiaTV: "Hiáº¿m", on: "ã‚­", kun: "ã¾ã‚Œ", ti: "LÃºa (**HÃ²a ç¦¾**) hi vá»ng (**Hi å¸Œ**) hiáº¿m hoi.", ta: "**Ki** (Ki) láº¡ **Ma RÃª** (Mare) hiáº¿m.", examples: [{ w: "ç¨€å°‘", r: "ãã—ã‚‡ã†", m: "Hiáº¿m cÃ³" }, { w: "ç¨€", r: "ã¾ã‚Œ", m: "Hiáº¿m" }] },
            { char: "å¾½", nghiaHV: "HUY", nghiaTV: "Huy hiá»‡u", on: "ã‚­", kun: "-", ti: "Sá»£i chá»‰ nhá» (**Vi å¾®** - biáº¿n thá»ƒ) lÃ  huy hiá»‡u.", ta: "**Ki** (Ki) láº¡ huy hiá»‡u.", examples: [{ w: "å¾½ç« ", r: "ãã—ã‚‡ã†", m: "Huy chÆ°Æ¡ng" }] },
            { char: "è¨˜", nghiaHV: "KÃ", nghiaTV: "Ghi chÃ©p", on: "ã‚­", kun: "ã—ã‚‹", ti: "Lá»i nÃ³i (**NgÃ´n è¨€**) cá»§a báº£n thÃ¢n (**Ká»· å·±**) ghi láº¡i.", ta: "**Ki** (Ki) láº¡ **Si RÆ°** (Shirusu) ghi chÃ©p.", examples: [{ w: "æ—¥è¨˜", r: "ã«ã£ã", m: "Nháº­t kÃ½" }, { w: "è¨˜ã™", r: "ã—ã‚‹ã™", m: "Ghi chÃ©p" }] },
            { char: "é¬¼", nghiaHV: "QUá»¶", nghiaTV: "Ma quá»·", on: "ã‚­", kun: "ãŠã«", ti: "TÆ°á»£ng hÃ¬nh.", ta: "**Ki** (Ki) láº¡ **Ã” Ni** (Oni) con quá»·.", examples: [{ w: "é¬¼", r: "ãŠã«", m: "Con quá»·" }, { w: "å¸è¡€é¬¼", r: "ãã‚…ã†ã‘ã¤ã", m: "Ma cÃ  rá»“ng" }] },
            { char: "äº€", nghiaHV: "QUY", nghiaTV: "Con rÃ¹a", on: "ã‚­", kun: "ã‹ã‚", ti: "TÆ°á»£ng hÃ¬nh.", ta: "**Ki** (Ki) láº¡ **Ca MÃª** (Kame) con rÃ¹a.", examples: [{ w: "äº€", r: "ã‹ã‚", m: "Con rÃ¹a" }] },
            { char: "å¦“", nghiaHV: "Ká»¸", nghiaTV: "Ká»¹ ná»¯", on: "ã‚®", kun: "-", ti: "Phá»¥ ná»¯ (**Ná»¯ å¥³**) chi (**Chi æ”¯**) phá»‘i ká»¹ nghá»‡.", ta: "**Ghi** (Gi) chÃ©p ká»¹ ná»¯.", examples: [{ w: "èŠ¸å¦“", r: "ã’ã„ã", m: "Nghá»‡ giáº£ (Geisha)" }, { w: "å¦“å¥³", r: "ãã˜ã‚‡", m: "Ká»¹ ná»¯" }] },
            { char: "ä»‡", nghiaHV: "Cá»ªU", nghiaTV: "Káº» thÃ¹", on: "ã‚­ãƒ¥ã‚¦", kun: "ã‹ãŸã", ti: "NgÆ°á»i (**NhÃ¢n äº»**) cá»­u (**Cá»­u ä¹**) oÃ¡n.", ta: "**Cá»©u** (Kyuu) tui **Ca Ta Ki** (Kataki) káº» thÃ¹.", examples: [{ w: "å¾©ä»‡", r: "ãµã£ãã‚…ã†", m: "BÃ¡o thÃ¹" }, { w: "ä»‡", r: "ã‹ãŸã", m: "Káº» thÃ¹" }] },
            { char: "å¼“", nghiaHV: "CUNG", nghiaTV: "CÃ¢y cung", on: "ã‚­ãƒ¥ã‚¦", kun: "ã‚†ã¿", ti: "TÆ°á»£ng hÃ¬nh.", ta: "**Cá»©u** (Kyuu) **DÆ° Mi** (Yumi) cÃ¢y cung.", examples: [{ w: "å¼“", r: "ã‚†ã¿", m: "CÃ¢y cung" }, { w: "å¼“é“", r: "ãã‚…ã†ã©ã†", m: "Cung Ä‘áº¡o" }] },
            { char: "ç‰›", nghiaHV: "NGÆ¯U", nghiaTV: "Con bÃ²", on: "ã‚®ãƒ¥ã‚¦", kun: "ã†ã—", ti: "TÆ°á»£ng hÃ¬nh.", ta: "**Giu** (Gyuu) **U Si** (Ushi) con bÃ².", examples: [{ w: "ç‰›ä¹³", r: "ãã‚…ã†ã«ã‚…ã†", m: "Sá»¯a bÃ²" }, { w: "ç‰›", r: "ã†ã—", m: "Con bÃ²" }] },
            { char: "æ±²", nghiaHV: "Cáº¤P", nghiaTV: "MÃºc nÆ°á»›c", on: "ã‚­ãƒ¥ã‚¦", kun: "ã", ti: "NÆ°á»›c (**Thá»§y æ°µ**) Ä‘uá»•i ká»‹p (**Cáº­p åŠ**) mÃºc lÃªn.", ta: "**Cá»©u** (Kyuu) **CÆ°** (Kumu) mÃºc.", examples: [{ w: "æ±²ã‚€", r: "ãã‚€", m: "MÃºc (nÆ°á»›c)" }] }
        ];

        // --- STATE ---
        let currentTab = 'learn';
        let currentQuizIndex = 0;
        let quizScore = 0;
        let currentQuizQuestion = null;
        let currentStrokeSvg = null;

        // --- UTILS ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                // Clean text for speech: remove special chars
                const clean = text.replace(/\[.*?\]/g, '').replace(/<.*?>/g, '').replace(/ãƒ»/g, '').replace(/\*/g, '');
                const u = new SpeechSynthesisUtterance(clean);
                u.lang = 'ja-JP'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        function getKanjiHex(kanji) {
            return kanji.charCodeAt(0).toString(16).padStart(5, '0');
        }

        async function fetchKanjiSvg(hex) {
            try {
                const response = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${hex}.svg`);
                if (!response.ok) throw new Error('Not found');
                return await response.text();
            } catch (e) { return null; }
        }

        // --- TABS ---
        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            
            const btnLearn = document.getElementById('tab-learn');
            const btnQuiz = document.getElementById('tab-quiz');
            
            if (tab === 'learn') {
                btnLearn.classList.add('tab-active'); btnLearn.classList.remove('tab-inactive');
                btnQuiz.classList.add('tab-inactive'); btnQuiz.classList.remove('tab-active');
            } else {
                btnQuiz.classList.add('tab-active'); btnQuiz.classList.remove('tab-inactive');
                btnLearn.classList.add('tab-inactive'); btnLearn.classList.remove('tab-active');
                startQuiz();
            }
        }

        // --- RENDER LEARN ---
        function renderLearn() {
            const grid = document.getElementById('kanji-grid');
            grid.innerHTML = kanjiData.map((k, idx) => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition duration-300 flex flex-col group">
                    <!-- HEADER -->
                    <div class="bg-sky-50 p-4 border-b border-sky-100 flex justify-between items-start relative">
                        <div class="flex gap-4 items-center">
                            <div class="w-16 h-16 bg-white rounded-lg flex items-center justify-center border-2 border-sky-200 cursor-pointer hover:border-sky-400 transition shadow-sm" onclick="showStrokeOrder('${k.char}')">
                                <span class="text-4xl font-bold kanji-font text-gray-800">${k.char}</span>
                            </div>
                            <div>
                                <div class="text-red-600 font-bold text-lg tracking-wide">${k.nghiaHV}</div>
                                <div class="text-gray-600 text-sm font-medium">${k.nghiaTV}</div>
                            </div>
                        </div>
                        <button onclick="showStrokeOrder('${k.char}')" class="text-sky-500 hover:text-sky-700 bg-white rounded-full p-2 w-8 h-8 flex items-center justify-center shadow-sm border border-sky-100"><i class="fas fa-pen-nib text-xs"></i></button>
                        <div class="absolute -bottom-3 right-4 text-6xl text-gray-100 font-black -z-0 pointer-events-none select-none">${idx + 1768}</div>
                    </div>
                    
                    <!-- BODY -->
                    <div class="p-4 space-y-3 z-10 relative flex-grow flex flex-col">
                        <!-- READINGS with Audio -->
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="bg-gray-50 rounded p-2 border border-gray-100">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-[10px] uppercase font-bold text-gray-400">On</span>
                                    <button onclick="speak('${k.on}')" class="text-sky-400 hover:text-sky-600"><i class="fas fa-volume-up text-xs"></i></button>
                                </div>
                                <span class="font-bold text-sky-800 kanji-font text-base">${k.on}</span>
                            </div>
                            <div class="bg-gray-50 rounded p-2 border border-gray-100">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-[10px] uppercase font-bold text-gray-400">Kun</span>
                                    <button onclick="speak('${k.kun}')" class="text-sky-400 hover:text-sky-600"><i class="fas fa-volume-up text-xs"></i></button>
                                </div>
                                <span class="font-bold text-sky-800 kanji-font text-base">${k.kun}</span>
                            </div>
                        </div>
                        
                        <!-- MNEMONICS (AZAKANJI STYLE) -->
                        <div class="space-y-2">
                            <div class="bg-orange-50 p-2 rounded text-xs text-orange-900 border border-orange-100">
                                <span class="font-bold text-orange-600 mr-1">ğŸ–¼ï¸ HÃ¬nh:</span> ${k.ti}
                            </div>
                            <div class="bg-blue-50 p-2 rounded text-xs text-blue-900 border border-blue-100">
                                <span class="font-bold text-blue-600 mr-1">ğŸ”Š Ã‚m:</span> ${k.ta.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-blue-700">$1</span>')}
                            </div>
                        </div>

                        <!-- EXAMPLES with Audio -->
                        <div class="pt-2 border-t border-gray-100 space-y-2 mt-auto">
                            ${k.examples.map(ex => `
                                <div class="flex justify-between items-center group/ex cursor-pointer p-1 rounded hover:bg-gray-50" onclick="speak('${ex.w}')">
                                    <div>
                                        <div class="kanji-font font-bold text-gray-800 text-sm">${ex.w} <span class="text-xs font-normal text-gray-400">(${ex.r})</span></div>
                                        <div class="text-xs text-gray-500">${ex.m}</div>
                                    </div>
                                    <i class="fas fa-volume-up text-xs text-gray-300 group-hover/ex:text-sky-500 transition"></i>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- STROKE ORDER MODAL ---
        async function showStrokeOrder(kanji) {
            const hex = getKanjiHex(kanji);
            document.getElementById('stroke-modal').classList.remove('hidden');
            document.getElementById('stroke-modal-char').innerText = kanji;
            
            const animContainer = document.getElementById('stroke-animation-container');
            const gridContainer = document.getElementById('stroke-grid-container');
            animContainer.innerHTML = '<span class="text-xs text-gray-400">Äang táº£i...</span>';
            
            const svgContent = await fetchKanjiSvg(hex);
            if (!svgContent) {
                animContainer.innerHTML = "<p class='p-4 text-red-500 text-xs'>Lá»—i</p>";
                gridContainer.innerHTML = "";
                return;
            }

            // Animation Setup
            animContainer.innerHTML = svgContent;
            const mainSvg = animContainer.querySelector('svg');
            mainSvg.setAttribute('width', '100%'); mainSvg.setAttribute('height', '100%');
            const paths = mainSvg.querySelectorAll('path');
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len;
                p.style.stroke = "#333"; p.style.strokeWidth = "4"; p.style.fill = "none";
                p.style.strokeLinecap = "round"; p.style.strokeLinejoin = "round";
            });
            currentStrokeSvg = mainSvg;
            replayStrokeAnimation();

            // Grid Setup
            gridContainer.innerHTML = '';
            for(let i=0; i<paths.length; i++) {
                const box = document.createElement('div');
                box.className = "w-12 h-12 md:w-16 md:h-16 bg-white border border-gray-200 relative stroke-grid-box flex items-center justify-center";
                const parser = new DOMParser();
                const svgClone = parser.parseFromString(svgContent, "image/svg+xml").querySelector('svg');
                svgClone.setAttribute('width', '100%'); svgClone.setAttribute('height', '100%');
                svgClone.querySelectorAll('path').forEach((p, idx) => {
                    p.style.fill="none"; p.style.strokeLinecap="round"; p.style.strokeLinejoin="round";
                    if(idx < i) { p.style.stroke="#9ca3af"; p.style.strokeWidth="3"; }
                    else if(idx === i) { p.style.stroke="#000"; p.style.strokeWidth="4"; }
                    else p.style.display="none";
                });
                box.appendChild(svgClone);
                gridContainer.appendChild(box);
            }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition = 'none'; p.style.strokeDashoffset = p.getTotalLength(); });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                p.style.transition = `stroke-dashoffset 0.6s ease-in-out ${delay}s`;
                p.style.strokeDashoffset = '0';
                delay += 0.6;
            });
        }

        function closeStrokeModal() { document.getElementById('stroke-modal').classList.add('hidden'); }

        // --- QUIZ LOGIC ---
        function startQuiz() {
            quizScore = 0;
            currentQuizIndex = 0;
            document.getElementById('score-display').innerText = '0';
            loadQuestion();
        }

        function loadQuestion() {
            const qType = Math.random() > 0.5 ? 'kanji-meaning' : 'meaning-kanji';
            const target = kanjiData[Math.floor(Math.random() * kanjiData.length)];
            currentQuizQuestion = { target, type: qType };

            const display = document.getElementById('quiz-kanji-display');
            const questionText = document.getElementById('quiz-question-text');
            const optionsArea = document.getElementById('options-area');
            
            document.getElementById('feedback-area').classList.add('hidden');
            document.getElementById('q-current').innerText = currentQuizIndex + 1;
            document.getElementById('quiz-progress').style.width = `${((currentQuizIndex) / 10) * 100}%`;

            // Generate distractors
            const others = kanjiData.filter(k => k !== target).sort(() => 0.5 - Math.random()).slice(0, 3);
            const options = [target, ...others].sort(() => 0.5 - Math.random());

            if (qType === 'kanji-meaning') {
                display.innerText = target.char;
                questionText.innerText = "HÃ¡n tá»± nÃ y cÃ³ nghÄ©a lÃ  gÃ¬?";
                optionsArea.innerHTML = options.map(opt => `
                    <button onclick="checkAnswer('${opt.char}')" class="quiz-opt-btn bg-white border-2 border-gray-200 p-4 rounded-xl hover:border-sky-400 hover:bg-sky-50 transition active:scale-95 shadow-sm text-lg font-bold text-gray-700">
                        ${opt.nghiaHV} (${opt.nghiaTV})
                    </button>
                `).join('');
            } else {
                display.innerText = target.nghiaHV;
                questionText.innerText = `Chá»n Kanji tÆ°Æ¡ng á»©ng vá»›i "${target.nghiaTV}"`;
                optionsArea.innerHTML = options.map(opt => `
                    <button onclick="checkAnswer('${opt.char}')" class="quiz-opt-btn bg-white border-2 border-gray-200 p-4 rounded-xl hover:border-sky-400 hover:bg-sky-50 transition active:scale-95 shadow-sm text-4xl font-bold kanji-font text-gray-800">
                        ${opt.char}
                    </button>
                `).join('');
            }
        }

        function checkAnswer(selectedChar) {
            const btns = document.querySelectorAll('.quiz-opt-btn');
            btns.forEach(b => b.disabled = true);

            const isCorrect = selectedChar === currentQuizQuestion.target.char;
            const feedbackArea = document.getElementById('feedback-area');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackDetail = document.getElementById('feedback-detail');

            feedbackArea.classList.remove('hidden');

            if (isCorrect) {
                quizScore += 10;
                document.getElementById('score-display').innerText = quizScore;
                feedbackTitle.innerHTML = '<i class="fas fa-check-circle text-emerald-500 mr-2"></i> ChÃ­nh xÃ¡c!';
                feedbackTitle.className = "font-bold text-lg mb-1 flex items-center text-emerald-700";
                feedbackDetail.innerHTML = `
                    <span class="text-3xl kanji-font font-bold text-gray-800 mr-2">${currentQuizQuestion.target.char}</span>
                    <span class="font-bold text-red-600">${currentQuizQuestion.target.nghiaHV}</span>: ${currentQuizQuestion.target.nghiaTV}
                `;
                feedbackArea.className = "bg-emerald-50 rounded-xl p-4 border border-emerald-200 text-left animate-fade-in";
                speak(currentQuizQuestion.target.char);
            } else {
                feedbackTitle.innerHTML = '<i class="fas fa-times-circle text-red-500 mr-2"></i> Sai rá»“i!';
                feedbackTitle.className = "font-bold text-lg mb-1 flex items-center text-red-700";
                feedbackDetail.innerHTML = `ÄÃ¡p Ã¡n Ä‘Ãºng lÃ : <strong>${currentQuizQuestion.target.char} (${currentQuizQuestion.target.nghiaTV})</strong>`;
                feedbackArea.className = "bg-red-50 rounded-xl p-4 border border-red-200 text-left animate-fade-in wrong-anim";
            }
        }

        function nextQuestion() {
            currentQuizIndex++;
            if (currentQuizIndex >= 10) {
                alert(`HoÃ n thÃ nh! Báº¡n Ä‘áº¡t ${quizScore} Ä‘iá»ƒm.`);
                startQuiz();
            } else {
                loadQuestion();
            }
        }

        // INIT
        renderLearn();

    </script>
</body>
</html>
