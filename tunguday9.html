<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 9: Điều kiện & Khả năng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 9: Điều kiện & Khả năng</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">ゴルフ</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">ゴルフ</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Golf (gôn)</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 9 (N5 - N4)</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (N5 - N4) ---
        const grammarRepo = {
            "ta_koto_ga_aru": { title: "Đã từng (Kinh nghiệm)", formula: "Vた + ことがある", desc: "N4: Nói về kinh nghiệm trong quá khứ.", ex: "富士山に登ったことがあります。" },
            "tari_tari": { title: "Liệt kê hành động", formula: "Vたり Vたり します", desc: "N4: Liệt kê các hành động đại diện (không cần theo thứ tự).", ex: "日曜日は本を読んだり、テレビを見たりします。" },
            "potential": { title: "Thể khả năng", formula: "Vれる / Vられる", desc: "N4: Có thể làm gì đó.", ex: "漢字が読めます。" },
            "tara": { title: "Nếu/Sau khi", formula: "Vたら", desc: "N4: Điều kiện giả định hoặc hành động nối tiếp.", ex: "お金があったら、旅行します。" },
            "to_conditional": { title: "Hễ...thì...", formula: "Vる + と", desc: "N4: Điều kiện dẫn đến kết quả tất yếu.", ex: "ボタンを押すと、ドアが開きます。" },
            "ndesu": { title: "Giải thích/Nhấn mạnh", formula: "V/Adj + んです", desc: "N4: Giải thích lý do, tình huống hoặc nhấn mạnh sự quan tâm.", ex: "頭が痛いんです。" },
            "te_mo_ii": { title: "Làm...được không", formula: "Vてもいい", desc: "N5/N4: Xin phép làm gì đó.", ex: "写真を撮ってもいいですか。" },
            "nai_de": { title: "Xin đừng...", formula: "Vないで + ください", desc: "N5: Yêu cầu ai đó không làm gì.", ex: "ここでタバコを吸わないでください。" },
            "narimasu": { title: "Trở nên/Trở thành", formula: "Adj(ku/ni) / N(ni) + なります", desc: "N5: Sự thay đổi trạng thái.", ex: "寒くなります。" },
            "adverb": { title: "Phó từ (Tính từ)", formula: "Adj(i)く / Adj(na)に + V", desc: "N5/N4: Biến tính từ thành phó từ bổ nghĩa cho động từ.", ex: "早く帰ります。" },
            "nakucha": { title: "Phải... (Văn nói)", formula: "Vなくちゃ", desc: "N3: Dạng rút gọn của Vなければなりません.", ex: "もう行かなくちゃ。" },
            "mashou": { title: "Cùng làm nhé", formula: "Vましょう", desc: "N5: Rủ rê, đề nghị.", ex: "帰りましょう。" },
            "volitional": { title: "Thể ý định", formula: "Vよう", desc: "N4: Dùng trong văn nói thân mật để rủ rê hoặc tỏ ý định.", ex: "行こう！" },
            "wa_desu": { title: "Cấu trúc định danh", formula: "N1 は N2 です", desc: "N5: Khẳng định N1 là N2.", ex: "これはペンです。" },
            "ni_iku": { title: "Đi để...", formula: "V(bỏ masu)/N + に行く", desc: "N5: Đi đâu đó để thực hiện mục đích gì.", ex: "映画を見に行きます。" },
            "te_iru": { title: "Đang/Trạng thái", formula: "Vている", desc: "N5/N4: Hành động đang diễn ra hoặc kết quả trạng thái.", ex: "雨が降っています。" },
            "te_kudasai": { title: "Hãy...", formula: "Vてください", desc: "N5: Yêu cầu, nhờ vả lịch sự.", ex: "座ってください。" },
            "nan_de": { title: "Tại sao/Bằng gì", formula: "何で", desc: "N5: Hỏi lý do hoặc phương tiện.", ex: "何で来ましたか。" }
        };

        // --- 2. VOCABULARY DATA (Day 9) ---
        const vocabData = [
            { "STT": 1, "Kanji": "", "Nghĩa": "Golf (gôn)", "Furigana": "ゴルフ", "type": "activity", "conv": { "polite": "ゴルフをしたことがありますか。", "pVi": "Bạn đã từng chơi golf chưa?", "casual": "ゴルフ、したことある？", "cVi": "Chơi golf bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 2, "Kanji": "日記", "Nghĩa": "Nhật kí", "Furigana": "にっき", "type": "noun", "conv": { "polite": "毎日日記を書いたり、本を読んだりします。", "pVi": "Hàng ngày tôi viết nhật ký và đọc sách.", "casual": "毎日日記書いたり、本読んだりする。", "cVi": "Ngày nào cũng viết nhật ký, đọc sách các kiểu.", "gIds": ["tari_tari"] } },
            { "STT": 3, "Kanji": "", "Nghĩa": "Có thể", "Furigana": "できます", "type": "verb", "conv": { "polite": "スキーができますか。", "pVi": "Bạn có biết trượt tuyết không?", "casual": "スキーできる？", "cVi": "Biết trượt tuyết không?", "gIds": ["potential"] } },
            { "STT": 4, "Kanji": "弾きます", "Nghĩa": "Chơi (nhạc cụ)", "Furigana": "ひきます", "type": "verb", "conv": { "polite": "ピアノを弾いたことがありますか。", "pVi": "Bạn đã từng chơi piano chưa?", "casual": "ピアノ弾いたことある？", "cVi": "Chơi piano bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 5, "Kanji": "歌います", "Nghĩa": "Hát", "Furigana": "うたいます", "type": "verb", "conv": { "polite": "歌を歌いませんか。", "pVi": "Hát một bài không?", "casual": "歌、歌わない？", "cVi": "Hát hông?", "gIds": ["mashou"] } },
            { "STT": 6, "Kanji": "踊ります", "Nghĩa": "Nhảy", "Furigana": "おどります", "type": "verb", "conv": { "polite": "週末は踊ったり、歌ったりします。", "pVi": "Cuối tuần tôi nhảy và hát.", "casual": "週末は踊ったり歌ったりする。", "cVi": "Cuối tuần toàn nhảy với hát.", "gIds": ["tari_tari"] } },
            { "STT": 7, "Kanji": "運転します", "Nghĩa": "Lái xe", "Furigana": "うんてんします", "type": "verb", "conv": { "polite": "車を運転したことがありますか。", "pVi": "Bạn đã từng lái xe chưa?", "casual": "車運転したことある？", "cVi": "Lái xe bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 8, "Kanji": "自分", "Nghĩa": "Tự mình", "Furigana": "じぶん", "type": "noun", "conv": { "polite": "どうして自分で料理を作りますか。", "pVi": "Tại sao bạn tự nấu ăn?", "casual": "なんで自分で料理作るの？", "cVi": "Sao tự nấu ăn thế?", "gIds": ["nan_de"] } },
            { "STT": 9, "Kanji": "〜度", "Nghĩa": "độ", "Furigana": "ど", "type": "counter", "conv": { "polite": "温度が上がったら、エアコンをつけましょう。", "pVi": "Nếu nhiệt độ tăng, hãy bật điều hòa.", "casual": "温度上がったら、エアコンつけよう。", "cVi": "Nóng lên thì bật điều hòa nhé.", "gIds": ["tara", "mashou"] } },
            { "STT": 10, "Kanji": "道", "Nghĩa": "Con đường", "Furigana": "みち", "type": "place", "conv": { "polite": "この道は狭くて、危ないです。", "pVi": "Con đường này hẹp và nguy hiểm.", "casual": "この道、狭くて危ないよ。", "cVi": "Đường này hẹp nguy hiểm đấy.", "gIds": ["shi_shi"] } },
            { "STT": 11, "Kanji": "", "Nghĩa": "Núm vặn", "Furigana": "つまみ", "type": "noun", "conv": { "polite": "つまみを回したら、音が大きくなります。", "pVi": "Nếu vặn núm, âm thanh sẽ lớn hơn.", "casual": "つまみ回すと、音大きくなるよ。", "cVi": "Vặn cái này là tiếng to lên đấy.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 12, "Kanji": "", "Nghĩa": "Nút bấm", "Furigana": "ボタン", "type": "noun", "conv": { "polite": "このボタンを押したら、ドアが開きます。", "pVi": "Nếu ấn nút này, cửa sẽ mở.", "casual": "このボタン押すと、ドア開くよ。", "cVi": "Ấn nút này là cửa mở.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 13, "Kanji": "", "Nghĩa": "Góc", "Furigana": "かど", "type": "place", "conv": { "polite": "角を曲がったら、駅があります。", "pVi": "Nếu rẽ ở góc, sẽ có nhà ga.", "casual": "角曲がると、駅あるよ。", "cVi": "Rẽ góc kia là có nhà ga.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 14, "Kanji": "橋", "Nghĩa": "Cầu", "Furigana": "はし", "type": "place", "conv": { "polite": "橋を渡ったら、公園があります。", "pVi": "Nếu qua cầu, sẽ có công viên.", "casual": "橋渡ると、公園ある。", "cVi": "Qua cầu là có công viên.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 15, "Kanji": "病気", "Nghĩa": "Bệnh", "Furigana": "びょうき", "type": "noun", "conv": { "polite": "どうして病気になりましたか。", "pVi": "Tại sao bạn bị ốm?", "casual": "なんで病気になったの？", "cVi": "Sao lại ốm thế?", "gIds": ["nan_de"] } },
            { "STT": 16, "Kanji": "回します", "Nghĩa": "Xoay", "Furigana": "まわします", "type": "verb", "conv": { "polite": "つまみを回しませんか。", "pVi": "Bạn vặn núm không?", "casual": "つまみ回さない？", "cVi": "Vặn cái núm không?", "gIds": ["mashou"] } },
            { "STT": 17, "Kanji": "引きます", "Nghĩa": "Kéo", "Furigana": "ひきます", "type": "verb", "conv": { "polite": "ドアを引いたら、開きます。", "pVi": "Nếu kéo cửa, nó sẽ mở.", "casual": "ドア引くと、開くよ。", "cVi": "Kéo cửa là mở đấy.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 18, "Kanji": "渡ります", "Nghĩa": "Đi qua", "Furigana": "わたります", "type": "verb", "conv": { "polite": "橋を渡りませんか。", "pVi": "Đi qua cầu không?", "casual": "橋渡らない？", "cVi": "Qua cầu hông?", "gIds": ["mashou"] } },
            { "STT": 19, "Kanji": "必要", "Nghĩa": "Cần thiết", "Furigana": "ひつよう", "type": "adj_na", "conv": { "polite": "お金があったら、必要なものを買います。", "pVi": "Nếu có tiền, tôi sẽ mua những thứ cần thiết.", "casual": "お金あったら、必要なもの買う。", "cVi": "Có tiền là mua đồ cần thiết ngay.", "gIds": ["tara"] } },
            { "STT": 20, "Kanji": "要ります", "Nghĩa": "Cần", "Furigana": "いります", "type": "verb", "conv": { "polite": "お金が要ったら、言ってください。", "pVi": "Nếu cần tiền, hãy nói cho tôi.", "casual": "お金要ったら、言ってね。", "cVi": "Cần tiền thì bảo nhé.", "gIds": ["tara", "te_kudasai"] } },
            { "STT": 21, "Kanji": "行きます", "Nghĩa": "Đi", "Furigana": "いきます", "type": "verb", "conv": { "polite": "行ってきますと言ったら、家を出ます。", "pVi": "Nếu nói 'Itte kimasu', tôi sẽ ra khỏi nhà.", "casual": "行ってきますって言ったら、家出る。", "cVi": "Nói 'Itte kimasu' là đi ra ngoài.", "gIds": ["tara"] } },
            { "STT": 22, "Kanji": "", "Nghĩa": "Về nhà", "Furigana": "ただいま", "type": "phrase", "conv": { "polite": "ただいまと言ったら、家に入ります。", "pVi": "Nếu nói 'Tadaima', tôi sẽ vào nhà.", "casual": "ただいまって言ったら、家入る。", "cVi": "Nói 'Tadaima' là vào nhà.", "gIds": ["tara"] } },
            { "STT": 23, "Kanji": "食", "Nghĩa": "Ăn", "Furigana": "たべます", "type": "verb", "conv": { "polite": "食べたら、いただきますと言います。", "pVi": "Nếu ăn thì sẽ nói 'Itadakimasu'.", "casual": "食べたら、いただきますって言う。", "cVi": "Ăn thì nói 'Itadakimasu'.", "gIds": ["tara"] } },
            { "STT": 24, "Kanji": "", "Nghĩa": "Cảm ơn bữa ăn", "Furigana": "ごちそうさま", "type": "phrase", "conv": { "polite": "食べ終わったら、ごちそうさまと言います。", "pVi": "Nếu ăn xong thì sẽ nói 'Gochisousama'.", "casual": "食べ終わったら、ごちそうさまって言う。", "cVi": "Ăn xong thì nói 'Gochisousama'.", "gIds": ["tara"] } },
            { "STT": 25, "Kanji": "食事", "Nghĩa": "Bữa ăn", "Furigana": "しょくじ", "type": "noun", "conv": { "polite": "食事をしたり、映画を見たりします。", "pVi": "Tôi ăn uống và xem phim.", "casual": "食事したり、映画見たりする。", "cVi": "Nào là ăn uống, nào là xem phim.", "gIds": ["tari_tari"] } },
            { "STT": 26, "Kanji": "", "Nghĩa": "Thùng các-tông", "Furigana": "ダンボール", "type": "noun", "conv": { "polite": "ダンボールは軽くて、便利です。", "pVi": "Thùng các-tông nhẹ và tiện lợi.", "casual": "ダンボール、軽くて便利だね。", "cVi": "Thùng này nhẹ mà tiện ghê.", "gIds": ["shi_shi"] } },
            { "STT": 27, "Kanji": "", "Nghĩa": "Danh mục", "Furigana": "カタログ", "type": "noun", "conv": { "polite": "カタログを見ませんか。", "pVi": "Xem danh mục sản phẩm không?", "casual": "カタログ見ない？", "cVi": "Xem catalog không?", "gIds": ["mashou"] } },
            { "STT": 28, "Kanji": "時刻表", "Nghĩa": "Bảng giờ tàu", "Furigana": "じこくひょう", "type": "noun", "conv": { "polite": "時刻表を見たら、時間が分かります。", "pVi": "Nếu xem bảng giờ tàu, bạn sẽ biết thời gian.", "casual": "時刻表見ると、時間分かるよ。", "cVi": "Xem bảng giờ là biết mấy giờ ngay.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 29, "Kanji": "発表", "Nghĩa": "Phát biểu", "Furigana": "はっぴょう", "type": "verb", "conv": { "polite": "発表したことがありますか。", "pVi": "Bạn đã từng phát biểu chưa?", "casual": "発表したことある？", "cVi": "Phát biểu bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 30, "Kanji": "引っ越します", "Nghĩa": "Chuyển nhà", "Furigana": "ひっこします", "type": "verb", "conv": { "polite": "引っ越したら、教えてください。", "pVi": "Nếu chuyển nhà, hãy nói cho tôi biết.", "casual": "引っ越したら、教えてね。", "cVi": "Chuyển nhà thì bảo tớ nhé.", "gIds": ["tara", "te_kudasai"] } },
            { "STT": 31, "Kanji": "言います", "Nghĩa": "Nói", "Furigana": "いいます", "type": "verb", "conv": { "polite": "はっきり言いました。", "pVi": "Tôi đã nói rõ ràng rồi.", "casual": "はっきり言ったよ。", "cVi": "Nói rõ rồi mà.", "gIds": ["ta_form"] } },
            { "STT": 32, "Kanji": "", "Nghĩa": "Gõ cửa", "Furigana": "ノックします", "type": "verb", "conv": { "polite": "ドアをノックしませんか。", "pVi": "Gõ cửa không?", "casual": "ドア、ノックしない？", "cVi": "Gõ cửa hông?", "gIds": ["mashou"] } },
            { "STT": 33, "Kanji": "", "Nghĩa": "Chỉ", "Furigana": "だけ", "type": "noun", "conv": { "polite": "これだけ食べます。", "pVi": "Tôi chỉ ăn cái này.", "casual": "これだけ食べる。", "cVi": "Chỉ ăn cái này thôi.", "gIds": ["dake"] } },
            { "STT": 34, "Kanji": "", "Nghĩa": "Chỉ (phủ định)", "Furigana": "しか", "type": "noun", "conv": { "polite": "日本語しか話せません。", "pVi": "Tôi chỉ nói được tiếng Nhật.", "casual": "日本語しか話せない。", "cVi": "Chỉ nói được mỗi tiếng Nhật.", "gIds": ["potential"] } },
            { "STT": 35, "Kanji": "何回も", "Nghĩa": "Nhiều lần", "Furigana": "なんかいも", "type": "adverb", "conv": { "polite": "何回も行ったことがあります。", "pVi": "Tôi đã từng đi nhiều lần.", "casual": "何回も行ったことある。", "cVi": "Đi suốt rồi.", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 36, "Kanji": "一生懸命", "Nghĩa": "Chăm chỉ", "Furigana": "いっしょうけんめい", "type": "adverb", "conv": { "polite": "一生懸命勉強したら、上手になります。", "pVi": "Nếu học chăm chỉ, sẽ giỏi lên.", "casual": "一生懸命勉強すると、上手になるよ。", "cVi": "Cày cuốc chăm chỉ là giỏi ngay.", "gIds": ["tara", "narimasu"] } },
            { "STT": 37, "Kanji": "失礼", "Nghĩa": "Thất lễ", "Furigana": "しつれい", "type": "phrase", "conv": { "polite": "部屋に入ったら、失礼しますと言います。", "pVi": "Nếu vào phòng, tôi sẽ nói 'Shitsurei shimasu'.", "casual": "部屋入ったら、失礼しますって言う。", "cVi": "Vào phòng là phải chào đấy.", "gIds": ["tara"] } },
            { "STT": 38, "Kanji": "", "Nghĩa": "Áo khoác", "Furigana": "コート", "type": "noun", "conv": { "polite": "コートを着たり、脱いだりします。", "pVi": "Tôi mặc áo khoác rồi cởi ra.", "casual": "コート着たり脱いだりする。", "cVi": "Cứ mặc vào rồi lại cởi ra.", "gIds": ["tari_tari"] } },
            { "STT": 39, "Kanji": "", "Nghĩa": "Vest", "Furigana": "スーツ", "type": "noun", "conv": { "polite": "スーツを着たことがありますか。", "pVi": "Bạn đã từng mặc vest chưa?", "casual": "スーツ着たことある？", "cVi": "Mặc vest bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 40, "Kanji": "", "Nghĩa": "Áo len", "Furigana": "セーター", "type": "noun", "conv": { "polite": "セーターは暖かくて、軽いです。", "pVi": "Áo len ấm và nhẹ.", "casual": "セーター、暖かくて軽いね。", "cVi": "Áo len này ấm mà nhẹ ghê.", "gIds": ["shi_shi"] } },
            { "STT": 41, "Kanji": "", "Nghĩa": "Khăn tay", "Furigana": "ハンカチ", "type": "noun", "conv": { "polite": "ハンカチはどこですか。", "pVi": "Khăn tay ở đâu?", "casual": "ハンカチどこ？", "cVi": "Khăn tay đâu rồi?", "gIds": ["wa_doko"] } },
            { "STT": 42, "Kanji": "眼鏡", "Nghĩa": "Kính", "Furigana": "めがね", "type": "noun", "conv": { "polite": "眼鏡をかけたら、よく見えます。", "pVi": "Nếu đeo kính, sẽ nhìn rõ.", "casual": "眼鏡かけると、よく見える。", "cVi": "Đeo kính vào là rõ ngay.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 43, "Kanji": "", "Nghĩa": "Cà vạt", "Furigana": "ネクタイ", "type": "noun", "conv": { "polite": "ネクタイを締めませんか。", "pVi": "Thắt cà vạt không?", "casual": "ネクタイ締めない？", "cVi": "Thắt cà vạt không?", "gIds": ["mashou"] } },
            { "STT": 44, "Kanji": "お菓子", "Nghĩa": "Kẹo", "Furigana": "おかし", "type": "food", "conv": { "polite": "お菓子を食べたことがありますか。", "pVi": "Bạn đã từng ăn kẹo chưa?", "casual": "お菓子食べたことある？", "cVi": "Ăn kẹo bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 45, "Kanji": "", "Nghĩa": "Sô cô la", "Furigana": "チョコレート", "type": "food", "conv": { "polite": "チョコレートを食べたり、飲んだりします。", "pVi": "Tôi ăn sô cô la và uống.", "casual": "チョコ食べたり飲んだりする。", "cVi": "Ăn uống sô cô la các kiểu.", "gIds": ["tari_tari"] } },
            { "STT": 46, "Kanji": "", "Nghĩa": "Hăm bơ gơ", "Furigana": "ハンバーガー", "type": "food", "conv": { "polite": "ハンバーガーを食べませんか。", "pVi": "Ăn hamburger không?", "casual": "ハンバーガー食べない？", "cVi": "Ăn hamburger hông?", "gIds": ["mashou"] } },
            { "STT": 47, "Kanji": "履きます", "Nghĩa": "Xỏ (giày)", "Furigana": "はきます", "type": "verb", "conv": { "polite": "靴を履いたら、出かけましょう。", "pVi": "Sau khi xỏ giày, chúng ta hãy ra ngoài.", "casual": "靴履いたら、出かけよう。", "cVi": "Giày dép xong xuôi thì đi thôi.", "gIds": ["tara", "volitional"] } },
            { "STT": 48, "Kanji": "被ります", "Nghĩa": "Đội (mũ)", "Furigana": "かぶります", "type": "verb", "conv": { "polite": "帽子を被ったことがありますか。", "pVi": "Bạn đã từng đội mũ chưa?", "casual": "帽子被ったことある？", "cVi": "Đội mũ bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 49, "Kanji": "かけます", "Nghĩa": "Đeo (kính)", "Furigana": "かけます", "type": "verb", "conv": { "polite": "眼鏡をかけたら、よく見えます。", "pVi": "Nếu đeo kính, sẽ nhìn rõ.", "casual": "眼鏡かけると、よく見える。", "cVi": "Đeo kính vào nhìn rõ lắm.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 50, "Kanji": "脱ぎます", "Nghĩa": "Cởi", "Furigana": "ぬぎます", "type": "verb", "conv": { "polite": "服を脱いでから、寝ましょう。", "pVi": "Sau khi cởi quần áo, chúng ta hãy ngủ.", "casual": "服脱いでから、寝よう。", "cVi": "Cởi đồ ra rồi ngủ.", "gIds": ["te_form_cause", "volitional"] } },
            { "STT": 51, "Kanji": "", "Nghĩa": "Hủy", "Furigana": "キャンセルします", "type": "verb", "conv": { "polite": "予約をキャンセルしませんか。", "pVi": "Hủy đặt chỗ không?", "casual": "予約キャンセルしない？", "cVi": "Hủy kèo không?", "gIds": ["mashou"] } },
            { "STT": 52, "Kanji": "", "Nghĩa": "Hùng biện", "Furigana": "スピーチ", "type": "noun", "conv": { "polite": "スピーチコンテストに出たことがありますか。", "pVi": "Bạn đã từng tham gia cuộc thi hùng biện chưa?", "casual": "スピーチコンテスト出たことある？", "cVi": "Thi hùng biện bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 53, "Kanji": "", "Nghĩa": "Đội", "Furigana": "チーム", "type": "noun", "conv": { "polite": "チームでサッカーをしませんか。", "pVi": "Chơi bóng đá theo đội không?", "casual": "チームでサッカーしない？", "cVi": "Đá bóng theo đội đê?", "gIds": ["mashou"] } },
            { "STT": 54, "Kanji": "無駄", "Nghĩa": "Lãng phí", "Furigana": "むだ", "type": "adj_na", "conv": { "polite": "時間を無駄にしたら、後悔します。", "pVi": "Nếu lãng phí thời gian, bạn sẽ hối hận.", "casual": "時間無駄にすると、後悔するよ。", "cVi": "Phí thời gian là hối hận đấy.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 55, "Kanji": "", "Nghĩa": "Tuyệt vời", "Furigana": "すごい", "type": "adj_i", "conv": { "polite": "彼はすごい人ですね。", "pVi": "Anh ấy là một người tuyệt vời nhỉ.", "casual": "彼、すごい人だね。", "cVi": "Ông ấy siêu thật.", "gIds": ["wa_desu"] } },
            { "STT": 56, "Kanji": "素敵", "Nghĩa": "Tuyệt vời", "Furigana": "すてき", "type": "adj_na", "conv": { "polite": "素敵なドレスを着たことがありますか。", "pVi": "Bạn đã từng mặc váy đẹp chưa?", "casual": "素敵なドレス着たことある？", "cVi": "Mặc váy đẹp bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 57, "Kanji": "楽しい", "Nghĩa": "Vui vẻ", "Furigana": "たのしい", "type": "adj_i", "conv": { "polite": "週末は楽しかったですか。", "pVi": "Cuối tuần vui vẻ chứ?", "casual": "週末、楽しかった？", "cVi": "Cuối tuần vui hông?", "gIds": ["ta_form"] } },
            { "STT": 58, "Kanji": "勝ちます", "Nghĩa": "Thắng", "Furigana": "かちます", "type": "verb", "conv": { "polite": "試合に勝ったら、嬉しいです。", "pVi": "Nếu thắng trận đấu, tôi sẽ vui.", "casual": "試合に勝つと、嬉しい。", "cVi": "Thắng là vui rồi.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 59, "Kanji": "負けます", "Nghĩa": "Thua", "Furigana": "まけます", "type": "verb", "conv": { "polite": "試合に負けても、頑張りましょう。", "pVi": "Dù thua trận đấu, chúng ta hãy cố gắng.", "casual": "試合に負けても、頑張ろう。", "cVi": "Thua thì cũng phải cố gắng.", "gIds": ["te_mo", "volitional"] } },
            { "STT": 60, "Kanji": "", "Nghĩa": "Cơ hội", "Furigana": "チャンス", "type": "noun", "conv": { "polite": "チャンスがあったら、日本へ行きたいです。", "pVi": "Nếu có cơ hội, tôi muốn đi Nhật.", "casual": "チャンスあったら、日本行きたい。", "cVi": "Có cơ hội là đi Nhật liền.", "gIds": ["tara", "tai"] } },
            { "STT": 61, "Kanji": "", "Nghĩa": "Nhóm", "Furigana": "グループ", "type": "noun", "conv": { "polite": "グループで勉強しませんか。", "pVi": "Học theo nhóm không?", "casual": "グループで勉強しない？", "cVi": "Học nhóm hông?", "gIds": ["mashou"] } },
            { "STT": 62, "Kanji": "地図", "Nghĩa": "Bản đồ", "Furigana": "ちず", "type": "noun", "conv": { "polite": "地図を見たら、道が分かります。", "pVi": "Nếu xem bản đồ, bạn sẽ biết đường.", "casual": "地図見ると、道分かるよ。", "cVi": "Xem bản đồ là biết đường.", "gIds": ["tara", "to_conditional"] } },
            { "STT": 63, "Kanji": "", "Nghĩa": "Lịch", "Furigana": "カレンダー", "type": "noun", "conv": { "polite": "カレンダーに予定を書きましょう。", "pVi": "Hãy viết lịch trình vào lịch.", "casual": "カレンダーに予定書こう。", "cVi": "Viết lịch trình vào lịch đi.", "gIds": ["mashou", "volitional"] } },
            { "STT": 64, "Kanji": "", "Nghĩa": "Máy ảnh", "Furigana": "カメラ", "type": "noun", "conv": { "polite": "カメラで写真を撮りませんか。", "pVi": "Chụp ảnh bằng máy ảnh không?", "casual": "カメラで写真撮らない？", "cVi": "Chụp bằng máy ảnh hông?", "gIds": ["mashou"] } },
            { "STT": 65, "Kanji": "宝くじ", "Nghĩa": "Xổ số", "Furigana": "たからくじ", "type": "noun", "conv": { "polite": "宝くじが当たったら、嬉しいです。", "pVi": "Nếu trúng xổ số, tôi sẽ vui.", "casual": "宝くじ当たったら、嬉しい。", "cVi": "Trúng số thì sướng.", "gIds": ["tara"] } },
            { "STT": 66, "Kanji": "", "Nghĩa": "Làm thêm", "Furigana": "アルバイト", "type": "noun", "conv": { "polite": "アルバイトをしたことがありますか。", "pVi": "Bạn đã từng làm thêm chưa?", "casual": "アルバイトしたことある？", "cVi": "Làm thêm bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 67, "Kanji": "役", "Nghĩa": "Có ích", "Furigana": "やくにたちます", "type": "verb", "conv": { "polite": "この本はとても役に立ちます。", "pVi": "Cuốn sách này rất có ích.", "casual": "この本、めっちゃ役に立つ。", "cVi": "Sách này có ích phết.", "gIds": ["wa_desu"] } },
            { "STT": 68, "Kanji": "成", "Nghĩa": "Trở nên", "Furigana": "なります", "type": "verb", "conv": { "polite": "日本語が上手になりたいです。", "pVi": "Tôi muốn giỏi tiếng Nhật.", "casual": "日本語上手になりたい。", "cVi": "Muốn giỏi tiếng Nhật ghê.", "gIds": ["tai", "narimasu"] } },
            { "STT": 69, "Kanji": "居酒屋", "Nghĩa": "Quán rượu", "Furigana": "いざかや", "type": "place", "conv": { "polite": "居酒屋へ行きませんか。", "pVi": "Đi quán rượu không?", "casual": "居酒屋行かない？", "cVi": "Đi nhậu hông?", "gIds": ["mashou"] } },
            { "STT": 70, "Kanji": "温泉", "Nghĩa": "Suối nước nóng", "Furigana": "おんせん", "type": "place", "conv": { "polite": "温泉に入ったことがありますか。", "pVi": "Bạn đã từng tắm suối nước nóng chưa?", "casual": "温泉入ったことある？", "cVi": "Tắm suối nóng bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 71, "Kanji": "抹茶", "Nghĩa": "Trà xanh", "Furigana": "まっちゃ", "type": "food", "conv": { "polite": "抹茶を飲んだことがありますか。", "pVi": "Bạn đã từng uống trà xanh chưa?", "casual": "抹茶飲んだことある？", "cVi": "Uống trà xanh bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 72, "Kanji": "", "Nghĩa": "Cái cốc", "Furigana": "コップ", "type": "noun", "conv": { "polite": "コップに水を入れてください。", "pVi": "Vui lòng cho nước vào cốc.", "casual": "コップに水入れて。", "cVi": "Cho nước vào cốc đi.", "gIds": ["te_kudasai"] } },
            { "STT": 73, "Kanji": "", "Nghĩa": "Dịch vụ", "Furigana": "サービス", "type": "noun", "conv": { "polite": "この店のサービスはとてもいいです。", "pVi": "Dịch vụ của cửa hàng này rất tốt.", "casual": "この店、サービスいいよ。", "cVi": "Quán này phục vụ tốt đấy.", "gIds": ["wa_desu"] } },
            { "STT": 74, "Kanji": "機械", "Nghĩa": "Máy móc", "Furigana": "きかい", "type": "noun", "conv": { "polite": "この機械は複雑ですが、面白いです。", "pVi": "Máy móc này phức tạp nhưng thú vị.", "casual": "この機械、複雑だけど面白い。", "cVi": "Máy này phức tạp mà hay.", "gIds": ["shi_shi"] } },
            { "STT": 75, "Kanji": "味", "Nghĩa": "Vị", "Furigana": "あじ", "type": "noun", "conv": { "polite": "この料理は味が薄いです。", "pVi": "Món ăn này vị nhạt.", "casual": "これ、味薄いな。", "cVi": "Món này nhạt thế.", "gIds": ["wa_desu"] } },
            { "STT": 76, "Kanji": "匂い", "Nghĩa": "Mùi", "Furigana": "におい", "type": "noun", "conv": { "polite": "変な匂いがします。", "pVi": "Có mùi lạ.", "casual": "変な匂いする。", "cVi": "Có mùi gì lạ lạ.", "gIds": [] } },
            { "STT": 77, "Kanji": "音", "Nghĩa": "Âm thanh", "Furigana": "おと", "type": "noun", "conv": { "polite": "変な音がします。", "pVi": "Có âm thanh lạ.", "casual": "変な音する。", "cVi": "Có tiếng gì lạ thế.", "gIds": [] } },
            { "STT": 78, "Kanji": "髪", "Nghĩa": "Tóc", "Furigana": "かみ", "type": "noun", "conv": { "polite": "髪が長いです。", "pVi": "Tóc dài.", "casual": "髪、長いね。", "cVi": "Tóc dài nhỉ.", "gIds": ["wa_desu"] } },
            { "STT": 79, "Kanji": "故障", "Nghĩa": "Hỏng", "Furigana": "こしょう", "type": "noun", "conv": { "polite": "パソコンが故障したら、どうしますか。", "pVi": "Nếu máy tính hỏng, bạn sẽ làm gì?", "casual": "パソコン故障したら、どうする？", "cVi": "Máy tính hỏng thì làm sao?", "gIds": ["tara"] } },
            { "STT": 80, "Kanji": "", "Nghĩa": "Chạy bộ", "Furigana": "ジョギング", "type": "activity", "conv": { "polite": "毎日ジョギングをしませんか。", "pVi": "Hàng ngày chạy bộ không?", "casual": "毎日ジョギングしない？", "cVi": "Chạy bộ mỗi ngày hông?", "gIds": ["mashou"] } },
            { "STT": 81, "Kanji": "直します", "Nghĩa": "Sửa chữa", "Furigana": "なおします", "type": "verb", "conv": { "polite": "パソコンを直しましょうか。", "pVi": "Để tôi sửa máy tính nhé?", "casual": "パソコン直そうか？", "cVi": "Sửa máy tính giúp cho nhé?", "gIds": ["mashou"] } },
            { "STT": 82, "Kanji": "入院", "Nghĩa": "Nhập viện", "Furigana": "にゅういん", "type": "verb", "conv": { "polite": "入院したことがありますか。", "pVi": "Bạn đã từng nhập viện chưa?", "casual": "入院したことある？", "cVi": "Nằm viện bao giờ chưa?", "gIds": ["ta_koto_ga_aru"] } },
            { "STT": 83, "Kanji": "退院", "Nghĩa": "Xuất viện", "Furigana": "たいいん", "type": "verb", "conv": { "polite": "退院したら、会いに行きましょう。", "pVi": "Nếu xuất viện, chúng ta hãy đi thăm.", "casual": "退院したら、会いに行こう。", "cVi": "Xuất viện xong thì đi gặp nhé.", "gIds": ["tara", "mashou", "ni_iku"] } },
            { "STT": 84, "Kanji": "電源", "Nghĩa": "Nguồn điện", "Furigana": "でんげん", "type": "noun", "conv": { "polite": "電源を入れたら、使えます。", "pVi": "Nếu bật nguồn, có thể sử dụng.", "casual": "電源入れると、使えるよ。", "cVi": "Bật nguồn là dùng được.", "gIds": ["tara", "to_conditional", "potential"] } },
            { "STT": 85, "Kanji": "切ります", "Nghĩa": "Tắt/Cắt", "Furigana": "きります", "type": "verb", "conv": { "polite": "電源を切ってから、帰りましょう。", "pVi": "Sau khi tắt nguồn, chúng ta hãy về.", "casual": "電源切ってから、帰ろう。", "cVi": "Tắt nguồn xong rồi về.", "gIds": ["te_form_cause", "volitional"] } },
            { "STT": 86, "Kanji": "気持", "Nghĩa": "Dễ chịu", "Furigana": "きもちがいい", "type": "adj_i", "conv": { "polite": "気持ちが良かったら、嬉しいです。", "pVi": "Nếu cảm thấy dễ chịu, tôi sẽ vui.", "casual": "気持ちよかったら、嬉しい。", "cVi": "Thấy thoải mái là vui rồi.", "gIds": ["tara"] } },
            { "STT": 87, "Kanji": "悪", "Nghĩa": "Khó chịu", "Furigana": "きもちがわるい", "type": "adj_i", "conv": { "polite": "気持ちが悪かったら、休んでください。", "pVi": "Nếu cảm thấy khó chịu, hãy nghỉ ngơi.", "casual": "気持ち悪かったら、休んで。", "cVi": "Thấy mệt thì nghỉ đi.", "gIds": ["tara", "te_kudasai"] } }
        ];

        // --- 3. KANJI DETAILS (Tips & Mnemonics) ---
        const kanjiDetails = {
            "日": { hanviet: "NHẬT", mean: "Ngày/Mặt trời", on: "ニチ, ジツ", kun: "ひ, か", radicals: "Nhật (日)", tipImg: "Hình mặt trời.", tipSound: "**Nik**ki nhật ký.", words: [{w:"日記 (にっき)", m:"Nhật ký"}, {w:"日曜日 (にちようび)", m:"Chủ nhật"}] },
            "記": { hanviet: "KÝ", mean: "Ghi chép", on: "キ", kun: "しる.す", radicals: "Ngôn (言) + Kỷ (己)", tipImg: "Lời nói (言) của bản thân (己) ghi lại.", tipSound: "Nik**ki** ký.", words: [{w:"日記 (にっき)", m:"Nhật ký"}, {w:"記録 (きろく)", m:"Kỷ lục"}] },
            "弾": { hanviet: "ĐÀN", mean: "Chơi đàn", on: "ダン", kun: "ひ.く", radicals: "Cung (弓) + Đơn (単)", tipImg: "Cung (弓) bắn đơn (単) độc.", tipSound: "**Hi**ku chơi đàn.", words: [{w:"弾きます (ひきます)", m:"Chơi đàn"}] },
            "歌": { hanviet: "CA", mean: "Hát", on: "カ", kun: "うた", radicals: "Khả (可) + Khiếm (欠)", tipImg: "Hai người ca (哥) hát thiếu (欠) hơi.", tipSound: "**Uta** bài hát.", words: [{w:"歌 (うた)", m:"Bài hát"}, {w:"歌います (うたいます)", m:"Hát"}] },
            "踊": { hanviet: "DŨNG", mean: "Nhảy múa", on: "ヨウ", kun: "おど.る", radicals: "T足 (Túc) + Dũng (勇)", tipImg: "Chân (足) dũng (勇) cảm nhảy múa.", tipSound: "**Odo**ru nhảy.", words: [{w:"踊ります (おどります)", m:"Nhảy"}, {w:"舞踊 (ぶよう)", m:"Vũ điệu"}] },
            "運": { hanviet: "VẬN", mean: "Vận chuyển", on: "ウン", kun: "はこ.ぶ", radicals: "Xước (⻌) + Quân (軍)", tipImg: "Quân (軍) đội di chuyển (⻌).", tipSound: "**Un**ten lái xe.", words: [{w:"運転 (うんてん)", m:"Lái xe"}, {w:"運動 (うんどう)", m:"Vận động"}] },
            "転": { hanviet: "CHUYỂN", mean: "Lăn/Chuyển", on: "テン", kun: "ころ.ぶ", radicals: "Xa (車) + Vân (云)", tipImg: "Xe (車) chở mây (云).", tipSound: "Un**ten** chuyển.", words: [{w:"運転 (うんてん)", m:"Lái xe"}, {w:"自転車 (じてんしゃ)", m:"Xe đạp"}] },
            "自": { hanviet: "TỰ", mean: "Tự mình", on: "ジ", kun: "みずか.ら", radicals: "Tự (自)", tipImg: "Mắt (目) có cái phẩy là tự.", tipSound: "**Ji**bun tự mình.", words: [{w:"自分 (じぶん)", m:"Bản thân"}, {w:"自由 (じゆう)", m:"Tự do"}] },
            "分": { hanviet: "PHÂN", mean: "Hiểu/Phút/Phần", on: "フン, ブン", kun: "わ.かる", radicals: "Đao (刀)", tipImg: "Dùng dao (刀) chia tám (八) phần.", tipSound: "Ji**bun** phần.", words: [{w:"自分 (じぶん)", m:"Bản thân"}, {w:"分かります (わかります)", m:"Hiểu"}] },
            "度": { hanviet: "ĐỘ", mean: "Lần/Độ", on: "ド", kun: "たび", radicals: "Nghiễm (广)", tipImg: "Trong nhà (广) hai mươi (廿) tay (又) đo độ.", tipSound: "On**do** nhiệt độ.", words: [{w:"〜度 (ど)", m:"Độ"}, {w:"今度 (こんど)", m:"Lần này"}] },
            "道": { hanviet: "ĐẠO", mean: "Đường", on: "ドウ", kun: "みち", radicals: "Xước (⻌) + Thủ (首)", tipImg: "Đầu (首) đi (⻌) trên đường.", tipSound: "**Michi** đường.", words: [{w:"道 (みち)", m:"Con đường"}, {w:"書道 (しょどう)", m:"Thư pháp"}] },
            "角": { hanviet: "GIÁC", mean: "Góc/Sừng", on: "カク", kun: "かど", radicals: "Giác (角)", tipImg: "Hình cái sừng.", tipSound: "**Kado** góc.", words: [{w:"角 (かど)", m:"Góc đường"}, {w:"三角形 (さんかくけい)", m:"Tam giác"}] },
            "橋": { hanviet: "KIỀU", mean: "Cầu", on: "キョウ", kun: "はし", radicals: "Mộc (木) + Kiều (喬)", tipImg: "Cầu làm bằng gỗ (木) cao (喬).", tipSound: "**Hashi** cầu.", words: [{w:"橋 (はし)", m:"Cây cầu"}, {w:"歩道橋 (ほどうきょう)", m:"Cầu vượt đi bộ"}] },
            "病": { hanviet: "BỆNH", mean: "Ốm", on: "ビョウ", kun: "や.む", radicals: "Nạch (疒) + Bính (丙)", tipImg: "Người ốm nằm trên giường (疒) trong nhà (丙).", tipSound: "**Byou**ki bệnh.", words: [{w:"病気 (びょうき)", m:"Bệnh"}, {w:"病院 (びょういん)", m:"Bệnh viện"}] },
            "気": { hanviet: "KHÍ", mean: "Khí chất", on: "キ", kun: "", radicals: "Khí (气) + Mễ (米)", tipImg: "Hơi nước (气) bốc lên từ gạo (米).", tipSound: "Byou**ki** khí.", words: [{w:"病気 (びょうき)", m:"Bệnh"}, {w:"元気 (げんき)", m:"Khỏe mạnh"}] },
            "回": { hanviet: "HỒI", mean: "Xoay/Lần", on: "カイ", kun: "まわ.す", radicals: "Vi (囗) + Khẩu (口)", tipImg: "Hai cái miệng xoay vòng.", tipSound: "**Mawa**su xoay.", words: [{w:"回します (まわします)", m:"Vặn/Xoay"}, {w:"今回 (こんかい)", m:"Lần này"}] },
            "引": { hanviet: "DẪN", mean: "Kéo", on: "イン", kun: "ひ.く", radicals: "Cung (弓) + Côn (丨)", tipImg: "Cây cung thẳng cần kéo căng.", tipSound: "**Hi**ku kéo.", words: [{w:"引きます (ひきます)", m:"Kéo"}, {w:"引用 (いんよう)", m:"Trích dẫn"}] },
            "渡": { hanviet: "ĐỘ", mean: "Qua", on: "ト", kun: "わた.る", radicals: "Thủy (氵) + Độ (度)", tipImg: "Nước độ qua sông.", tipSound: "**Wata**ru băng qua.", words: [{w:"渡ります (わたります)", m:"Băng qua"}, {w:"渡します (わたします)", m:"Trao/Đưa"}] },
            "必": { hanviet: "TẤT", mean: "Tất yếu", on: "ヒツ", kun: "かなら.ず", radicals: "Tâm (心)", tipImg: "Tâm (心) bị gạch chéo là tất yếu.", tipSound: "**Hitsu**you cần thiết.", words: [{w:"必要 (ひつよう)", m:"Cần thiết"}, {w:"必ず (かならず)", m:"Nhất định"}] },
            "要": { hanviet: "YẾU", mean: "Cần/Chủ yếu", on: "ヨウ", kun: "い.る", radicals: "Tây (覀) + Nữ (女)", tipImg: "Người nữ (女) phương tây (覀) là nhân vật chủ yếu.", tipSound: "Hitsu**you** yếu.", words: [{w:"必要 (ひつよう)", m:"Cần thiết"}, {w:"要ります (いります)", m:"Cần"}] },
            "食": { hanviet: "THỰC", mean: "Ăn", on: "ショク", kun: "た.べる", radicals: "Thực (食)", tipImg: "Người tốt (艮) che mũ (人) ăn.", tipSound: "**Shoku**ji bữa ăn.", words: [{w:"食事 (しょくじ)", m:"Bữa ăn"}, {w:"食べます (たべます)", m:"Ăn"}] },
            "事": { hanviet: "SỰ", mean: "Việc", on: "ジ", kun: "こと", radicals: "Quyết (亅)", tipImg: "Một cái miệng nói chuyện sử sách.", tipSound: "Shoku**ji** sự.", words: [{w:"食事 (しょくじ)", m:"Bữa ăn"}, {w:"仕事 (しごと)", m:"Công việc"}] },
            "時": { hanviet: "THỜI", mean: "Thời gian", on: "ジ", kun: "とき", radicals: "Nhật (日) + Tự (寺)", tipImg: "Mặt trời ở chùa.", tipSound: "**Ji**kokuhyou thời khắc.", words: [{w:"時刻表 (じこくひょう)", m:"Bảng giờ tàu"}, {w:"時間 (じかん)", m:"Thời gian"}] },
            "刻": { hanviet: "KHẮC", mean: "Khắc/Thái", on: "コク", kun: "きざ.む", radicals: "Hợi (亥) + Đao (刂)", tipImg: "Dùng dao (刂) khắc con heo (亥).", tipSound: "Ji**koku**hyou khắc.", words: [{w:"時刻表 (じこくひょう)", m:"Bảng giờ tàu"}, {w:"遅刻 (ちこく)", m:"Đến muộn"}] },
            "表": { hanviet: "BIỂU", mean: "Bảng/Mặt ngoài", on: "ヒョウ", kun: "おもて", radicals: "Y (衣)", tipImg: "Thổ (土) trên y phục (衣) biểu hiện ra ngoài.", tipSound: "Jikoku**hyou** biểu.", words: [{w:"時刻表 (じこくひょう)", m:"Bảng giờ tàu"}, {w:"発表 (はっぴょう)", m:"Phát biểu"}] },
            "発": { hanviet: "PHÁT", mean: "Phát ra", on: "ハツ", kun: "", radicals: "Bát (癶)", tipImg: "Hai chân (癶) chạy đi phát tin.", tipSound: "**Hap**pyou phát biểu.", words: [{w:"発表 (はっぴょう)", m:"Phát biểu"}, {w:"出発 (しゅっぱつ)", m:"Xuất phát"}] },
            "言": { hanviet: "NGÔN", mean: "Nói", on: "ゲン", kun: "い.う", radicals: "Ngôn (言)", tipImg: "Mồm nói ra lời.", tipSound: "**I**u nói.", words: [{w:"言います (いいます)", m:"Nói"}, {w:"言語 (げんご)", m:"Ngôn ngữ"}] },
            "何": { hanviet: "HÀ", mean: "Cái gì", on: "カ", kun: "なに, なん", radicals: "Nhân (亻) + Khả (可)", tipImg: "Người gánh vật gì.", tipSound: "**Nan**kai mấy lần.", words: [{w:"何回 (なんかい)", m:"Mấy lần"}, {w:"何か (なにか)", m:"Cái gì đó"}] },
            "生": { hanviet: "SINH", mean: "Sinh sống", on: "セイ", kun: "い.きる", radicals: "Sinh (生)", tipImg: "Cây nảy mầm.", tipSound: "Is**shou**kenmei nhất sinh.", words: [{w:"一生懸命 (いっしょうけんめい)", m:"Cố gắng hết sức"}, {w:"先生 (せんせい)", m:"Giáo viên"}] },
            "懸": { hanviet: "HUYỀN", mean: "Treo/Cần cù", on: "ケン", kun: "か.ける", radicals: "Tâm (心)", tipImg: "Huyện (県) lệnh để tâm (心) treo giải.", tipSound: "Isshou**ken**mei huyền.", words: [{w:"一生懸命 (いっしょうけんめい)", m:"Nỗ lực"}, {w:"懸賞 (けんしょう)", m:"Giải thưởng"}] },
            "命": { hanviet: "MỆNH", mean: "Sinh mệnh", on: "メイ", kun: "いのち", radicals: "Khẩu (口) + Lệnh (令)", tipImg: "Miệng ra lệnh quyết định mạng sống.", tipSound: "Isshouken**mei** mệnh.", words: [{w:"一生懸命 (いっしょうけんめい)", m:"Nỗ lực"}, {w:"運命 (うんめい)", m:"Vận mệnh"}] },
            "失": { hanviet: "THẤT", mean: "Mất/Lỗi", on: "シツ", kun: "うしな.う", radicals: "Đại (大)", tipImg: "Người (人) đánh rơi đồ.", tipSound: "**Shitsu**rei thất lễ.", words: [{w:"失礼 (しつれい)", m:"Thất lễ"}, {w:"失敗 (しっぱい)", m:"Thất bại"}] },
            "礼": { hanviet: "LỄ", mean: "Lễ nghi", on: "レイ", kun: "", radicals: "Kỳ (礻)", tipImg: "Quỳ lạy thần đất.", tipSound: "Shitsu**rei** lễ.", words: [{w:"失礼 (しつれい)", m:"Thất lễ"}, {w:"お礼 (おれい)", m:"Cảm ơn"}] },
            "眼": { hanviet: "NHÃN", mean: "Mắt/Kính", on: "ガン", kun: "まなこ", radicals: "Mục (目) + Cấn (艮)", tipImg: "Mắt (目) nhìn tốt (艮).", tipSound: "**Me**gane kính.", words: [{w:"眼鏡 (めがね)", m:"Kính mắt"}] },
            "鏡": { hanviet: "KÍNH", mean: "Gương", on: "キョウ", kun: "かがみ", radicals: "Kim (金) + Cánh (竟)", tipImg: "Kim loại (金) soi được (竟) là gương.", tipSound: "Me**gane** kính.", words: [{w:"眼鏡 (めがね)", m:"Kính mắt"}, {w:"鏡 (かがみ)", m:"Cái gương"}] },
            "菓": { hanviet: "QUẢ", mean: "Bánh kẹo", on: "カ", kun: "", radicals: "Thảo (艹) + Quả (果)", tipImg: "Cỏ (艹) ra quả (果) làm kẹo.", tipSound: "O**ka**shi bánh kẹo.", words: [{w:"お菓子 (おかし)", m:"Bánh kẹo"}] },
            "子": { hanviet: "TỬ", mean: "Con/Cái", on: "シ", kun: "こ", radicals: "Tử (子)", tipImg: "Đứa trẻ.", tipSound: "Oka**shi** tử.", words: [{w:"お菓子 (おかし)", m:"Bánh kẹo"}, {w:"子供 (こども)", m:"Trẻ em"}] },
            "履": { hanviet: "LÝ", mean: "Xỏ/Đi", on: "リ", kun: "は.く", radicals: "Thi (尸) + Phục (復)", tipImg: "Xác chết (尸) phục hồi (復) đi lại.", tipSound: "**Ha**ku xỏ.", words: [{w:"履きます (はきます)", m:"Xỏ (giày)"}, {w:"履歴書 (りれきしょ)", m:"Sơ yếu lý lịch"}] },
            "被": { hanviet: "BỊ", mean: "Đội/Bị", on: "ヒ", kun: "かぶ.る", radicals: "Y (衣) + Bì (皮)", tipImg: "Áo (衣) da (皮) bị khoác lên.", tipSound: "**Kabu**ru đội.", words: [{w:"被ります (かぶります)", m:"Đội (mũ)"}, {w:"被害 (ひがい)", m:"Thiệt hại"}] },
            "脱": { hanviet: "THOÁT", mean: "Cởi/Thoát", on: "ダツ", kun: "ぬ.ぐ", radicals: "Nhục (月) + Duyệt (兑)", tipImg: "Cởi bỏ (兑) xác thịt (月).", tipSound: "**Nu**gu cởi.", words: [{w:"脱ぎます (ぬぎます)", m:"Cởi"}, {w:"脱出 (だっしゅつ)", m:"Thoát ra"}] },
            "無": { hanviet: "VÔ", mean: "Không", on: "ム", kun: "な.い", radicals: "Hỏa (灬)", tipImg: "Không có lửa.", tipSound: "**Mu**da vô ích.", words: [{w:"無駄 (むだ)", m:"Lãng phí"}, {w:"無料 (むりょう)", m:"Miễn phí"}] },
            "駄": { hanviet: "ĐÀ", mean: "Thồ hàng/Vô ích", on: "ダ", kun: "", radicals: "Mã (馬) + Thái (太)", tipImg: "Ngựa (馬) béo (太) vô dụng.", tipSound: "Mu**da** đà.", words: [{w:"無駄 (むだ)", m:"Lãng phí"}] },
            "素": { hanviet: "TỐ", mean: "Yếu tố", on: "ソ", kun: "もと", radicals: "Mịch (糸) + Chủ (主)", tipImg: "Sợi chỉ (糸) chủ (主) yếu.", tipSound: "**Su**teki tuyệt vời.", words: [{w:"素敵 (すてき)", m:"Tuyệt vời"}, {w:"素材 (そざい)", m:"Nguyên liệu"}] },
            "敵": { hanviet: "ĐỊCH", mean: "Kẻ địch", on: "テキ", kun: "かたき", radicals: "Phộc (攵)", tipImg: "Đánh (攵) kẻ địch.", tipSound: "Su**teki** địch.", words: [{w:"素敵 (すてき)", m:"Tuyệt vời"}, {w:"敵 (てき)", m:"Kẻ địch"}] },
            "楽": { hanviet: "LẠC", mean: "Vui", on: "ラク", kun: "たの.しい", radicals: "Mộc (木)", tipImg: "Gỗ (木) trắng (白) vui vẻ.", tipSound: "**Tano**shii vui.", words: [{w:"楽しい (たのしい)", m:"Vui vẻ"}, {w:"気楽 (きらく)", m:"Thoải mái"}] },
            "勝": { hanviet: "THẮNG", mean: "Thắng", on: "ショウ", kun: "か.つ", radicals: "Lực (力)", tipImg: "Dùng sức (力) chiến thắng.", tipSound: "**Ka**tsu thắng.", words: [{w:"勝ちます (かちます)", m:"Thắng"}, {w:"勝利 (しょうり)", m:"Thắng lợi"}] },
            "負": { hanviet: "PHỤ", mean: "Thua", on: "フ", kun: "ま.ける", radicals: "Bối (貝)", tipImg: "Mất tiền (貝) là thua.", tipSound: "**Ma**keru thua.", words: [{w:"負けます (まけます)", m:"Thua"}, {w:"勝負 (しょうぶ)", m:"Thắng thua"}] },
            "地": { hanviet: "ĐỊA", mean: "Đất", on: "チ", kun: "", radicals: "Thổ (土) + Dã (也)", tipImg: "Đất có bọ cạp.", tipSound: "**Chi**zu bản đồ.", words: [{w:"地図 (ちず)", m:"Bản đồ"}, {w:"地下 (ちか)", m:"Dưới đất"}] },
            "宝": { hanviet: "BẢO", mean: "Bảo vật", on: "ホウ", kun: "たから", radicals: "Miên (宀) + Ngọc (玉)", tipImg: "Trong nhà (宀) có ngọc (玉) là bảo vật.", tipSound: "**Takara**kuji xổ số.", words: [{w:"宝くじ (たからくじ)", m:"Xổ số"}, {w:"宝物 (たからもの)", m:"Báu vật"}] },
            "役": { hanviet: "DỊCH", mean: "Vai trò", on: "ヤク", kun: "", radicals: "Xích (彳)", tipImg: "Đi làm việc.", tipSound: "**Yaku**ni... có ích.", words: [{w:"役に立ちます (やくにたちます)", m:"Có ích"}, {w:"役所 (やくしょ)", m:"Công sở"}] },
            "立": { hanviet: "LẬP", mean: "Đứng", on: "リツ", kun: "た.つ", radicals: "Lập (立)", tipImg: "Người đứng trên đất.", tipSound: "Yakuni**ta**chimasu lập.", words: [{w:"役に立ちます (やくにたちます)", m:"Có ích"}, {w:"立ちます (たちます)", m:"Đứng"}] },
            "居": { hanviet: "CƯ", mean: "Ở", on: "キョ", kun: "い.る", radicals: "Thi (尸) + Cổ (古)", tipImg: "Xác chết (尸) cổ (古) cư trú.", tipSound: "**I**zakaya quán rượu.", words: [{w:"居酒屋 (いざかや)", m:"Quán rượu"}, {w:"居間 (いま)", m:"Phòng khách"}] },
            "屋": { hanviet: "ỐC", mean: "Nhà/Tiệm", on: "オク", kun: "や", radicals: "Thi (尸) + Chí (至)", tipImg: "Xác chết (尸) đến (至) nhà.", tipSound: "Izaka**ya** ốc.", words: [{w:"居酒屋 (いざかや)", m:"Quán rượu"}, {w:"部屋 (へや)", m:"Phòng"}] },
            "温": { hanviet: "ÔN", mean: "Ấm", on: "オン", kun: "あたた.かい", radicals: "Thủy (氵) + Ôn (温)", tipImg: "Nước ấm.", tipSound: "**On**sen suối nóng.", words: [{w:"温泉 (おんせん)", m:"Suối nước nóng"}, {w:"温度 (おんど)", m:"Nhiệt độ"}] },
            "泉": { hanviet: "TUYỀN", mean: "Suối", on: "セン", kun: "いずみ", radicals: "Thủy (水) + Bạch (白)", tipImg: "Nước (水) trắng (白) từ suối.", tipSound: "On**sen** tuyền.", words: [{w:"温泉 (おんせん)", m:"Suối nước nóng"}] },
            "茶": { hanviet: "TRÀ", mean: "Trà", on: "チャ", kun: "", radicals: "Thảo (艹)", tipImg: "Người hái trà.", tipSound: "Mac**cha** trà.", words: [{w:"抹茶 (まっちゃ)", m:"Trà xanh"}, {w:"お茶 (おちゃ)", m:"Trà"}] },
            "機": { hanviet: "CƠ", mean: "Máy", on: "キ", kun: "はた", radicals: "Mộc (木)", tipImg: "Máy dệt gỗ.", tipSound: "**Ki**kai cơ khí.", words: [{w:"機械 (きかい)", m:"Máy móc"}] },
            "械": { hanviet: "GIỚI", mean: "Dụng cụ", on: "カイ", kun: "", radicals: "Mộc (木) + Giới (戒)", tipImg: "Cây (木) răn dạy (戒) làm dụng cụ.", tipSound: "Ki**kai** giới.", words: [{w:"機械 (きかい)", m:"Máy móc"}] },
            "味": { hanviet: "VỊ", mean: "Vị", on: "ミ", kun: "あじ", radicals: "Khẩu (口) + Vị (未)", tipImg: "Miệng nếm vị.", tipSound: "**Aji** vị.", words: [{w:"味 (あじ)", m:"Vị"}, {w:"意味 (いみ)", m:"Ý nghĩa"}] },
            "匂": { hanviet: "MÙI", mean: "Mùi", on: "", kun: "にお.い", radicals: "Bao (勹)", tipImg: "Bao bọc mùi hương.", tipSound: "**Nioi** mùi.", words: [{w:"匂い (におい)", m:"Mùi"}] },
            "音": { hanviet: "ÂM", mean: "Âm thanh", on: "オン", kun: "おと", radicals: "Âm (音)", tipImg: "Âm thanh.", tipSound: "**Oto** âm.", words: [{w:"音 (おと)", m:"Âm thanh"}, {w:"音楽 (おんがく)", m:"Âm nhạc"}] },
            "髪": { hanviet: "PHÁT", mean: "Tóc", on: "ハツ", kun: "かみ", radicals: "Tiêu (髟)", tipImg: "Tóc dài.", tipSound: "**Kami** tóc.", words: [{w:"髪 (かみ)", m:"Tóc"}] },
            "故": { hanviet: "CỐ", mean: "Cũ/Sự cố", on: "コ", kun: "", radicals: "Phộc (攵) + Cổ (古)", tipImg: "Đánh (攵) cái cũ (古) gây sự cố.", tipSound: "**Ko**shou cố chướng.", words: [{w:"故障 (こしょう)", m:"Hỏng hóc"}, {w:"事故 (じこ)", m:"Tai nạn"}] },
            "障": { hanviet: "CHƯỚNG", mean: "Che chắn/Hỏng", on: "ショウ", kun: "", radicals: "Phụ (阝) + Chương (章)", tipImg: "Gò đất (阝) viết chương (章) che chắn.", tipSound: "Ko**shou** chướng.", words: [{w:"故障 (こしょう)", m:"Hỏng hóc"}, {w:"障害 (しょうがい)", m:"Trở ngại"}] },
            "直": { hanviet: "TRỰC", mean: "Sửa/Thẳng", on: "チョク", kun: "なお.す", radicals: "Mục (目)", tipImg: "Mắt (目) nhìn thẳng (乚).", tipSound: "**Nao**su sửa.", words: [{w:"直します (なおします)", m:"Sửa chữa"}, {w:"直接 (ちょくせつ)", m:"Trực tiếp"}] },
            "退": { hanviet: "THOÁI", mean: "Lùi/Rời", on: "タイ", kun: "", radicals: "Xước (⻌) + Cấn (艮)", tipImg: "Đi (⻌) lùi lại tốt (艮).", tipSound: "**Tai**in thoái viện.", words: [{w:"退院 (たいいん)", m:"Xuất viện"}, {w:"退屈 (たいくつ)", m:"Chán ngắt"}] },
            "源": { hanviet: "NGUYÊN", mean: "Nguồn", on: "ゲン", kun: "", radicals: "Thủy (氵) + Nguyên (原)", tipImg: "Nước (氵) từ cao nguyên (原).", tipSound: "**Den**gen nguồn điện.", words: [{w:"電源 (でんげん)", m:"Nguồn điện"}, {w:"資源 (しげん)", m:"Tài nguyên"}] },
            "行": { hanviet: "HÀNH", mean: "Đi", on: "コウ", kun: "い.く", radicals: "Hành (行)", tipImg: "Bước chân đi.", tipSound: "**I**kimasu đi.", words: [{w:"行きます (いきます)", m:"Đi"}, {w:"旅行 (りょこう)", m:"Du lịch"}] },
            "越": { hanviet: "VIỆT", mean: "Vượt qua", on: "エツ", kun: "こ.す", radicals: "Tẩu (走) + Việt (戉)", tipImg: "Chạy (走) vượt qua (戉) biên giới.", tipSound: "Hik**ko**shimasu chuyển nhà.", words: [{w:"引っ越します (ひっこします)", m:"Chuyển nhà"}, {w:"超越 (ちょうえつ)", m:"Siêu việt"}] },
            "一": { hanviet: "NHẤT", mean: "Một", on: "イチ", kun: "ひと", radicals: "Nhất (一)", tipImg: "Một ngón tay.", tipSound: "**Is**shoukenmei một đời.", words: [{w:"一生懸命 (いっしょうけんめい)", m:"Cố gắng"}, {w:"一番 (いちばん)", m:"Số 1"}] },
            "図": { hanviet: "ĐỒ", mean: "Bản đồ", on: "ズ", kun: "はか.る", radicals: "Vi (囗)", tipImg: "Bản đồ trong khung.", tipSound: "Chi**zu** bản đồ.", words: [{w:"地図 (ちず)", m:"Bản đồ"}, {w:"図書館 (としょかん)", m:"Thư viện"}] },
            "成": { hanviet: "THÀNH", mean: "Trở thành", on: "セイ", kun: "な.る", radicals: "Qua (戈)", tipImg: "Dùng giáo mác (戈) thành công.", tipSound: "**Na**rimasu trở thành.", words: [{w:"成ります (なります)", m:"Trở thành"}, {w:"成功 (せいこう)", m:"Thành công"}] },
            "酒": { hanviet: "TỬU", mean: "Rượu", on: "シュ", kun: "さけ", radicals: "Thủy (氵) + Dậu (酉)", tipImg: "Nước ủ trong bình dậu là rượu.", tipSound: "Iza**ka**ya quán rượu.", words: [{w:"居酒屋 (いざかや)", m:"Quán rượu"}, {w:"お酒 (おさけ)", m:"Rượu"}] },
            "抹": { hanviet: "MẠT", mean: "Bột/Xoa", on: "マツ", kun: "", radicals: "Thủ (扌) + Mạt (末)", tipImg: "Tay (扌) xoa bột (末).", tipSound: "**Mat**cha trà xanh.", words: [{w:"抹茶 (まっちゃ)", m:"Trà xanh"}, {w:"抹消 (まっしょう)", m:"Xóa bỏ"}] },
            "院": { hanviet: "VIỆN", mean: "Viện", on: "イン", kun: "", radicals: "Phụ (阝) + Hoàn (完)", tipImg: "Tòa nhà hoàn hảo.", tipSoundOn: "Nyuu**in** nhập viện.", words: [{w:"入院 (にゅういん)", m:"Nhập viện"}, {w:"病院 (びょういん)", m:"Bệnh viện"}] },
            "電": { hanviet: "ĐIỆN", mean: "Điện", on: "デン", kun: "", radicals: "Vũ (雨)", tipImg: "Mưa có sét.", tipSoundOn: "**Den**gen nguồn điện.", words: [{w:"電源 (でんげん)", m:"Nguồn điện"}, {w:"電車 (でんしゃ)", m:"Tàu điện"}] },
            "切": { hanviet: "THIẾT", mean: "Cắt", on: "セツ", kun: "き.る", radicals: "Đao (刀) + Thất (七)", tipImg: "Bảy con dao cắt.", tipSoundOn: "**Ki**rimasu cắt.", words: [{w:"切ります (きります)", m:"Cắt/Tắt"}, {w:"親切 (しんせつ)", m:"Tốt bụng"}] },
            "持": { hanviet: "TRÌ", mean: "Cầm/Giữ", on: "ジ", kun: "も.つ", radicals: "Thủ (扌) + Tự (寺)", tipImg: "Tay cầm đồ ở chùa.", tipSoundOn: "Ki**mo**chi cảm giác.", words: [{w:"気持ち (きもち)", m:"Tâm trạng/Cảm giác"}, {w:"持ちます (もちます)", m:"Cầm"}] },
            "悪": { hanviet: "ÁC", mean: "Xấu", on: "アク", kun: "わる.い", radicals: "Tâm (心) + Á (亜)", tipImg: "Tâm địa xấu xa.", tipSoundOn: "Kimochi ga **waru**i khó chịu.", words: [{w:"気持ちが悪い (きもちがわるい)", m:"Khó chịu"}, {w:"悪い (わるい)", m:"Xấu"}] }
        };

        // --- 4. APP LOGIC (Standard Day 1 Logic) ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
