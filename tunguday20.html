<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 20: Thời gian & Điều kiện</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 20: Ngữ pháp về Thời gian & Điều kiện</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">不足する</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">ふそくする</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Không đủ</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- MOBILE DRAWER -->
        <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none flex">
            <div id="drawerBackdrop" class="absolute inset-0 bg-gray-900/50 opacity-0 transition-opacity" onclick="toggleDrawer()"></div>
            <div id="drawerContent" class="relative w-72 bg-white h-full shadow-2xl transition-transform -translate-x-full flex flex-col pointer-events-auto">
                <div class="p-4 bg-indigo-700 text-white flex justify-between items-center">
                    <h2 class="font-bold">Danh sách từ vựng</h2>
                    <button onclick="toggleDrawer()"><i class="fas fa-times"></i></button>
                </div>
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <input type="text" id="mobileSearchInput" placeholder="Tìm kiếm nhanh..." class="w-full px-4 py-2 bg-white border border-gray-200 rounded-xl text-sm outline-none">
                </div>
                <div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 20</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (Day 20) ---
        const grammarRepo = {
            "uchi_ni_1": { title: "Nhân lúc / Khi còn", formula: "V/A/N + うちに", desc: "Tranh thủ làm gì đó trước khi trạng thái thay đổi.", ex: "若いうちに勉強しなさい。" },
            "uchi_ni_2": { title: "Trong khi / Trong lúc", formula: "Vている + うちに", desc: "Trong khi đang làm V thì có sự thay đổi xảy ra (thường là tự nhiên/bất ngờ).", ex: "知らないうちに寝てしまった。" },
            "kawari_ni": { title: "Thay vì / Thay cho", formula: "Nの / Vる + かわりに", desc: "Làm việc này thay cho việc kia, hoặc người này thay cho người kia.", ex: "父のかわりに私が来ました。" },
            "aida_ni": { title: "Trong khi (Hành động)", formula: "Vている / Nの + 間に", desc: "Làm một hành động nào đó diễn ra và kết thúc TRONG KHI một trạng thái khác đang tiếp diễn.", ex: "留守の間に泥棒が入った。" },
            "tekara_denaito": { title: "Nếu chưa... thì không", formula: "Vてから + でないと/でなければ", desc: "Điều kiện cần: Phải làm A xong mới làm được B.", ex: "許可をもらってからでないと入室できない。" },
            "ni_yotte": { title: "Tùy thuộc vào", formula: "N + によって", desc: "Diễn tả sự khác nhau, đa dạng tùy theo đối tượng.", ex: "人によって考え方が違う。" },
            "tokoro": { title: "Đúng lúc / Vừa mới", formula: "Vる/Vている/Vた + ところ", desc: "Nhấn mạnh thời điểm của hành động (sắp sửa, đang, vừa mới xong).", ex: "これから食べるところです。" }
        };

        // --- 2. VOCABULARY DATA (Day 20 - 87 words) ---
        const vocabData = [
            { "STT": 1, "Kanji": "不足する", "Nghĩa": "Không đủ", "Furigana": "ふそくする", "type": "verb", "conv": { "polite": "食料が不足しているうちに、何か対策を立てなければなりません。", "pVi": "Trong khi lương thực đang thiếu hụt, chúng ta phải đưa ra biện pháp đối phó.", "casual": "食料が不足してるうちに、なんか対策立てなきゃ。", "cVi": "Lương thực đang thiếu, phải tính sao đi chứ.", "gIds": ["uchi_ni_1"] } },
            { "STT": 2, "Kanji": "平均する", "Nghĩa": "Trung bình", "Furigana": "へいきんする", "type": "verb", "conv": { "polite": "クラスの平均点を上げるために、努力しているところです。", "pVi": "Tôi đang nỗ lực để nâng cao điểm trung bình của lớp.", "casual": "クラスの平均点上げるために、頑張ってるとこだよ。", "cVi": "Tớ đang cố gắng kéo điểm trung bình của lớp lên đây.", "gIds": ["tokoro"] } },
            { "STT": 3, "Kanji": "割合", "Nghĩa": "Tỉ lệ", "Furigana": "わりあい", "type": "noun", "conv": { "polite": "国によって、高齢者の割合が違うんです。", "pVi": "Tùy theo mỗi quốc gia mà tỷ lệ người cao tuổi khác nhau.", "casual": "国によって高齢者の割合って違うんだよね。", "cVi": "Tùy nước mà tỷ lệ người già khác nhau ha.", "gIds": ["ni_yotte"] } },
            { "STT": 4, "Kanji": "報道", "Nghĩa": "Tin tức", "Furigana": "ほうどう", "type": "noun", "conv": { "polite": "ニュースが報道されている間に、家に帰ってきました。", "pVi": "Trong khi tin tức đang được đưa tin, tôi đã về nhà.", "casual": "ニュースやってる間に、家帰ってきたよ。", "cVi": "Lúc tin tức đang chiếu thì tớ về đến nhà.", "gIds": ["aida_ni"] } },
            { "STT": 5, "Kanji": "商売する", "Nghĩa": "Buôn bán", "Furigana": "しょうばいする", "type": "verb", "conv": { "polite": "お金をいただいてからでないと、商売は始められません。", "pVi": "Nếu chưa nhận được tiền thì không thể bắt đầu buôn bán.", "casual": "お金もらってからじゃないと、商売始められないよ。", "cVi": "Chưa nhận tiền thì chưa buôn bán gì được đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 6, "Kanji": "商品", "Nghĩa": "Sản phẩm", "Furigana": "しょうひん", "type": "noun", "conv": { "polite": "この店では、季節によって商品が変わります。", "pVi": "Ở cửa hàng này, sản phẩm thay đổi tùy theo mùa.", "casual": "この店、季節で商品変わるんだ。", "cVi": "Quán này đổi hàng theo mùa đấy.", "gIds": ["ni_yotte"] } },
            { "STT": 7, "Kanji": "質", "Nghĩa": "Chất lượng", "Furigana": "しつ", "type": "noun", "conv": { "polite": "品質は高ければ高いほどいいんです。", "pVi": "Chất lượng càng cao càng tốt.", "casual": "質は高ければ高いほどいいよね。", "cVi": "Chất lượng càng cao càng tốt mà.", "gIds": [] } },
            { "STT": 8, "Kanji": "型", "Nghĩa": "Khuôn mẫu", "Furigana": "かた", "type": "noun", "conv": { "polite": "この型では、色々なものが作れるところです。", "pVi": "Với khuôn này, đang có thể làm được nhiều thứ.", "casual": "この型なら色々作れるとこだよ。", "cVi": "Khuôn này làm được ối thứ đấy.", "gIds": ["tokoro"] } },
            { "STT": 9, "Kanji": "生産する", "Nghĩa": "Sản xuất", "Furigana": "せいさんする", "type": "verb", "conv": { "polite": "この工場では、毎日車が生産されています。", "pVi": "Ở nhà máy này, ô tô đang được sản xuất mỗi ngày.", "casual": "ここじゃ毎日車作ってるよ。", "cVi": "Ở đây ngày nào cũng sản xuất xe.", "gIds": [] } },
            { "STT": 10, "Kanji": "農業", "Nghĩa": "Nông nghiệp", "Furigana": "のうぎょう", "type": "noun", "conv": { "polite": "農業が盛んなうちに、旅行に行きたいです。", "pVi": "Nhân lúc nông nghiệp đang phát triển, tôi muốn đi du lịch.", "casual": "農業盛んなうちに旅行行きたいな。", "cVi": "Tranh thủ lúc nông nghiệp đang mạnh đi du lịch đi.", "gIds": ["uchi_ni_1"] } },
            { "STT": 11, "Kanji": "消費する", "Nghĩa": "Tiêu thụ", "Furigana": "しょうひする", "type": "verb", "conv": { "polite": "電気を消費しているうちに、節約を考えましょう。", "pVi": "Trong khi đang tiêu thụ điện, hãy nghĩ đến việc tiết kiệm.", "casual": "電気使ってるうちに節約考えようよ。", "cVi": "Đang tốn điện thì tính chuyện tiết kiệm đi.", "gIds": ["uchi_ni_2"] } },
            { "STT": 12, "Kanji": "物価", "Nghĩa": "Giá cả", "Furigana": "ぶっか", "type": "noun", "conv": { "polite": "物価が高い間は、外食はしないほうがいいです。", "pVi": "Trong khi giá cả cao, không nên ăn ngoài.", "casual": "物価高い間は外食しないほうがいいよ。", "cVi": "Lúc vật giá leo thang thì đừng ăn quán.", "gIds": ["aida_ni"] } },
            { "STT": 13, "Kanji": "倒産する", "Nghĩa": "Phá sản", "Furigana": "とうさんする", "type": "verb", "conv": { "polite": "倒産してからでないと、新しいビジネスは始められません。", "pVi": "Nếu chưa phá sản thì không thể bắt đầu công việc kinh doanh mới.", "casual": "倒産してからじゃないと、新しいことできないよ。", "cVi": "Chưa phá sản xong thì chưa làm cái mới được đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 14, "Kanji": "携帯", "Nghĩa": "Di động", "Furigana": "けいたい", "type": "noun", "conv": { "polite": "携帯電話の機能は、モデルによって違うんです。", "pVi": "Chức năng của điện thoại di động khác nhau tùy theo mẫu.", "casual": "携帯の機能ってモデルで違うんだよ。", "cVi": "Chức năng điện thoại tùy dòng mà khác nhau đó.", "gIds": ["ni_yotte"] } },
            { "STT": 15, "Kanji": "現代", "Nghĩa": "Hiện đại", "Furigana": "げんだい", "type": "noun", "conv": { "polite": "現代では、情報が早く伝わるところです。", "pVi": "Trong thời hiện đại, thông tin đang được truyền đi nhanh chóng.", "casual": "現代じゃ情報が早く伝わるとこだね。", "cVi": "Thời nay tin tức lan truyền nhanh thật.", "gIds": ["tokoro"] } },
            { "STT": 16, "Kanji": "世紀", "Nghĩa": "Thế kỷ", "Furigana": "せいき", "type": "noun", "conv": { "polite": "21世紀は、AIが発展する世紀だと言われています。", "pVi": "Thế kỷ 21 được nói là thế kỷ mà AI sẽ phát triển.", "casual": "21世紀はAIが伸びる時代だって言われてるよ。", "cVi": "Thế kỷ 21 nghe đồn là thời của AI đấy.", "gIds": [] } },
            { "STT": 17, "Kanji": "文化", "Nghĩa": "Văn hóa", "Furigana": "ぶんか", "type": "noun", "conv": { "polite": "日本の文化を学んでいるうちに、日本のことがもっと好きになりました。", "pVi": "Trong khi học văn hóa Nhật Bản, tôi đã thích Nhật Bản hơn.", "casual": "日本文化学んでるうちに、もっと日本好きになったよ。", "cVi": "Học văn hóa Nhật một hồi thấy thích Nhật hơn hẳn.", "gIds": ["uchi_ni_2"] } },
            { "STT": 18, "Kanji": "都市", "Nghĩa": "Thành phố", "Furigana": "とし", "type": "noun", "conv": { "polite": "都市に住んでいるうちに、自然が恋しくなりました。", "pVi": "Trong khi sống ở thành phố, tôi đã nhớ thiên nhiên.", "casual": "都会に住んでるうちに、自然が恋しくなっちゃった。", "cVi": "Sống ở phố thị riết lại nhớ thiên nhiên.", "gIds": ["uchi_ni_2"] } },
            { "STT": 19, "Kanji": "地方", "Nghĩa": "Địa phương", "Furigana": "ちほう", "type": "noun", "conv": { "polite": "地方では、地域によって習慣が違うんです。", "pVi": "Ở địa phương, phong tục khác nhau tùy theo vùng.", "casual": "地方じゃ地域で習慣違うんだよね。", "cVi": "Ở quê thì tùy vùng mà phong tục khác nhau.", "gIds": ["ni_yotte"] } },
            { "STT": 20, "Kanji": "戦争", "Nghĩa": "Chiến tranh", "Furigana": "せんそう", "type": "noun", "conv": { "polite": "戦争が終わってからでないと、平和は訪れません。", "pVi": "Nếu chiến tranh chưa kết thúc thì hòa bình sẽ không đến.", "casual": "戦争終わってからじゃないと、平和にならないよ。", "cVi": "Chiến tranh chưa dứt thì làm gì có hòa bình.", "gIds": ["tekara_denaito"] } },
            { "STT": 21, "Kanji": "平和", "Nghĩa": "Hòa bình", "Furigana": "へいわ", "type": "noun", "conv": { "polite": "平和な世界を築くために、努力しているところです。", "pVi": "Tôi đang nỗ lực để xây dựng một thế giới hòa bình.", "casual": "平和な世界作るために、頑張ってるとこだよ。", "cVi": "Đang cố gắng xây dựng thế giới hòa bình đây.", "gIds": ["tokoro"] } },
            { "STT": 22, "Kanji": "(が)上る", "Nghĩa": "Leo lên", "Furigana": "のぼる", "type": "verb", "conv": { "polite": "山に登っているうちに、雨が降ってきました。", "pVi": "Trong khi đang leo núi, trời bắt đầu mưa.", "casual": "山登ってるうちに、雨降ってきたよ。", "cVi": "Đang leo núi thì trời mưa.", "gIds": ["uchi_ni_2"] } },
            { "STT": 23, "Kanji": "階段", "Nghĩa": "Cầu thang", "Furigana": "かいだん", "type": "noun", "conv": { "polite": "階段を上るのに時間がかかるところです。", "pVi": "Tôi đang chuẩn bị mất thời gian để lên cầu thang.", "casual": "階段上るの、時間かかるとこだよ。", "cVi": "Leo cầu thang tốn thời gian lắm đấy.", "gIds": ["tokoro"] } },
            { "STT": 24, "Kanji": "坂", "Nghĩa": "Dốc", "Furigana": "さか", "type": "noun", "conv": { "polite": "この坂は、人によって上りやすさが違うんです。", "pVi": "Con dốc này, độ dễ leo khác nhau tùy theo người.", "casual": "この坂、人によって上りやすさ違うんだ。", "cVi": "Dốc này tùy người mà thấy dễ leo hay không.", "gIds": ["ni_yotte"] } },
            { "STT": 25, "Kanji": "下る", "Nghĩa": "Đi xuống", "Furigana": "くだる", "type": "verb", "conv": { "polite": "坂を下っている間に、転んでしまいました。", "pVi": "Trong khi đang xuống dốc, tôi đã bị ngã.", "casual": "坂下ってる間に、転んじゃった。", "cVi": "Đang xuống dốc thì ngã oạch cái.", "gIds": ["aida_ni"] } },
            { "STT": 26, "Kanji": "(が)進む", "Nghĩa": "Tiến lên", "Furigana": "すすむ", "type": "verb", "conv": { "polite": "勉強が進んでいるうちに、新しい目標を立てましょう。", "pVi": "Trong khi việc học đang tiến triển, hãy đặt mục tiêu mới.", "casual": "勉強進んでるうちに、新しい目標立てようよ。", "cVi": "Học hành đang tốt thì đặt mục tiêu mới đi.", "gIds": ["uchi_ni_2"] } },
            { "STT": 27, "Kanji": "進める", "Nghĩa": "Thúc đẩy", "Furigana": "すすめる", "type": "verb", "conv": { "polite": "仕事を進めるのに、協力が必要なところです。", "pVi": "Tôi đang ở giai đoạn cần sự hợp tác để thúc đẩy công việc.", "casual": "仕事進めるのに、協力が必要なとこなんだ。", "cVi": "Đang cần mọi người giúp để đẩy nhanh công việc.", "gIds": ["tokoro"] } },
            { "STT": 28, "Kanji": "(が)通る", "Nghĩa": "Đi qua", "Furigana": "とおる", "type": "verb", "conv": { "polite": "この道は、時間帯によっては車が通れないんです。", "pVi": "Con đường này, tùy theo khung giờ mà ô tô không thể đi qua.", "casual": "この道、時間帯で車通れないことあるよ。", "cVi": "Đường này tùy giờ mà xe không qua được đâu.", "gIds": ["ni_yotte"] } },
            { "STT": 29, "Kanji": "通す", "Nghĩa": "Xuyên qua", "Furigana": "とおす", "type": "verb", "conv": { "polite": "針に糸を通してからでないと、縫えません。", "pVi": "Nếu chưa xỏ chỉ qua kim thì không thể may được.", "casual": "糸通してからじゃないと、縫えないよ。", "cVi": "Chưa xỏ chỉ thì may sao được.", "gIds": ["tekara_denaito"] } },
            { "STT": 30, "Kanji": "光", "Nghĩa": "Ánh sáng", "Furigana": "ひかり", "type": "noun", "conv": { "polite": "光があるうちに、写真を撮りましょう。", "pVi": "Nhân lúc còn ánh sáng, chúng ta hãy chụp ảnh.", "casual": "明るいうちに写真撮ろうよ。", "cVi": "Tranh thủ còn sáng chụp ảnh đi.", "gIds": ["uchi_ni_1"] } },
            { "STT": 31, "Kanji": "布", "Nghĩa": "Vải", "Furigana": "ぬの", "type": "noun", "conv": { "polite": "この布は、素材によって値段が違うんです。", "pVi": "Vải này, giá cả khác nhau tùy theo chất liệu.", "casual": "この布、素材で値段違うんだ。", "cVi": "Vải này tùy chất liệu mà giá khác nhau đấy.", "gIds": ["ni_yotte"] } },
            { "STT": 32, "Kanji": "空気", "Nghĩa": "Không khí", "Furigana": "くうき", "type": "noun", "conv": { "polite": "新鮮な空気を吸っているうちに、気分が良くなりました。", "pVi": "Trong khi hít thở không khí trong lành, tôi đã cảm thấy tốt hơn.", "casual": "いい空気吸ってたら、気分良くなったよ。", "cVi": "Hít thở không khí trong lành thấy khỏe hẳn ra.", "gIds": ["uchi_ni_2"] } },
            { "STT": 33, "Kanji": "(が)越える", "Nghĩa": "Vượt qua", "Furigana": "こえる", "type": "verb", "conv": { "polite": "山を越えるのは、人によって難しさが違うんです。", "pVi": "Việc vượt qua núi, độ khó khác nhau tùy theo người.", "casual": "山越えって人によって難易度違うよね。", "cVi": "Leo qua núi thì tùy người mà thấy khó hay dễ.", "gIds": ["ni_yotte"] } },
            { "STT": 34, "Kanji": "(が)過ぎる", "Nghĩa": "Quá/Trôi qua", "Furigana": "すぎる", "type": "verb", "conv": { "polite": "時間が過ぎている間に、宿題を終わらせましょう。", "pVi": "Trong khi thời gian đang trôi qua, hãy hoàn thành bài tập.", "casual": "時間過ぎてる間に宿題終わらせちゃおう。", "cVi": "Tranh thủ thời gian trôi thì làm cho xong bài tập đi.", "gIds": ["aida_ni"] } },
            { "STT": 35, "Kanji": "過ごす", "Nghĩa": "Trải qua", "Furigana": "すごす", "type": "verb", "conv": { "polite": "楽しい時間を過ごしているところです。", "pVi": "Tôi đang trải qua thời gian vui vẻ.", "casual": "楽しい時間過ごしてるとこだよ。", "cVi": "Đang vui vẻ lắm đây.", "gIds": ["tokoro"] } },
            { "STT": 36, "Kanji": "移る", "Nghĩa": "Di chuyển", "Furigana": "うつる", "type": "verb", "conv": { "polite": "新しい部屋に移る前に、荷物を整理しておきましょう。", "pVi": "Trước khi chuyển đến phòng mới, hãy sắp xếp hành lý trước.", "casual": "部屋移る前に荷物整理しとこう。", "cVi": "Dọn đồ trước khi chuyển phòng đi.", "gIds": [] } },
            { "STT": 37, "Kanji": "移す", "Nghĩa": "Chuyển", "Furigana": "うつす", "type": "verb", "conv": { "polite": "荷物を移してからでないと、出発できません。", "pVi": "Nếu chưa chuyển hành lý thì không thể xuất phát.", "casual": "荷物移してからじゃないと出発できないよ。", "cVi": "Chưa chuyển đồ xong thì chưa đi được đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 38, "Kanji": "本社", "Nghĩa": "Trụ sở chính", "Furigana": "ほんしゃ", "type": "noun", "conv": { "polite": "本社へ行くのは、私のかわりに友達が行ってくれました。", "pVi": "Việc đi đến trụ sở chính, bạn tôi đã đi thay cho tôi.", "casual": "本社行くの、友達が代わりに行ってくれたよ。", "cVi": "Bạn tớ đi lên trụ sở chính thay tớ rồi.", "gIds": ["kawari_ni"] } },
            { "STT": 39, "Kanji": "連れる", "Nghĩa": "Dẫn", "Furigana": "つれる", "type": "verb", "conv": { "polite": "子供を連れている間に、雨が降ってきました。", "pVi": "Trong khi đang dẫn con đi, trời bắt đầu mưa.", "casual": "子供連れてる間に雨降ってきた。", "cVi": "Đang dắt con đi thì mưa.", "gIds": ["aida_ni"] } },
            { "STT": 40, "Kanji": "寄る", "Nghĩa": "Ghé thăm", "Furigana": "よる", "type": "verb", "conv": { "polite": "友達の家に寄ってからでないと、帰れません。", "pVi": "Nếu chưa ghé thăm nhà bạn thì không thể về.", "casual": "友達んち寄ってからじゃないと帰れないよ。", "cVi": "Phải ghé nhà bạn xong mới về được.", "gIds": ["tekara_denaito"] } },
            { "STT": 41, "Kanji": "寄せる", "Nghĩa": "Ghé vào", "Furigana": "よせる", "type": "verb", "conv": { "polite": "車を端に寄せているうちに、警察が来ました。", "pVi": "Trong khi đang đỗ xe vào lề, cảnh sát đã đến.", "casual": "車寄せてるうちに警察来ちゃった。", "cVi": "Đang tấp xe vào lề thì cảnh sát tới.", "gIds": ["uchi_ni_2"] } },
            { "STT": 42, "Kanji": "奨学金", "Nghĩa": "Học bổng", "Furigana": "しょうがくきん", "type": "noun", "conv": { "polite": "奨学金をもらってからでないと、留学できません。", "pVi": "Nếu chưa nhận được học bổng thì không thể du học.", "casual": "奨学金もらってからじゃないと留学できないよ。", "cVi": "Không có học bổng sao đi du học được.", "gIds": ["tekara_denaito"] } },
            { "STT": 43, "Kanji": "成績", "Nghĩa": "Thành tích", "Furigana": "せいせき", "type": "noun", "conv": { "polite": "成績は、努力によって変わるんです。", "pVi": "Thành tích thay đổi tùy theo nỗ lực.", "casual": "成績って努力で変わるんだよね。", "cVi": "Thành tích tùy thuộc vào nỗ lực mà.", "gIds": ["ni_yotte"] } },
            { "STT": 44, "Kanji": "与える", "Nghĩa": "Ban/Tặng", "Furigana": "あたえる", "type": "verb", "conv": { "polite": "情報を与えているところです。", "pVi": "Tôi đang cung cấp thông tin.", "casual": "情報与えてるとこだよ。", "cVi": "Đang đưa thông tin đây.", "gIds": ["tokoro"] } },
            { "STT": 45, "Kanji": "得る", "Nghĩa": "Đạt được", "Furigana": "える", "type": "verb", "conv": { "polite": "経験を得るために、色々なことに挑戦しています。", "pVi": "Để đạt được kinh nghiệm, tôi đang thử thách nhiều điều khác nhau.", "casual": "経験得るために色々やってるよ。", "cVi": "Tớ đang thử đủ thứ để lấy kinh nghiệm.", "gIds": [] } },
            { "STT": 46, "Kanji": "向く", "Nghĩa": "Hướng về", "Furigana": "むく", "type": "verb", "conv": { "polite": "太陽に向いているうちに、目が痛くなりました。", "pVi": "Trong khi đang hướng về phía mặt trời, mắt tôi đã bị đau.", "casual": "太陽見てたら目痛くなった。", "cVi": "Nhìn mặt trời một hồi đau hết cả mắt.", "gIds": ["uchi_ni_2"] } },
            { "STT": 47, "Kanji": "向ける", "Nghĩa": "Chĩa về", "Furigana": "むける", "type": "verb", "conv": { "polite": "カメラを向けている間に、鳥が飛んでいきました。", "pVi": "Trong khi đang quay máy ảnh, con chim đã bay đi.", "casual": "カメラ向けてる間に鳥逃げちゃった。", "cVi": "Đang lia máy thì chim bay mất tiêu.", "gIds": ["aida_ni"] } },
            { "STT": 48, "Kanji": "勧める", "Nghĩa": "Mời/Rủ", "Furigana": "すすめる", "type": "verb", "conv": { "polite": "お酒を勧めてからでないと、帰れません。", "pVi": "Nếu chưa mời rượu thì không thể về.", "casual": "お酒勧めてからじゃないと帰れないよ。", "cVi": "Chưa mời rượu xong chưa về được đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 49, "Kanji": "薦める", "Nghĩa": "Gợi ý", "Furigana": "すすめる", "type": "verb", "conv": { "polite": "この本は、人によって好き嫌いが違うんです。", "pVi": "Cuốn sách này, sở thích khác nhau tùy theo người.", "casual": "この本、人によって好み分かれるよね。", "cVi": "Sách này tùy người thích hay không.", "gIds": ["ni_yotte"] } },
            { "STT": 50, "Kanji": "任せる", "Nghĩa": "Giao phó", "Furigana": "まかせる", "type": "verb", "conv": { "polite": "この仕事を任せているところです。", "pVi": "Tôi đang giao phó công việc này.", "casual": "この仕事任せてるとこだよ。", "cVi": "Đang giao việc này rồi.", "gIds": ["tokoro"] } },
            { "STT": 51, "Kanji": "守る", "Nghĩa": "Bảo vệ", "Furigana": "まもる", "type": "verb", "conv": { "polite": "ルールを守っている間に、ゲームが終わりました。", "pVi": "Trong khi đang tuân thủ luật, trò chơi đã kết thúc.", "casual": "ルール守ってる間にゲーム終わっちゃった。", "cVi": "Mải theo luật thì game over mất rồi.", "gIds": ["aida_ni"] } },
            { "STT": 52, "Kanji": "争う", "Nghĩa": "Tranh giành", "Furigana": "あらそう", "type": "verb", "conv": { "polite": "兄弟が争っているうちに、親が来ました。", "pVi": "Trong khi anh em đang cãi nhau, bố mẹ đã đến.", "casual": "兄弟喧嘩してるうちに親来ちゃった。", "cVi": "Đang cãi nhau thì bố mẹ tới.", "gIds": ["uchi_ni_2"] } },
            { "STT": 53, "Kanji": "望む", "Nghĩa": "Mong ước", "Furigana": "のぞむ", "type": "verb", "conv": { "polite": "平和を望んでからでないと、行動はできません。", "pVi": "Nếu chưa mong muốn hòa bình thì không thể hành động.", "casual": "平和望んでからじゃないと動けないよ。", "cVi": "Phải muốn hòa bình thật sự mới hành động được.", "gIds": ["tekara_denaito"] } },
            { "STT": 54, "Kanji": "信じる", "Nghĩa": "Tin tưởng", "Furigana": "しんじる", "type": "verb", "conv": { "polite": "彼の言葉を信じているところです。", "pVi": "Tôi đang tin lời anh ấy.", "casual": "彼の言葉信じてるとこだよ。", "cVi": "Tớ đang tin lời hắn đây.", "gIds": ["tokoro"] } },
            { "STT": 55, "Kanji": "通じる", "Nghĩa": "Thông hiểu", "Furigana": "つうじる", "type": "verb", "conv": { "polite": "彼の気持ちが私に通じるのは、時間によって違うんです。", "pVi": "Cảm xúc của anh ấy đến với tôi, tùy theo thời gian mà khác nhau.", "casual": "気持ちが通じるタイミングって人それぞれだよね。", "cVi": "Tình cảm chạm được tới nhau hay không cũng tùy lúc.", "gIds": ["ni_yotte"] } },
            { "STT": 56, "Kanji": "飽く", "Nghĩa": "Chán", "Furigana": "あく", "type": "verb", "conv": { "polite": "このゲームに飽きてからでないと、次のゲームはできません。", "pVi": "Nếu chưa chán trò chơi này thì không thể chơi trò tiếp theo.", "casual": "このゲーム飽きてからじゃないと次できないよ。", "cVi": "Chưa chán game này thì chưa chơi game mới được.", "gIds": ["tekara_denaito"] } },
            { "STT": 57, "Kanji": "思いつく", "Nghĩa": "Nảy ra", "Furigana": "おもいつく", "type": "verb", "conv": { "polite": "新しいアイデアを思いついているところです。", "pVi": "Tôi đang nghĩ ra một ý tưởng mới.", "casual": "新しいアイデア思いついてるとこだよ。", "cVi": "Đang nảy ra ý tưởng mới đây.", "gIds": ["tokoro"] } },
            { "STT": 58, "Kanji": "思いやる", "Nghĩa": "Quan tâm", "Furigana": "おもいやる", "type": "verb", "conv": { "polite": "友達を思いやっているうちに、優しくなりました。", "pVi": "Trong khi quan tâm đến bạn bè, tôi đã trở nên hiền lành hơn.", "casual": "友達思いやってるうちに優しくなったな。", "cVi": "Biết quan tâm bạn bè xong thấy mình hiền hơn hẳn.", "gIds": ["uchi_ni_2"] } },
            { "STT": 59, "Kanji": "熱中する", "Nghĩa": "Nghiện/Say mê", "Furigana": "ねっちゅうする", "type": "verb", "conv": { "polite": "ゲームに熱中している間に、時間が過ぎてしまいました。", "pVi": "Trong khi đang nghiện game, thời gian đã trôi qua mất rồi.", "casual": "ゲーム熱中してる間に時間過ぎちゃった。", "cVi": "Mải chơi game quá hết ngày lúc nào không hay.", "gIds": ["aida_ni"] } },
            { "STT": 60, "Kanji": "暮らす", "Nghĩa": "Sinh sống", "Furigana": "くらす", "type": "verb", "conv": { "polite": "日本で暮らしてからでないと、日本のことはわかりません。", "pVi": "Nếu chưa sống ở Nhật thì không thể hiểu về Nhật Bản.", "casual": "日本で暮らしてからじゃないと、日本わかんないよ。", "cVi": "Chưa sống ở Nhật thì chưa hiểu Nhật đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 61, "Kanji": "巻く", "Nghĩa": "Cuộn/Quấn", "Furigana": "まく", "type": "verb", "conv": { "polite": "髪を巻いているところです。", "pVi": "Tôi đang cuộn tóc.", "casual": "髪巻いてるとこだよ。", "cVi": "Đang uốn tóc đây.", "gIds": ["tokoro"] } },
            { "STT": 62, "Kanji": "結ぶ", "Nghĩa": "Buộc/Thắt", "Furigana": "むすぶ", "type": "verb", "conv": { "polite": "紐を結んでからでないと、靴が履けません。", "pVi": "Nếu chưa buộc dây thì không thể đi giày.", "casual": "紐結んでからじゃないと靴履けないよ。", "cVi": "Chưa buộc dây thì sao đi giày được.", "gIds": ["tekara_denaito"] } },
            { "STT": 63, "Kanji": "紐", "Nghĩa": "Dây", "Furigana": "ひも", "type": "noun", "conv": { "polite": "この紐は、使い方によって色々なことができます。", "pVi": "Sợi dây này, tùy theo cách sử dụng mà có thể làm được nhiều thứ.", "casual": "この紐、使い方で色々できるんだ。", "cVi": "Dây này tùy cách dùng mà làm được khối trò.", "gIds": ["ni_yotte"] } },
            { "STT": 64, "Kanji": "済む", "Nghĩa": "Xong/Hoàn tất", "Furigana": "すむ", "type": "verb", "conv": { "polite": "仕事が終わるまで、待っているところです。", "pVi": "Tôi đang đợi cho đến khi công việc kết thúc.", "casual": "仕事終わるの待ってるとこだよ。", "cVi": "Đang đợi xong việc đây.", "gIds": ["tokoro"] } },
            { "STT": 65, "Kanji": "済ます", "Nghĩa": "Làm cho xong", "Furigana": "すます", "type": "verb", "conv": { "polite": "宿題を済ませてからでないと、遊びに行けません。", "pVi": "Nếu chưa hoàn thành bài tập thì không thể đi chơi.", "casual": "宿題済ませてからじゃないと遊び行けないよ。", "cVi": "Chưa làm xong bài tập thì chưa được đi chơi.", "gIds": ["tekara_denaito"] } },
            { "STT": 66, "Kanji": "出来る", "Nghĩa": "Hoàn thành/Có thể", "Furigana": "できる", "type": "verb", "conv": { "polite": "日本語が話せるようになっているところです。", "pVi": "Tôi đang trong quá trình có thể nói tiếng Nhật.", "casual": "日本語話せるようになってるとこだよ。", "cVi": "Đang học để nói được tiếng Nhật đây.", "gIds": ["tokoro"] } },
            { "STT": 67, "Kanji": "切れる", "Nghĩa": "Đứt/Hết", "Furigana": "きれる", "type": "verb", "conv": { "polite": "電池が切れている間に、ゲームが終わってしまいました。", "pVi": "Trong khi pin đang hết, trò chơi đã kết thúc mất rồi.", "casual": "電池切れてる間にゲーム終わっちゃった。", "cVi": "Hết pin giữa chừng nên game over luôn.", "gIds": ["aida_ni"] } },
            { "STT": 68, "Kanji": "切らす", "Nghĩa": "Dùng hết", "Furigana": "きらす", "type": "verb", "conv": { "polite": "お金を切らしてからでないと、新しいものは買えません。", "pVi": "Nếu chưa dùng hết tiền thì không thể mua đồ mới.", "casual": "お金なくなってからじゃないと次買えないよ。", "cVi": "Chưa hết tiền thì chưa mua cái mới được.", "gIds": ["tekara_denaito"] } },
            { "STT": 69, "Kanji": "(が)伝わる", "Nghĩa": "Được truyền đi", "Furigana": "つたわる", "type": "verb", "conv": { "polite": "ニュースが伝わっているところに、電話がかかってきました。", "pVi": "Đúng lúc tin tức đang được truyền đi thì có điện thoại đến.", "casual": "ニュース伝わったとこに電話きた。", "cVi": "Đúng lúc tin tới thì điện thoại reo.", "gIds": ["tokoro"] } },
            { "STT": 70, "Kanji": "伝える", "Nghĩa": "Truyền đạt", "Furigana": "つたえる", "type": "verb", "conv": { "polite": "ニュースを伝えているところです。", "pVi": "Tôi đang truyền tin tức.", "casual": "ニュース伝えてるとこだよ。", "cVi": "Đang báo tin đây.", "gIds": ["tokoro"] } },
            { "STT": 71, "Kanji": "(が)続く", "Nghĩa": "Tiếp tục", "Furigana": "つづく", "type": "verb", "conv": { "polite": "雨が続いている間に、家にいましょう。", "pVi": "Trong khi trời vẫn đang mưa, chúng ta hãy ở nhà.", "casual": "雨降ってる間は家にいようよ。", "cVi": "Mưa thì cứ ở nhà đi.", "gIds": ["aida_ni"] } },
            { "STT": 72, "Kanji": "続ける", "Nghĩa": "Làm tiếp", "Furigana": "つづける", "type": "verb", "conv": { "polite": "勉強を続けているうちに、日本語が上手になりました。", "pVi": "Trong khi tiếp tục học, tiếng Nhật của tôi đã giỏi hơn.", "casual": "勉強続けてるうちに日本語上手くなったよ。", "cVi": "Học miết nên tiếng Nhật khá lên hẳn.", "gIds": ["uchi_ni_2"] } },
            { "STT": 73, "Kanji": "(が)繋がる", "Nghĩa": "Được kết nối", "Furigana": "つながる", "type": "verb", "conv": { "polite": "インターネットが繋がっているところに、メールが来ました。", "pVi": "Đúng lúc internet đang được kết nối thì có email đến.", "casual": "ネット繋がったとこにメールきた。", "cVi": "Mạng vừa có thì mail tới.", "gIds": ["tokoro"] } },
            { "STT": 74, "Kanji": "繋ぐ", "Nghĩa": "Kết nối/Nắm tay", "Furigana": "つなぐ", "type": "verb", "conv": { "polite": "手を繋いでいるうちに、友達が来ました。", "pVi": "Trong khi đang nắm tay, bạn bè đã đến.", "casual": "手繋いでるうちに友達きちゃった。", "cVi": "Đang nắm tay thì bạn tới.", "gIds": ["uchi_ni_2"] } },
            { "STT": 75, "Kanji": "繋げる", "Nghĩa": "Làm chặt", "Furigana": "つなげる", "type": "verb", "conv": { "polite": "紐を繋げてからでないと、使えません。", "pVi": "Nếu chưa buộc chặt dây thì không thể sử dụng.", "casual": "紐繋げてからじゃないと使えないよ。", "cVi": "Chưa nối dây thì chưa dùng được đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 76, "Kanji": "伸びる", "Nghĩa": "Dài ra", "Furigana": "のびる", "type": "verb", "conv": { "polite": "髪が伸びている間に、美容院に行きましょう。", "pVi": "Trong khi tóc đang dài ra, chúng ta hãy đi đến tiệm làm tóc.", "casual": "髪伸びてる間に美容院行こうよ。", "cVi": "Tóc dài rồi thì đi cắt tóc đi.", "gIds": ["aida_ni"] } },
            { "STT": 77, "Kanji": "伸ばす", "Nghĩa": "Làm dài ra", "Furigana": "のばす", "type": "verb", "conv": { "polite": "髪を伸ばしているところです。", "pVi": "Tôi đang để tóc dài.", "casual": "髪伸ばしてるとこだよ。", "cVi": "Đang nuôi tóc dài đây.", "gIds": ["tokoro"] } },
            { "STT": 78, "Kanji": "延びる", "Nghĩa": "Bị trì hoãn", "Furigana": "のびる", "type": "verb", "conv": { "polite": "会議が延びている間に、他の仕事をしましょう。", "pVi": "Trong khi cuộc họp đang bị trì hoãn, chúng ta hãy làm công việc khác.", "casual": "会議延びてる間に他の仕事しよう。", "cVi": "Họp hoãn thì làm việc khác đi.", "gIds": ["aida_ni"] } },
            { "STT": 79, "Kanji": "延ばす", "Nghĩa": "Trì hoãn/Kéo dài", "Furigana": "のばす", "type": "verb", "conv": { "polite": "時間を延ばしてからでないと、終わりません。", "pVi": "Nếu chưa kéo dài thời gian thì sẽ không kết thúc.", "casual": "時間延ばしてからじゃないと終わんないよ。", "cVi": "Không thêm giờ thì không xong được đâu.", "gIds": ["tekara_denaito"] } },
            { "STT": 80, "Kanji": "(が)重なる", "Nghĩa": "Chồng chất", "Furigana": "かさなる", "type": "verb", "conv": { "polite": "問題が重なっているところに、新しい問題が起きました。", "pVi": "Đúng lúc vấn đề đang chồng chất thì một vấn đề mới đã xảy ra.", "casual": "問題重なってるとこにまた問題だよ。", "cVi": "Đang rối ren thì lại thêm chuyện.", "gIds": ["tokoro"] } },
            { "STT": 81, "Kanji": "重ねる", "Nghĩa": "Xếp chồng", "Furigana": "かさねる", "type": "verb", "conv": { "polite": "本を重ねているところです。", "pVi": "Tôi đang xếp chồng sách lên.", "casual": "本重ねてるとこだよ。", "cVi": "Đang xếp sách đây.", "gIds": ["tokoro"] } },
            { "STT": 82, "Kanji": "(が)広がる", "Nghĩa": "Lan rộng", "Furigana": "ひろがる", "type": "verb", "conv": { "polite": "視野が広がっているうちに、新しい発見がありました。", "pVi": "Trong khi tầm nhìn đang được mở rộng, tôi đã có một phát hiện mới.", "casual": "視野広がってるうちに新しい発見あったよ。", "cVi": "Tầm nhìn mở rộng cái là phát hiện ra cái mới liền.", "gIds": ["uchi_ni_2"] } },
            { "STT": 83, "Kanji": "広げる", "Nghĩa": "Mở rộng", "Furigana": "ひろげる", "type": "verb", "conv": { "polite": "視野を広げているところです。", "pVi": "Tôi đang mở rộng tầm nhìn.", "casual": "視野広げてるとこだよ。", "cVi": "Đang mở mang tầm mắt đây.", "gIds": ["tokoro"] } },
            { "STT": 84, "Kanji": "(が)載る", "Nghĩa": "Được đăng/Lên", "Furigana": "のる", "type": "verb", "conv": { "polite": "雑誌に写真が載っているのを見ました。", "pVi": "Tôi đã nhìn thấy ảnh được đăng trên tạp chí.", "casual": "雑誌に写真載ってるの見たよ。", "cVi": "Tớ thấy ảnh lên báo rồi đấy.", "gIds": [] } },
            { "STT": 85, "Kanji": "載せる", "Nghĩa": "Đăng tải/Chất lên", "Furigana": "のせる", "type": "verb", "conv": { "polite": "荷物を車に載せているところです。", "pVi": "Tôi đang chất hành lý lên xe.", "casual": "荷物車に載せてるとこだよ。", "cVi": "Đang chất đồ lên xe đây.", "gIds": ["tokoro"] } },
            { "STT": 86, "Kanji": "(が)揃う", "Nghĩa": "Tập hợp đủ/Đồng đều", "Furigana": "そろう", "type": "verb", "conv": { "polite": "準備が揃っているうちに、出発しましょう。", "pVi": "Trong khi việc chuẩn bị đang đầy đủ, chúng ta hãy xuất phát.", "casual": "準備揃ってるうちに出発しよう。", "cVi": "Chuẩn bị xong rồi thì đi thôi.", "gIds": ["uchi_ni_1"] } },
            { "STT": 87, "Kanji": "揃える", "Nghĩa": "Làm cho đều/Thu thập", "Furigana": "そろえる", "type": "verb", "conv": { "polite": "みんなを揃えてからでないと、始められません。", "pVi": "Nếu chưa tập hợp mọi người thì không thể bắt đầu.", "casual": "みんな揃えてからじゃないと始められないよ。", "cVi": "Chưa đủ người thì chưa bắt đầu được đâu.", "gIds": ["tekara_denaito"] } }
        ];

        // --- 3. KANJI DETAILS (Updated for Day 20) ---
        const kanjiDetails = {
            "不": { hanviet: "BẤT", mean: "Không", on: "フ", kun: "", radicals: "Nhất (一)", tipImg: "Con chim bay lên trời không (不) quay lại.", tipSoundOn: "**Fu**an bất an.", tipSoundKun: "", words: [{w:"不足 (ふそく)", m:"Thiếu"}, {w:"不安 (ふあん)", m:"Bất an"}] },
            "足": { hanviet: "TÚC", mean: "Chân/Đủ", on: "ソク", kun: "あし", radicals: "Khẩu (口) + Chỉ (止)", tipImg: "Cái miệng (口) nói cái chân (止) đi đủ rồi.", tipSoundOn: "En**soku** dã ngoại.", tipSoundKun: "**Ashi** chân.", words: [{w:"不足 (ふそく)", m:"Thiếu"}, {w:"足 (あし)", m:"Chân"}] },
            "平": { hanviet: "BÌNH", mean: "Bằng phẳng", on: "ヘイ", kun: "たい.ら", radicals: "Can (干)", tipImg: "Cán cân thăng bằng.", tipSoundOn: "**Hei**wa hòa bình.", tipSoundKun: "**Tai**ra bằng phẳng.", words: [{w:"平均 (へいきん)", m:"Trung bình"}, {w:"平和 (へいわ)", m:"Hòa bình"}] },
            "均": { hanviet: "QUÂN", mean: "Đều/Cân bằng", on: "キン", kun: "", radicals: "Thổ (土) + Bao (勹) + Nhị (二)", tipImg: "Đất (土) được chia đều (勻).", tipSoundOn: "Hei**kin** trung bình.", tipSoundKun: "", words: [{w:"平均 (へいきん)", m:"Trung bình"}] },
            "割": { hanviet: "CÁT", mean: "Vỡ/Chia", on: "カツ", kun: "わ.る", radicals: "Hại (害) + Đao (刂)", tipImg: "Dùng dao (刂) cắt bỏ cái hại (害).", tipSoundOn: "Bun**katsu** chia cắt.", tipSoundKun: "**Wa**ru làm vỡ.", words: [{w:"割合 (わりあい)", m:"Tỷ lệ"}, {w:"割引 (わりびき)", m:"Giảm giá"}] },
            "合": { hanviet: "HỢP", mean: "Hợp/Vừa", on: "ゴウ", kun: "あ.う", radicals: "Nhân (人) + Nhất (一) + Khẩu (口)", tipImg: "Người (人) một (一) nhà ăn chung miệng (口) là hợp.", tipSoundOn: "**Gou**kaku đậu.", tipSoundKun: "**A**u gặp/hợp.", words: [{w:"割合 (わりあい)", m:"Tỷ lệ"}, {w:"間に合う (まにあう)", m:"Kịp giờ"}] },
            "報": { hanviet: "BÁO", mean: "Báo cáo/Tin tức", on: "ホウ", kun: "むく.いる", radicals: "Hạnh (幸) + Phục (卩)", tipImg: "Hạnh phúc (幸) khi quỳ (卩) nhận tin báo.", tipSoundOn: "**Hou**dou tin tức.", tipSoundKun: "", words: [{w:"報道 (ほうどう)", m:"Tin tức"}, {w:"予報 (よほう)", m:"Dự báo"}] },
            "道": { hanviet: "ĐẠO", mean: "Đường/Đạo lý", on: "ドウ", kun: "みち", radicals: "Xước (⻌) + Thủ (首)", tipImg: "Cái đầu (首) dẫn đường đi (⻌).", tipSoundOn: "Dou**gu** đạo cụ.", tipSoundKun: "**Michi** đường.", words: [{w:"報道 (ほうどう)", m:"Tin tức"}, {w:"道具 (どうぐ)", m:"Dụng cụ"}] },
            "商": { hanviet: "THƯƠNG", mean: "Buôn bán", on: "ショウ", kun: "あきな.う", radicals: "Lập (立) + Quý (冏)", tipImg: "Đứng (立) ở cửa (冏) buôn bán.", tipSoundOn: "**Shou**bai buôn bán.", tipSoundKun: "**Akina**u kinh doanh.", words: [{w:"商売 (しょうばい)", m:"Buôn bán"}, {w:"商品 (しょうひん)", m:"Sản phẩm"}] },
            "売": { hanviet: "MẠI", mean: "Bán", on: "バイ", kun: "う.る", radicals: "Sĩ (士) + Mịch (冖) + Nhân (儿)", tipImg: "Kẻ sĩ (士) trùm khăn (冖) đi bán chân (儿).", tipSoundOn: "**Bai**ten quầy bán.", tipSoundKun: "**U**ru bán.", words: [{w:"商売 (しょうばい)", m:"Buôn bán"}, {w:"売り場 (うりば)", m:"Quầy hàng"}] },
            "品": { hanviet: "PHẨM", mean: "Sản phẩm/Vật phẩm", on: "ヒン", kun: "しな", radicals: "Khẩu (口)", tipImg: "Ba cái miệng đánh giá sản phẩm.", tipSoundOn: "Shou**hin** sản phẩm.", tipSoundKun: "**Shina**mono hàng hóa.", words: [{w:"商品 (しょうひん)", m:"Sản phẩm"}, {w:"品物 (しなもの)", m:"Hàng hóa"}] },
            "質": { hanviet: "CHẤT", mean: "Chất lượng/Hỏi", on: "シツ", kun: "", radicals: "Cân (斤) + Bối (貝)", tipImg: "Cầm rìu (斤) đòi tiền (貝) chất lượng.", tipSoundOn: "**Shitsu**mon câu hỏi.", tipSoundKun: "", words: [{w:"質問 (しつもん)", m:"Câu hỏi"}, {w:"品質 (ひんしつ)", m:"Chất lượng"}] },
            "型": { hanviet: "HÌNH", mean: "Khuôn mẫu", on: "ケイ", kun: "かた", radicals: "Hình (刑) + Thổ (土)", tipImg: "Dùng đất (土) làm khuôn hình (刑).", tipSoundOn: "Ten**kei** điển hình.", tipSoundKun: "**Kata** khuôn/kiểu.", words: [{w:"型 (かた)", m:"Khuôn mẫu"}, {w:"髪型 (かみがた)", m:"Kiểu tóc"}] },
            "産": { hanviet: "SẢN", mean: "Sản xuất/Sinh", on: "サン", kun: "う.む", radicals: "Lập (立) + Sinh (生)", tipImg: "Đứng (立) sinh (生) ra sản phẩm.", tipSoundOn: "**San**gyou công nghiệp.", tipSoundKun: "**U**mu sinh đẻ.", words: [{w:"生産 (せいさん)", m:"Sản xuất"}, {w:"財産 (ざいさん)", m:"Tài sản"}] },
            "農": { hanviet: "NÔNG", mean: "Nông nghiệp", on: "ノウ", kun: "", radicals: "Khúc (曲) + Thần (辰)", tipImg: "Khúc (曲) nhạc thần (辰) nông.", tipSoundOn: "**Nou**gyou nông nghiệp.", tipSoundKun: "", words: [{w:"農業 (のうぎょう)", m:"Nông nghiệp"}, {w:"農家 (のうか)", m:"Nhà nông"}] },
            "消": { hanviet: "TIÊU", mean: "Tiêu thụ/Tắt", on: "ショウ", kun: "き.える", radicals: "Thủy (氵) + Tiếu (肖)", tipImg: "Nước (氵) làm tan biến (肖).", tipSoundOn: "**Shou**hi tiêu thụ.", tipSoundKun: "**Ki**eru tắt.", words: [{w:"消費 (しょうひ)", m:"Tiêu thụ"}, {w:"消す (けす)", m:"Tắt/Xóa"}] },
            "費": { hanviet: "PHÍ", mean: "Chi phí", on: "ヒ", kun: "つい.やす", radicals: "Phất (弗) + Bối (貝)", tipImg: "Tiền (貝) phất (弗) đi là phí.", tipSoundOn: "Shou**hi** tiêu thụ.", tipSoundKun: "**Tsui**yasu tiêu tốn.", words: [{w:"消費 (しょうひ)", m:"Tiêu thụ"}, {w:"費用 (ひよう)", m:"Chi phí"}] },
            "物": { hanviet: "VẬT", mean: "Đồ vật", on: "ブツ, モツ", kun: "もの", radicals: "Ngưu (牛) + Vật (勿)", tipImg: "Con bò (牛) chớ (勿) coi là đồ vật.", tipSoundOn: "**Bukka** giá cả.", tipSoundKun: "**Mono** đồ vật.", words: [{w:"物価 (ぶっか)", m:"Giá cả"}, {w:"食べ物 (たべもの)", m:"Đồ ăn"}] },
            "価": { hanviet: "GIÁ", mean: "Giá trị", on: "カ", kun: "あたい", radicals: "Nhân (亻) + Giả (西)", tipImg: "Người (亻) buôn bán phương Tây (西) định giá.", tipSoundOn: "Buk**ka** giá cả.", tipSoundKun: "**Atai** giá trị.", words: [{w:"物価 (ぶっか)", m:"Giá cả"}, {w:"価値 (かち)", m:"Giá trị"}] },
            "倒": { hanviet: "ĐẢO", mean: "Đổ/Ngã", on: "トウ", kun: "たお.れる", radicals: "Nhân (亻) + Đáo (到)", tipImg: "Người đến thì ngã.", tipSoundOn: "**Tou**san phá sản.", tipSoundKun: "**Tao**reru đổ.", words: [{w:"倒産 (とうさん)", m:"Phá sản"}, {w:"面倒 (めんどう)", m:"Phiền phức"}] },
            "携": { hanviet: "HUỀ", mean: "Mang theo", on: "ケイ", kun: "たずさ.わる", radicals: "Thủ (扌) + Quý (隽)", tipImg: "Tay mang vật quý.", tipSoundOn: "**Kei**tai di động.", tipSoundKun: "**Tazusa**waru tham gia.", words: [{w:"携帯 (けいたい)", m:"Điện thoại di động"}] },
            "帯": { hanviet: "ĐỚI", mean: "Đai/Mang", on: "タイ", kun: "おび", radicals: "Cân (巾)", tipImg: "Cái đai vải.", tipSoundOn: "Kei**tai** di động.", tipSoundKun: "**Obi** đai lưng.", words: [{w:"携帯 (けいたい)", m:"Điện thoại di động"}] },
            "現": { hanviet: "HIỆN", mean: "Hiện tại/Xuất hiện", on: "ゲン", kun: "あらわ.れる", radicals: "Ngọc (王) + Kiến (見)", tipImg: "Vua (王) nhìn (見) hiện thực.", tipSoundOn: "**Gen**dai hiện đại.", tipSoundKun: "**Arawa**reru xuất hiện.", words: [{w:"現代 (げんだい)", m:"Hiện đại"}, {w:"現金 (げんきん)", m:"Tiền mặt"}] },
            "代": { hanviet: "ĐẠI", mean: "Thay thế/Đời", on: "ダイ", kun: "か.わる", radicals: "Nhân (亻) + Dực (弋)", tipImg: "Người (亻) cầm cung (弋) thay thế.", tipSoundOn: "Ji**dai** thời đại.", tipSoundKun: "**Ka**waru thay thế.", words: [{w:"現代 (げんだい)", m:"Hiện đại"}, {w:"代わり (かわり)", m:"Sự thay thế"}] },
            "世": { hanviet: "THẾ", mean: "Thế giới", on: "セイ, セ", kun: "よ", radicals: "Nhất (一)", tipImg: "Ba mươi năm một thế hệ.", tipSoundOn: "**Sei**ki thế kỷ.", tipSoundKun: "**Yo**naka nửa đêm.", words: [{w:"世紀 (せいき)", m:"Thế kỷ"}, {w:"世間 (せけん)", m:"Thế gian"}] },
            "紀": { hanviet: "KỶ", mean: "Kỷ nguyên", on: "キ", kun: "", radicals: "Mịch (糸) + Kỷ (己)", tipImg: "Sợi chỉ ghi kỷ niệm.", tipSoundOn: "Sei**ki** thế kỷ.", tipSoundKun: "", words: [{w:"世紀 (せいき)", m:"Thế kỷ"}] },
            "文": { hanviet: "VĂN", mean: "Văn hóa/Văn chương", on: "ブン, モン", kun: "ふみ", radicals: "Đầu (亠) + Nghệ (乂)", tipImg: "Văn chương nghệ thuật.", tipSoundOn: "**Bun**ka văn hóa.", tipSoundKun: "**Fumi** lá thư (cũ).", words: [{w:"文化 (ぶんか)", m:"Văn hóa"}, {w:"文学 (ぶんがく)", m:"Văn học"}] },
            "化": { hanviet: "HÓA", mean: "Biến hóa", on: "カ, ケ", kun: "ば.ける", radicals: "Nhân (亻) + Chủy (匕)", tipImg: "Người (亻) cầm thìa (匕) biến hóa.", tipSoundOn: "Bun**ka** văn hóa.", tipSoundKun: "**Ba**keru biến hóa.", words: [{w:"文化 (ぶんか)", m:"Văn hóa"}, {w:"化粧 (けしょう)", m:"Trang điểm"}] },
            "都": { hanviet: "ĐÔ", mean: "Kinh đô", on: "ト", kun: "みやこ", radicals: "Giả (者) + Ấp (阝)", tipImg: "Người (者) ở ấp (阝) lớn là đô thị.", tipSoundOn: "**To**shi thành phố.", tipSoundKun: "**Miyako** kinh đô.", words: [{w:"都市 (とし)", m:"Thành phố"}, {w:"都会 (とかい)", m:"Đô hội"}] },
            "市": { hanviet: "THỊ", mean: "Thành phố/Chợ", on: "シ", kun: "いち", radicals: "Đầu (亠) + Cân (巾)", tipImg: "Đội khăn (巾) đi chợ.", tipSoundOn: "To**shi** thành phố.", tipSoundKun: "**Ichi**ba chợ.", words: [{w:"都市 (とし)", m:"Thành phố"}, {w:"市場 (いちば)", m:"Chợ"}] },
            "地": { hanviet: "ĐỊA", mean: "Đất", on: "チ, ジ", kun: "", radicals: "Thổ (土) + Dã (也)", tipImg: "Đất (土) cũng (也) là địa.", tipSoundOn: "**Chi**hou địa phương.", tipSoundKun: "", words: [{w:"地方 (ちほう)", m:"Địa phương"}, {w:"地図 (ちず)", m:"Bản đồ"}] },
            "方": { hanviet: "PHƯƠNG", mean: "Hướng/Phương pháp", on: "ホウ", kun: "かた", radicals: "Phương (方)", tipImg: "Hướng về phía trước.", tipSoundOn: "Chi**hou** địa phương.", tipSoundKun: "**Kata** cách làm/vị.", words: [{w:"地方 (ちほう)", m:"Địa phương"}, {w:"読み方 (よみかた)", m:"Cách đọc"}] },
            "戦": { hanviet: "CHIẾN", mean: "Chiến tranh", on: "セン", kun: "たたか.う", radicals: "Đơn (単) + Qua (戈)", tipImg: "Đơn độc cầm giáo chiến đấu.", tipSoundOn: "**Sen**sou chiến tranh.", tipSoundKun: "**Tataka**u chiến đấu.", words: [{w:"戦争 (せんそう)", m:"Chiến tranh"}] },
            "争": { hanviet: "TRANH", mean: "Tranh giành", on: "ソウ", kun: "あらそ.う", radicals: "Quyết (亅)", tipImg: "Tranh giành nhau.", tipSoundOn: "Sen**sou** chiến tranh.", tipSoundKun: "**Araso**u tranh giành.", words: [{w:"戦争 (せんそう)", m:"Chiến tranh"}, {w:"争う (あらそう)", m:"Tranh giành"}] },
            "平": { hanviet: "BÌNH", mean: "Hòa bình", on: "ヘイ", kun: "たい.ら", radicals: "Can (干)", tipImg: "Cân bằng.", tipSoundOn: "**Hei**wa hòa bình.", tipSoundKun: "**Tai**ra bằng phẳng.", words: [{w:"平和 (へいわ)", m:"Hòa bình"}] },
            "和": { hanviet: "HÒA", mean: "Hòa bình/Nhật", on: "ワ", kun: "やわ.らぐ", radicals: "Hòa (禾) + Khẩu (口)", tipImg: "Lúa gạo vào miệng là hòa bình.", tipSoundOn: "Hei**wa** hòa bình.", tipSoundKun: "**Yawa**ragu dịu đi.", words: [{w:"平和 (へいわ)", m:"Hòa bình"}, {w:"和食 (わしょく)", m:"Món Nhật"}] },
            "上": { hanviet: "THƯỢNG", mean: "Trên/Lên", on: "ジョウ", kun: "うえ, のぼ.る", radicals: "Nhất (一) + Bốc (卜)", tipImg: "Đứng trên mặt đất.", tipSoundOn: "**Jou**zu giỏi.", tipSoundKun: "**Ue** trên.", words: [{w:"上る (のぼる)", m:"Leo lên"}, {w:"上がる (あがる)", m:"Tăng lên"}] },
            "階": { hanviet: "GIAI", mean: "Tầng/Giai cấp", on: "カイ", kun: "", radicals: "Ấp (阝) + Giai (皆)", tipImg: "Mọi người (皆) ở ấp (阝) leo tầng.", tipSoundOn: "**Kai**dan cầu thang.", tipSoundKun: "", words: [{w:"階段 (かいだん)", m:"Cầu thang"}, {w:"三階 (さんがい)", m:"Tầng 3"}] },
            "段": { hanviet: "ĐOẠN", mean: "Giai đoạn/Bậc", on: "ダン", kun: "", radicals: "Thù (殳)", tipImg: "Tay cầm thù lao theo giai đoạn.", tipSoundOn: "Kai**dan** cầu thang.", tipSoundKun: "", words: [{w:"階段 (かいだん)", m:"Cầu thang"}, {w:"値段 (ねだん)", m:"Giá cả"}] },
            "坂": { hanviet: "PHẢN", mean: "Dốc", on: "ハン", kun: "さか", radicals: "Thổ (土) + Phản (反)", tipImg: "Đất (土) phản (反) lại thành dốc.", tipSoundOn: "", tipSoundKun: "**Saka** dốc.", words: [{w:"坂 (さか)", m:"Dốc"}] },
            "下": { hanviet: "HẠ", mean: "Dưới/Xuống", on: "カ, ゲ", kun: "した, くだ.る", radicals: "Nhất (一) + Bốc (卜)", tipImg: "Ở dưới mặt đất.", tipSoundOn: "Chi**ka** tàu điện ngầm.", tipSoundKun: "**Shita** dưới.", words: [{w:"下る (くだる)", m:"Đi xuống"}, {w:"下さる (くださる)", m:"Cho (kính ngữ)"}] },
            "進": { hanviet: "TIẾN", mean: "Tiến lên", on: "シン", kun: "すす.む", radicals: "Xước (⻌) + Chuy (隹)", tipImg: "Chim (隹) bay đi (⻌) tiến lên.", tipSoundOn: "**Shin**po tiến bộ.", tipSoundKun: "**Susu**mu tiến lên.", words: [{w:"進む (すすむ)", m:"Tiến lên"}, {w:"進める (すすめる)", m:"Thúc đẩy"}] },
            "通": { hanviet: "THÔNG", mean: "Đi qua/Thông suốt", on: "ツウ", kun: "とお.る", radicals: "Xước (⻌) + Dũng (甬)", tipImg: "Dũng cảm đi thông qua.", tipSoundOn: "**Tsuu**jiru hiểu nhau.", tipSoundKun: "**Too**ru đi qua.", words: [{w:"通じる (つうじる)", m:"Thông hiểu"}, {w:"通う (かよう)", m:"Đi lại"}] },
            "光": { hanviet: "QUANG", mean: "Ánh sáng", on: "コウ", kun: "ひかり", radicals: "Tiểu (⺌) + Nhất (一) + Nhân (儿)", tipImg: "Tiểu nhân đứng dưới ánh sáng.", tipSoundOn: "Kan**kou** tham quan.", tipSoundKun: "**Hikari** ánh sáng.", words: [{w:"光 (ひかり)", m:"Ánh sáng"}, {w:"光る (ひかる)", m:"Tỏa sáng"}] },
            "布": { hanviet: "BỐ", mean: "Vải", on: "フ", kun: "ぬの", radicals: "Cân (巾) + Phụ (父 - bớt nét)", tipImg: "Cha cầm khăn vải.", tipSoundOn: "Zou**kin** giẻ lau (dùng chữ khác).", tipSoundKun: "**Nuno** vải.", words: [{w:"布 (ぬの)", m:"Vải"}] },
            "空": { hanviet: "KHÔNG", mean: "Bầu trời/Trống", on: "クウ", kun: "そら", radicals: "Huyệt (穴) + Công (工)", tipImg: "Công trường trong hang trống rỗng.", tipSoundOn: "**Kuu**ki không khí.", tipSoundKun: "**Sora** bầu trời.", words: [{w:"空気 (くうき)", m:"Không khí"}, {w:"空港 (くうこう)", m:"Sân bay"}] },
            "気": { hanviet: "KHÍ", mean: "Không khí/Tinh thần", on: "キ", kun: "", radicals: "Khí (气) + Mễ (米)", tipImg: "Hơi gạo bốc lên là khí.", tipSoundOn: "Kuu**ki** không khí.", tipSoundKun: "**Ki** cảm giác.", words: [{w:"空気 (くうき)", m:"Không khí"}, {w:"気持ち (きもち)", m:"Cảm xúc"}] },
            "越": { hanviet: "VIỆT", mean: "Vượt qua", on: "エツ", kun: "こ.える", radicals: "Tẩu (走) + Việt (戉)", tipImg: "Chạy (走) vượt qua cái rìu (戉).", tipSoundOn: "Hikkoshi chuyển nhà (dùng 越し).", tipSoundKun: "**Ko**eru vượt qua.", words: [{w:"越える (こえる)", m:"Vượt qua"}] },
            "過": { hanviet: "QUÁ", mean: "Qua/Quá", on: "カ", kun: "す.ぎる", radicals: "Xước (⻌) + Oa (咼)", tipImg: "Đi (⻌) qua cái hố xương (咼).", tipSoundOn: "**Ka**ko quá khứ.", tipSoundKun: "**Su**giru quá/trôi qua.", words: [{w:"過ぎる (すぎる)", m:"Quá/Trôi qua"}, {w:"過ごす (すごす)", m:"Trải qua"}] },
            "移": { hanviet: "DI", mean: "Di chuyển", on: "イ", kun: "うつ.る", radicals: "Hòa (禾) + Đa (多)", tipImg: "Lúa (禾) nhiều (多) phải di chuyển.", tipSoundOn: "**I**dou di động.", tipSoundKun: "**Utsu**ru di chuyển.", words: [{w:"移る (うつる)", m:"Di chuyển"}, {w:"移す (うつす)", m:"Dời đi"}] },
            "本": { hanviet: "BẢN", mean: "Sách/Gốc", on: "ホン", kun: "もと", radicals: "Mộc (木) + Nhất (一)", tipImg: "Gạch một nét gốc cây.", tipSoundOn: "**Hon**sha trụ sở.", tipSoundKun: "**Moto** nguồn gốc.", words: [{w:"本社 (ほんしゃ)", m:"Trụ sở chính"}, {w:"本 (ほん)", m:"Sách"}] },
            "社": { hanviet: "XÃ", mean: "Công ty/Đền", on: "シャ", kun: "やしろ", radicals: "Thị (礻) + Thổ (土)", tipImg: "Thờ thần đất (土) ở xã.", tipSoundOn: "Hon**sha** trụ sở.", tipSoundKun: "**Yashiro** đền.", words: [{w:"本社 (ほんしゃ)", m:"Trụ sở chính"}, {w:"会社 (かいしゃ)", m:"Công ty"}] },
            "連": { hanviet: "LIÊN", mean: "Dẫn đi/Liên lạc", on: "レン", kun: "つ.れる", radicals: "Xước (⻌) + Xa (車)", tipImg: "Xe (車) chạy liên tục (⻌).", tipSoundOn: "**Ren**raku liên lạc.", tipSoundKun: "**Tsu**reru dẫn đi.", words: [{w:"連れる (つれる)", m:"Dẫn đi"}, {w:"連休 (れんきゅう)", m:"Kỳ nghỉ dài"}] },
            "寄": { hanviet: "KÝ", mean: "Ghé/Ký gửi", on: "キ", kun: "よ.る", radicals: "Miên (宀) + Đại (大) + Khả (可)", tipImg: "Nhà (宀) to (大) có thể (可) ghé vào.", tipSoundOn: "**Ki**fu quyên góp.", tipSoundKun: "**Yo**ru ghé qua.", words: [{w:"寄る (よる)", m:"Ghé thăm"}, {w:"寄せる (よせる)", m:"Ghé vào/Dời"}] },
            "奨": { hanviet: "TƯỞNG", mean: "Khích lệ", on: "ショウ", kun: "", radicals: "Tương (将) + Đại (大)", tipImg: "Tương lai (将) lớn (大) được tưởng thưởng.", tipSoundOn: "**Shou**gakukin học bổng.", tipSoundKun: "", words: [{w:"奨学金 (しょうがくきん)", m:"Học bổng"}] },
            "学": { hanviet: "HỌC", mean: "Học", on: "ガク", kun: "まな.ぶ", radicals: "Tử (子)", tipImg: "Đứa trẻ (子) học dưới mái trường.", tipSoundOn: "Shou**gaku**kin học bổng.", tipSoundKun: "**Mana**bu học.", words: [{w:"奨学金 (しょうがくきん)", m:"Học bổng"}, {w:"学校 (がっこう)", m:"Trường học"}] },
            "金": { hanviet: "KIM", mean: "Vàng/Tiền", on: "キン", kun: "かね", radicals: "Kim (金)", tipImg: "Vàng chôn dưới đất.", tipSoundOn: "Shougaku**kin** học bổng.", tipSoundKun: "**Kane** tiền.", words: [{w:"奨学金 (しょうがくきん)", m:"Học bổng"}, {w:"お金 (おかね)", m:"Tiền"}] },
            "成": { hanviet: "THÀNH", mean: "Thành đạt/Trở thành", on: "セイ", kun: "な.る", radicals: "Qua (戈)", tipImg: "Chiến đấu bằng qua (戈) để thành công.", tipSoundOn: "**Sei**seki thành tích.", tipSoundKun: "**Na**ru trở thành.", words: [{w:"成績 (せいせき)", m:"Thành tích"}, {w:"成功 (せいこう)", m:"Thành công"}] },
            "績": { hanviet: "TÍCH", mean: "Thành tích", on: "セキ", kun: "", radicals: "Mịch (糸) + Trách (責)", tipImg: "Dệt (糸) trách (責) nhiệm thành tích.", tipSoundOn: "Sei**seki** thành tích.", tipSoundKun: "", words: [{w:"成績 (せいせき)", m:"Thành tích"}, {w:"実績 (じっせき)", m:"Thực tích"}] },
            "与": { hanviet: "DỮ", mean: "Cho/Tặng", on: "ヨ", kun: "あた.える", radicals: "Nhất (一)", tipImg: "Cho đi một cái gì đó.", tipSoundOn: "Zou**yo** tặng.", tipSoundKun: "**Ata**eru ban tặng.", words: [{w:"与える (あたえる)", m:"Ban/Tặng"}] },
            "得": { hanviet: "ĐẮC", mean: "Được/Lãi", on: "トク", kun: "え.る", radicals: "Xích (彳) + Đán (旦) + Thốn (寸)", tipImg: "Đi sớm (旦) đo (寸) được lợi.", tipSoundOn: "Nat**toku** lý giải.", tipSoundKun: "**E**ru đạt được.", words: [{w:"得る (える)", m:"Đạt được"}, {w:"得意 (とくい)", m:"Đắc ý"}] },
            "向": { hanviet: "HƯỚNG", mean: "Hướng về", on: "コウ", kun: "む.く", radicals: "Khẩu (口)", tipImg: "Cái miệng hướng về phía trước.", tipSoundOn: "Hou**kou** phương hướng.", tipSoundKun: "**Mu**ku hướng.", words: [{w:"向く (むく)", m:"Hướng về"}, {w:"向かう (むかう)", m:"Hướng tới"}] },
            "勧": { hanviet: "KHUYẾN", mean: "Khuyên bảo", on: "カン", kun: "すす.める", radicals: "Lực (力) + Quan (雚)", tipImg: "Dùng sức quan sát khuyên bảo.", tipSoundOn: "**Kan**yuu rủ rê.", tipSoundKun: "**Susu**meru gợi ý.", words: [{w:"勧める (すすめる)", m:"Gợi ý/Khuyên"}] },
            "薦": { hanviet: "TIẾN", mean: "Tiến cử", on: "セン", kun: "すす.める", radicals: "Thảo (艹) + Tàn (戋)", tipImg: "Cỏ tàn được tiến cử.", tipSoundOn: "Sui**sen** tiến cử.", tipSoundKun: "**Susu**meru giới thiệu.", words: [{w:"薦める (すすめる)", m:"Giới thiệu"}] },
            "任": { hanviet: "NHIỆM", mean: "Trách nhiệm", on: "ニン", kun: "まか.せる", radicals: "Nhân (亻) + Nhâm (壬)", tipImg: "Người (亻) gánh vác việc lớn (壬).", tipSoundOn: " seki**nin** trách nhiệm.", tipSoundKun: "**Maka**seru giao phó.", words: [{w:"任せる (まかせる)", m:"Giao phó"}] },
            "守": { hanviet: "THỦ", mean: "Bảo vệ", on: "シュ, ス", kun: "まも.る", radicals: "Miên (宀) + Thốn (寸)", tipImg: "Dưới mái nhà (宀) dùng tấc sắt (寸) bảo vệ.", tipSoundOn: "Ru**su** vắng nhà.", tipSoundKun: "**Mamo**ru bảo vệ.", words: [{w:"守る (まもる)", m:"Bảo vệ"}, {w:"留守 (るす)", m:"Vắng nhà"}] },
            "望": { hanviet: "VỌNG", mean: "Hy vọng/Nhìn", on: "ボウ", kun: "のぞ.む", radicals: "Nguyệt (月) + Vong (亡) + Vương (王)", tipImg: "Vua (王) mất (亡) nhìn trăng (月) hy vọng.", tipSoundOn: "Ki**bou** hy vọng.", tipSoundKun: "**Nozo**mu mong muốn.", words: [{w:"望む (のぞむ)", m:"Mong muốn"}, {w:"希望 (きぼう)", m:"Hy vọng"}] },
            "信": { hanviet: "TÍN", mean: "Tin tưởng", on: "シン", kun: "", radicals: "Nhân (亻) + Ngôn (言)", tipImg: "Người nói lời đáng tin.", tipSoundOn: "**Shin**jiru tin tưởng.", tipSoundKun: "", words: [{w:"信じる (しんじる)", m:"Tin tưởng"}, {w:"自信 (じしん)", m:"Tự tin"}] },
            "通": { hanviet: "THÔNG", mean: "Đi qua/Thông suốt", on: "ツウ", kun: "とお.る", radicals: "Xước (⻌) + Dũng (甬)", tipImg: "Dũng cảm đi thông qua.", tipSoundOn: "**Tsuu**jiru hiểu nhau.", tipSoundKun: "**Too**ru đi qua.", words: [{w:"通じる (つうじる)", m:"Thông hiểu"}, {w:"通う (かよう)", m:"Đi lại"}] },
            "飽": { hanviet: "BÃO", mean: "No/Chán", on: "ホウ", kun: "あ.きる", radicals: "Thực (饣) + Bao (包)", tipImg: "Ăn (饣) bao (包) nhiêu cũng chán.", tipSoundOn: "**Hou**wa bão hòa.", tipSoundKun: "**Aki**ru chán.", words: [{w:"飽きる (あきる)", m:"Chán"}] },
            "思": { hanviet: "TƯ", mean: "Suy nghĩ", on: "シ", kun: "おも.う", radicals: "Điền (田) + Tâm (心)", tipImg: "Tâm (心) nghĩ về ruộng (田).", tipSoundOn: "I**shi** ý chí.", tipSoundKun: "**Omo**itsuku nảy ra.", words: [{w:"思いつく (おもいつく)", m:"Nảy ra"}, {w:"思いやる (おもいやる)", m:"Quan tâm"}] },
            "熱": { hanviet: "NHIỆT", mean: "Nóng", on: "ネツ", kun: "あつ.い", radicals: "Hỏa (灬)", tipImg: "Thế lực đốt lửa nóng.", tipSoundOn: "**Nec**chuu nhiệt trung.", tipSoundKun: "**Atsu**i nóng.", words: [{w:"熱中 (ねっちゅう)", m:"Say mê"}, {w:"熱 (ねつ)", m:"Sốt"}] },
            "暮": { hanviet: "MỘ", mean: "Sống/Lặn", on: "ボ", kun: "く.らす", radicals: "Thảo (艹) + Nhật (日) + Đại (大)", tipImg: "Mặt trời lặn sau cỏ cây to.", tipSoundOn: "", tipSoundKun: "**Kura**su sinh sống.", words: [{w:"暮らす (くらす)", m:"Sinh sống"}, {w:"暮れる (くれる)", m:"Lặn (mặt trời)"}] },
            "巻": { hanviet: "QUYỂN", mean: "Cuộn", on: "カン", kun: "ま.く", radicals: "Kỷ (己)", tipImg: "Tự mình cuộn lại.", tipSoundOn: "**Kan** quyển (sách).", tipSoundKun: "**Ma**ku cuộn.", words: [{w:"巻く (まく)", m:"Cuộn/Quấn"}] },
            "結": { hanviet: "KẾT", mean: "Kết hợp/Buộc", on: "ケツ", kun: "むす.ぶ", radicals: "Mịch (糸) + Cát (吉)", tipImg: "Sợi chỉ buộc điều tốt lành.", tipSoundOn: "**Kek**kon kết hôn.", tipSoundKun: "**Musu**bu buộc.", words: [{w:"結ぶ (むすぶ)", m:"Buộc"}, {w:"結果 (けっか)", m:"Kết quả"}] },
            "紐": { hanviet: "NỮU", mean: "Dây", on: "チュウ", kun: "ひも", radicals: "Mịch (糸) + Sửu (丑)", tipImg: "Sợi chỉ buộc trâu (丑).", tipSoundOn: "", tipSoundKun: "**Himo** dây.", words: [{w:"紐 (ひも)", m:"Dây"}] },
            "済": { hanviet: "TẾ", mean: "Hoàn thành/Cứu", on: "サイ", kun: "す.む", radicals: "Thủy (氵) + Tề (斉)", tipImg: "Nước tề chỉnh là xong.", tipSoundOn: "Kei**zai** kinh tế.", tipSoundKun: "**Su**mu xong.", words: [{w:"済む (すむ)", m:"Xong"}, {w:"済ます (すます)", m:"Làm cho xong"}] },
            "出": { hanviet: "XUẤT", mean: "Ra", on: "シュツ", kun: "で.る", radicals: "Sơn (山)", tipImg: "Hai ngọn núi chồng lên nhau.", tipSoundOn: "**Shut**shin xuất thân.", tipSoundKun: "**De**kiru có thể.", words: [{w:"出来る (できる)", m:"Có thể/Hoàn thành"}] },
            "来": { hanviet: "LAI", mean: "Đến", on: "ライ", kun: "く.る", radicals: "Mộc (木)", tipImg: "Người đến dưới gốc cây.", tipSoundOn: "Mi**rai** tương lai.", tipSoundKun: "De**ki**ru có thể.", words: [{w:"出来る (できる)", m:"Có thể/Hoàn thành"}] },
            "切": { hanviet: "THIẾT", mean: "Cắt", on: "セツ", kun: "き.る", radicals: "Đao (刀) + Thất (七)", tipImg: "Bảy con dao cắt.", tipSoundOn: "Shin**setsu** thân thiện.", tipSoundKun: "**Ki**ru cắt.", words: [{w:"切れる (きれる)", m:"Đứt/Hết"}, {w:"切らす (きらす)", m:"Dùng hết"}] },
            "伝": { hanviet: "TRUYỀN", mean: "Truyền đạt", on: "デン", kun: "つた.わる", radicals: "Nhân (亻) + Vân (云)", tipImg: "Người nói (云) truyền tin.", tipSoundOn: "**Den**gon tin nhắn.", tipSoundKun: "**Tsuta**waru lan truyền.", words: [{w:"伝わる (つたわる)", m:"Được truyền"}, {w:"伝える (つたえる)", m:"Truyền đạt"}] },
            "続": { hanviet: "TỤC", mean: "Tiếp tục", on: "ゾク", kun: "つづ.く", radicals: "Mịch (糸) + Mại (売)", tipImg: "Sợi chỉ bán tiếp.", tipSoundOn: "Kei**zoku** kế tục.", tipSoundKun: "**Tsuzu**ku tiếp tục.", words: [{w:"続く (つづく)", m:"Tiếp tục"}, {w:"続ける (つづける)", m:"Làm tiếp"}] },
            "繋": { hanviet: "HỆ", mean: "Kết nối", on: "ケイ", kun: "つな.ぐ", radicals: "Mịch (糸) + Kích (撃 - xe)", tipImg: "Dây buộc xe kết nối.", tipSoundOn: "", tipSoundKun: "**Tsuna**gu kết nối.", words: [{w:"繋がる (つながる)", m:"Được nối"}, {w:"繋ぐ (つなぐ)", m:"Nối"}] },
            "伸": { hanviet: "THÂN", mean: "Duỗi/Dài ra", on: "シン", kun: "の.びる", radicals: "Nhân (亻) + Thân (申)", tipImg: "Người thân duỗi người.", tipSoundOn: "Tsui**shin** tái bút.", tipSoundKun: "**No**biru dài ra.", words: [{w:"伸びる (のびる)", m:"Dài ra"}, {w:"伸ばす (のばす)", m:"Làm dài"}] },
            "延": { hanviet: "DUYÊN", mean: "Kéo dài/Trì hoãn", on: "エン", kun: "の.びる", radicals: "Dẫn (廴) + Chính (正 - thiếu)", tipImg: "Dẫn đi chính xác là kéo dài.", tipSoundOn: "**En**ki hoãn.", tipSoundKun: "**No**biru bị hoãn.", words: [{w:"延びる (のびる)", m:"Bị hoãn"}, {w:"延ばす (のばす)", m:"Trì hoãn"}] },
            "重": { hanviet: "TRỌNG", mean: "Nặng/Chồng chất", on: "ジュウ", kun: "おも.い", radicals: "Lý (里)", tipImg: "Ngàn ngôi làng rất nặng.", tipSoundOn: "**Juu**you quan trọng.", tipSoundKun: "**Kasa**naru chồng chất.", words: [{w:"重なる (かさなる)", m:"Chồng chất"}, {w:"重ねる (かさねる)", m:"Xếp chồng"}] },
            "広": { hanviet: "QUẢNG", mean: "Rộng", on: "コウ", kun: "ひろ.い", radicals: "Nghiễm (广) + Tư (ム)", tipImg: "Nhà (广) tư (ム) rộng.", tipSoundOn: "**Kou**koku quảng cáo.", tipSoundKun: "**Hiro**garu lan rộng.", words: [{w:"広がる (ひろがる)", m:"Lan rộng"}, {w:"広げる (ひろげる)", m:"Mở rộng"}] },
            "載": { hanviet: "TẢI", mean: "Chất/Đăng", on: "サイ", kun: "の.る", radicals: "Xa (車)", tipImg: "Xe (車) chở đất (土) qua qua (戈).", tipSoundOn: "Kei**sai** đăng tải.", tipSoundKun: "**No**ru được đăng.", words: [{w:"載る (のる)", m:"Được đăng"}, {w:"載せる (のせる)", m:"Chất lên"}] },
            "揃": { hanviet: "TIỄN", mean: "Đều/Đủ", on: "セン", kun: "そろ.う", radicals: "Thủ (扌) + Tiền (前)", tipImg: "Tay (扌) cắt tiền (前) cho đều.", tipSoundOn: "", tipSoundKun: "**Soro**u tập hợp đủ.", words: [{w:"揃う (そろう)", m:"Tụ tập đủ"}, {w:"揃える (そろえる)", m:"Làm cho đều/đủ"}] }
        };

        // --- 4. APP LOGIC ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
