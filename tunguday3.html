<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 3: Tính từ & Động từ (2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 3: Tính từ & Động từ (2)</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">豚</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">ぶた</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">con lợn</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 3 (N5 - N1)</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <div class="space-y-2">
                                        <p class="text-sm text-orange-700 flex items-start gap-2"><span class="font-bold text-[10px] bg-orange-200 px-1.5 py-0.5 rounded text-orange-800 min-w-[30px] text-center mt-0.5">ON</span> <span id="detailTipSoundOn"></span></p>
                                        <p class="text-sm text-orange-700 flex items-start gap-2"><span class="font-bold text-[10px] bg-pink-200 px-1.5 py-0.5 rounded text-pink-800 min-w-[30px] text-center mt-0.5">KUN</span> <span id="detailTipSoundKun"></span></p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const grammarRepo = {
            "wa_desu": { title: "Cấu trúc định danh", formula: "N1 は N2 です", desc: "N5: N1 là N2.", ex: "これはペンです。" },
            "yori_hodo": { title: "So sánh hơn/kém", formula: "N1 は N2 より Adj / N1 は N2 ほど Adj(nai)", desc: "N4/N3: So sánh mức độ, tính chất giữa 2 đối tượng.", ex: "今日は昨日より暑いです。" },
            "toshite": { title: "Với tư cách là", formula: "N + として", desc: "N3: Biểu thị lập trường, tư cách, danh nghĩa.", ex: "医者として働いています。" },
            "zaru_wo_enai": { title: "Đành phải", formula: "Vない + ざるを得ない", desc: "N2: Không muốn nhưng bắt buộc phải làm.", ex: "嫌だが、行かざるを得ない。" },
            "te_simau": { title: "Hoàn thành/Lỡ làm", formula: "Vてしまう", desc: "N4: Làm xong hết hoặc lỡ làm điều không mong muốn.", ex: "忘れてしまいました。" },
            "te_form_cause": { title: "Vì...nên...", formula: "Vて / Adj(i)くて / Adj(na)で", desc: "N4: Chỉ nguyên nhân, lý do (vế sau không dùng mệnh lệnh/ý chí).", ex: "風邪を引いて、休みました。" },
            "you_ni": { title: "Cố gắng làm gì", formula: "Vる + ようにする", desc: "N3: Biểu thị nỗ lực tạo thói quen.", ex: "野菜を食べるようにしています。" },
            "tara": { title: "Nếu/Sau khi", formula: "Vたら", desc: "N4: Điều kiện giả định hoặc hành động nối tiếp.", ex: "雨が降ったら、行きません。" },
            "te_iru": { title: "Đang/Trạng thái", formula: "Vている", desc: "N5/N4: Đang diễn ra hoặc kết quả trạng thái còn lưu lại.", ex: "帽子をかぶっています。" },
            "koto_ga_aru": { title: "Đã từng", formula: "Vた + ことが（ある）", desc: "N4: Kinh nghiệm trong quá khứ.", ex: "日本へ行ったことがあります。" },
            "nagara": { title: "Vừa... vừa...", formula: "V(bỏ masu) + ながら", desc: "N4: Hai hành động diễn ra đồng thời.", ex: "歩きながら話します。" },
            "tai": { title: "Muốn", formula: "Vたい", desc: "N5: Mong muốn làm gì đó của bản thân.", ex: "水が飲みたいです。" },
            "te_kudasai": { title: "Hãy...", formula: "Vてください", desc: "N5: Yêu cầu, nhờ vả lịch sự.", ex: "座ってください。" },
            "o_kudasai": { title: "Kính ngữ: Hãy...", formula: "お/ご + V(bỏ masu) + ください", desc: "N4/N3: Yêu cầu lịch sự hơn V-te kudasai.", ex: "おかけください (Mời ngồi)。" },
            "nai_de": { title: "Làm gì mà không...", formula: "Vないで", desc: "N4: Trạng thái không làm V1 mà làm V2.", ex: "寝ないで勉強しました。" },
            "to_omou": { title: "Nghĩ rằng", formula: "～と 思います", desc: "N4: Biểu thị suy nghĩ, phỏng đoán.", ex: "明日雨が降ると思います。" },
            "mashou": { title: "Cùng làm nhé", formula: "Vましょう", desc: "N5: Rủ rê, đề nghị.", ex: "帰りましょう。" },
            "ba_yokatta": { title: "Giá mà...", formula: "Vば + よかった", desc: "N3: Hối tiếc về việc đã không làm.", ex: "もっと勉強すればよかった。" },
            "sou_da_visual": { title: "Trông có vẻ", formula: "Adj(bỏ i/na) + そうです", desc: "N4: Phỏng đoán dựa trên thị giác.", ex: "おいしそうです。" },
            "sou_da_hearsay": { title: "Nghe nói là", formula: "Vru/Adj + そうです", desc: "N4: Truyền đạt lại thông tin nghe được.", ex: "雨が降るそうです。" },
            "te_mo": { title: "Cho dù/Cũng được", formula: "Vても", desc: "N4: Nhượng bộ hoặc cho phép.", ex: "高くても買います。" },
            "te_mo_ii": { title: "Làm...được không", formula: "Vてもいい", desc: "N5/N4: Xin phép làm gì đó.", ex: "入ってもいいですか。" },
            "shi_shi": { title: "Vừa...vừa... (Liệt kê)", formula: "～し、～し", desc: "N4: Liệt kê lý do, tính chất.", ex: "安いし、おいしいです。" },
            "koto_ni_suru": { title: "Quyết định (Chủ quan)", formula: "Vる + ことにする", desc: "N3: Tự mình quyết định làm gì.", ex: "明日から走ることにします。" },
            "ni_iku": { title: "Đi để...", formula: "V(bỏ masu)/N + に行く", desc: "N5: Đi đâu đó để thực hiện mục đích gì.", ex: "映画を見に行きます。" },
            "ta_form": { title: "Thể quá khứ ngắn", formula: "Vた", desc: "N5: Dùng trong văn nói thân mật để kể lại chuyện quá khứ.", ex: "ご飯食べた？" },
            "v_mashita": { title: "Đã làm (Lịch sự)", formula: "Vました", desc: "N5: Quá khứ lịch sự.", ex: "買いました。" },
            "v_masu": { title: "Sẽ/Thường làm", formula: "Vます", desc: "N5: Thói quen hoặc tương lai.", ex: "毎日起きます。" },
            "volitional": { title: "Thể ý định", formula: "Vよう", desc: "N4: Dùng trong văn nói thân mật để rủ rê hoặc tỏ ý định.", ex: "行こう！" },
            "nakucha": { title: "Phải... (Văn nói)", formula: "Vなくちゃ", desc: "N3: Dạng rút gọn của Vなければなりません.", ex: "もう行かなくちゃ。" },
            "mono_da": { title: "Hồi tưởng", formula: "Vた + ものだ", desc: "N2: Nhớ lại thói quen trong quá khứ.", ex: "よく遊んだものだ。" },
            "te_kuru": { title: "Đi rồi về/Thay đổi", formula: "Vてくる", desc: "N4: Đi làm gì đó rồi quay lại, hoặc sự thay đổi hướng về phía mình.", ex: "行ってくる。" },
            "te_morau": { title: "Được làm cho", formula: "Vてもらう", desc: "N4: Được ai đó làm gì cho mình (biết ơn).", ex: "教えてもらった。" },
            "datte": { title: "Nghe nói là...", formula: "～だって", desc: "N3: Văn nói thân mật dùng để trích dẫn lại lời nghe được.", ex: "雨だって。" },
            "tara_dou": { title: "Thử...xem sao", formula: "Vたらどう", desc: "N4: Đưa ra lời khuyên, đề nghị.", ex: "やってみたらどう？" },
            "to_iwareru": { title: "Được nói là", formula: "～と言われている", desc: "N4: Bị động, chỉ dư luận chung.", ex: "彼は天才だと言われている。" },
            "de_method": { title: "Bằng phương tiện/cách thức", formula: "N + で", desc: "N5: Làm bằng cái gì, bằng cách nào.", ex: "バスで行きます。" },
            "ni_time": { title: "Vào lúc", formula: "Time + に", desc: "N5: Thời điểm diễn ra hành động.", ex: "6時に起きます。" },
            "o_particle": { title: "Trợ từ O", formula: "N + を + V", desc: "N5: Chỉ đối tượng tác động của hành động.", ex: "ご飯を食べます。" }
        };

        const vocabData = [
            { "STT": 1, "Kanji": "豚", "Nghĩa": "con lợn", "Furigana": "ぶた", "type": "noun", "conv": { "polite": "豚は賢い動物だと言われています。", "pVi": "Người ta nói rằng lợn là loài động vật thông minh.", "casual": "豚は賢い動物だと言われてるよ。", "cVi": "Nghe nói lợn là loài động vật thông minh đấy.", "gIds": ["to_iwareru"] } },
            { "STT": 2, "Kanji": "", "Nghĩa": "cái bút", "Furigana": "ペン", "type": "noun", "conv": { "polite": "ペンをお借りしてもよろしいですか。", "pVi": "Tôi mượn bút có được không ạ?", "casual": "ペン、借りてもいい？", "cVi": "Mượn cái bút được không?", "gIds": ["te_mo_ii"] } },
            { "STT": 3, "Kanji": "", "Nghĩa": "ti-vi", "Furigana": "テレビ", "type": "noun", "conv": { "polite": "テレビを見ながらご飯を食べないでください。", "pVi": "Xin đừng vừa xem tivi vừa ăn cơm.", "casual": "テレビ見ながらご飯食べないで。", "cVi": "Đừng vừa xem tivi vừa ăn cơm.", "gIds": ["nagara", "nai_de"] } },
            { "STT": 4, "Kanji": "", "Nghĩa": "cái bàn", "Furigana": "テーブル", "type": "noun", "conv": { "polite": "テーブルを拭いてください。", "pVi": "Hãy lau bàn đi ạ.", "casual": "テーブル拭いて。", "cVi": "Lau bàn đi.", "gIds": ["te_kudasai"] } },
            { "STT": 5, "Kanji": "椅子", "Nghĩa": "cái ghế", "Furigana": "いす", "type": "noun", "conv": { "polite": "どうぞ、椅子におかけください。", "pVi": "Xin mời ngồi lên ghế ạ.", "casual": "椅子に座って。", "cVi": "Ngồi lên ghế đi.", "gIds": ["o_kudasai"] } },
            { "STT": 6, "Kanji": "帽子", "Nghĩa": "cái mũ", "Furigana": "ぼうし", "type": "noun", "conv": { "polite": "彼はいつも帽子をかぶっています。", "pVi": "Anh ấy lúc nào cũng đội mũ.", "casual": "彼、いつも帽子かぶってるね。", "cVi": "Hắn lúc nào cũng đội mũ nhỉ.", "gIds": ["te_iru"] } },
            { "STT": 7, "Kanji": "", "Nghĩa": "áo sơ mi", "Furigana": "シャツ", "type": "noun", "conv": { "polite": "白いシャツを着ています。", "pVi": "Tôi đang mặc áo sơ mi trắng.", "casual": "白いシャツ着てる。", "cVi": "Đang mặc sơ mi trắng.", "gIds": ["te_iru"] } },
            { "STT": 8, "Kanji": "", "Nghĩa": "cái quần", "Furigana": "ズボン", "type": "noun", "conv": { "polite": "新しいズボンを買いました。", "pVi": "Tôi đã mua cái quần mới.", "casual": "新しいズボン買った。", "cVi": "Mua quần mới rồi.", "gIds": ["v_mashita", "ta_form"] } },
            { "STT": 9, "Kanji": "", "Nghĩa": "cái váy", "Furigana": "ドレス", "type": "noun", "conv": { "polite": "そのドレス、高そうですね。", "pVi": "Cái váy đó trông có vẻ đắt nhỉ.", "casual": "そのドレス、高そう！", "cVi": "Cái váy đó trông đắt thế!", "gIds": ["sou_da_visual"] } },
            { "STT": 10, "Kanji": "靴", "Nghĩa": "giày", "Furigana": "くつ", "type": "noun", "conv": { "polite": "ここで靴を脱いでください。", "pVi": "Xin hãy cởi giày ở đây.", "casual": "ここで靴脱いで。", "cVi": "Cởi giày ở đây đi.", "gIds": ["te_kudasai"] } },
            { "STT": 11, "Kanji": "", "Nghĩa": "túi", "Furigana": "かばん", "type": "noun", "conv": { "polite": "重いかばんを持ちましょうか。", "pVi": "Để tôi mang cái túi nặng giúp nhé?", "casual": "かばん、持ってあげる。", "cVi": "Tớ xách túi cho.", "gIds": ["mashou"] } },
            { "STT": 12, "Kanji": "寒い", "Nghĩa": "lạnh", "Furigana": "さむい", "type": "adj_i", "conv": { "polite": "今日は昨日より寒いです。", "pVi": "Hôm nay lạnh hơn hôm qua.", "casual": "今日、昨日より寒いね。", "cVi": "Nay lạnh hơn qua ha.", "gIds": ["yori_hodo"] } },
            { "STT": 13, "Kanji": "暑い", "Nghĩa": "nóng", "Furigana": "あつい", "type": "adj_i", "conv": { "polite": "暑いので窓を開けましょう。", "pVi": "Nóng quá nên hãy mở cửa sổ nào.", "casual": "暑いから窓開けよう。", "cVi": "Nóng quá mở cửa sổ đi.", "gIds": ["mashou"] } },
            { "STT": 14, "Kanji": "暖かい", "Nghĩa": "ấm áp", "Furigana": "あたたかい", "type": "adj_i", "conv": { "polite": "春になって暖かくなりました。", "pVi": "Sang xuân trời đã trở nên ấm áp.", "casual": "春になって暖かくなったね。", "cVi": "Sang xuân ấm lên rồi nhỉ.", "gIds": ["v_mashita"] } },
            { "STT": 15, "Kanji": "涼しい", "Nghĩa": "mát mẻ", "Furigana": "すずしい", "type": "adj_i", "conv": { "polite": "ここは涼しくて気持ちいいです。", "pVi": "Chỗ này mát mẻ dễ chịu thật.", "casual": "ここ、涼しくて気持ちいいね。", "cVi": "Chỗ này mát dễ chịu ghê.", "gIds": ["te_form_cause"] } },
            { "STT": 16, "Kanji": "新しい", "Nghĩa": "mới", "Furigana": "あたらしい", "type": "adj_i", "conv": { "polite": "新しいパソコンが欲しいです。", "pVi": "Tôi muốn có máy tính mới.", "casual": "新しいパソコン欲しい。", "cVi": "Muốn có máy tính mới.", "gIds": ["tai"] } },
            { "STT": 17, "Kanji": "古い", "Nghĩa": "cũ", "Furigana": "ふるい", "type": "adj_i", "conv": { "polite": "これは古いお寺です。", "pVi": "Đây là ngôi chùa cổ.", "casual": "これ、古いお寺だね。", "cVi": "Đây là ngôi chùa cổ nhỉ.", "gIds": ["wa_desu"] } },
            { "STT": 18, "Kanji": "長い", "Nghĩa": "dài", "Furigana": "ながい", "type": "adj_i", "conv": { "polite": "長い間お世話になりました。", "pVi": "Cảm ơn đã chăm sóc tôi suốt thời gian dài.", "casual": "長い間お世話になったね。", "cVi": "Cảm ơn đã chăm sóc suốt thời gian dài nhé.", "gIds": ["v_mashita"] } },
            { "STT": 19, "Kanji": "短い", "Nghĩa": "ngắn", "Furigana": "みじかい", "type": "adj_i", "conv": { "polite": "髪を短く切りました。", "pVi": "Tôi đã cắt tóc ngắn.", "casual": "髪、短く切ったよ。", "cVi": "Tớ cắt tóc ngắn rồi.", "gIds": ["v_mashita"] } },
            { "STT": 20, "Kanji": "強い", "Nghĩa": "mạnh", "Furigana": "つよい", "type": "adj_i", "conv": { "polite": "風が強くて歩けません。", "pVi": "Gió mạnh quá (nên) không đi bộ được.", "casual": "風強くて歩けない。", "cVi": "Gió to quá chả đi được.", "gIds": ["te_form_cause"] } },
            { "STT": 21, "Kanji": "弱い", "Nghĩa": "yếu", "Furigana": "よわい", "type": "adj_i", "conv": { "polite": "体が弱いので、よく病気になります。", "pVi": "Vì cơ thể yếu nên hay bị ốm.", "casual": "体弱いから、よく病気になる。", "cVi": "Người yếu nên hay ốm lắm.", "gIds": ["wa_desu"] } },
            { "STT": 22, "Kanji": "良い", "Nghĩa": "tốt", "Furigana": "いい", "type": "adj_i", "conv": { "polite": "天気が良くてよかったです。", "pVi": "Thời tiết tốt thì tốt quá rồi.", "casual": "天気良くてよかった。", "cVi": "Trời đẹp thì tốt rồi.", "gIds": ["ba_yokatta"] } },
            { "STT": 23, "Kanji": "悪い", "Nghĩa": "xấu", "Furigana": "わるい", "type": "adj_i", "conv": { "polite": "顔色が悪いですが、大丈夫ですか。", "pVi": "Sắc mặt bạn xấu quá, có ổn không?", "casual": "顔色悪いけど、大丈夫？", "cVi": "Sắc mặt tệ thế, ổn không?", "gIds": ["wa_desu"] } },
            { "STT": 24, "Kanji": "好き", "Nghĩa": "thích", "Furigana": "すき", "type": "adj_na", "conv": { "polite": "日本料理が好きです。", "pVi": "Tôi thích món ăn Nhật.", "casual": "日本料理、好き。", "cVi": "Tớ thích đồ Nhật.", "gIds": ["wa_desu"] } },
            { "STT": 25, "Kanji": "嫌い", "Nghĩa": "ghét", "Furigana": "きらい", "type": "adj_na", "conv": { "polite": "納豆は嫌いではありません。", "pVi": "Tôi không ghét natto.", "casual": "納豆、嫌いじゃないよ。", "cVi": "Tớ không ghét natto đâu.", "gIds": ["wa_desu"] } },
            { "STT": 26, "Kanji": "上手", "Nghĩa": "giỏi", "Furigana": "じょうず", "type": "adj_na", "conv": { "polite": "日本語が上手ですね。", "pVi": "Tiếng Nhật của bạn giỏi nhỉ.", "casual": "日本語、上手だね。", "cVi": "Tiếng Nhật giỏi thế.", "gIds": ["wa_desu"] } },
            { "STT": 27, "Kanji": "下手", "Nghĩa": "kém", "Furigana": "へた", "type": "adj_na", "conv": { "polite": "絵が下手で恥ずかしいです。", "pVi": "Tôi vẽ kém nên xấu hổ lắm.", "casual": "絵が下手で恥ずかしい。", "cVi": "Vẽ kém xấu hổ quá.", "gIds": ["te_form_cause"] } },
            { "STT": 28, "Kanji": "便利", "Nghĩa": "tiện lợi", "Furigana": "べんり", "type": "adj_na", "conv": { "polite": "コンビニは便利です。", "pVi": "Cửa hàng tiện lợi rất tiện.", "casual": "コンビニ、便利だね。", "cVi": "Cửa hàng tiện lợi tiện thật.", "gIds": ["wa_desu"] } },
            { "STT": 29, "Kanji": "不便", "Nghĩa": "bất tiện", "Furigana": "ふべん", "type": "adj_na", "conv": { "polite": "車がないと不便だと思います。", "pVi": "Tôi nghĩ không có xe hơi thì bất tiện.", "casual": "車ないと不便だと思う。", "cVi": "Tớ nghĩ không có xe thì bất tiện.", "gIds": ["to_omou"] } },
            { "STT": 30, "Kanji": "安全", "Nghĩa": "an toàn", "Furigana": "あんぜん", "type": "adj_na", "conv": { "polite": "安全第一で作業します。", "pVi": "Làm việc với tiêu chí an toàn là số một.", "casual": "安全第一で作業するよ。", "cVi": "Làm việc an toàn là trên hết nha.", "gIds": ["de_method"] } },
            { "STT": 31, "Kanji": "忙しい", "Nghĩa": "bận rộn", "Furigana": "いそがしい", "type": "adj_i", "conv": { "polite": "今週は仕事が忙しいそうです。", "pVi": "Nghe nói tuần này công việc bận rộn.", "casual": "今週、仕事忙しいんだって。", "cVi": "Nghe bảo tuần này bận lắm.", "gIds": ["sou_da_hearsay", "datte"] } },
            { "STT": 32, "Kanji": "易しい", "Nghĩa": "dễ", "Furigana": "やさしい", "type": "adj_i", "conv": { "polite": "この問題は思ったより易しいです。", "pVi": "Vấn đề này dễ hơn tôi tưởng.", "casual": "この問題、思ったより易しいね。", "cVi": "Vấn đề này dễ hơn tớ tưởng.", "gIds": ["yori_hodo"] } },
            { "STT": 33, "Kanji": "難しい", "Nghĩa": "khó", "Furigana": "むずかしい", "type": "adj_i", "conv": { "polite": "日本語の文法は難しいです。", "pVi": "Ngữ pháp tiếng Nhật khó.", "casual": "日本語の文法、難しいよ。", "cVi": "Ngữ pháp tiếng Nhật khó lắm.", "gIds": ["wa_desu"] } },
            { "STT": 34, "Kanji": "危ない", "Nghĩa": "nguy hiểm", "Furigana": "あぶない", "type": "adj_i", "conv": { "polite": "危ないですから、下がってください。", "pVi": "Nguy hiểm nên hãy lùi lại.", "casual": "危ないから下がって。", "cVi": "Nguy hiểm, lùi lại đi.", "gIds": ["te_kudasai"] } },
            { "STT": 35, "Kanji": "優しい", "Nghĩa": "hiền lành", "Furigana": "やさしい", "type": "adj_i", "conv": { "polite": "彼はとても優しい人です。", "pVi": "Anh ấy là người rất hiền lành.", "casual": "彼、すっごく優しい人だよ。", "cVi": "Anh ấy hiền cực.", "gIds": ["wa_desu"] } },
            { "STT": 36, "Kanji": "厳しい", "Nghĩa": "nghiêm khắc", "Furigana": "きびしい", "type": "adj_i", "conv": { "polite": "父は教育に厳しいです。", "pVi": "Bố tôi nghiêm khắc trong việc giáo dục.", "casual": "父さん、教育に厳しいんだ。", "cVi": "Bố tớ nghiêm khắc chuyện học hành lắm.", "gIds": ["wa_desu"] } },
            { "STT": 37, "Kanji": "大きい", "Nghĩa": "to", "Furigana": "おおきい", "type": "adj_i", "conv": { "polite": "もっと大きい声で話してください。", "pVi": "Hãy nói to hơn nữa.", "casual": "もっと大きい声で話して。", "cVi": "Nói to lên chút đi.", "gIds": ["te_kudasai"] } },
            { "STT": 38, "Kanji": "小さい", "Nghĩa": "nhỏ", "Furigana": "ちいさい", "type": "adj_i", "conv": { "polite": "文字が小さくて読めません。", "pVi": "Chữ nhỏ quá (nên) không đọc được.", "casual": "文字小さくて読めない。", "cVi": "Chữ bé tí chả đọc được.", "gIds": ["te_form_cause"] } },
            { "STT": 39, "Kanji": "広い", "Nghĩa": "rộng", "Furigana": "ひろい", "type": "adj_i", "conv": { "polite": "広い家に住みたいです。", "pVi": "Tôi muốn sống trong ngôi nhà rộng.", "casual": "広い家に住みたいな。", "cVi": "Muốn ở nhà rộng ghê.", "gIds": ["tai"] } },
            { "STT": 40, "Kanji": "狭い", "Nghĩa": "hẹp", "Furigana": "せまい", "type": "adj_i", "conv": { "polite": "道が狭くて車が通れません。", "pVi": "Đường hẹp nên xe không qua được.", "casual": "道狭くて車通れないよ。", "cVi": "Đường hẹp xe không qua được đâu.", "gIds": ["te_form_cause"] } },
            { "STT": 41, "Kanji": "高い", "Nghĩa": "cao/đắt", "Furigana": "たかい", "type": "adj_i", "conv": { "polite": "背が高いですね。", "pVi": "Dáng cao nhỉ.", "casual": "背、高いね。", "cVi": "Dáng cao thế.", "gIds": ["wa_desu"] } },
            { "STT": 42, "Kanji": "安い", "Nghĩa": "rẻ", "Furigana": "やすい", "type": "adj_i", "conv": { "polite": "安いチケットを探しています。", "pVi": "Tôi đang tìm vé rẻ.", "casual": "安いチケット探してる。", "cVi": "Đang tìm vé rẻ.", "gIds": ["te_iru"] } },
            { "STT": 43, "Kanji": "低い", "Nghĩa": "thấp", "Furigana": "ひくい", "type": "adj_i", "conv": { "polite": "彼は鼻が低いです。", "pVi": "Mũi anh ấy thấp.", "casual": "彼、鼻低いね。", "cVi": "Mũi hắn thấp nhỉ.", "gIds": ["wa_desu"] } },
            { "STT": 44, "Kanji": "面白い", "Nghĩa": "thú vị", "Furigana": "おもしろい", "type": "adj_i", "conv": { "polite": "面白い話を聞かせてください。", "pVi": "Hãy kể cho tôi nghe chuyện thú vị đi.", "casual": "面白い話聞かせて。", "cVi": "Kể chuyện vui nghe xem nào.", "gIds": ["te_kudasai"] } },
            { "STT": 45, "Kanji": "詰まらない", "Nghĩa": "chán", "Furigana": "つまらない", "type": "adj_i", "conv": { "polite": "詰まらない映画でした。", "pVi": "Bộ phim chán ngắt (quá khứ).", "casual": "詰まんない映画だった。", "cVi": "Phim chán phèo.", "gIds": ["wa_desu"] } },
            { "STT": 46, "Kanji": "美味しい", "Nghĩa": "ngon", "Furigana": "おいしい", "type": "adj_i", "conv": { "polite": "美味しいケーキを食べに行きましょう。", "pVi": "Đi ăn bánh ngon nào.", "casual": "美味しいケーキ食べに行こう。", "cVi": "Đi ăn bánh ngon đi.", "gIds": ["mashou", "volitional", "ni_iku"] } },
            { "STT": 47, "Kanji": "旨い", "Nghĩa": "ngon/giỏi", "Furigana": "うまい", "type": "adj_i", "conv": { "polite": "話が旨いですね。", "pVi": "Nói chuyện khéo (giỏi) nhỉ.", "casual": "話、旨いね。", "cVi": "Nói chuyện khéo thế.", "gIds": ["wa_desu"] } },
            { "STT": 48, "Kanji": "不味い", "Nghĩa": "dở", "Furigana": "まずい", "type": "adj_i", "conv": { "polite": "この料理は少し不味いです。", "pVi": "Món này hơi dở.", "casual": "これ、ちょっと不味い。", "cVi": "Cái này hơi dở.", "gIds": ["wa_desu"] } },
            { "STT": 49, "Kanji": "重い", "Nghĩa": "nặng", "Furigana": "おもい", "type": "adj_i", "conv": { "polite": "口が重い人は信用できます。", "pVi": "Người kín miệng (nặng miệng) thì tin tưởng được.", "casual": "口重い人は信用できる。", "cVi": "Người kín miệng thì tin được.", "gIds": ["wa_desu"] } },
            { "STT": 50, "Kanji": "軽い", "Nghĩa": "nhẹ", "Furigana": "かるい", "type": "adj_i", "conv": { "polite": "口が軽い人には秘密を話しません。", "pVi": "Tôi không kể bí mật cho người to mồm (nhẹ miệng).", "casual": "口軽い人には秘密話さない。", "cVi": "Không kể bí mật cho đứa to mồm đâu.", "gIds": ["wa_desu"] } },
            { "STT": 51, "Kanji": "起きます", "Nghĩa": "thức dậy", "Furigana": "おきます", "type": "verb", "conv": { "polite": "毎朝６時に起きます。", "pVi": "Sáng nào tôi cũng dậy lúc 6 giờ.", "casual": "毎朝６時に起きる。", "cVi": "Sáng nào tớ cũng dậy lúc 6 giờ.", "gIds": ["ni_time"] } },
            { "STT": 52, "Kanji": "立ちます", "Nghĩa": "đứng", "Furigana": "たちます", "type": "verb", "conv": { "polite": "ドアの前に立ってください。", "pVi": "Hãy đứng trước cửa.", "casual": "ドアの前に立って。", "cVi": "Đứng trước cửa đi.", "gIds": ["te_kudasai"] } },
            { "STT": 53, "Kanji": "寝ます", "Nghĩa": "ngủ", "Furigana": "ねます", "type": "verb", "conv": { "polite": "昨夜はよく寝ましたか。", "pVi": "Tối qua bạn ngủ ngon không?", "casual": "昨夜よく寝た？", "cVi": "Qua ngủ ngon không?", "gIds": ["ta_form"] } },
            { "STT": 54, "Kanji": "笑います", "Nghĩa": "cười", "Furigana": "わらいます", "type": "verb", "conv": { "polite": "彼はいつも笑っています。", "pVi": "Anh ấy lúc nào cũng cười.", "casual": "彼、いつも笑ってる。", "cVi": "Hắn lúc nào cũng cười.", "gIds": ["te_iru"] } },
            { "STT": 55, "Kanji": "泣きます", "Nghĩa": "khóc", "Furigana": "なきます", "type": "verb", "conv": { "polite": "感動して泣きました。", "pVi": "Tôi đã khóc vì cảm động.", "casual": "感動して泣いた。", "cVi": "Cảm động phát khóc.", "gIds": ["te_form_cause", "ta_form"] } },
            { "STT": 56, "Kanji": "座ります", "Nghĩa": "ngồi", "Furigana": "すわります", "type": "verb", "conv": { "polite": "どうぞ、ここに座ってください。", "pVi": "Xin mời ngồi vào đây.", "casual": "ここ座って。", "cVi": "Ngồi đây đi.", "gIds": ["te_kudasai"] } },
            { "STT": 57, "Kanji": "食べます", "Nghĩa": "ăn", "Furigana": "たべます", "type": "verb", "conv": { "polite": "朝ごはんを食べましたか。", "pVi": "Bạn đã ăn sáng chưa?", "casual": "朝ごはん食べた？", "cVi": "Ăn sáng chưa?", "gIds": ["ta_form"] } },
            { "STT": 58, "Kanji": "飲みます", "Nghĩa": "uống", "Furigana": "のみます", "type": "verb", "conv": { "polite": "お茶でも飲みませんか。", "pVi": "Bạn uống chút trà hay gì đó không?", "casual": "お茶でも飲まない？", "cVi": "Uống chút trà không?", "gIds": ["mashou"] } },
            { "STT": 59, "Kanji": "歩きます", "Nghĩa": "đi bộ", "Furigana": "あるきます", "type": "verb", "conv": { "polite": "駅まで歩きましょう。", "pVi": "Chúng ta cùng đi bộ ra ga nhé.", "casual": "駅まで歩こう。", "cVi": "Đi bộ ra ga nào.", "gIds": ["mashou", "volitional"] } },
            { "STT": 60, "Kanji": "走ります", "Nghĩa": "chạy", "Furigana": "はしります", "type": "verb", "conv": { "polite": "廊下を走らないでください。", "pVi": "Xin đừng chạy ở hành lang.", "casual": "廊下走らないで。", "cVi": "Đừng chạy ở hành lang.", "gIds": ["nai_de"] } },
            { "STT": 61, "Kanji": "浴びます", "Nghĩa": "tắm", "Furigana": "あびます", "type": "verb", "conv": { "polite": "シャワーを浴びてから寝ます。", "pVi": "Tôi tắm vòi sen xong rồi ngủ.", "casual": "シャワー浴びてから寝る。", "cVi": "Tắm xong rồi ngủ.", "gIds": ["te_kuru"] } },
            { "STT": 62, "Kanji": "勉強します", "Nghĩa": "học", "Furigana": "べんきょうします", "type": "verb", "conv": { "polite": "日本語を勉強しています。", "pVi": "Tôi đang học tiếng Nhật.", "casual": "日本語勉強してる。", "cVi": "Tớ đang học tiếng Nhật.", "gIds": ["te_iru"] } },
            { "STT": 63, "Kanji": "働きます", "Nghĩa": "làm việc", "Furigana": "はたらきます", "type": "verb", "conv": { "polite": "銀行で働いています。", "pVi": "Tôi đang làm việc ở ngân hàng.", "casual": "銀行で働いてる。", "cVi": "Tớ đang làm ở ngân hàng.", "gIds": ["te_iru"] } },
            { "STT": 64, "Kanji": "休みます", "Nghĩa": "nghỉ", "Furigana": "やすみます", "type": "verb", "conv": { "polite": "少し休みましょうか。", "pVi": "Chúng ta nghỉ một chút nhé?", "casual": "少し休もうか。", "cVi": "Nghỉ chút nhé?", "gIds": ["mashou", "volitional"] } },
            { "STT": 65, "Kanji": "着ます", "Nghĩa": "mặc", "Furigana": "きます", "type": "verb", "conv": { "polite": "スーツを着て行かなければなりません。", "pVi": "Tôi phải mặc vest đi.", "casual": "スーツ着て行かなきゃ。", "cVi": "Phải mặc vest đi.", "gIds": ["nakucha"] } },
            { "STT": 66, "Kanji": "考えます", "Nghĩa": "suy nghĩ", "Furigana": "かんがえます", "type": "verb", "conv": { "polite": "よく考えて行動します。", "pVi": "Tôi suy nghĩ kỹ rồi mới hành động.", "casual": "よく考えて行動する。", "cVi": "Nghĩ kỹ rồi mới làm.", "gIds": ["te_kudasai"] } },
            { "STT": 67, "Kanji": "見ます", "Nghĩa": "xem", "Furigana": "みます", "type": "verb", "conv": { "polite": "テレビを見ます。", "pVi": "Tôi xem tivi.", "casual": "テレビ見る。", "cVi": "Xem tivi.", "gIds": ["o_particle"] } },
            { "STT": 68, "Kanji": "聞きます", "Nghĩa": "nghe", "Furigana": "ききます", "type": "verb", "conv": { "polite": "音楽を聞くのが好きです。", "pVi": "Tôi thích nghe nhạc.", "casual": "音楽聞くの好き。", "cVi": "Thích nghe nhạc.", "gIds": ["wa_desu"] } },
            { "STT": 69, "Kanji": "読みます", "Nghĩa": "đọc", "Furigana": "よみます", "type": "verb", "conv": { "polite": "新聞を読みますか。", "pVi": "Bạn có đọc báo không?", "casual": "新聞読む？", "cVi": "Đọc báo không?", "gIds": ["o_particle"] } },
            { "STT": 70, "Kanji": "書きます", "Nghĩa": "viết", "Furigana": "かきます", "type": "verb", "conv": { "polite": "手紙を書きました。", "pVi": "Tôi đã viết thư.", "casual": "手紙書いた。", "cVi": "Viết thư rồi.", "gIds": ["ta_form"] } },
            { "STT": 71, "Kanji": "します", "Nghĩa": "làm", "Furigana": "します", "type": "verb", "conv": { "polite": "宿題をします。", "pVi": "Tôi làm bài tập.", "casual": "宿題する。", "cVi": "Làm bài tập.", "gIds": ["o_particle"] } },
            { "STT": 72, "Kanji": "来ます", "Nghĩa": "đến", "Furigana": "きます", "type": "verb", "conv": { "polite": "日本に来ました。", "pVi": "Tôi đã đến Nhật.", "casual": "日本に来た。", "cVi": "Đến Nhật rồi.", "gIds": ["ta_form"] } },
            { "STT": 73, "Kanji": "行きます", "Nghĩa": "đi", "Furigana": "いきます", "type": "verb", "conv": { "polite": "学校へ行きます。", "pVi": "Tôi đi đến trường.", "casual": "学校へ行く。", "cVi": "Đi học đây.", "gIds": ["ni_iku"] } },
            { "STT": 74, "Kanji": "帰ります", "Nghĩa": "về", "Furigana": "かえります", "type": "verb", "conv": { "polite": "国へ帰ります。", "pVi": "Tôi về nước.", "casual": "国へ帰る。", "cVi": "Về nước đây.", "gIds": ["ni_iku"] } },
            { "STT": 75, "Kanji": "遊びます", "Nghĩa": "chơi", "Furigana": "あそびます", "type": "verb", "conv": { "polite": "公園で遊びます。", "pVi": "Tôi chơi ở công viên.", "casual": "公園で遊ぶ。", "cVi": "Chơi ở công viên.", "gIds": ["de_method"] } },
            { "STT": 76, "Kanji": "持ちます", "Nghĩa": "cầm", "Furigana": "もちます", "type": "verb", "conv": { "polite": "傘を持っていますか。", "pVi": "Bạn có mang ô không?", "casual": "傘持ってる？", "cVi": "Có mang ô không?", "gIds": ["te_iru"] } },
            { "STT": 77, "Kanji": "運びます", "Nghĩa": "vận chuyển", "Furigana": "はこびます", "type": "verb", "conv": { "polite": "荷物を運びます。", "pVi": "Tôi chuyển hành lý.", "casual": "荷物運ぶ。", "cVi": "Chuyển hành lý.", "gIds": ["o_particle"] } },
            { "STT": 78, "Kanji": "買います", "Nghĩa": "mua", "Furigana": "かいます", "type": "verb", "conv": { "polite": "お土産を買いました。", "pVi": "Tôi đã mua quà lưu niệm.", "casual": "お土産買った。", "cVi": "Mua quà rồi.", "gIds": ["ta_form"] } },
            { "STT": 79, "Kanji": "売ります", "Nghĩa": "bán", "Furigana": "うります", "type": "verb", "conv": { "polite": "家を売りました。", "pVi": "Tôi đã bán nhà.", "casual": "家売った。", "cVi": "Bán nhà rồi.", "gIds": ["ta_form"] } },
            { "STT": 80, "Kanji": "払います", "Nghĩa": "trả tiền", "Furigana": "はらいます", "type": "verb", "conv": { "polite": "現金で払います。", "pVi": "Tôi trả bằng tiền mặt.", "casual": "現金で払う。", "cVi": "Trả tiền mặt.", "gIds": ["de_method"] } },
            { "STT": 81, "Kanji": "乗ります", "Nghĩa": "lên xe", "Furigana": "のります", "type": "verb", "conv": { "polite": "電車に乗ります。", "pVi": "Tôi lên tàu điện.", "casual": "電車に乗る。", "cVi": "Lên tàu.", "gIds": ["v_masu"] } },
            { "STT": 82, "Kanji": "降ります", "Nghĩa": "xuống xe", "Furigana": "おります", "type": "verb", "conv": { "polite": "バスを降ります。", "pVi": "Tôi xuống xe buýt.", "casual": "バス降りる。", "cVi": "Xuống xe buýt.", "gIds": ["o_particle"] } },
            { "STT": 83, "Kanji": "入ります", "Nghĩa": "vào", "Furigana": "はいります", "type": "verb", "conv": { "polite": "お風呂に入ります。", "pVi": "Tôi đi tắm.", "casual": "お風呂入る。", "cVi": "Đi tắm đây.", "gIds": ["v_masu"] } },
            { "STT": 84, "Kanji": "出ます", "Nghĩa": "ra", "Furigana": "でます", "type": "verb", "conv": { "polite": "家を出ます。", "pVi": "Tôi ra khỏi nhà.", "casual": "家出る。", "cVi": "Ra khỏi nhà.", "gIds": ["o_particle"] } },
            { "STT": 85, "Kanji": "開けます", "Nghĩa": "mở", "Furigana": "あけます", "type": "verb", "conv": { "polite": "ドアを開けます。", "pVi": "Tôi mở cửa.", "casual": "ドア開ける。", "cVi": "Mở cửa.", "gIds": ["o_particle"] } },
            { "STT": 86, "Kanji": "閉めます", "Nghĩa": "đóng", "Furigana": "しめます", "type": "verb", "conv": { "polite": "カーテンを閉めます。", "pVi": "Tôi kéo rèm cửa.", "casual": "カーテン閉める。", "cVi": "Kéo rèm.", "gIds": ["o_particle"] } },
            { "STT": 87, "Kanji": "覚えます", "Nghĩa": "nhớ", "Furigana": "おぼえます", "type": "verb", "conv": { "polite": "漢字を覚えます。", "pVi": "Tôi nhớ Kanji.", "casual": "漢字覚える。", "cVi": "Nhớ Kanji.", "gIds": ["o_particle"] } }
        ];

        const kanjiDetails = {
            "豚": { hanviet: "ĐỒN", mean: "Con lợn", on: "トン", kun: "ぶた", radicals: "Thỉ (豕) + Nhục (月)", tipImg: "Con lợn (豕) béo nhiều thịt (月).", tipSoundOn: "**Ton**katsu (thịt lợn chiên).", tipSoundKun: "**Buta** bự quá.", words: [{w:"豚肉",m:"Thịt lợn"},{w:"子豚",m:"Lợn con"}] },
            "椅": { hanviet: "Y", mean: "Cái ghế", on: "イ", kun: "", radicals: "Mộc (木) + Kỳ (奇)", tipImg: "Cái ghế gỗ (木) hình kỳ lạ (奇).", tipSoundOn: "**I** ngồi ị.", tipSoundKun: "", words: [{w:"椅子",m:"Ghế"},{w:"車椅子",m:"Xe lăn"}] },
            "子": { hanviet: "TỬ", mean: "Con/Cái", on: "シ", kun: "こ", radicals: "Tử (子)", tipImg: "Đứa trẻ.", tipSoundOn: "**Shi** tử.", tipSoundKun: "**Ko** con.", words: [{w:"椅子",m:"Ghế"},{w:"子供",m:"Trẻ em"}] },
            "帽": { hanviet: "MẠO", mean: "Mũ", on: "ボウ", kun: "", radicals: "Cân (巾) + Mạo (冒)", tipImg: "Khăn (巾) trùm đầu mạo hiểm.", tipSoundOn: "**Bou** bô đội đầu.", tipSoundKun: "", words: [{w:"帽子",m:"Mũ"},{w:"脱帽",m:"Ngả mũ"}] },
            "靴": { hanviet: "OA", mean: "Giày", on: "カ", kun: "くつ", radicals: "Cách (革) + Hóa (化)", tipImg: "Da (革) biến hóa (化) thành giày.", tipSoundOn: "**Ka** ca múa.", tipSoundKun: "**Kutsu** cũ từ từ.", words: [{w:"靴下",m:"Tất"},{w:"長靴",m:"Ủng"}] },
            "寒": { hanviet: "HÀN", mean: "Lạnh", on: "カン", kun: "さむ.い", radicals: "Miên (宀) + Băng (冫)", tipImg: "Trong nhà (宀) có băng (冫) thì lạnh.", tipSoundOn: "**Kan** hàn.", tipSoundKun: "**Samu** sa mù lạnh.", words: [{w:"寒気",m:"Ớn lạnh"},{w:"寒冷",m:"Hàn lạnh"}] },
            "暑": { hanviet: "THỬ", mean: "Nóng", on: "ショ", kun: "あつ.い", radicals: "Nhật (日) + Giả (者)", tipImg: "Người (者) đứng dưới nắng (日) thấy nóng.", tipSoundOn: "**Sho** sở.", tipSoundKun: "**Atsu** áp suất nóng.", words: [{w:"暑中",m:"Giữa hè"}] },
            "暖": { hanviet: "NOÃN", mean: "Ấm", on: "ダン", kun: "あたた.かい", radicals: "Nhật (日)", tipImg: "Mặt trời sưởi ấm.", tipSoundOn: "**Dan** đàn sưởi.", tipSoundKun: "**Atata** a ta ta ấm.", words: [{w:"暖房",m:"Lò sưởi"}] },
            "涼": { hanviet: "LƯƠNG", mean: "Mát", on: "リョウ", kun: "すず.しい", radicals: "Thủy (氵) + Kinh (京)", tipImg: "Nước ở kinh đô mát mẻ.", tipSoundOn: "**Ryou** lương thực.", tipSoundKun: "**Suzu** su su mát.", words: [{w:"涼風",m:"Gió mát"}] },
            "新": { hanviet: "TÂN", mean: "Mới", on: "シン", kun: "あたら.しい", radicals: "Lập (立) + Mộc (木) + Cân (斤)", tipImg: "Dùng rìu (斤) đẽo cây (木) làm bia (立) mới.", tipSoundOn: "**Shin** tân sinh.", tipSoundKun: "**Atara** ắt ta ra cái mới.", words: [{w:"新聞",m:"Báo"},{w:"新年",m:"Năm mới"}] },
            "古": { hanviet: "CỔ", mean: "Cũ", on: "コ", kun: "ふる.い", radicals: "Thập (十) + Khẩu (口)", tipImg: "Chuyện mười (十) đời miệng (口) kể là chuyện cổ.", tipSoundOn: "**Ko** cổ.", tipSoundKun: "**Furu** cũ rích.", words: [{w:"中古",m:"Đồ cũ"},{w:"古代",m:"Cổ đại"}] },
            "長": { hanviet: "TRƯỜNG", mean: "Dài", on: "チョウ", kun: "なが.い", radicals: "Trường (長)", tipImg: "Tóc dài.", tipSoundOn: "**Chou** trưởng.", tipSoundKun: "**Naga** nằm dài.", words: [{w:"社長",m:"Giám đốc"},{w:"身長",m:"Chiều cao"}] },
            "短": { hanviet: "ĐOẢN", mean: "Ngắn", on: "タン", kun: "みじか.い", radicals: "Thỉ (矢) + Đậu (豆)", tipImg: "Mũi tên (矢) bắn vào hạt đậu (豆) ngắn.", tipSoundOn: "**Tan** đoản.", tipSoundKun: "**Mijika** mì j cả.", words: [{w:"短気",m:"Nóng tính"},{w:"短歌",m:"Thơ ngắn"}] },
            "強": { hanviet: "CƯỜNG", mean: "Mạnh", on: "キョウ", kun: "つよ.い", radicals: "Cung (弓) + Trùng (虫)", tipImg: "Con sâu (虫) giương cung (弓) mạnh.", tipSoundOn: "**Kyou** cường.", tipSoundKun: "**Tsuyo** tự do mạnh.", words: [{w:"勉強",m:"Học"},{w:"強力",m:"Hùng mạnh"}] },
            "弱": { hanviet: "NHƯỢC", mean: "Yếu", on: "ジャク", kun: "よわ.い", radicals: "Cung (弓)", tipImg: "Hai cái cung gãy cánh.", tipSoundOn: "**Jaku** nhược.", tipSoundKun: "**Yowa** gió qua.", words: [{w:"弱点",m:"Điểm yếu"}] },
            "良": { hanviet: "LƯƠNG", mean: "Tốt", on: "リョウ", kun: "い.い", radicals: "Cấn (艮)", tipImg: "Người tốt ăn hiền ở lành.", tipSoundOn: "**Ryou** lương thiện.", tipSoundKun: "**Yo** zô.", words: [{w:"良心",m:"Lương tâm"}] },
            "悪": { hanviet: "ÁC", mean: "Xấu", on: "アク", kun: "わる.い", radicals: "Á (亜) + Tâm (心)", tipImg: "Tâm (心) địa châu Á (亜) xấu (đùa thôi).", tipSoundOn: "**Aku** ác.", tipSoundKun: "**Waru** qua rủ.", words: [{w:"悪魔",m:"Ác ma"},{w:"最悪",m:"Tệ nhất"}] },
            "好": { hanviet: "HẢO", mean: "Thích", on: "コウ", kun: "す.き", radicals: "Nữ (女) + Tử (子)", tipImg: "Mẹ (女) thích con (子).", tipSoundOn: "**Kou** hảo.", tipSoundKun: "**Suki** su kem.", words: [{w:"好み",m:"Sở thích"},{w:"好物",m:"Món tủ"}] },
            "嫌": { hanviet: "HIỀM", mean: "Ghét", on: "ケン", kun: "きら.い", radicals: "Nữ (女) + Kiêm (兼)", tipImg: "Phụ nữ kiêm nhiệm nhiều việc thì ghét.", tipSoundOn: "**Ken** hiềm khích.", tipSoundKun: "**Kira** killer ghét.", words: [{w:"嫌悪",m:"Chán ghét"}] },
            "上": { hanviet: "THƯỢNG", mean: "Trên/Giỏi", on: "ジョウ", kun: "うえ", radicals: "Bốc (卜)", tipImg: "Ngón tay chỉ lên.", tipSoundOn: "**Jou** thượng.", tipSoundKun: "**Ue** ở trên.", words: [{w:"上手",m:"Giỏi"},{w:"以上",m:"Trở lên"}] },
            "手": { hanviet: "THỦ", mean: "Tay", on: "シュ", kun: "て", radicals: "Thủ (手)", tipImg: "Hình bàn tay.", tipSoundOn: "**Shu** thủ.", tipSoundKun: "**Te** tay.", words: [{w:"歌手",m:"Ca sĩ"},{w:"切手",m:"Tem"}] },
            "下": { hanviet: "HẠ", mean: "Dưới/Kém", on: "カ", kun: "した", radicals: "Bốc (卜)", tipImg: "Ngón tay chỉ xuống.", tipSoundOn: "**Ka** hạ.", tipSoundKun: "**Shita** dưới.", words: [{w:"下手",m:"Kém"},{w:"地下",m:"Dưới đất"}] },
            "便": { hanviet: "TIỆN", mean: "Tiện", on: "ベン", kun: "たよ.り", radicals: "Nhân (亻) + Canh (更)", tipImg: "Người canh gác đi vệ sinh.", tipSoundOn: "**Ben** bệt.", tipSoundKun: "**Tayo** tay ố.", words: [{w:"便利",m:"Tiện lợi"},{w:"郵便",m:"Bưu điện"}] },
            "利": { hanviet: "LỢI", mean: "Lợi", on: "リ", kun: "き.く", radicals: "Hòa (禾) + Đao (刂)", tipImg: "Dùng dao gặt lúa thu lợi.", tipSoundOn: "**Ri** ly.", tipSoundKun: "**Ki** ki.", words: [{w:"利用",m:"Sử dụng"}] },
            "不": { hanviet: "BẤT", mean: "Không", on: "フ", kun: "", radicals: "Nhất (一)", tipImg: "Rễ cây không mọc lên được.", tipSoundOn: "**Fu** phủ định.", tipSoundKun: "", words: [{w:"不安",m:"Bất an"},{w:"不足",m:"Thiếu"}] },
            "安": { hanviet: "AN", mean: "An/Rẻ", on: "アン", kun: "やす.い", radicals: "Miên (宀) + Nữ (女)", tipImg: "Phụ nữ ở trong nhà thì an toàn.", tipSoundOn: "**An** an tâm.", tipSoundKun: "**Yasu** rẻ.", words: [{w:"安全",m:"An toàn"},{w:"安心",m:"An tâm"}] },
            "全": { hanviet: "TOÀN", mean: "Toàn bộ", on: "ゼン", kun: "まった.く", radicals: "Nhập (入) + Vương (王)", tipImg: "Vua cai quản toàn bộ.", tipSoundOn: "**Zen** dền.", tipSoundKun: "**Matta** mắt ta.", words: [{w:"全然",m:"Hoàn toàn"}] },
            "忙": { hanviet: "MANG", mean: "Bận", on: "ボウ", kun: "いそが.しい", radicals: "Tâm (忄) + Vong (亡)", tipImg: "Tim chết vì bận.", tipSoundOn: "**Bou** bâu xâu.", tipSoundKun: "**Isoga** đi xô gà.", words: [{w:"多忙",m:"Rất bận"}] },
            "易": { hanviet: "DỊ", mean: "Dễ", on: "イ", kun: "やさ.しい", radicals: "Nhật (日) + Vật (勿)", tipImg: "Mặt trời dễ mọc.", tipSoundOn: "**I** ý kiến.", tipSoundKun: "**Yasa** da xa.", words: [{w:"貿易",m:"Ngoại thương"}] },
            "難": { hanviet: "NAN", mean: "Khó", on: "ナン", kun: "むずか.しい", radicals: "Hán (⻀) + Chuy (隹)", tipImg: "Chim bị bắt thì khó thoát.", tipSoundOn: "**Nan** gian nan.", tipSoundKun: "**Muzuka** mù dư cả.", words: [{w:"困難",m:"Khó khăn"}] },
            "危": { hanviet: "NGUY", mean: "Nguy hiểm", on: "キ", kun: "あぶ.ない", radicals: "Tiết (卩)", tipImg: "Người quỳ bên vách núi.", tipSoundOn: "**Ki** kìa.", tipSoundKun: "**Abu** a bự.", words: [{w:"危険",m:"Nguy hiểm"}] },
            "優": { hanviet: "ƯU", mean: "Ưu tú/Hiền", on: "ユウ", kun: "やさ.しい", radicals: "Nhân (亻) + Ưu (憂)", tipImg: "Người ưu tú biết lo lắng.", tipSoundOn: "**Yuu** ưu tú.", tipSoundKun: "**Yasa** da xa.", words: [{w:"優秀",m:"Ưu tú"}] },
            "厳": { hanviet: "NGHIÊM", mean: "Nghiêm khắc", on: "ゲン", kun: "きび.しい", radicals: "Cảm (敢)", tipImg: "Dám nghiêm khắc.", tipSoundOn: "**Gen** nghiêm.", tipSoundKun: "**Kibi** kì bí.", words: [{w:"厳禁",m:"Nghiêm cấm"}] },
            "大": { hanviet: "ĐẠI", mean: "To", on: "ダイ", kun: "おお.きい", radicals: "Đại (大)", tipImg: "Người dang tay.", tipSoundOn: "**Dai** đại.", tipSoundKun: "**Oo** ồ.", words: [{w:"大学",m:"Đại học"}] },
            "小": { hanviet: "TIỂU", mean: "Nhỏ", on: "ショウ", kun: "ちい.さい", radicals: "Tiểu (小)", tipImg: "Móc câu.", tipSoundOn: "**Shou** số.", tipSoundKun: "**Chii** chi chi.", words: [{w:"小学校",m:"Tiểu học"}] },
            "広": { hanviet: "QUẢNG", mean: "Rộng", on: "コウ", kun: "ひろ.い", radicals: "Nghiễm (广)", tipImg: "Mái nhà rộng.", tipSoundOn: "**Kou** quảng.", tipSoundKun: "**Hiro** hi rô.", words: [{w:"広場",m:"Quảng trường"}] },
            "狭": { hanviet: "HIỆP", mean: "Hẹp", on: "キョウ", kun: "せま.い", radicals: "Khuyển (犭) + Giáp (夹)", tipImg: "Chó bị kẹp hẹp.", tipSoundOn: "**Kyou** hiệp.", tipSoundKun: "**Sema** xe mà.", words: [{w:"狭義",m:"Nghĩa hẹp"}] },
            "高": { hanviet: "CAO", mean: "Cao", on: "コウ", kun: "たか.い", radicals: "Cao (高)", tipImg: "Tòa tháp cao.", tipSoundOn: "**Kou** cao.", tipSoundKun: "**Taka** ta ca.", words: [{w:"高校",m:"Cấp 3"}] },
            "低": { hanviet: "ĐÊ", mean: "Thấp", on: "テイ", kun: "ひく.い", radicals: "Nhân (亻) + Để (氐)", tipImg: "Người cúi thấp.", tipSoundOn: "**Tei** tệ.", tipSoundKun: "**Hiku** hì hục.", words: [{w:"低下",m:"Giảm xuống"}] },
            "面": { hanviet: "DIỆN", mean: "Mặt", on: "メン", kun: "おも", radicals: "Diện (面)", tipImg: "Khuôn mặt.", tipSoundOn: "**Men** mặt.", tipSoundKun: "**Omo** ô mô.", words: [{w:"表面",m:"Bề mặt"}] },
            "白": { hanviet: "BẠCH", mean: "Trắng", on: "ハク", kun: "しろ", radicals: "Bạch (白)", tipImg: "Ánh sáng trắng.", tipSoundOn: "**Haku** hạc.", tipSoundKun: "**Shiro** si rô.", words: [{w:"面白い",m:"Thú vị"}] },
            "詰": { hanviet: "CẬT", mean: "Nhét/Bí", on: "キツ", kun: "つ.まる", radicals: "Ngôn (言) + Cát (吉)", tipImg: "Nói lời tốt đẹp khi bị bí.", tipSoundOn: "**Kitsu** kít.", tipSoundKun: "**Tsu** sư.", words: [{w:"詰問",m:"Thẩm vấn"}] },
            "美": { hanviet: "MỸ", mean: "Đẹp", on: "ビ", kun: "うつく.しい", radicals: "Dương (⺶) + Đại (大)", tipImg: "Con dê to thì đẹp.", tipSoundOn: "**Bi** bị.", tipSoundKun: "**Utsu** ú ụ.", words: [{w:"美人",m:"Mỹ nhân"}] },
            "味": { hanviet: "VỊ", mean: "Vị", on: "ミ", kun: "あじ", radicals: "Khẩu (口) + Vị (未)", tipImg: "Miệng nếm vị chưa tới.", tipSoundOn: "**Mi** mì.", tipSoundKun: "**Aji** a dì.", words: [{w:"意味",m:"Ý nghĩa"}] },
            "旨": { hanviet: "CHỈ", mean: "Ngon", on: "シ", kun: "うま.い", radicals: "Chỉ (匕) + Cam (甘)", tipImg: "Thìa múc đồ ngọt.", tipSoundOn: "**Shi** si.", tipSoundKun: "**Uma** ngựa ngon.", words: [{w:"旨味",m:"Vị ngon"}] },
            "重": { hanviet: "TRỌNG", mean: "Nặng", on: "ジュウ", kun: "おも.い", radicals: "Lý (里)", tipImg: "Ngàn (千) ngôi làng (里) rất nặng.", tipSoundOn: "**Juu** nhu đạo.", tipSoundKun: "**Omo** ô mô.", words: [{w:"体重",m:"Cân nặng"}] },
            "軽": { hanviet: "KHINH", mean: "Nhẹ", on: "ケイ", kun: "かる.い", radicals: "Xa (車)", tipImg: "Xe chạy nhẹ.", tipSoundOn: "**Kei** kê.", tipSoundKun: "**Karu** ca rù.", words: [{w:"軽食",m:"Bữa nhẹ"}] },
            "起": { hanviet: "KHỞI", mean: "Dậy", on: "キ", kun: "お.きる", radicals: "Tẩu (走) + Kỷ (己)", tipImg: "Tự mình (己) chạy (走) dậy.", tipSoundOn: "**Ki** kìa.", tipSoundKun: "**Oki** ô kìa.", words: [{w:"起床",m:"Thức dậy"}] },
            "立": { hanviet: "LẬP", mean: "Đứng", on: "リツ", kun: "た.つ", radicals: "Lập (立)", tipImg: "Người đứng trên đất.", tipSoundOn: "**Ritsu** ri.", tipSoundKun: "**Ta** ta.", words: [{w:"国立",m:"Quốc lập"}] },
            "寝": { hanviet: "TẨM", mean: "Ngủ", on: "シン", kun: "ね.る", radicals: "Miên (宀)", tipImg: "Vào nhà (宀) nằm trên giường.", tipSoundOn: "**Shin** tâm.", tipSoundKun: "**Ne** nê.", words: [{w:"寝室",m:"Phòng ngủ"}] },
            "笑": { hanviet: "TIẾU", mean: "Cười", on: "ショウ", kun: "わら.う", radicals: "Trúc (竹) + Yểu (夭)", tipImg: "Trúc (竹) cười yểu điệu (夭).", tipSoundOn: "**Shou** sô.", tipSoundKun: "**Wara** wa ra.", words: [{w:"笑顔",m:"Mặt cười"}] },
            "泣": { hanviet: "KHẤP", mean: "Khóc", on: "キュウ", kun: "な.く", radicals: "Thủy (氵) + Lập (立)", tipImg: "Đứng (立) khóc nước mắt (氵) chảy.", tipSoundOn: "**Kyuu** cứu.", tipSoundKun: "**Na** nà.", words: [{w:"号泣",m:"Khóc lóc"}] },
            "座": { hanviet: "TỌA", mean: "Ngồi", on: "ザ", kun: "すわ.る", radicals: "Nghiễm (广) + Tọa (坐)", tipImg: "Hai người ngồi (坐) dưới mái nhà (广).", tipSoundOn: "**Za** da.", tipSoundKun: "**Suwa** su su.", words: [{w:"座席",m:"Chỗ ngồi"}] },
            "食": { hanviet: "THỰC", mean: "Ăn", on: "ショク", kun: "た.べる", radicals: "Thực (食)", tipImg: "Người tốt (艮) che mũ (人) ăn.", tipSoundOn: "**Shoku** sốc.", tipSoundKun: "**Tabe** ta bế.", words: [{w:"食事",m:"Bữa ăn"}] },
            "飲": { hanviet: "ẨM", mean: "Uống", on: "イン", kun: "の.む", radicals: "Thực (饣) + Khiếm (欠)", tipImg: "Ăn (饣) xong thiếu (欠) nước uống.", tipSoundOn: "**In** in ấn.", tipSoundKun: "**No** no nê.", words: [{w:"飲料",m:"Đồ uống"}] },
            "歩": { hanviet: "BỘ", mean: "Đi bộ", on: "ホ", kun: "ある.く", radicals: "Chỉ (止) + Thiểu (少)", tipImg: "Dừng (止) lại một chút (少) để đi bộ.", tipSoundOn: "**Ho** hô.", tipSoundKun: "**Aru** a rủ.", words: [{w:"散歩",m:"Tản bộ"}] },
            "走": { hanviet: "TẨU", mean: "Chạy", on: "ソウ", kun: "はし.る", radicals: "Tẩu (走)", tipImg: "Đất (土) dưới chân (疋) chạy.", tipSoundOn: "**Sou** sâu.", tipSoundKun: "**Hashi** hà sĩ.", words: [{w:"競走",m:"Chạy đua"}] },
            "浴": { hanviet: "DỤC", mean: "Tắm", on: "ヨク", kun: "あ.びる", radicals: "Thủy (氵) + Cốc (谷)", tipImg: "Tắm ở thung lũng (谷) có nước (氵).", tipSoundOn: "**Yoku** dô cụ.", tipSoundKun: "**A** a.", words: [{w:"浴室",m:"Phòng tắm"}] },
            "勉": { hanviet: "MIỄN", mean: "Cố gắng", on: "ベン", kun: "", radicals: "Lực (力) + Miễn (免)", tipImg: "Dùng sức (力) để miễn (免) trừ.", tipSoundOn: "**Ben** bền.", tipSoundKun: "", words: [{w:"勉強",m:"Học"}] },
            "働": { hanviet: "ĐỘNG", mean: "Làm việc", on: "ドウ", kun: "はたら.く", radicals: "Nhân (亻) + Động (動)", tipImg: "Người (亻) vận động (動) là làm việc.", tipSoundOn: "**Dou** đâu.", tipSoundKun: "**Hatara** ha ta ra.", words: [{w:"労働",m:"Lao động"}] },
            "休": { hanviet: "HƯU", mean: "Nghỉ", on: "キュウ", kun: "やす.む", radicals: "Nhân (亻) + Mộc (木)", tipImg: "Người (亻) dựa vào cây (木) nghỉ.", tipSoundOn: "**Kyuu** cứu.", tipSoundKun: "**Yasu** da su.", words: [{w:"休日",m:"Ngày nghỉ"}] },
            "着": { hanviet: "TRƯỚC", mean: "Mặc/Đến", on: "チャク", kun: "き.る", radicals: "Dương (⺶) + Mục (目)", tipImg: "Dê (⺶) nhìn (目) quần áo.", tipSoundOn: "**Chaku** trắc.", tipSoundKun: "**Ki** kị.", words: [{w:"到着",m:"Đến nơi"}] }
        };

        // --- 4. APP LOGIC (Standard Day 1 Logic) ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id].formula).join("  /  ");
            e.innerHTML = ids.map(id => `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                document.getElementById('detailTipSoundOn').innerHTML = fmt(d.tipSoundOn || ''); 
                document.getElementById('detailTipSoundKun').innerHTML = fmt(d.tipSoundKun || '');
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
