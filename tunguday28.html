<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 28: So sánh & Đi kèm</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base Settings */
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* UI Components */
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Logic CSS */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially for animation */
        #strokeAnimContainer svg path { opacity: 0; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 28: So sánh & Đi kèm</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">無くす</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">なくす</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Làm mất</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại & Ví dụ</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- MOBILE DRAWER -->
        <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none flex">
            <div id="drawerBackdrop" class="absolute inset-0 bg-gray-900/50 opacity-0 transition-opacity" onclick="toggleDrawer()"></div>
            <div id="drawerContent" class="relative w-72 bg-white h-full shadow-2xl transition-transform -translate-x-full flex flex-col pointer-events-auto">
                <div class="p-4 bg-indigo-700 text-white flex justify-between items-center">
                    <h2 class="font-bold">Danh sách từ vựng</h2>
                    <button onclick="toggleDrawer()"><i class="fas fa-times"></i></button>
                </div>
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <input type="text" id="mobileSearchInput" placeholder="Tìm kiếm nhanh..." class="w-full px-4 py-2 bg-white border border-gray-200 rounded-xl text-sm outline-none">
                </div>
                <div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 28</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (Day 28) ---
        const grammarRepo = {
            "toori": { title: "Đúng như / Theo như", formula: "Vる/Vた/Nの + とおり", desc: "Thực hiện hành động hoặc sự việc xảy ra giống hệt như mẫu/dự đoán.", ex: "予想のとおり、彼が勝った。" },
            "kurai_nara": { title: "Nếu... thì thà... còn hơn", formula: "Vる + くらいなら", desc: "So sánh tiêu cực: Nếu phải làm A (điều không muốn) thì thà làm B (còn đỡ hơn).", ex: "彼に謝るくらいなら、死んだほうがましだ。" },
            "tabi_ni": { title: "Cứ mỗi lần", formula: "Vる/Nの + たびに", desc: "Mỗi khi hành động A xảy ra thì hành động B cũng xảy ra (thường là quy luật/thói quen).", ex: "この曲を聞くたびに、故郷を思い出す。" },
            "tsuide_ni": { title: "Nhân tiện", formula: "Vる/Vた/Nの + ついでに", desc: "Làm hành động B tận dụng cơ hội khi làm hành động A.", ex: "買い物のついでに、本屋に寄った。" },
            "to_iu_yori": { title: "Nói là... thì đúng hơn", formula: "A というより B", desc: "Dùng để đính chính, B diễn tả bản chất chính xác hơn A.", ex: "彼は医者というより、科学者だ。" },
            "to_iwarete_iru": { title: "Người ta nói rằng", formula: "Thể thường + と言われている", desc: "Diễn tả nhận định chung của xã hội, dư luận.", ex: "納豆は体にいいと言われている。" },
            "wa_nai": { title: "Không có... bằng", formula: "N + くらい/ほど + ...はない", desc: "So sánh nhất: Không có gì đạt đến mức độ của N.", ex: "彼ぐらい親切な人はいない。" },
            "ni_kagiru": { title: "Tốt nhất là", formula: "Vる/Vない/N + に限る", desc: "Đưa ra lời khuyên chủ quan, cho rằng cách đó là tốt nhất.", ex: "風邪を引いた時は寝るに限る。" },
            "tame_ni": { title: "Vì... (Nguyên nhân)", formula: "Thể thường + ため(に)", desc: "Chỉ nguyên nhân dẫn đến kết quả (thường là kết quả xấu hoặc trang trọng).", ex: "大雪のため、電車が遅れた。" },
            "okage_sei": { title: "Nhờ... / Tại...", formula: "Thể thường + おかげで / せいで", desc: "Okage de: Nhờ (kết quả tốt). Sei de: Tại (kết quả xấu).", ex: "先生のおかげで合格しました。" },
            "no_wa": { title: "Việc... (Danh từ hóa)", formula: "Vる + のは + A/N", desc: "Biến động từ thành danh từ để làm chủ ngữ cho câu.", ex: "漢字を書くのは難しいです。" },
            "no_de": { title: "Vì... nên...", formula: "Thể thường + ので", desc: "Nêu lý do, nguyên nhân một cách nhẹ nhàng, khách quan.", ex: "用事があるので、先に帰ります。" },
            "tara_douka": { title: "Thử... xem sao?", formula: "Vたら + どうか", desc: "Đưa ra lời khuyên hoặc đề xuất một cách nhẹ nhàng.", ex: "少し休んだらどうですか。" }
        };

        // --- 2. VOCABULARY DATA (Day 28 - 87 words) ---
        const vocabData = [
            { "STT": 1, "Kanji": "無くす", "Nghĩa": "Làm mất", "Furigana": "なくす", "type": "verb", "conv": { "polite": "鍵をなくすくらいなら、家にいないほうがいい。", "pVi": "Nếu phải làm mất chìa khóa, thà không ở nhà còn hơn.", "casual": "鍵なくすくらいなら外出てる方がマシ。", "cVi": "Mất khóa thà đi chơi còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 2, "Kanji": "足りる", "Nghĩa": "Đủ", "Furigana": "たりる", "type": "verb", "conv": { "polite": "お金が足りないくらいなら、アルバイトをしたほうがいい。", "pVi": "Nếu không đủ tiền, thà đi làm thêm còn hơn.", "casual": "金足りないならバイトしなよ。", "cVi": "Thiếu tiền thì đi làm thêm đi.", "gIds": ["kurai_nara"] } },
            { "STT": 3, "Kanji": "収入", "Nghĩa": "Thu nhập", "Furigana": "しゅうにゅう", "type": "noun", "conv": { "polite": "収入は多ければ多いほどいいと言われている。", "pVi": "Thu nhập càng nhiều càng tốt.", "casual": "収入は多いほどいいって言うよね。", "cVi": "Lương càng cao càng tốt mà.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 4, "Kanji": "残る", "Nghĩa": "Còn lại", "Furigana": "のこる", "type": "verb", "conv": { "polite": "食事が残るたびに、もったいないと感じる。", "pVi": "Cứ mỗi lần còn thức ăn thừa, tôi lại cảm thấy lãng phí.", "casual": "ご飯残るたびにもったいないなって思う。", "cVi": "Cứ thừa cơm là thấy phí.", "gIds": ["tabi_ni"] } },
            { "STT": 5, "Kanji": "残す", "Nghĩa": "Bỏ lại", "Furigana": "のこす", "type": "verb", "conv": { "polite": "食事を残すくらいなら、食べないほうがいい。", "pVi": "Nếu phải bỏ lại thức ăn, thà không ăn còn hơn.", "casual": "残すくらいなら最初から食うなよ。", "cVi": "Bỏ thừa thì thà đừng ăn.", "gIds": ["kurai_nara"] } },
            { "STT": 6, "Kanji": "腐る", "Nghĩa": "Thiu/Hỏng", "Furigana": "くさる", "type": "verb", "conv": { "polite": "食べ物が腐る前に、食べましょう。", "pVi": "Trước khi thức ăn bị ôi thiu, hãy ăn đi.", "casual": "腐る前に食べちゃおう。", "cVi": "Ăn đi trước khi nó hỏng.", "gIds": [] } },
            { "STT": 7, "Kanji": "剥ける", "Nghĩa": "Bong/Tróc", "Furigana": "むける", "type": "verb", "conv": { "polite": "皮が剥けるのは、日焼けのせいだと言われている。", "pVi": "Việc da bị lột được cho là do cháy nắng.", "casual": "皮むけたの日焼けのせいらしいよ。", "cVi": "Bong da là do cháy nắng đấy.", "gIds": ["okage_sei", "to_iwarete_iru"] } },
            { "STT": 8, "Kanji": "剥く", "Nghĩa": "Gọt/Bóc", "Furigana": "むく", "type": "verb", "conv": { "polite": "りんごの皮を剥くついでに、他の果物も剥いてくれませんか。", "pVi": "Nhân tiện bóc vỏ táo, bạn gọt luôn các loại trái cây khác giúp tôi được không?", "casual": "ついでに他のもむいてよ。", "cVi": "Tiện tay gọt luôn mấy quả kia đi.", "gIds": ["tsuide_ni"] } },
            { "STT": 9, "Kanji": "滑る", "Nghĩa": "Trượt", "Furigana": "すべる", "type": "verb", "conv": { "polite": "雪道は滑りやすいと言われている。", "pVi": "Đường tuyết được cho là dễ trượt.", "casual": "雪道滑りやすいらしいよ。", "cVi": "Đường tuyết trơn lắm đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 10, "Kanji": "雪", "Nghĩa": "Tuyết", "Furigana": "ゆき", "type": "noun", "conv": { "polite": "雪が降るたびに、子供たちは喜ぶ。", "pVi": "Cứ mỗi lần tuyết rơi, bọn trẻ lại vui mừng.", "casual": "雪降るたびに子供大喜びだね。", "cVi": "Cứ tuyết rơi là tụi nhỏ thích mê.", "gIds": ["tabi_ni"] } },
            { "STT": 11, "Kanji": "積もる", "Nghĩa": "Chất đống", "Furigana": "つもる", "type": "verb", "conv": { "polite": "雪が積もるたびに、交通が不便になる。", "pVi": "Cứ mỗi lần tuyết chất đống, giao thông lại trở nên bất tiện.", "casual": "雪積もると交通不便になるよね。", "cVi": "Tuyết dày là đi lại khó khăn ngay.", "gIds": ["tabi_ni"] } },
            { "STT": 12, "Kanji": "積む", "Nghĩa": "Chất lên", "Furigana": "つむ", "type": "verb", "conv": { "polite": "荷物を車に積むついでに、ゴミも捨ててくれませんか。", "pVi": "Nhân tiện chất hành lý lên xe, bạn vứt rác luôn giúp tôi được không?", "casual": "荷物積むついでにゴミ捨てといて。", "cVi": "Tiện chất đồ thì vứt rác luôn nhé.", "gIds": ["tsuide_ni"] } },
            { "STT": 13, "Kanji": "空く", "Nghĩa": "Trống", "Furigana": "あく", "type": "verb", "conv": { "polite": "部屋が空いているというより、誰もいないようだ。", "pVi": "Phòng nói là trống thì đúng hơn là không có ai.", "casual": "空いてるっていうか誰もいないっぽい。", "cVi": "Trống gì, chả có ai thì có.", "gIds": ["to_iu_yori"] } },
            { "STT": 14, "Kanji": "空ける", "Nghĩa": "Làm trống", "Furigana": "あける", "type": "verb", "conv": { "polite": "コップを空けるくらいなら、飲んだほうがいい。", "pVi": "Nếu phải làm rỗng cốc, thà uống còn hơn.", "casual": "空けるくらいなら飲んじゃえば。", "cVi": "Đổ đi phí, uống luôn đi.", "gIds": ["kurai_nara"] } },
            { "STT": 15, "Kanji": "下がる", "Nghĩa": "Giảm/Hạ", "Furigana": "さがる", "type": "verb", "conv": { "polite": "気温が下がるたびに、寒くなる。", "pVi": "Cứ mỗi lần nhiệt độ giảm, trời lại lạnh hơn.", "casual": "気温下がるたびに寒くなるね。", "cVi": "Cứ giảm độ là lạnh run.", "gIds": ["tabi_ni"] } },
            { "STT": 16, "Kanji": "下げる", "Nghĩa": "Hạ xuống", "Furigana": "さげる", "type": "verb", "conv": { "polite": "音量を下げるついでに、テレビも消してくれませんか。", "pVi": "Nhân tiện giảm âm lượng, bạn tắt luôn TV giúp tôi được không?", "casual": "音下げるついでにテレビ消して。", "cVi": "Tiện vặn nhỏ thì tắt TV luôn đi.", "gIds": ["tsuide_ni"] } },
            { "STT": 17, "Kanji": "冷える", "Nghĩa": "Lạnh đi", "Furigana": "ひえる", "type": "verb", "conv": { "polite": "体が冷えるたびに、風邪をひきやすい。", "pVi": "Cứ mỗi lần cơ thể bị lạnh, tôi lại dễ bị cảm.", "casual": "体冷えるとすぐ風邪引くんだよね。", "cVi": "Cứ lạnh là ốm ngay.", "gIds": ["tabi_ni"] } },
            { "STT": 18, "Kanji": "冷やす", "Nghĩa": "Làm lạnh", "Furigana": "ひやす", "type": "verb", "conv": { "polite": "ジュースを冷やすついでに、ビールも冷やしてくれませんか。", "pVi": "Nhân tiện làm lạnh nước ép, bạn làm lạnh luôn bia giúp tôi được không?", "casual": "ジュースついでにビールも冷やしといて。", "cVi": "Tiện ướp nước ngọt thì ướp bia luôn nhé.", "gIds": ["tsuide_ni"] } },
            { "STT": 19, "Kanji": "冷める", "Nghĩa": "Nguội đi", "Furigana": "さめる", "type": "verb", "conv": { "polite": "コーヒーが冷めるくらいなら、飲まないほうがいい。", "pVi": "Nếu cà phê nguội đến mức đó, thà không uống còn hơn.", "casual": "冷めるくらいなら飲まない。", "cVi": "Nguội thì thà khỏi uống.", "gIds": ["kurai_nara"] } },
            { "STT": 20, "Kanji": "冷ます", "Nghĩa": "Làm nguội", "Furigana": "さます", "type": "verb", "conv": { "polite": "お湯を冷ますついでに、お茶も入れてくれませんか。", "pVi": "Nhân tiện làm nguội nước nóng, bạn pha luôn trà giúp tôi được không?", "casual": "お湯冷ますついでにお茶淹れて。", "cVi": "Tiện làm nguội nước thì pha trà luôn đi.", "gIds": ["tsuide_ni"] } },
            { "STT": 21, "Kanji": "燃える", "Nghĩa": "Cháy", "Furigana": "もえる", "type": "verb", "conv": { "polite": "紙が燃えるのは、想像以上に早いと言われている。", "pVi": "Giấy cháy được cho là nhanh hơn tưởng tượng.", "casual": "紙燃えるのめっちゃ早いらしいよ。", "cVi": "Giấy cháy nhanh lắm đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 22, "Kanji": "燃やす", "Nghĩa": "Đốt", "Furigana": "もやす", "type": "verb", "conv": { "polite": "ゴミを燃やすくらいなら、リサイクルしたほうがいい。", "pVi": "Nếu phải đốt rác, thà tái chế còn hơn.", "casual": "燃やすくらいならリサイクルしなよ。", "cVi": "Đốt làm gì, tái chế đi.", "gIds": ["kurai_nara"] } },
            { "STT": 23, "Kanji": "沸く", "Nghĩa": "Sôi", "Furigana": "わく", "type": "verb", "conv": { "polite": "お湯が沸くたびに、音がする。", "pVi": "Cứ mỗi lần nước sôi, lại có tiếng động.", "casual": "お湯沸くたびに音するね。", "cVi": "Cứ sôi là kêu.", "gIds": ["tabi_ni"] } },
            { "STT": 24, "Kanji": "沸かす", "Nghĩa": "Đun sôi", "Furigana": "わかす", "type": "verb", "conv": { "polite": "お湯を沸かすついでに、コーヒーも淹れてくれませんか。", "pVi": "Nhân tiện đun sôi nước, bạn pha luôn cà phê giúp tôi được không?", "casual": "お湯沸かすついでにコーヒー淹れて。", "cVi": "Tiện đun nước pha cà phê luôn nhé.", "gIds": ["tsuide_ni"] } },
            { "STT": 25, "Kanji": "お湯", "Nghĩa": "Nước nóng", "Furigana": "おゆ", "type": "noun", "conv": { "polite": "お湯を飲むくらいなら、水がいい。", "pVi": "Nếu phải uống nước nóng, thà uống nước lạnh còn hơn.", "casual": "お湯飲むなら水でいいや。", "cVi": "Uống nước nóng thà uống nước lạnh.", "gIds": ["kurai_nara"] } },
            { "STT": 26, "Kanji": "鳴る", "Nghĩa": "Kêu/Reo", "Furigana": "なる", "type": "verb", "conv": { "polite": "電話が鳴るたびに、彼は慌てる。", "pVi": "Cứ mỗi lần điện thoại kêu, anh ấy lại luống cuống.", "casual": "電話鳴るたびに慌ててるよ。", "cVi": "Cứ chuông kêu là cuống lên.", "gIds": ["tabi_ni"] } },
            { "STT": 27, "Kanji": "鳴らす", "Nghĩa": "Làm kêu", "Furigana": "ならす", "type": "verb", "conv": { "polite": "ベルを鳴らすついでに、ドアも開けてくれませんか。", "pVi": "Nhân tiện làm cho chuông kêu, bạn mở luôn cửa giúp tôi được không?", "casual": "ベル鳴らすついでにドア開けて。", "cVi": "Tiện bấm chuông mở cửa luôn đi.", "gIds": ["tsuide_ni"] } },
            { "STT": 28, "Kanji": "役に立つ", "Nghĩa": "Có ích", "Furigana": "やくにたつ", "type": "phrase", "conv": { "polite": "この本は役に立つというより、人生を変える本だ。", "pVi": "Cuốn sách này nói là có ích thì đúng hơn là một cuốn sách thay đổi cuộc đời.", "casual": "これ役に立つっていうか人生変わるよ。", "cVi": "Sách này không chỉ có ích đâu, đổi đời đấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 29, "Kanji": "役に立てる", "Nghĩa": "Ứng dụng/Có ích", "Furigana": "やくにたてる", "type": "phrase", "conv": { "polite": "この経験を役に立てることは、誰にでもできることではないと言われている。", "pVi": "Việc tận dụng kinh nghiệm này được cho là không phải điều ai cũng có thể làm được.", "casual": "この経験活かすの誰でもできるわけじゃないらしい。", "cVi": "Nghe bảo không phải ai cũng dùng được kinh nghiệm này đâu.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 30, "Kanji": "飾る", "Nghĩa": "Trang trí", "Furigana": "かざる", "type": "verb", "conv": { "polite": "部屋を飾るたびに、気分が明るくなる。", "pVi": "Cứ mỗi lần trang trí phòng, tâm trạng lại trở nên vui vẻ.", "casual": "部屋飾るたびに気分上がるわ。", "cVi": "Cứ trang trí phòng là thấy vui.", "gIds": ["tabi_ni"] } },
            { "STT": 31, "Kanji": "遊ぶ", "Nghĩa": "Chơi", "Furigana": "あそぶ", "type": "verb", "conv": { "polite": "子供と遊ぶくらいなら、仕事をしたほうがいい。", "pVi": "Nếu phải chơi với trẻ con, thà làm việc còn hơn.", "casual": "子供と遊ぶなら仕事するわ。", "cVi": "Chơi với trẻ con thà đi làm còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 32, "Kanji": "集まる", "Nghĩa": "Tập trung", "Furigana": "あつまる", "type": "verb", "conv": { "polite": "人が集まるたびに、賑やかになる。", "pVi": "Cứ mỗi lần người tập trung, lại trở nên náo nhiệt.", "casual": "集まるたびにうるさくなるね。", "cVi": "Cứ tụ tập là ồn ào.", "gIds": ["tabi_ni"] } },
            { "STT": 33, "Kanji": "踊る", "Nghĩa": "Nhảy múa", "Furigana": "おどる", "type": "verb", "conv": { "polite": "音楽を聞くついでに、踊りませんか。", "pVi": "Nhân tiện nghe nhạc, bạn nhảy không?", "casual": "音楽ついでに踊らない？", "cVi": "Tiện nghe nhạc nhảy tí không?", "gIds": ["tsuide_ni"] } },
            { "STT": 34, "Kanji": "思う", "Nghĩa": "Nghĩ", "Furigana": "おもう", "type": "verb", "conv": { "polite": "彼のことを思うたびに、悲しくなる。", "pVi": "Cứ mỗi lần nghĩ về anh ấy, tôi lại buồn.", "casual": "彼のこと思うたびに悲しくなる。", "cVi": "Cứ nghĩ đến anh ấy là buồn.", "gIds": ["tabi_ni"] } },
            { "STT": 35, "Kanji": "考える", "Nghĩa": "Suy nghĩ", "Furigana": "かんがえる", "type": "verb", "conv": { "polite": "彼のことを考えるというより、心配している。", "pVi": "Nói là suy nghĩ về anh ấy thì đúng hơn là đang lo lắng.", "casual": "考えるっていうか心配してるだけ。", "cVi": "Lo lắng chứ suy nghĩ gì.", "gIds": ["to_iu_yori"] } },
            { "STT": 36, "Kanji": "手伝う", "Nghĩa": "Giúp đỡ", "Furigana": "てつだう", "type": "verb", "conv": { "polite": "友達を手伝うことは、誰にでもできることだと言われている。", "pVi": "Việc giúp đỡ bạn bè được cho là điều ai cũng có thể làm được.", "casual": "友達手伝うの誰でもできるらしいよ。", "cVi": "Giúp bạn ai chả làm được.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 37, "Kanji": "働く", "Nghĩa": "Làm việc", "Furigana": "はたらく", "type": "verb", "conv": { "polite": "毎日働くくらいなら、休んだほうがいい。", "pVi": "Nếu phải làm việc mỗi ngày, thà nghỉ ngơi còn hơn.", "casual": "毎日働くくらいなら休むわ。", "cVi": "Làm cả ngày thà nghỉ cho khỏe.", "gIds": ["kurai_nara"] } },
            { "STT": 38, "Kanji": "決まる", "Nghĩa": "Được quyết định", "Furigana": "きまる", "type": "verb", "conv": { "polite": "会議の時間が決まるたびに、連絡が来る。", "pVi": "Cứ mỗi lần thời gian cuộc họp được quyết định, lại có liên lạc đến.", "casual": "時間決まるたびに連絡来るんだ。", "cVi": "Cứ chốt giờ là lại nhắn tin.", "gIds": ["tabi_ni"] } },
            { "STT": 39, "Kanji": "騒ぐ", "Nghĩa": "Làm ồn", "Furigana": "さわぐ", "type": "verb", "conv": { "polite": "夜中に騒ぐくらいなら、寝たほうがいい。", "pVi": "Nếu phải làm ồn giữa đêm, thà ngủ còn hơn.", "casual": "夜中騒ぐなら寝ろよ。", "cVi": "Đêm hôm ồn ào thà ngủ đi.", "gIds": ["kurai_nara"] } },
            { "STT": 40, "Kanji": "知らせる", "Nghĩa": "Thông báo", "Furigana": "しらせる", "type": "verb", "conv": { "polite": "ニュースを知らせるついでに、他の情報も教えてくれませんか。", "pVi": "Nhân tiện thông báo tin tức, bạn cho tôi biết luôn thông tin khác được không?", "casual": "ニュースついでに他のも教えて。", "cVi": "Tiện báo tin thì nói luôn cái kia đi.", "gIds": ["tsuide_ni"] } },
            { "STT": 41, "Kanji": "頼む", "Nghĩa": "Nhờ vả", "Furigana": "たのむ", "type": "verb", "conv": { "polite": "友達に頼むのは、簡単だと言われている。", "pVi": "Việc nhờ vả bạn bè được cho là dễ.", "casual": "友達に頼むの簡単らしいよ。", "cVi": "Nhờ bạn bè dễ ợt mà.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 42, "Kanji": "疲れる", "Nghĩa": "Mệt mỏi", "Furigana": "つかれる", "type": "verb", "conv": { "polite": "毎日疲れるくらいなら、休んだほうがいい。", "pVi": "Nếu phải mệt mỏi mỗi ngày, thà nghỉ ngơi còn hơn.", "casual": "疲れるくらいなら休みなよ。", "cVi": "Mệt quá thì nghỉ đi.", "gIds": ["kurai_nara"] } },
            { "STT": 43, "Kanji": "違う", "Nghĩa": "Khác/Sai", "Furigana": "ちがう", "type": "verb", "conv": { "polite": "彼の意見は私と違うというより、全く逆だ。", "pVi": "Ý kiến của anh ấy nói là khác tôi thì đúng hơn là hoàn toàn trái ngược.", "casual": "違うっていうか逆だね。", "cVi": "Khác gì, ngược hẳn luôn ấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 44, "Kanji": "始める", "Nghĩa": "Bắt đầu", "Furigana": "はじめる", "type": "verb", "conv": { "polite": "新しい仕事を始めることは、誰にでもできることではないと言われている。", "pVi": "Việc bắt đầu công việc mới được cho là không phải điều ai cũng có thể làm được.", "casual": "新しく始めるの誰でもできるわけじゃないらしい。", "cVi": "Bắt đầu cái mới không dễ đâu.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 45, "Kanji": "別れる", "Nghĩa": "Chia tay", "Furigana": "わかれる", "type": "verb", "conv": { "polite": "友達と別れるたびに、悲しくなる。", "pVi": "Cứ mỗi lần chia tay bạn bè, tôi lại buồn.", "casual": "別れるたびに悲しいわ。", "cVi": "Cứ chia tay là buồn.", "gIds": ["tabi_ni"] } },
            { "STT": 46, "Kanji": "喜ぶ", "Nghĩa": "Vui mừng", "Furigana": "よろこぶ", "type": "verb", "conv": { "polite": "嬉しいニュースを聞くたびに、喜ぶ。", "pVi": "Cứ mỗi lần nghe tin vui, tôi lại vui mừng.", "casual": "いいニュース聞くたびに喜んじゃう。", "cVi": "Cứ nghe tin vui là sướng.", "gIds": ["tabi_ni"] } },
            { "STT": 47, "Kanji": "続く", "Nghĩa": "Tiếp tục", "Furigana": "つづく", "type": "verb", "conv": { "polite": "雨が続くたびに、気分が落ち込む。", "pVi": "Cứ mỗi lần mưa liên tục, tâm trạng tôi lại chùng xuống.", "casual": "雨続くとテンション下がる。", "cVi": "Mưa miết chán đời.", "gIds": ["tabi_ni"] } },
            { "STT": 48, "Kanji": "暮れる", "Nghĩa": "Lặn/Hết ngày", "Furigana": "くれる", "type": "verb", "conv": { "polite": "日が暮れるのは、早いと言われている。", "pVi": "Mặt trời lặn được cho là nhanh.", "casual": "日暮れるの早いらしいよ。", "cVi": "Nghe bảo tối nhanh lắm.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 49, "Kanji": "分別", "Nghĩa": "Phân loại", "Furigana": "ぶんべつ", "type": "noun", "conv": { "polite": "ゴミの分別は、環境保護のために必要だと言われている。", "pVi": "Việc phân loại rác được cho là cần thiết để bảo vệ môi trường.", "casual": "分別は環境のために必要だって。", "cVi": "Phân loại rác là cần thiết đấy.", "gIds": ["to_iwarete_iru", "tame_ni"] } },
            { "STT": 50, "Kanji": "喜ばせる", "Nghĩa": "Làm vui lòng", "Furigana": "よろこばせる", "type": "verb", "conv": { "polite": "友達を喜ばせることは、誰にでもできることだと言われている。", "pVi": "Việc làm bạn bè hạnh phúc được cho là điều ai cũng có thể làm được.", "casual": "人を喜ばせるの誰でもできるって。", "cVi": "Làm người khác vui ai chả làm được.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 51, "Kanji": "優勝する", "Nghĩa": "Vô địch", "Furigana": "ゆうしょうする", "type": "verb", "conv": { "polite": "優勝するくらいなら、参加しないほうがいい。", "pVi": "Nếu phải vô địch, thà không tham gia còn hơn (Câu này context hơi lạ).", "casual": "優勝するくらいなら出ないほうがマシ。", "cVi": "Vô địch thì thà nghỉ cho rồi.", "gIds": ["kurai_nara"] } },
            { "STT": 52, "Kanji": "笑う", "Nghĩa": "Cười", "Furigana": "わらう", "type": "verb", "conv": { "polite": "彼の話を聞くたびに、笑う。", "pVi": "Cứ mỗi lần nghe chuyện của anh ấy, tôi lại cười.", "casual": "話聞くたびに笑っちゃう。", "cVi": "Cứ nghe hắn nói là buồn cười.", "gIds": ["tabi_ni"] } },
            { "STT": 53, "Kanji": "驚く", "Nghĩa": "Kinh ngạc", "Furigana": "おどろく", "type": "verb", "conv": { "polite": "彼の話を聞くたびに、驚く。", "pVi": "Cứ mỗi lần nghe chuyện của anh ấy, tôi lại kinh ngạc.", "casual": "話聞くたびに驚くよ。", "cVi": "Lần nào nghe cũng giật mình.", "gIds": ["tabi_ni"] } },
            { "STT": 54, "Kanji": "怒る", "Nghĩa": "Nổi giận", "Furigana": "おこる", "type": "verb", "conv": { "polite": "彼の態度を見るたびに、怒る。", "pVi": "Cứ mỗi lần nhìn thái độ của anh ấy, tôi lại nổi giận.", "casual": "態度見るたびにイライラする。", "cVi": "Cứ thấy thái độ đó là cáu.", "gIds": ["tabi_ni"] } },
            { "STT": 55, "Kanji": "殺人", "Nghĩa": "Sát nhân", "Furigana": "さつじん", "type": "noun", "conv": { "polite": "殺人事件は、許されないことだと言われている。", "pVi": "Vụ án sát nhân được cho là điều không thể tha thứ.", "casual": "殺人は許されないって言われてるよね。", "cVi": "Giết người là không tha thứ được đâu.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 56, "Kanji": "幸せ", "Nghĩa": "Hạnh phúc", "Furigana": "しあわせ", "type": "adj", "conv": { "polite": "幸せな生活を送ることは、誰にでもできることではないと言われている。", "pVi": "Việc sống một cuộc sống hạnh phúc được cho là không phải điều ai cũng có thể làm được.", "casual": "幸せな生活は簡単じゃないらしい。", "cVi": "Sống hạnh phúc không dễ đâu.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 57, "Kanji": "得意", "Nghĩa": "Giỏi/Đắc ý", "Furigana": "とくい", "type": "adj", "conv": { "polite": "彼は料理が得意だと言われている。", "pVi": "Anh ấy được cho là giỏi nấu ăn.", "casual": "彼料理得意らしいよ。", "cVi": "Nghe bảo hắn nấu ăn ngon lắm.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 58, "Kanji": "苦手", "Nghĩa": "Kém/Không giỏi", "Furigana": "にがて", "type": "adj", "conv": { "polite": "私は歌が苦手だと言われている。", "pVi": "Tôi được cho là kém hát.", "casual": "私歌苦手だって言われる。", "cVi": "Bị chê hát dở.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 59, "Kanji": "熱心", "Nghĩa": "Nhiệt tình", "Furigana": "ねっしん", "type": "adj", "conv": { "polite": "彼は熱心なのだから、成功するだろうと言われている。", "pVi": "Vì anh ấy nhiệt tình, nên được cho là sẽ thành công.", "casual": "彼熱心だから成功するらしいよ。", "cVi": "Hắn nhiệt tình thế chắc thành công thôi.", "gIds": ["no_dakara", "to_iwarete_iru"] } },
            { "STT": 60, "Kanji": "認め", "Nghĩa": "Thừa nhận", "Furigana": "みとめ", "type": "verb", "conv": { "polite": "彼の努力は認められるべきだと言われている。", "pVi": "Nỗ lực của anh ấy được cho là nên được thừa nhận.", "casual": "彼の努力認められるべきだって。", "cVi": "Nỗ lực đó đáng được công nhận.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 61, "Kanji": "昇進", "Nghĩa": "Thăng tiến", "Furigana": "しょうしん", "type": "noun", "conv": { "polite": "彼は昇進するたびに、周りの人が喜ぶ。", "pVi": "Cứ mỗi lần anh ấy được thăng tiến, những người xung quanh lại vui mừng.", "casual": "昇進するたびにみんな喜んでる。", "cVi": "Cứ thăng chức là cả làng vui.", "gIds": ["tabi_ni"] } },
            { "STT": 62, "Kanji": "夢中", "Nghĩa": "Say mê", "Furigana": "むちゅう", "type": "adj", "conv": { "polite": "彼はゲームに夢中なのだから、勉強しないのも当然だ。", "pVi": "Vì anh ấy say mê game, nên việc không học cũng là điều đương nhiên.", "casual": "夢中だから勉強しないの当たり前。", "cVi": "Mê game thế thì học hành gì.", "gIds": ["no_dakara"] } },
            { "STT": 63, "Kanji": "観客", "Nghĩa": "Khán giả", "Furigana": "かんきゃく", "type": "noun", "conv": { "polite": "観客は、彼の演奏に感動したと言われている。", "pVi": "Khán giả được cho là đã cảm động trước màn trình diễn của anh ấy.", "casual": "観客感動したらしいよ。", "cVi": "Khán giả xúc động lắm đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 64, "Kanji": "退屈", "Nghĩa": "Chán ngắt", "Furigana": "たいくつ", "type": "adj", "conv": { "polite": "映画が退屈なのだから、途中で帰ったらどうか。", "pVi": "Vì bộ phim chán, nên về giữa chừng thì sao?", "casual": "退屈だから帰れば？", "cVi": "Chán thì về đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 65, "Kanji": "健康", "Nghĩa": "Sức khỏe", "Furigana": "けんこう", "type": "noun", "conv": { "polite": "健康のために、毎日運動するに限る。", "pVi": "Để khỏe mạnh, tốt nhất là nên tập thể dục mỗi ngày.", "casual": "健康には運動に限るよ。", "cVi": "Muốn khỏe cứ tập thể dục là nhất.", "gIds": ["tame_ni", "ni_kagiru"] } },
            { "STT": 66, "Kanji": "育てる", "Nghĩa": "Nuôi dạy", "Furigana": "そだてる", "type": "verb", "conv": { "polite": "子供を育てることは、親の責任だと言われている。", "pVi": "Việc nuôi dạy con cái được cho là trách nhiệm của cha mẹ.", "casual": "子育ては親の責任だって。", "cVi": "Nuôi con là trách nhiệm cha mẹ mà.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 67, "Kanji": "苦しい", "Nghĩa": "Khổ cực", "Furigana": "くるしい", "type": "adj", "conv": { "polite": "苦しい生活を送るたびに、彼は強くなる。", "pVi": "Cứ mỗi lần sống một cuộc sống cực khổ, anh ấy lại trở nên mạnh mẽ hơn.", "casual": "苦しいたびに強くなるね。", "cVi": "Càng khổ càng mạnh mẽ.", "gIds": ["tabi_ni"] } },
            { "STT": 68, "Kanji": "悪口", "Nghĩa": "Nói xấu", "Furigana": "わるぐち", "type": "noun", "conv": { "polite": "人の悪口を言うくらいなら、何も言わないほうがいい。", "pVi": "Nếu phải nói xấu người khác, thà không nói gì còn hơn.", "casual": "悪口言うなら黙ってなよ。", "cVi": "Nói xấu thì thà im đi còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 69, "Kanji": "平気", "Nghĩa": "Bình thản/Không sao", "Furigana": "へいき", "type": "adj", "conv": { "polite": "彼は平気なのだから、心配いらないだろう。", "pVi": "Vì anh ấy bình thản, nên chắc không cần lo lắng đâu.", "casual": "彼平気だから大丈夫でしょ。", "cVi": "Nó tỉnh bơ à, không sao đâu.", "gIds": ["no_dakara"] } },
            { "STT": 70, "Kanji": "悔しい", "Nghĩa": "Cay cú/Tiếc nuối", "Furigana": "くやしい", "type": "adj", "conv": { "polite": "試合に負けるたびに、悔しいと感じる。", "pVi": "Cứ mỗi lần thua trận đấu, tôi lại cảm thấy đáng tiếc.", "casual": "負けるたびに悔しいよ。", "cVi": "Cứ thua là cay.", "gIds": ["tabi_ni"] } },
            { "STT": 71, "Kanji": "羨ましい", "Nghĩa": "Ghen tị", "Furigana": "うらやましい", "type": "adj", "conv": { "polite": "彼の才能は羨ましいくらいだ。", "pVi": "Tài năng của anh ấy đáng ghen tị đến mức đó.", "casual": "才能うらやましいくらいだよ。", "cVi": "Ghen tị với tài năng của hắn ghê.", "gIds": ["kurai_nara"] } },
            { "STT": 72, "Kanji": "才能", "Nghĩa": "Tài năng", "Furigana": "さいのう", "type": "noun", "conv": { "polite": "彼の才能は、誰にでも認められていると言われている。", "pVi": "Tài năng của anh ấy được cho là được mọi người công nhận.", "casual": "彼の才能みんな認めてるらしい。", "cVi": "Ai cũng công nhận tài năng của hắn.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 73, "Kanji": "豊か", "Nghĩa": "Phong phú", "Furigana": "ゆたか", "type": "adj", "conv": { "polite": "豊かな自然があるおかげで、この町は人気がある。", "pVi": "Nhờ có thiên nhiên phong phú mà thị trấn này được yêu thích.", "casual": "自然豊かだから人気あるんだ。", "cVi": "Nhờ cảnh đẹp mà chỗ này hot đấy.", "gIds": ["okage_sei"] } },
            { "STT": 74, "Kanji": "蚊", "Nghĩa": "Muỗi", "Furigana": "か", "type": "noun", "conv": { "polite": "蚊に刺されるたびに、痒くなる。", "pVi": "Cứ mỗi lần bị muỗi đốt, tôi lại ngứa.", "casual": "蚊に刺されるたびにかゆい。", "cVi": "Cứ bị đốt là ngứa điên.", "gIds": ["tabi_ni"] } },
            { "STT": 75, "Kanji": "首", "Nghĩa": "Cổ", "Furigana": "くび", "type": "noun", "conv": { "polite": "首が痛いのだから、医者に見てもらったらどうか。", "pVi": "Vì cổ đau, nên đi khám bác sĩ thì sao?", "casual": "首痛いなら医者行けば？", "cVi": "Đau cổ thì đi khám đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 76, "Kanji": "痒い", "Nghĩa": "Ngứa", "Furigana": "かゆい", "type": "adj", "conv": { "polite": "蚊に刺されるたびに、痒くて眠れない。", "pVi": "Cứ mỗi lần bị muỗi đốt, tôi lại ngứa đến mức không ngủ được.", "casual": "蚊に刺されると痒くて寝れない。", "cVi": "Bị đốt ngứa không ngủ nổi.", "gIds": ["tabi_ni"] } },
            { "STT": 77, "Kanji": "大人しい", "Nghĩa": "Trầm tính", "Furigana": "おとなしい", "type": "adj", "conv": { "polite": "彼は大人しいというより、真面目だ。", "pVi": "Anh ấy nói là trầm tính thì đúng hơn là nghiêm túc.", "casual": "大人しいっていうか真面目だね。", "cVi": "Nó nghiêm túc chứ không phải hiền đâu.", "gIds": ["to_iu_yori"] } },
            { "STT": 78, "Kanji": "我慢強い", "Nghĩa": "Kiên nhẫn", "Furigana": "がまんづよい", "type": "adj", "conv": { "polite": "彼は我慢強いので、どんな困難も乗り越えられると言われている。", "pVi": "Vì anh ấy giỏi chịu đựng, nên được cho là có thể vượt qua mọi khó khăn.", "casual": "彼我慢強いから何でも乗り越えられるらしい。", "cVi": "Hắn lì đòn lắm, cái gì cũng qua được.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 79, "Kanji": "けち", "Nghĩa": "Keo kiệt", "Furigana": "けち", "type": "adj", "conv": { "polite": "彼はけちなのに対して、弟は気前がいい。", "pVi": "Anh ấy keo kiệt, ngược lại em trai lại hào phóng.", "casual": "彼はケチだけど弟は気前いい。", "cVi": "Hắn keo kiệt mà em trai lại thoáng.", "gIds": ["ni_taishite"] } },
            { "STT": 80, "Kanji": "我儘", "Nghĩa": "Ích kỷ", "Furigana": "わがまま", "type": "adj", "conv": { "polite": "彼女はわがままな反面、優しいところもある。", "pVi": "Cô ấy ích kỷ nhưng mặt khác cũng có điểm hiền lành.", "casual": "わがまだけど優しいとこもあるよ。", "cVi": "Ích kỷ nhưng cũng có lúc hiền.", "gIds": ["hanmen"] } },
            { "STT": 81, "Kanji": "積極的", "Nghĩa": "Tích cực", "Furigana": "せっきょくてき", "type": "adj", "conv": { "polite": "彼は積極的な一方、少しせっかちだ。", "pVi": "Anh ấy tích cực nhưng đồng thời hơi nóng vội.", "casual": "積極的だけどせっかちだね。", "cVi": "Năng nổ nhưng hơi vội.", "gIds": ["ippou_de"] } },
            { "STT": 82, "Kanji": "消極的", "Nghĩa": "Tiêu cực", "Furigana": "しょうきょくてき", "type": "adj", "conv": { "polite": "彼女は消極的なのなら、もっと自信を持たせたらどうか。", "pVi": "Nếu cô ấy tiêu cực, nên cho cô ấy tự tin hơn thì sao?", "casual": "消極的なら自信持たせたら？", "cVi": "Thụ động thì giúp cổ tự tin lên.", "gIds": ["no_nara", "tara_douka"] } },
            { "STT": 83, "Kanji": "満足", "Nghĩa": "Mãn nguyện", "Furigana": "まんぞく", "type": "adj", "conv": { "polite": "満足な生活を送るたびに、感謝の気持ちが湧く。", "pVi": "Cứ mỗi lần sống một cuộc sống mãn nguyện, tôi lại cảm thấy biết ơn.", "casual": "満足な生活送ると感謝しちゃう。", "cVi": "Sống sướng là thấy biết ơn ngay.", "gIds": ["tabi_ni"] } },
            { "STT": 84, "Kanji": "不満", "Nghĩa": "Bất mãn", "Furigana": "ふまん", "type": "adj", "conv": { "polite": "彼は不満な顔をしているのだから、何かあったのだろう。", "pVi": "Vì anh ấy đang có vẻ mặt bất mãn, nên chắc có chuyện gì đó rồi.", "casual": "不満そうだから何かあったんでしょ。", "cVi": "Mặt bí xị thế kia chắc có biến.", "gIds": ["no_dakara"] } },
            { "STT": 85, "Kanji": "不安", "Nghĩa": "Bất an", "Furigana": "ふあん", "type": "adj", "conv": { "polite": "不安な気持ちのままでは、何もできない。", "pVi": "Nếu cứ trong trạng thái bất an thì không thể làm gì cả.", "casual": "不安なままじゃ何もできないよ。", "cVi": "Cứ lo thế thì làm ăn gì.", "gIds": ["no_wa"] } },
            { "STT": 86, "Kanji": "大変", "Nghĩa": "Vất vả", "Furigana": "たいへん", "type": "adj", "conv": { "polite": "仕事が大変なのだから、休んだらどうか。", "pVi": "Vì công việc vất vả, nên nghỉ ngơi thì sao?", "casual": "大変なんだから休めば？", "cVi": "Mệt thì nghỉ đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 87, "Kanji": "無理", "Nghĩa": "Vô lý", "Furigana": "むり", "type": "adj", "conv": { "polite": "無理な計画は立てないに限る。", "pVi": "Tốt nhất là không nên lập kế hoạch vô lý.", "casual": "無理な計画は立てないに限るよ。", "cVi": "Đừng lên kế hoạch ảo tưởng là tốt nhất.", "gIds": ["ni_kagiru"] } }
        ];

        // --- 3. KANJI DETAILS (Updated for Day 28) ---
        const kanjiDetails = {
            "無": { hanviet: "VÔ", mean: "Không có", on: "ム, ブ", kun: "な.い", radicals: "Hỏa (灬)", tipImg: "Lửa (灬) đốt hết không còn gì.", tipSoundOn: "**Mu**ryou miễn phí.", tipSoundKun: "**Na**i không có.", words: [{w:"無くす (なくす)", m:"Làm mất"}, {w:"無理 (むり)", m:"Vô lý"}] },
            "足": { hanviet: "TÚC", mean: "Chân/Đủ", on: "ソク", kun: "あし", radicals: "Khẩu (口) + Chỉ (止)", tipImg: "Chân (止) đi đủ (口) rồi.", tipSoundOn: "En**soku** dã ngoại.", tipSoundKun: "**Ashi** chân.", words: [{w:"足りる (たりる)", m:"Đủ"}, {w:"足 (あし)", m:"Chân"}] },
            "収": { hanviet: "THU", mean: "Thu nhập/Thu vào", on: "シュウ", kun: "おさ.める", radicals: "Hựu (又)", tipImg: "Tay (又) thu lấy.", tipSoundOn: "**Shuu**nyuu thu nhập.", tipSoundKun: "**Osa**meru thu được.", words: [{w:"収入 (しゅうにゅう)", m:"Thu nhập"}, {w:"領収書 (りょうしゅうしょ)", m:"Hóa đơn"}] },
            "残": { hanviet: "TÀN", mean: "Còn lại/Tàn dư", on: "ザン", kun: "のこ.る", radicals: "Ngạt (歹) + Qua (戈)", tipImg: "Xương tàn (歹) sau chiến tranh (戈).", tipSoundOn: "**Zan**gyou làm thêm.", tipSoundKun: "**Noko**ru còn lại.", words: [{w:"残る (のこる)", m:"Còn lại"}, {w:"残す (のこす)", m:"Để lại"}] },
            "腐": { hanviet: "HỦ", mean: "Thối nát", on: "フ", kun: "くさ.る", radicals: "Nhục (肉) + Phủ (府)", tipImg: "Thịt (肉) trong phủ (府) bị thối.", tipSoundOn: "Tou**fu** đậu phụ.", tipSoundKun: "**Kusa**ru thiu.", words: [{w:"腐る (くさる)", m:"Thiu/Hỏng"}] },
            "剥": { hanviet: "BÁC", mean: "Bóc/Lột", on: "ハク", kun: "む.く", radicals: "Đao (刂)", tipImg: "Dùng dao (刂) bóc vỏ.", tipSoundOn: "", tipSoundKun: "**Mu**ku bóc.", words: [{w:"剥く (むく)", m:"Bóc"}, {w:"剥ける (むける)", m:"Bong"}] },
            "滑": { hanviet: "HOẠT", mean: "Trơn trượt", on: "カツ", kun: "すべ.る", radicals: "Thủy (氵) + Cốt (骨)", tipImg: "Nước (氵) trên xương (骨) thì trơn.", tipSoundOn: "En**katsu** trôi chảy.", tipSoundKun: "**Sube**ru trượt.", words: [{w:"滑る (すべる)", m:"Trượt"}] },
            "雪": { hanviet: "TUYẾT", mean: "Tuyết", on: "セツ", kun: "ゆき", radicals: "Vũ (雨)", tipImg: "Mưa (雨) đông lại thành tuyết.", tipSoundOn: "**Setsu**gen cánh đồng tuyết.", tipSoundKun: "**Yuki** tuyết.", words: [{w:"雪 (ゆき)", m:"Tuyết"}] },
            "積": { hanviet: "TÍCH", mean: "Tích tụ/Chất", on: "セキ", kun: "つ.む", radicals: "Hòa (禾) + Trách (責)", tipImg: "Lúa (禾) chất đống là trách (責) nhiệm.", tipSoundOn: "Men**seki** diện tích.", tipSoundKun: "**Tsu**mu chất.", words: [{w:"積む (つむ)", m:"Chất lên"}, {w:"積もる (つもる)", m:"Chất đống"}] },
            "空": { hanviet: "KHÔNG", mean: "Trống/Bầu trời", on: "クウ", kun: "そら, あ.く", radicals: "Huyệt (穴) + Công (工)", tipImg: "Trong hang (穴) thợ (工) làm rỗng.", tipSoundOn: "**Kuu**ki không khí.", tipSoundKun: "**A**ku trống.", words: [{w:"空く (あく)", m:"Trống"}, {w:"空ける (あける)", m:"Làm trống"}] },
            "下": { hanviet: "HẠ", mean: "Dưới/Xuống", on: "カ, ゲ", kun: "した, さ.げる", radicals: "Nhất (一)", tipImg: "Dưới mặt đất.", tipSoundOn: "Chi**ka** tàu điện ngầm.", tipSoundKun: "**Sa**geru hạ xuống.", words: [{w:"下がる (さがる)", m:"Giảm"}, {w:"下げる (さげる)", m:"Hạ"}] },
            "冷": { hanviet: "LÃNH", mean: "Lạnh", on: "レイ", kun: "つめ.たい", radicals: "Băng (冫) + Lệnh (令)", tipImg: "Ra lệnh (令) đóng băng (冫).", tipSoundOn: "**Rei**zouko tủ lạnh.", tipSoundKun: "**Hi**eru lạnh đi.", words: [{w:"冷える (ひえる)", m:"Lạnh"}, {w:"冷やす (ひやす)", m:"Làm lạnh"}, {w:"冷める (さめる)", m:"Nguội"}, {w:"冷ます (さます)", m:"Làm nguội"}] },
            "燃": { hanviet: "NHIÊN", mean: "Cháy", on: "ネン", kun: "も.える", radicals: "Hỏa (火) + Nhiên (然)", tipImg: "Lửa (火) cháy tự nhiên (然).", tipSoundOn: "**Nen**ryou nhiên liệu.", tipSoundKun: "**Mo**eru cháy.", words: [{w:"燃える (もえる)", m:"Cháy"}, {w:"燃やす (もやす)", m:"Đốt"}] },
            "沸": { hanviet: "PHÍ", mean: "Sôi", on: "フツ", kun: "わ.く", radicals: "Thủy (氵) + Phất (弗)", tipImg: "Nước (氵) phất (弗) lên khi sôi.", tipSoundOn: "", tipSoundKun: "**Wa**ku sôi.", words: [{w:"沸く (わく)", m:"Sôi"}, {w:"沸かす (わかす)", m:"Đun sôi"}] },
            "湯": { hanviet: "THANG", mean: "Nước nóng", on: "トウ", kun: "おゆ", radicals: "Thủy (氵) + Dương (昜)", tipImg: "Nước (氵) nóng dưới mặt trời (昜).", tipSoundOn: "Sen**tou** nhà tắm công cộng.", tipSoundKun: "**Oyu** nước nóng.", words: [{w:"お湯 (おゆ)", m:"Nước nóng"}] },
            "鳴": { hanviet: "MINH", mean: "Kêu/Hót", on: "メイ", kun: "な.く", radicals: "Khẩu (口) + Điểu (鳥)", tipImg: "Chim (鳥) mở miệng (口) hót.", tipSoundOn: "Hi**mei** tiếng hét.", tipSoundKun: "**Na**ru kêu.", words: [{w:"鳴る (なる)", m:"Kêu"}, {w:"鳴らす (ならす)", m:"Làm kêu"}] },
            "役": { hanviet: "DỊCH", mean: "Vai trò/Có ích", on: "ヤク", kun: "", radicals: "Xích (彳) + Thù (殳)", tipImg: "Đi (彳) cầm gậy (殳) làm nhiệm vụ.", tipSoundOn: "**Yaku** ni tatsu có ích.", words: [{w:"役に立つ (やくにたつ)", m:"Có ích"}, {w:"市役所 (しやくしょ)", m:"Tòa thị chính"}] },
            "飾": { hanviet: "SỨC", mean: "Trang trí", on: "ショク", kun: "かざ.る", radicals: "Thực (饣) + Cân (巾)", tipImg: "Ăn (饣) xong dùng khăn (巾) trang trí.", tipSoundOn: "Sou**shoku** trang sức.", tipSoundKun: "**Kaza**ru trang trí.", words: [{w:"飾る (かざる)", m:"Trang trí"}] },
            "遊": { hanviet: "DU", mean: "Chơi", on: "ユウ", kun: "あそ.ぶ", radicals: "Xước (⻌) + Phương (方)", tipImg: "Đi (⻌) chơi khắp phương (方) trời.", tipSoundOn: "**Yuu**enchi khu vui chơi.", tipSoundKun: "**Aso**bu chơi.", words: [{w:"遊ぶ (あそぶ)", m:"Chơi"}] },
            "集": { hanviet: "TẬP", mean: "Tập hợp", on: "シュウ", kun: "あつ.まる", radicals: "Chuy (隹) + Mộc (木)", tipImg: "Chim (隹) tập hợp trên cây (木).", tipSoundOn: "**Shuu**gou tập hợp.", tipSoundKun: "**Atsu**maru tập trung.", words: [{w:"集まる (あつまる)", m:"Tập trung"}] },
            "踊": { hanviet: "DŨNG", mean: "Nhảy múa", on: "ヨウ", kun: "おど.る", radicals: "Túc (足) + Dũng (勇)", tipImg: "Chân (足) dũng (勇) cảm nhảy múa.", tipSoundOn: "Bu**you** vũ điệu.", tipSoundKun: "**Odo**ru nhảy.", words: [{w:"踊る (おどる)", m:"Nhảy múa"}] },
            "思": { hanviet: "TƯ", mean: "Nghĩ", on: "シ", kun: "おも.う", radicals: "Điền (田) + Tâm (心)", tipImg: "Tâm (心) nghĩ về ruộng (田).", tipSoundOn: "I**shi** ý chí.", tipSoundKun: "**Omo**u nghĩ.", words: [{w:"思う (おもう)", m:"Nghĩ"}, {w:"思い出 (おもいで)", m:"Kỷ niệm"}] },
            "考": { hanviet: "KHẢO", mean: "Suy nghĩ", on: "コウ", kun: "かんが.える", radicals: "Lão (耂)", tipImg: "Người già (耂) suy nghĩ.", tipSoundOn: "San**kou** tham khảo.", tipSoundKun: "**Kanga**eru suy nghĩ.", words: [{w:"考える (かんがえる)", m:"Suy nghĩ"}] },
            "手": { hanviet: "THỦ", mean: "Tay", on: "シュ", kun: "て", radicals: "Thủ (手)", tipImg: "Bàn tay 5 ngón.", tipSoundOn: "Ka**shu** ca sĩ.", tipSoundKun: "**Te** tay.", words: [{w:"手伝う (てつだう)", m:"Giúp đỡ"}] },
            "働": { hanviet: "ĐỘNG", mean: "Làm việc", on: "ドウ", kun: "はたら.く", radicals: "Nhân (亻) + Động (動)", tipImg: "Người (亻) lao động (動).", tipSoundOn: "Rou**dou** lao động.", tipSoundKun: "**Hatara**ku làm việc.", words: [{w:"働く (はたらく)", m:"Làm việc"}] },
            "決": { hanviet: "QUYẾT", mean: "Quyết định", on: "ケツ", kun: "き.める", radicals: "Thủy (氵)", tipImg: "Dòng nước quyết liệt.", tipSoundOn: "**Ket**tei quyết định.", tipSoundKun: "**Ki**maru được quyết định.", words: [{w:"決まる (きまる)", m:"Được quyết định"}] },
            "騒": { hanviet: "TAO", mean: "Ồn ào", on: "ソウ", kun: "さわ.ぐ", radicals: "Mã (馬) + Trảo (蚤)", tipImg: "Ngựa (馬) bị bọ chét (蚤) cắn làm ồn.", tipSoundOn: "**Sou**on tiếng ồn.", tipSoundKun: "**Sawa**gu làm ồn.", words: [{w:"騒ぐ (さわぐ)", m:"Làm ồn"}] },
            "知": { hanviet: "TRI", mean: "Biết", on: "チ", kun: "し.る", radicals: "Thỉ (矢) + Khẩu (口)", tipImg: "Miệng (口) nói nhanh như tên (矢) là biết.", tipSoundOn: "**Chi**shiki tri thức.", tipSoundKun: "**Shi**raseru thông báo.", words: [{w:"知らせる (しらせる)", m:"Thông báo"}] },
            "頼": { hanviet: "LẠI", mean: "Nhờ cậy", on: "ライ", kun: "たの.む", radicals: "Thúc (束) + Hiệt (頁)", tipImg: "Bó (束) đầu (頁) lại nhờ vả.", tipSoundOn: "Shin**rai** tin cậy.", tipSoundKun: "**Tano**mu nhờ.", words: [{w:"頼む (たのむ)", m:"Nhờ vả"}] },
            "疲": { hanviet: "BÌ", mean: "Mệt mỏi", on: "ヒ", kun: "つか.れる", radicals: "Nạch (疒) + Bì (皮)", tipImg: "Bệnh (疒) ngoài da (皮) mệt mỏi.", tipSoundOn: "**Hi**rou mệt mỏi.", tipSoundKun: "**Tsuka**reru mệt.", words: [{w:"疲れる (つかれる)", m:"Mệt"}] },
            "違": { hanviet: "VI", mean: "Sai/Khác", on: "イ", kun: "ちが.う", radicals: "Xước (⻌)", tipImg: "Đi trái đường.", tipSoundOn: "**I**han vi phạm.", tipSoundKun: "**Chiga**u khác/sai.", words: [{w:"違う (ちがう)", m:"Khác/Sai"}] },
            "始": { hanviet: "THỦY", mean: "Bắt đầu", on: "シ", kun: "はじ.める", radicals: "Nữ (女) + Đài (台)", tipImg: "Người nữ (女) đứng trên đài (台) bắt đầu.", tipSoundOn: "Kai**shi** khai thủy.", tipSoundKun: "**Haji**meru bắt đầu.", words: [{w:"始める (はじめる)", m:"Bắt đầu"}] },
            "別": { hanviet: "BIỆT", mean: "Chia tay/Khác", on: "ベツ", kun: "わか.れる", radicals: "Đao (刂)", tipImg: "Dùng dao (刂) chia biệt.", tipSoundOn: "ToKu**betsu** đặc biệt.", tipSoundKun: "**Waka**reru chia tay.", words: [{w:"別れる (わかれる)", m:"Chia tay"}] },
            "喜": { hanviet: "HỈ", mean: "Vui mừng", on: "キ", kun: "よろこ.ぶ", radicals: "Cát (吉)", tipImg: "Trống đánh vui mừng.", tipSoundOn: "", tipSoundKun: "**Yoroko**bu vui mừng.", words: [{w:"喜ぶ (よろこぶ)", m:"Vui mừng"}, {w:"喜ばせる (よろこばせる)", m:"Làm vui"}] },
            "続": { hanviet: "TỤC", mean: "Tiếp tục", on: "ゾク", kun: "つづ.く", radicals: "Mịch (糸) + Mại (売)", tipImg: "Sợi chỉ (糸) bán (売) tiếp.", tipSoundOn: "Kei**zoku** kế tục.", tipSoundKun: "**Tsuzu**ku tiếp tục.", words: [{w:"続く (つづく)", m:"Tiếp tục"}] },
            "暮": { hanviet: "MỘ", mean: "Lặn/Sinh sống", on: "ボ", kun: "く.れる", radicals: "Thảo (艹) + Nhật (日)", tipImg: "Mặt trời lặn sau cỏ.", tipSoundOn: "", tipSoundKun: "**Ku**reru lặn.", words: [{w:"暮れる (くれる)", m:"Lặn (mặt trời)"}] },
            "分": { hanviet: "PHÂN", mean: "Phân chia", on: "ブン, フン", kun: "わ.ける", radicals: "Đao (刀) + Bát (八)", tipImg: "Dao (刀) chia tám (八) phần.", tipSoundOn: "**Bun**betsu phân loại.", words: [{w:"分別 (ぶんべつ)", m:"Phân loại"}] },
            "勝": { hanviet: "THẮNG", mean: "Thắng", on: "ショウ", kun: "か.つ", radicals: "Lực (力)", tipImg: "Dùng sức mạnh chiến thắng.", tipSoundOn: "Yuui**shou** vô địch.", tipSoundKun: "**Ka**tsu thắng.", words: [{w:"優勝 (ゆうしょう)", m:"Vô địch"}] },
            "笑": { hanviet: "TIẾU", mean: "Cười", on: "ショウ", kun: "わら.う", radicals: "Trúc (竹) + Yểu (夭)", tipImg: "Trúc non cười.", tipSoundOn: "Bi**shou** mỉm cười.", tipSoundKun: "**Wara**u cười.", words: [{w:"笑う (わらう)", m:"Cười"}] },
            "驚": { hanviet: "KINH", mean: "Kinh ngạc", on: "キョウ", kun: "おどろ.く", radicals: "Mã (馬) + Kính (敬)", tipImg: "Ngựa (馬) kính (敬) sợ kinh ngạc.", tipSoundOn: "", tipSoundKun: "**Odoro**ku ngạc nhiên.", words: [{w:"驚く (おどろく)", m:"Kinh ngạc"}] },
            "怒": { hanviet: "NỘ", mean: "Giận", on: "ド", kun: "おこ.る", radicals: "Tâm (心) + Nô (奴)", tipImg: "Tâm (心) nô (奴) lệ giận dữ.", tipSoundOn: "Geki**do** kịch nộ.", tipSoundKun: "**Oko**ru giận.", words: [{w:"怒る (おこる)", m:"Nổi giận"}] },
            "殺": { hanviet: "SÁT", mean: "Giết", on: "サツ", kun: "ころ.す", radicals: "Thù (殳)", tipImg: "Cầm gậy (殳) giết.", tipSoundOn: "**Satsu**jin sát nhân.", tipSoundKun: "**Koro**su giết.", words: [{w:"殺人 (さつじん)", m:"Sát nhân"}] },
            "幸": { hanviet: "HẠNH", mean: "Hạnh phúc", on: "コウ", kun: "しあわ.せ", radicals: "Can (干)", tipImg: "May mắn.", tipSoundOn: "Fu**kou** bất hạnh.", tipSoundKun: "**Shiawa**se hạnh phúc.", words: [{w:"幸せ (しあわせ)", m:"Hạnh phúc"}] },
            "得": { hanviet: "ĐẮC", mean: "Được/Giỏi", on: "トク", kun: "え.る", radicals: "Xích (彳)", tipImg: "Đi thu đắc lợi.", tipSoundOn: "**Toku**i giỏi/đắc ý.", tipSoundKun: "**E**ru đạt được.", words: [{w:"得意 (とくい)", m:"Giỏi"}] },
            "苦": { hanviet: "KHỔ", mean: "Đắng/Khổ", on: "ク", kun: "にが.て", radicals: "Thảo (艹) + Cổ (古)", tipImg: "Cỏ (艹) cũ (古) ăn đắng.", tipSoundOn: "**Ku**rou gian khổ.", tipSoundKun: "**Niga**te kém.", words: [{w:"苦手 (にがて)", m:"Kém"}, {w:"苦しい (くるしい)", m:"Khổ cực"}] },
            "熱": { hanviet: "NHIỆT", mean: "Nóng/Nhiệt tình", on: "ネツ", kun: "あつ.い", radicals: "Hỏa (灬)", tipImg: "Lửa đốt nóng.", tipSoundOn: "**Nes**shin nhiệt tình.", tipSoundKun: "**Atsu**i nóng.", words: [{w:"熱心 (ねっしん)", m:"Nhiệt tình"}] },
            "認": { hanviet: "NHẬN", mean: "Thừa nhận", on: "ニン", kun: "みと.める", radicals: "Ngôn (言) + Nhẫn (忍)", tipImg: "Nói (言) lời nhẫn (忍) nhịn thừa nhận.", tipSoundOn: "Kaku**nin** xác nhận.", tipSoundKun: "**Mitome**ru thừa nhận.", words: [{w:"認め (みとめ)", m:"Thừa nhận"}] },
            "昇": { hanviet: "THĂNG", mean: "Thăng tiến", on: "ショウ", kun: "のぼ.る", radicals: "Nhật (日) + Thăng (升)", tipImg: "Mặt trời (日) thăng (升) lên.", tipSoundOn: "**Shou**shin thăng tiến.", words: [{w:"昇進 (しょうしん)", m:"Thăng tiến"}] },
            "夢": { hanviet: "MỘNG", mean: "Giấc mơ", on: "ム", kun: "ゆめ", radicals: "Mịch (夕)", tipImg: "Mơ trong đêm (夕).", tipSoundOn: "**Mu**chuu say mê.", tipSoundKun: "**Yume** giấc mơ.", words: [{w:"夢中 (むちゅう)", m:"Say mê"}] },
            "観": { hanviet: "QUAN", mean: "Quan sát", on: "カン", kun: "み.る", radicals: "Kiến (見)", tipImg: "Nhìn (見) quan sát.", tipSoundOn: "**Kan**kyaku khán giả.", words: [{w:"観客 (かんきゃく)", m:"Khán giả"}] },
            "退": { hanviet: "THOÁI", mean: "Rút lui", on: "タイ", kun: "しりぞ.く", radicals: "Xước (⻌)", tipImg: "Rút lui.", tipSoundOn: "**Tai**kutsu chán.", words: [{w:"退屈 (たいくつ)", m:"Chán ngắt"}] },
            "屈": { hanviet: "KHUẤT", mean: "Khuất phục", on: "クツ", kun: "", radicals: "Thi (尸) + Xuất (出)", tipImg: "Ra (出) khỏi xác (尸) khuất phục.", tipSoundOn: "Tai**kutsu** chán.", words: [{w:"退屈 (たいくつ)", m:"Chán ngắt"}] },
            "健": { hanviet: "KIỆN", mean: "Khỏe mạnh", on: "ケン", kun: "すこ.やか", radicals: "Nhân (亻) + Kiến (建)", tipImg: "Người (亻) xây dựng (建) sức khỏe.", tipSoundOn: "**Ken**kou sức khỏe.", words: [{w:"健康 (けんこう)", m:"Sức khỏe"}] },
            "康": { hanviet: "KHANG", mean: "An khang", on: "コウ", kun: "", radicals: "Nghiễm (广)", tipImg: "An khang trong nhà rộng.", tipSoundOn: "Ken**kou** sức khỏe.", words: [{w:"健康 (けんこう)", m:"Sức khỏe"}] },
            "悪": { hanviet: "ÁC", mean: "Xấu/Ác", on: "アク", kun: "わる.い", radicals: "Tâm (心)", tipImg: "Tâm xấu.", tipSoundOn: "Sai**aku** tệ nhất.", tipSoundKun: "**Waru**guchi nói xấu.", words: [{w:"悪口 (わるぐち)", m:"Nói xấu"}] },
            "悔": { hanviet: "HỐI", mean: "Hối hận", on: "カイ", kun: "くや.しい", radicals: "Tâm (忄) + Mỗi (每)", tipImg: "Tâm (忄) mỗi (每) ngày đều hối hận.", tipSoundOn: "Kou**kai** hối hận.", tipSoundKun: "**Kuya**shii cay cú.", words: [{w:"悔しい (くやしい)", m:"Cay cú"}] },
            "羨": { hanviet: "TIỆN", mean: "Ghen tị", on: "セン", kun: "うらや.ましい", radicals: "Dương (羊)", tipImg: "Thèm muốn con cừu (羊).", tipSoundOn: "", tipSoundKun: "**Uraya**mashii ghen tị.", words: [{w:"羨ましい (うらやましい)", m:"Ghen tị"}] },
            "才": { hanviet: "TÀI", mean: "Tài năng", on: "サイ", kun: "", radicals: "Thủ (扌)", tipImg: "Tài năng.", tipSoundOn: "**Sai**nou tài năng.", words: [{w:"才能 (さいのう)", m:"Tài năng"}] },
            "能": { hanviet: "NĂNG", mean: "Khả năng", on: "ノウ", kun: "", radicals: "Nhục (月)", tipImg: "Khả năng cơ thể.", tipSoundOn: "Sai**nou** tài năng.", words: [{w:"才能 (さいのう)", m:"Tài năng"}] },
            "豊": { hanviet: "PHONG", mean: "Phong phú", on: "ホウ", kun: "ゆた.か", radicals: "Đậu (豆)", tipImg: "Đậu (豆) chất đầy núi (山) phong phú.", tipSoundOn: "**Hou**fu phong phú.", tipSoundKun: "**Yuta**ka giàu có.", words: [{w:"豊か (ゆたか)", m:"Phong phú"}] },
            "蚊": { hanviet: "VĂN", mean: "Con muỗi", on: "ブン", kun: "か", radicals: "Trùng (虫) + Văn (文)", tipImg: "Côn trùng (虫) có hoa văn (文) là muỗi.", tipSoundOn: "", tipSoundKun: "**Ka** muỗi.", words: [{w:"蚊 (か)", m:"Muỗi"}] },
            "首": { hanviet: "THỦ", mean: "Cổ/Đầu", on: "シュ", kun: "くび", radicals: "Thủ (首)", tipImg: "Cái đầu.", tipSoundOn: "**Shu**to thủ đô.", tipSoundKun: "**Kubi** cổ.", words: [{w:"首 (くび)", m:"Cổ"}] },
            "痒": { hanviet: "DƯƠNG", mean: "Ngứa", on: "ヨウ", kun: "かゆ.い", radicals: "Nạch (疒) + Dương (羊)", tipImg: "Bệnh (疒) do lông cừu (羊) gây ngứa.", tipSoundOn: "", tipSoundKun: "**Kayu**i ngứa.", words: [{w:"痒い (かゆい)", m:"Ngứa"}] },
            "我": { hanviet: "NGÃ", mean: "Tôi/Ta", on: "ガ", kun: "われ", radicals: "Qua (戈)", tipImg: "Tay cầm qua (戈) tự vệ.", tipSoundOn: "**Ga**man chịu đựng.", tipSoundKun: "**Ware** ta.", words: [{w:"我慢 (がまん)", m:"Chịu đựng"}, {w:"我儘 (わがまま)", m:"Ích kỷ"}] },
            "慢": { hanviet: "MẠN", mean: "Ngạo mạn/Chậm", on: "マン", kun: "", radicals: "Tâm (忄) + Mạn (曼)", tipImg: "Tâm (忄) kiêu ngạo.", tipSoundOn: "Ga**man** chịu đựng.", words: [{w:"自慢 (じまん)", m:"Tự mãn"}] },
            "儘": { hanviet: "TẪN", mean: "Cứ để nguyên", on: "ジン", kun: "まま", radicals: "Nhân (亻) + Tận (盡)", tipImg: "Người (亻) tận (盡) lực cứ làm theo ý mình.", tipSoundOn: "", tipSoundKun: "Waga**mama** ích kỷ.", words: [{w:"気儘 (きまま)", m:"Tùy ý"}] },
            "積": { hanviet: "TÍCH", mean: "Tích tụ", on: "セキ", kun: "つ.む", radicals: "Hòa (禾) + Trách (責)", tipImg: "Lúa (禾) chất đống là trách (責) nhiệm.", tipSoundOn: "**Sek**kyoku tích cực.", tipSoundKun: "**Tsu**mu chất.", words: [{w:"積極的 (せっきょくてき)", m:"Tích cực"}] },
            "極": { hanviet: "CỰC", mean: "Cực độ/Rất", on: "キョク", kun: "きわ.める", radicals: "Mộc (木) + Cức (亟)", tipImg: "Cây (木) mọc nhanh cực (亟) độ.", tipSoundOn: "Sek**kyoku** tích cực.", tipSoundKun: "**Kiwa**meru bồi dưỡng.", words: [{w:"消極的 (しょうきょくてき)", m:"Tiêu cực"}] },
            "消": { hanviet: "TIÊU", mean: "Tiêu diệt/Tắt", on: "ショウ", kun: "き.える", radicals: "Thủy (氵) + Tiếu (肖)", tipImg: "Nước (氵) làm tan biến (肖).", tipSoundOn: "**Shou**kyoku tiêu cực.", tipSoundKun: "**Ki**eru tắt.", words: [{w:"消化 (しょうか)", m:"Tiêu hóa"}] },
            "満": { hanviet: "MÃN", mean: "Thỏa mãn/Đầy", on: "マン", kun: "み.ちる", radicals: "Thủy (氵)", tipImg: "Nước tràn đầy.", tipSoundOn: "**Man**zoku thỏa mãn.", tipSoundKun: "**Mi**chiru đầy.", words: [{w:"満足 (まんぞく)", m:"Hài lòng"}, {w:"不満 (ふまん)", m:"Bất mãn"}] },
            "不": { hanviet: "BẤT", mean: "Không", on: "フ, ブ", kun: "", radicals: "Nhất (一)", tipImg: "Chim bay lên trời không quay lại.", tipSoundOn: "**Fu**an bất an.", words: [{w:"不満 (ふまん)", m:"Bất mãn"}, {w:"不安 (ふあん)", m:"Bất an"}] },
            "変": { hanviet: "BIẾN", mean: "Thay đổi/Lạ", on: "ヘン", kun: "か.わる", radicals: "Phốc (攵)", tipImg: "Thay đổi.", tipSoundOn: "Tai**hen** vất vả.", tipSoundKun: "**Ka**waru thay đổi.", words: [{w:"大変 (たいへん)", m:"Vất vả"}] }
        };

        // --- 4. APP LOGIC ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }

        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }

        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
