<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Ti·∫øng Nh·∫≠t Si√™u T·ªëc - Ng√†y 24</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .jp-font {
            font-family: 'Noto Sans JP', sans-serif;
        }
        ruby rt {
            font-size: 0.7em;
            font-weight: 500;
            user-select: none;
        }
        .hide-furigana ruby rt {
            visibility: hidden;
        }
        .transition-height {
            transition: max-height 0.5s ease-in-out;
        }
        .correct-char { color: #16a34a; }
        .incorrect-char { color: #dc2626; text-decoration: underline; }
        
        /* --- NEW STYLES FOR UPGRADES --- */
        /* Progress Bar */
        .progress-bar-container {
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: #22c55e; /* green-500 */
            transition: width 0.5s ease-in-out;
        }
        /* Fade transition for conversation */
        .content-fade {
            transition: opacity 0.3s ease-in-out;
        }
        .fading-out {
            opacity: 0;
        }
        /* Quiz feedback icons */
        .feedback-icon {
            display: inline-block;
            margin-right: 0.5rem;
            font-weight: bold;
        }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-sky-700 jp-font" id="main-title"></h1>
            <p class="text-gray-500 mt-2">B√†i h·ªçc v·ªÅ h√†nh ƒë·ªông theo m·∫´u v√† c√°c c·∫•u tr√∫c so s√°nh.</p>
        </header>

        <!-- Progress Bar Section -->
        <div class="mb-8">
            <h3 class="font-bold text-center mb-2">Ti·∫øn ƒë·ªô b√†i h·ªçc</h3>
            <div class="progress-bar-container w-full h-4">
                <div id="lesson-progress-bar" class="progress-bar h-full text-xs text-white text-center" style="width: 0%;"></div>
            </div>
        </div>

        <main class="space-y-8">
            <!-- Settings Panel -->
            <div class="bg-white p-4 rounded-xl shadow-md border border-gray-200">
                <h3 class="font-bold text-lg mb-3 text-gray-700">B·∫£ng ƒëi·ªÅu khi·ªÉn</h3>
                <div class="flex flex-wrap gap-4">
                    <button id="toggle-furigana" class="toggle-btn">B·∫≠t Furigana</button>
                    <button id="toggle-romaji" class="toggle-btn">Hi·ªán Romaji</button>
                    <button id="toggle-vietnamese" class="toggle-btn">Hi·ªán Ti·∫øng Vi·ªát</button>
                </div>
            </div>

            <!-- Conversation Section -->
            <section id="conversation-section" class="lesson-section"></section>

            <!-- Reading Section -->
            <section id="reading-section" class="lesson-section"></section>

            <!-- Grammar Section -->
            <section id="grammar-section" class="lesson-section"></section>
            
            <!-- Quiz Section -->
            <section id="quiz-section" class="lesson-section"></section>
        </main>

        <footer class="text-center mt-12 text-gray-400 text-sm">
            <p>Copyright by AzaCan, 2025</p>
        </footer>
    </div>

    <script>
        // --- DATA FOR DAY 24 ---
        const day24Data = {
            title: "Ng√†y 24: Theo m·∫´u v√† Ti·ªán th·ªÉ",
            conversation: {
                id: 'conversation',
                title: "‰ªäÊó•„ÅÆ‰ºöË©± (H·ªôi tho·∫°i trong ng√†y)",
                context: "B·ªëi c·∫£nh: Tanaka v√† Suzuki n√≥i v·ªÅ vi·ªác ƒëi mua s·∫Øm.",
                modes: {
                    polite: {
                        name: "Th·ªÉ l·ªãch s·ª± (‰∏ÅÂØßÂΩ¢)",
                        dialogue: [
                            { speaker: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åï„Çì„ÄÅË≤∑[„Åã]„ÅÑÁâ©[„ÇÇ„ÅÆ]„Å´Ë°å[„ÅÑ]„Åè„Å§„ÅÑ„Åß„Å´„ÄÅ„Åì„ÅÆÊâãÁ¥ô[„Å¶„Åå„Åø]„ÇíÂá∫[„Å†]„Åó„Å¶„Åè„Çå„Åæ„Åõ„Çì„Åã„ÄÇ", romaji: "Suzuki-san, kaimono ni iku tsuide ni, kono tegami o dashite kuremasen ka.", vi: "Anh Suzuki, nh√¢n ti·ªán ƒëi mua s·∫Øm, anh g·ª≠i gi√∫p t√¥i l√° th∆∞ n√†y ƒë∆∞·ª£c kh√¥ng?" },
                            { speaker: "Suzuki", jp: "„ÅØ„ÅÑ„ÄÅ„ÅÑ„ÅÑ„Åß„Åô„Çà„ÄÇ‰∫àÊÉ≥[„Çà„Åù„ÅÜ]„Å©„Åä„Çä„ÄÅ‰ªäÊó•[„Åç„Çá„ÅÜ]„ÅØ‰∫∫[„Å≤„Å®]„ÅåÂ§ö[„Åä„Åä]„ÅÑ„Åß„Åô„Å≠„ÄÇ", romaji: "Hai, ii desu yo. Yosou doori, kyou wa hito ga ooi desu ne.", vi: "V√¢ng, ƒë∆∞·ª£c ch·ª©. ƒê√∫ng nh∆∞ d·ª± ƒëo√°n, h√¥m nay ƒë√¥ng ng∆∞·ªùi qu√° nh·ªâ." },
                            { speaker: "Tanaka", jp: "„Åà„Åà„ÄÇ„Åì„Çì„Å™„Å´Ê∑∑[„Åì]„Çì„Åß„ÅÑ„ÇãÂ∫ó[„Åø„Åõ]„ÅßÂæÖ[„Åæ]„Å§„Åè„Çâ„ÅÑ„Å™„Çâ„ÄÅÂ∏∞[„Åã„Åà]„Çä„Åü„ÅÑ„Åß„Åô„ÄÇ", romaji: "Ee. Konna ni konde iru mise de matsu kurai nara, kaeritai desu.", vi: "V√¢ng. N·∫øu ph·∫£i ch·ªù ·ªü m·ªôt c·ª≠a h√†ng ƒë√¥ng nh∆∞ th·∫ø n√†y th√¨ t√¥i th√† v·ªÅ c√≤n h∆°n." },
                            { speaker: "Suzuki", jp: "ÂàÜ[„Çè]„Åã„Çä„Åæ„Åô„ÄÇ„Åß„ÇÇ„ÄÅÊù•[„Åè]„Çã„Åü„Å≥„Å´Êñ∞[„ÅÇ„Åü„Çâ]„Åó„ÅÑÂïÜÂìÅ[„Åó„Çá„ÅÜ„Å≤„Çì]„ÅåÂá∫[„Åß]„Å¶„ÅÑ„Å¶„ÄÅË¶ã[„Åø]„Çã„Å†„Åë„Åß„ÇÇÊ•Ω[„Åü„ÅÆ]„Åó„ÅÑ„Åß„Åô„Çà„ÄÇ", romaji: "Wakarimasu. Demo, kuru tabi ni atarashii shouhin ga dete ite, miru dake demo tanoshii desu yo.", vi: "T√¥i hi·ªÉu. Nh∆∞ng c·ª© m·ªói l·∫ßn ƒë·∫øn l·∫°i c√≥ s·∫£n ph·∫©m m·ªõi ra, ch·ªâ ng·∫Øm th√¥i c≈©ng vui r·ªìi." },
                            { speaker: "Tanaka", jp: "„Åù„Çå„ÅØÂãß[„Åô„Åô]„ÇÅ„Å¶„ÅÑ„Çã„Å®„ÅÑ„ÅÜ„Çà„Çä„ÄÅË≤∑[„Åã]„Çè„Åõ„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„Åã„ÄÇ", romaji: "Sore wa susumete iru to iu yori, kawaseyou to shite imasen ka.", vi: "C√°i ƒë√≥ n√≥i l√† ƒëang g·ª£i √Ω th√¨ ƒë√∫ng h∆°n l√† ƒëang c·ªë l√†m cho t√¥i mua ph·∫£i kh√¥ng?" },
                            { speaker: "Suzuki", jp: "„ÅØ„ÅØ„ÅØ„ÄÅ„Éê„É¨„Åæ„Åó„Åü„Åã„ÄÇ„Åß„ÇÇ„ÄÅ„É™„Éº„Åï„Çì„Åê„Çâ„ÅÑË≤∑[„Åã]„ÅÑÁâ©[„ÇÇ„ÅÆ]Â•Ω[„Åö]„Åç„Å™‰∫∫[„Å≤„Å®]„ÅØ„ÅÑ„Å™„ÅÑ„Å®Ë®Ä[„ÅÑ]„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„Çà„ÄÇ", romaji: "Hahaha, baremashita ka. Demo, Rii-san gurai kaimono zuki na hito wa inai to iwarete imasu yo.", vi: "Hahaha, b·ªã ph√°t hi·ªán r·ªìi √†. Nh∆∞ng ng∆∞·ªùi ta n√≥i r·∫±ng kh√¥ng c√≥ ai th√≠ch mua s·∫Øm b·∫±ng c√¥ Ly ƒë√¢u." }
                        ]
                    },
                    casual: {
                        name: "Th·ªÉ th√¥ng th∆∞·ªùng (ÊôÆÈÄöÂΩ¢)",
                        dialogue: [
                            { speaker: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åè„Çì„ÄÅË≤∑[„Åã]„ÅÑÁâ©[„ÇÇ„ÅÆ]„Å´Ë°å[„ÅÑ]„Åè„Å§„ÅÑ„Åß„Å´„ÄÅ„Åì„ÅÆÊâãÁ¥ô[„Å¶„Åå„Åø]Âá∫[„Å†]„Åó„Å¶„Åè„Çå„Å™„ÅÑÔºü", romaji: "Suzuki-kun, kaimono ni iku tsuide ni, kono tegami dashite kurenai?", vi: "Suzuki, ti·ªán ƒëi mua ƒë·ªì th√¨ g·ª≠i h·ªô t·ªõ l√° th∆∞ n√†y ƒë∆∞·ª£c kh√¥ng?" },
                            { speaker: "Suzuki", jp: "„ÅÜ„Çì„ÄÅ„ÅÑ„ÅÑ„Çà„ÄÇ‰∫àÊÉ≥[„Çà„Åù„ÅÜ]„Å©„Åä„Çä„ÄÅ‰ªäÊó•[„Åç„Çá„ÅÜ]„ÅØ‰∫∫[„Å≤„Å®]„ÅåÂ§ö[„Åä„Åä]„ÅÑ„Å≠„ÄÇ", romaji: "Un, ii yo. Yosou doori, kyou wa hito ga ooi ne.", vi: "·ª™, ƒë∆∞·ª£c th√¥i. ƒê√∫ng nh∆∞ d·ª± ƒëo√°n, h√¥m nay ƒë√¥ng ng∆∞·ªùi gh√™." },
                            { speaker: "Tanaka", jp: "„Å†„Å≠„ÄÇ„Åì„Çì„Å™„Å´Ê∑∑[„Åì]„Çì„Åß„ÇãÂ∫ó[„Åø„Åõ]„ÅßÂæÖ[„Åæ]„Å§„Åè„Çâ„ÅÑ„Å™„Çâ„ÄÅÂ∏∞[„Åã„Åà]„Çä„Åü„ÅÑ„Çà„ÄÇ", romaji: "Da ne. Konna ni konderu mise de matsu kurai nara, kaeritai yo.", vi: "C√¥ng nh·∫≠n. N·∫øu ph·∫£i ch·ªù ·ªü qu√°n ƒë√¥ng th·∫ø n√†y, th√† v·ªÅ c√≤n h∆°n." },
                            { speaker: "Suzuki", jp: "ÂàÜ[„Çè]„Åã„Çã„ÄÇ„Åß„ÇÇ„ÄÅÊù•[„Åè]„Çã„Åü„Å≥„Å´Êñ∞[„ÅÇ„Åü„Çâ]„Åó„ÅÑÂïÜÂìÅ[„Åó„Çá„ÅÜ„Å≤„Çì]„ÅåÂá∫[„Åß]„Å¶„Å¶„ÄÅË¶ã[„Åø]„Çã„Å†„Åë„Åß„ÇÇÊ•Ω[„Åü„ÅÆ]„Åó„ÅÑ„Åò„ÇÉ„Çì„ÄÇ", romaji: "Wakaru. Demo, kuru tabi ni atarashii shouhin ga detete, miru dake demo tanoshii jan.", vi: "T·ªõ hi·ªÉu. Nh∆∞ng m·ªói l·∫ßn ƒë·∫øn l·∫°i c√≥ ƒë·ªì m·ªõi, ng·∫Øm th√¥i c≈©ng vui m√†." },
                            { speaker: "Tanaka", jp: "„Åù„Çå„Å£„Å¶Âãß[„Åô„Åô]„ÇÅ„Å¶„Çã„Å£„Å¶„ÅÑ„ÅÜ„Çà„Çä„ÄÅË≤∑[„Åã]„Çè„Åõ„Çà„ÅÜ„Å®„Åó„Å¶„Å™„ÅÑÔºü", romaji: "Sorette susumeteru tte iu yori, kawaseyou to shitenai?", vi: "C·∫≠u n√≥i v·∫≠y l√† g·ª£i √Ω hay l√† ƒëang c·ªë d·ª• t·ªõ mua ƒë·∫•y?" },
                            { speaker: "Suzuki", jp: "„ÅØ„ÅØ„ÅØ„ÄÅ„Éê„É¨„Åü„Åã„ÄÇ„Åß„ÇÇ„ÄÅ„É™„Éº„Åï„Çì„Åê„Çâ„ÅÑË≤∑[„Åã]„ÅÑÁâ©[„ÇÇ„ÅÆ]Â•Ω[„Åö]„Åç„ÅØ„ÅÑ„Å™„ÅÑ„Å£„Å¶Ë®Ä[„ÅÑ]„Çè„Çå„Å¶„Çã„Çà„ÄÇ", romaji: "Hahaha, bareta ka. Demo, Rii-san gurai kaimono zuki wa inai tte iwareteru yo.", vi: "Hahaha, l·ªô r·ªìi √†. Nh∆∞ng ng∆∞·ªùi ta b·∫£o l√†m g√¨ c√≥ ai th√≠ch mua s·∫Øm b·∫±ng Ly ƒë√¢u." }
                        ]
                    }
                }
            },
            reading: {
                id: 'reading',
                title: "‰ªäÊó•„ÅÆË™≠„ÅøÁâ© (B√†i ƒë·ªçc ng·∫Øn)",
                content: {
                    jp: "ÁßÅ[„Çè„Åü„Åó]„ÅØÊóÖË°å[„Çä„Çá„Åì„ÅÜ]„Å´Ë°å[„ÅÑ]„Åè„Åü„Å≥„Å´„ÄÅ„ÅäÂúüÁî£[„Åø„ÇÑ„Åí]„ÇíË≤∑[„Åã]„ÅÑ„Åæ„Åô„ÄÇÂÖàÊó•[„Åõ„Çì„Åò„Å§]„ÅÆÊóÖË°å[„Çä„Çá„Åì„ÅÜ]„ÅÆ„Å§„ÅÑ„Åß„Å´„ÄÅÂèã‰∫∫[„ÇÜ„ÅÜ„Åò„Çì]„Å∏„ÅÆ„Éó„É¨„Çº„É≥„Éà„ÇÇË≤∑[„Åã]„ÅÑ„Åæ„Åó„Åü„ÄÇË®àÁîª[„Åë„ÅÑ„Åã„Åè]„Å©„Åä„Çä„ÄÅ„Å®„Å¶„ÇÇÊ•Ω[„Åü„ÅÆ]„Åó„ÅÑÊóÖË°å[„Çä„Çá„Åì„ÅÜ]„Åß„Åó„Åü„ÄÇÂΩº[„Åã„Çå]„ÅÆÊñôÁêÜ[„Çä„Çá„ÅÜ„Çä]„ÅØ„ÄÅ„Åä„ÅÑ„Åó„ÅÑ„Å®„ÅÑ„ÅÜ„Çà„ÇäËä∏Ë°ìÁöÑ[„Åí„ÅÑ„Åò„ÇÖ„Å§„Å¶„Åç]„Åß„Åô„ÄÇ„Åæ„Åö„ÅÑ„ÇÇ„ÅÆ„ÇíÈ£ü[„Åü]„Åπ„Çã„Åè„Çâ„ÅÑ„Å™„Çâ„ÄÅ‰Ωï[„Å™„Å´]„ÇÇÈ£ü[„Åü]„Åπ„Å™„ÅÑ„Åª„ÅÜ„Åå„Åæ„Åó„Åß„Åô„ÄÇÁ¥çË±Ü[„Å™„Å£„Å®„ÅÜ]„ÅØ‰Ωì[„Åã„Çâ„Å†]„Å´„ÅÑ„ÅÑ„Å®Ë®Ä[„ÅÑ]„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÁßÅ[„Çè„Åü„Åó]„ÅØ„ÅÇ„Åæ„ÇäÂ•Ω[„Åô]„Åç„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
                    romaji: "Watashi wa ryokou ni iku tabi ni, omiyage o kaimasu. Senjitsu no ryokou no tsuide ni, yuujin e no purezento mo kaimashita. Keikaku doori, totemo tanoshii ryokou deshita. Kare no ryouri wa, oishii to iu yori geijutsuteki desu. Mazui mono o taberu kurai nara, nani mo tabenai hou ga mashi desu. Nattou wa karada ni ii to iwarete imasu ga, watashi wa amari suki de wa arimasen.",
                    vi: "C·ª© m·ªói l·∫ßn ƒëi du l·ªãch, t√¥i l·∫°i mua qu√† l∆∞u ni·ªám. Nh√¢n ti·ªán chuy·∫øn ƒëi h√¥m tr∆∞·ªõc, t√¥i c≈©ng ƒë√£ mua qu√† cho b·∫°n th√¢n. ƒê√∫ng nh∆∞ k·∫ø ho·∫°ch, ƒë√≥ l√† m·ªôt chuy·∫øn ƒëi r·∫•t vui. M√≥n ƒÉn c·ªßa anh ·∫•y, n√≥i l√† ngon th√¨ ƒë√∫ng h∆°n l√† c√≥ t√≠nh ngh·ªá thu·∫≠t. N·∫øu ph·∫£i ƒÉn ƒë·ªì d·ªü th√¨ th√† kh√¥ng ƒÉn g√¨ c√≤n h∆°n. Ng∆∞·ªùi ta n√≥i r·∫±ng natto t·ªët cho s·ª©c kh·ªèe, nh∆∞ng t√¥i kh√¥ng th√≠ch n√≥ l·∫Øm."
                }
            },
            grammar: {
                id: 'grammar',
                title: "‰ªäÊó•„ÅÆÊñáÊ≥ï (T·ªïng h·ª£p ng·ªØ ph√°p)",
                points: [
                    { rule: "ÔΩû„Å®„Åä„Çä„Å´ / ÔΩû„Å©„Åä„Çä„Å´", meaning: "Theo ƒë√∫ng nh∆∞...", formula: "V„Çã/V„Åü/N„ÅÆ + „Å®„Åä„Çä„Å´; N + „Å©„Åä„Çä„Å´", example: "Ë™¨ÊòéÊõ∏[„Åõ„Å§„ÇÅ„ÅÑ„Åó„Çá]„ÅÆ„Å®„Åä„Çä„Å´„ÄÅÁµÑ[„Åè]„ÅøÁ´ã[„Åü]„Å¶„Åæ„Åó„Åü„ÄÇ", example_vi: "T√¥i ƒë√£ l·∫Øp r√°p theo ƒë√∫ng nh∆∞ s√°ch h∆∞·ªõng d·∫´n." },
                    { rule: "ÔΩû„Åè„Çâ„ÅÑ„Å™„Çâ", meaning: "N·∫øu ph·∫£i... th√¨ th√†... c√≤n h∆°n", formula: "V„Çã + „Åè„Çâ„ÅÑ„Å™„Çâ", example: "„ÅÇ„Çì„Å™‰∫∫[„Å≤„Å®]„Å®ÂèãÈÅî[„Å®„ÇÇ„Å†„Å°]„Å´„Å™„Çã„Åè„Çâ„ÅÑ„Å™„Çâ„ÄÅ‰∏Ä‰∫∫[„Å≤„Å®„Çä]„ÅÆ„Åª„ÅÜ„Åå„ÅÑ„ÅÑ„ÄÇ", example_vi: "N·∫øu ph·∫£i l√†m b·∫°n v·ªõi ng∆∞·ªùi nh∆∞ th·∫ø th√¨ th√† ·ªü m·ªôt m√¨nh c√≤n h∆°n." },
                    { rule: "ÔΩû„Åü„Å≥„Å´", meaning: "C·ª© m·ªói l·∫ßn...", formula: "V„Çã / N„ÅÆ + „Åü„Å≥„Å´", example: "„Åì„ÅÆÂÜôÁúü[„Åó„ÇÉ„Åó„Çì]„ÇíË¶ã[„Åø]„Çã„Åü„Å≥„Å´„ÄÅÊ•Ω[„Åü„ÅÆ]„Åó„Åã„Å£„Åü„Åì„Å®„ÇíÊÄù[„Åä„ÇÇ]„ÅÑÂá∫[„Å†]„Åó„Åæ„Åô„ÄÇ", example_vi: "C·ª© m·ªói l·∫ßn nh√¨n b·ª©c ·∫£nh n√†y, t√¥i l·∫°i nh·ªõ v·ªÅ nh·ªØng chuy·ªán vui." },
                    { rule: "ÔΩû„Å§„ÅÑ„Åß„Å´", meaning: "Nh√¢n ti·ªán, ti·ªán th·ªÉ", formula: "V„Çã / V„Åü / N„ÅÆ + „Å§„ÅÑ„Åß„Å´", example: "Êï£Ê≠©[„Åï„Çì„ÅΩ]„ÅÆ„Å§„ÅÑ„Åß„Å´„ÄÅ„Åì„ÅÆÊâãÁ¥ô[„Å¶„Åå„Åø]„ÇíÂá∫[„Å†]„Åó„Å¶„Åç„Åæ„Åô„ÄÇ", example_vi: "Nh√¢n ti·ªán ƒëi d·∫°o, t√¥i s·∫Ω ƒëi g·ª≠i l√° th∆∞ n√†y." },
                    { rule: "A „Å®„ÅÑ„ÅÜ„Çà„Çä B", meaning: "N√≥i l√† B th√¨ ƒë√∫ng h∆°n l√† A", formula: "A (th·ªÉ th√¥ng th∆∞·ªùng) + „Å®„ÅÑ„ÅÜ„Çà„Çä + B", example: "‰ªäÊó•[„Åç„Çá„ÅÜ]„ÅØÊ∂º[„Åô„Åö]„Åó„ÅÑ„Å®„ÅÑ„ÅÜ„Çà„ÇäÂØí[„Åï„ÇÄ]„ÅÑ„Åè„Çâ„ÅÑ„Åß„Åô„ÄÇ", example_vi: "H√¥m nay n√≥i l√† m√°t m·∫ª th√¨ ƒë√∫ng h∆°n l√† l·∫°nh." },
                    { rule: "ÔΩû„Å®Ë®Ä„Çè„Çå„Å¶„ÅÑ„Çã", meaning: "Ng∆∞·ªùi ta n√≥i r·∫±ng...", formula: "Th·ªÉ th√¥ng th∆∞·ªùng + „Å®Ë®Ä„Çè„Çå„Å¶„ÅÑ„Çã", example: "„Åì„ÅÆÂú∞Êñπ[„Å°„Åª„ÅÜ]„ÅØ„ÄÅÊòî[„ÇÄ„Åã„Åó]„Åã„ÇâÂú∞Èúá[„Åò„Åó„Çì]„ÅåÂ§ö[„Åä„Åä]„ÅÑ„Å®Ë®Ä[„ÅÑ]„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ", example_vi: "Ng∆∞·ªùi ta n√≥i r·∫±ng v√πng n√†y t·ª´ x∆∞a ƒë√£ c√≥ nhi·ªÅu ƒë·ªông ƒë·∫•t." }
                ]
            },
            quiz: {
                id: 'quiz',
                title: "Á∑¥Áøí„Å®„ÉÜ„Çπ„Éà (Luy·ªán t·∫≠p & Ki·ªÉm tra)",
                questions: [
                    { type: "mcq", question: "ÁßÅ[„Çè„Åü„Åó]„ÅåË®Ä[„ÅÑ]„Å£„ÅüÔºà___Ôºâ„ÄÅ„ÇÑ„Çå„Å∞„Åß„Åç„Åæ„Åô„Çà„ÄÇ", options: ["„Å®„Åä„Çä„Å´", "„Åü„Å≥„Å´", "„Å§„ÅÑ„Åß„Å´"], answer: "„Å®„Åä„Çä„Å´" },
                    { type: "fill", question: "ÂΩº[„Åã„Çå]„Å´Ë¨ù[„ÅÇ„ÇÑ„Åæ]„ÇãÔºà___Ôºâ„ÄÅÊ≠ª[„Åó]„Çì„Å†„Åª„ÅÜ„Åå„Åæ„Åó„Å†„ÄÇ", answer: "„Åè„Çâ„ÅÑ„Å™„Çâ" },
                    { type: "mcq", question: "Ë≤∑[„Åã]„ÅÑÁâ©[„ÇÇ„ÅÆ]„ÅÆÔºà___Ôºâ„ÄÅÂõ≥Êõ∏È§®[„Å®„Åó„Çá„Åã„Çì]„Å´ÂØÑ[„Çà]„Å£„Å¶Êú¨[„Åª„Çì]„ÇíËøî[„Åã„Åà]„Åó„Åæ„Åô„ÄÇ", options: ["„Åü„Å≥„Å´", "„Å§„ÅÑ„Åß„Å´", "„Å®„Åä„Çä„Å´"], answer: "„Å§„ÅÑ„Åß„Å´" },
                    { type: "audio", jp: "Á¥çË±Ü„ÅØ‰Ωì„Å´„ÅÑ„ÅÑ„Å®Ë®Ä„Çè„Çå„Å¶„ÅÑ„Çã„ÄÇ", question: "Nghe v√† g√µ l·∫°i c√¢u b·∫°n v·ª´a nghe:" }
                ]
            }
        };

        // --- STATE MANAGEMENT & SETTINGS ---
        let settings = {
            hideFurigana: false,
            showRomaji: false,
            showVietnamese: false
        };

        let progress = {
            conversation: false,
            reading: false,
            grammar: false,
            quiz: false
        };

        function saveSettings() {
            localStorage.setItem('jpAppSettings_day24', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('jpAppSettings_day24');
            if (saved) {
                settings = JSON.parse(saved);
            }
        }

        function applySettings() {
            // Buttons
            updateToggleButtonUI('toggle-furigana', !settings.hideFurigana, '·∫®n Furigana', 'Hi·ªán Furigana');
            updateToggleButtonUI('toggle-romaji', settings.showRomaji, '·∫®n Romaji', 'Hi·ªán Romaji');
            updateToggleButtonUI('toggle-vietnamese', settings.showVietnamese, '·∫®n Ti·∫øng Vi·ªát', 'Hi·ªán Ti·∫øng Vi·ªát');
            
            // Content
            document.getElementById('app').classList.toggle('hide-furigana', settings.hideFurigana);
            document.querySelectorAll('.romaji-text').forEach(el => el.classList.toggle('hidden', !settings.showRomaji));
            document.querySelectorAll('.vi-text').forEach(el => el.classList.toggle('hidden', !settings.showVietnamese));
        }

        function updateToggleButtonUI(buttonId, isActive, activeText, inactiveText) {
            const button = document.getElementById(buttonId);
            button.textContent = isActive ? activeText : inactiveText;
            button.classList.toggle('bg-sky-500', isActive);
            button.classList.toggle('text-white', isActive);
            button.classList.toggle('bg-gray-200', !isActive);
            button.classList.toggle('text-gray-700', !isActive);
        }

        // --- PROGRESS ---
        function updateProgress(sectionId) {
            if (progress.hasOwnProperty(sectionId) && !progress[sectionId]) {
                progress[sectionId] = true;
                updateProgressBar();
            }
        }

        function updateProgressBar() {
            const completed = Object.values(progress).filter(Boolean).length;
            const total = Object.keys(progress).length;
            const percentage = (completed / total) * 100;
            const bar = document.getElementById('lesson-progress-bar');
            bar.style.width = `${percentage}%`;
            bar.textContent = `${Math.round(percentage)}%`;
        }


        // --- UTILITY FUNCTIONS ---
        function parseFurigana(text) {
            return text.replace(/([^\[\]]+)\[(.+?)\]/g, '<ruby>$1<rt>$2</rt></ruby>');
        }

        function speak(text) {
            speechSynthesis.cancel(); // Stop any previous speech
            const cleanText = text.replace(/\[.*?\]/g, '');
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }

        // --- RENDER FUNCTIONS ---
        function renderConversation() {
            const section = document.getElementById('conversation-section');
            const data = day24Data.conversation;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-1 jp-font">${data.title}</h2>
                    <p class="text-gray-500 mb-4">${data.context}</p>
                    <div class="flex items-center justify-center space-x-2 mb-6 p-1 bg-gray-100 rounded-full">
                        <button id="convo-mode-polite" class="convo-mode-btn flex-1 py-2 px-4 rounded-full bg-sky-600 text-white shadow">Th·ªÉ l·ªãch s·ª±</button>
                        <button id="convo-mode-casual" class="convo-mode-btn flex-1 py-2 px-4 rounded-full">Th·ªÉ th√¥ng th∆∞·ªùng</button>
                    </div>
                    <div id="conversation-content" class="space-y-4 content-fade"></div>
                </div>
            `;
            renderDialogue('polite');
            updateProgress(data.id);
        }
        
        function renderDialogue(mode) {
            const container = document.getElementById('conversation-content');
            const dialogue = day24Data.conversation.modes[mode].dialogue;

            container.innerHTML = dialogue.map((line) => `
                <div class="dialogue-line p-4 rounded-lg bg-gray-50 border">
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 rounded-full ${line.speaker === 'Tanaka' ? 'bg-sky-100' : 'bg-emerald-100'} flex items-center justify-center font-bold text-sky-800">${line.speaker.charAt(0)}</div>
                        <div class="flex-1">
                            <p class="font-bold text-gray-800">${line.speaker}</p>
                            <p class="jp-font text-lg mt-1 leading-relaxed">${parseFurigana(line.jp)}</p>
                            <p class="romaji-text text-sm text-gray-500 mt-1">${line.romaji}</p>
                            <p class="vi-text text-sm text-emerald-700 mt-1">${line.vi}</p>
                            <div class="mt-3 flex items-center space-x-3">
                                <button class="speak-btn" data-text="${line.jp}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                </button>
                                <div class="w-full">
                                    <input type="text" class="typing-input w-full p-2 border rounded-md bg-white text-base" data-correct="${line.jp.replace(/\[.*?\]/g, '')}" placeholder="Luy·ªán g√µ ·ªü ƒë√¢y...">
                                    <div class="typing-feedback text-xs mt-1 h-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            attachEventListenersToRenderedContent(container);
            applySettings();
        }

        function renderReading() {
            const section = document.getElementById('reading-section');
            const data = day24Data.reading;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-2 jp-font">${data.title}</h2>
                    <div class="reading-content p-4 rounded-lg bg-gray-50 border">
                        <p class="jp-font text-lg leading-relaxed">${parseFurigana(data.content.jp)}</p>
                        <p class="romaji-text text-sm text-gray-500 mt-2">${data.content.romaji}</p>
                        <p class="vi-text text-sm text-emerald-700 mt-2">${data.content.vi}</p>
                        <div class="mt-4 flex items-center space-x-3">
                             <button class="speak-btn" data-text="${data.content.jp}">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                             </button>
                             <div class="w-full">
                                 <input type="text" class="typing-input w-full p-2 border rounded-md bg-white text-base" data-correct="${data.content.jp.replace(/\[.*?\]/g, '')}" placeholder="Luy·ªán g√µ ·ªü ƒë√¢y...">
                                 <div class="typing-feedback text-xs mt-1 h-4"></div>
                             </div>
                        </div>
                    </div>
                </div>
            `;
            attachEventListenersToRenderedContent(section);
            updateProgress(data.id);
        }

        function renderGrammar() {
            const section = document.getElementById('grammar-section');
            const data = day24Data.grammar;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 jp-font">${data.title}</h2>
                    <div class="space-y-3">
                        ${data.points.map((point) => `
                            <div class="grammar-point border border-gray-200 rounded-lg overflow-hidden">
                                <button class="grammar-toggle w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100">
                                    <span class="font-bold text-sky-800 jp-font text-lg">${point.rule}</span>
                                    <svg class="w-5 h-5 transform transition-transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                                <div class="grammar-details max-h-0 overflow-hidden transition-height">
                                    <div class="p-4 border-t border-gray-200">
                                        <p><strong>√ù nghƒ©a:</strong> ${point.meaning}</p>
                                        <p><strong>C√¥ng th·ª©c:</strong> <code class="bg-gray-200 text-red-600 px-1 rounded">${point.formula}</code></p>
                                        <div class="mt-2 p-3 bg-sky-50 rounded-md">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="jp-font">${parseFurigana(point.example)}</p>
                                                    <p class="vi-text text-sm text-emerald-700 mt-1">${point.example_vi}</p>
                                                </div>
                                                <button class="speak-btn" data-text="${point.example}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            attachEventListenersToRenderedContent(section);
            updateProgress(data.id);
        }

        function renderQuiz() {
            const section = document.getElementById('quiz-section');
            const data = day24Data.quiz;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 jp-font">${data.title}</h2>
                    <div id="quiz-content" class="space-y-6">
                        ${data.questions.map((q, index) => {
                            if (q.type === 'mcq') {
                                return `
                                    <div class="quiz-question" data-answer="${q.answer}">
                                        <p class="mb-2 jp-font">${index + 1}. ${parseFurigana(q.question)}</p>
                                        <div class="flex flex-col space-y-2">
                                            ${q.options.map(opt => `<button class="mcq-option text-left p-3 border rounded-lg hover:bg-gray-100">${opt}</button>`).join('')}
                                        </div>
                                        <div class="feedback mt-2 text-sm h-5"></div>
                                    </div>
                                `;
                            }
                            if (q.type === 'fill') {
                                return `
                                    <div class="quiz-question" data-answer="${q.answer}">
                                        <p class="mb-2 jp-font">${index + 1}. ${parseFurigana(q.question)}</p>
                                        <input type="text" class="fill-input w-full p-2 border rounded-md">
                                        <div class="feedback mt-2 text-sm h-5"></div>
                                    </div>
                                `;
                            }
                            if (q.type === 'audio') {
                                return `
                                    <div class="quiz-question" data-answer="${q.jp.replace(/\[.*?\]/g, '')}">
                                        <p class="mb-2 jp-font">${index + 1}. ${q.question}</p>
                                        <button class="speak-btn mb-2 flex items-center" data-text="${q.jp}">
                                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-sky-600"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                           <span class="ml-2">Nghe</span>
                                        </button>
                                        <input type="text" class="fill-input w-full p-2 border rounded-md">
                                        <div class="feedback mt-2 text-sm h-5"></div>
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>
                    <button id="check-quiz-btn" class="mt-6 w-full bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition-colors">Ki·ªÉm tra ƒë√°p √°n</button>
                    <div id="quiz-result" class="mt-4 text-center font-bold"></div>
                </div>
            `;
            attachEventListenersToRenderedContent(section);
        }

        // --- EVENT LISTENERS ---
        function attachEventListenersToRenderedContent(container) {
            container.querySelectorAll('.speak-btn').forEach(btn => {
                btn.onclick = () => speak(btn.dataset.text);
            });

            container.querySelectorAll('.typing-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const correctText = e.target.dataset.correct;
                    const userText = e.target.value;
                    const feedbackContainer = e.target.nextElementSibling;
                    let styledText = '';
                    for (let i = 0; i < userText.length; i++) {
                        styledText += `<span class="${userText[i] === correctText[i] ? 'correct-char' : 'incorrect-char'}">${userText[i]}</span>`;
                    }
                    feedbackContainer.innerHTML = styledText;
                    if (userText === correctText) {
                        feedbackContainer.innerHTML = '<span class="text-green-600 font-bold">Ch√≠nh x√°c! üéâ</span>';
                    }
                });
            });
            
            container.querySelectorAll('.grammar-toggle').forEach(button => {
                button.addEventListener('click', () => {
                    const details = button.nextElementSibling;
                    const icon = button.querySelector('svg');
                    if (details.style.maxHeight && details.style.maxHeight !== '0px') {
                        details.style.maxHeight = '0px';
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        details.style.maxHeight = details.scrollHeight + 'px';
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });
        }

        function setupGlobalEventListeners() {
            document.getElementById('toggle-furigana').addEventListener('click', () => {
                settings.hideFurigana = !settings.hideFurigana;
                saveSettings();
                applySettings();
            });
            document.getElementById('toggle-romaji').addEventListener('click', () => {
                settings.showRomaji = !settings.showRomaji;
                saveSettings();
                applySettings();
            });
            document.getElementById('toggle-vietnamese').addEventListener('click', () => {
                settings.showVietnamese = !settings.showVietnamese;
                saveSettings();
                applySettings();
            });

            document.getElementById('convo-mode-polite').addEventListener('click', (e) => {
                const container = document.getElementById('conversation-content');
                container.classList.add('fading-out');
                setTimeout(() => {
                    renderDialogue('polite');
                    container.classList.remove('fading-out');
                    e.target.classList.add('bg-sky-600', 'text-white', 'shadow');
                    document.getElementById('convo-mode-casual').classList.remove('bg-sky-600', 'text-white', 'shadow');
                }, 300);
            });
            document.getElementById('convo-mode-casual').addEventListener('click', (e) => {
                const container = document.getElementById('conversation-content');
                container.classList.add('fading-out');
                setTimeout(() => {
                    renderDialogue('casual');
                    container.classList.remove('fading-out');
                    e.target.classList.add('bg-sky-600', 'text-white', 'shadow');
                    document.getElementById('convo-mode-polite').classList.remove('bg-sky-600', 'text-white', 'shadow');
                }, 300);
            });
            
            document.getElementById('check-quiz-btn').addEventListener('click', () => {
                const questions = document.querySelectorAll('.quiz-question');
                let score = 0;
                questions.forEach(q => {
                    const answer = q.dataset.answer;
                    const feedback = q.querySelector('.feedback');
                    let isCorrect = false;

                    const selectedOption = q.querySelector('.mcq-option.bg-sky-200');
                    if (selectedOption) {
                        isCorrect = selectedOption.textContent === answer;
                        selectedOption.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                    }
                    
                    const input = q.querySelector('.fill-input');
                    if (input) {
                        isCorrect = input.value.trim() === answer;
                        input.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                    }

                    if (isCorrect) {
                        score++;
                        feedback.innerHTML = `<span class="feedback-icon feedback-correct">‚úîÔ∏è</span><span class="text-green-600 font-bold">ƒê√∫ng!</span>`;
                    } else {
                        feedback.innerHTML = `<span class="feedback-icon feedback-incorrect">‚ùå</span><span class="text-red-600 font-bold">Sai! ƒê√°p √°n ƒë√∫ng l√†: ${answer}</span>`;
                    }
                });
                
                document.getElementById('quiz-result').innerHTML = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${score}/${questions.length} c√¢u!`;
                updateProgress(day24Data.quiz.id);
            });
            
            document.querySelectorAll('.mcq-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    opt.parentElement.querySelectorAll('.mcq-option').forEach(sibling => {
                        sibling.classList.remove('bg-sky-200', 'border-sky-500');
                    });
                    opt.classList.add('bg-sky-200', 'border-sky-500');
                });
            });
        }
        
        // --- INITIALIZATION ---
        function init() {
            document.getElementById('main-title').textContent = day24Data.title;
            loadSettings();
            renderConversation();
            renderReading();
            renderGrammar();
            renderQuiz();
            setupGlobalEventListeners();
            applySettings();
            updateProgressBar();
        }

        window.onload = init;
    </script>
</body>
</html>
