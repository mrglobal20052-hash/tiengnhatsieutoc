<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 23: Lý do & So sánh</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base Settings */
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* UI Components */
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Logic CSS */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially for animation */
        #strokeAnimContainer svg path { opacity: 0; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 23: Lý do & So sánh</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">首</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">くび</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Cái cổ</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại & Ví dụ</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- MOBILE DRAWER -->
        <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none flex">
            <div id="drawerBackdrop" class="absolute inset-0 bg-gray-900/50 opacity-0 transition-opacity" onclick="toggleDrawer()"></div>
            <div id="drawerContent" class="relative w-72 bg-white h-full shadow-2xl transition-transform -translate-x-full flex flex-col pointer-events-auto">
                <div class="p-4 bg-indigo-700 text-white flex justify-between items-center">
                    <h2 class="font-bold">Danh sách từ vựng</h2>
                    <button onclick="toggleDrawer()"><i class="fas fa-times"></i></button>
                </div>
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <input type="text" id="mobileSearchInput" placeholder="Tìm kiếm nhanh..." class="w-full px-4 py-2 bg-white border border-gray-200 rounded-xl text-sm outline-none">
                </div>
                <div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 23</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (Day 23) ---
        const grammarRepo = {
            "no_dakara": { title: "Tại vì (Đương nhiên)", formula: "Thể thường + のだから", desc: "Nêu lý do mang tính khách quan, hiển nhiên, thường dùng để phân trần hoặc thuyết phục.", ex: "子供なのだから、まだわからなくて当然だ。" },
            "ni_taishite": { title: "Ngược lại / Đối với", formula: "Thể thường + のに対して", desc: "So sánh sự đối lập giữa hai sự việc/đối tượng. Hoặc chỉ đối tượng mà hành động hướng tới.", ex: "兄は活発なのに対して、弟は大人しい。" },
            "hanmen": { title: "Mặt khác / Ngược lại", formula: "Thể thường + 反面", desc: "Diễn tả hai mặt đối lập của cùng một vấn đề/sự vật.", ex: "この薬はよく効く反面、副作用もある。" },
            "ippou_de": { title: "Đồng thời / Một mặt thì", formula: "Thể thường + 一方(で)", desc: "Diễn tả hai hành động/trạng thái diễn ra song song hoặc trái ngược nhau.", ex: "仕事が忙しい一方で、趣味も楽しんでいる。" },
            "no_nara": { title: "Nếu là... thì", formula: "Thể thường + (の)なら", desc: "Dựa vào thông tin vừa nghe được để đưa ra lời khuyên, ý kiến.", ex: "日本へ行くなら、秋がいいですよ。" },
            "tewa_dewa": { title: "Nếu... thì (KQ xấu)", formula: "Vて + は / N + では", desc: "Giả định nếu làm việc gì đó thì sẽ dẫn đến kết quả tiêu cực.", ex: "そんなに遊んでいては、試験に落ちるよ。" },
            "tara_douka": { title: "Thử... xem sao?", formula: "Vたら + どうか", desc: "Đưa ra lời khuyên hoặc đề xuất một cách nhẹ nhàng.", ex: "少し休んだらどうですか。" },
            "ni_kagiru": { title: "Tốt nhất là (Chủ quan)", formula: "Vる/Vない/N + に限る", desc: "Lời khuyên mang tính chủ quan của người nói.", ex: "夏はビールに限る。" },
            "tame_ni": { title: "Vì... (Nguyên nhân)", formula: "Thể thường + ため(に)", desc: "Chỉ nguyên nhân dẫn đến kết quả (thường là kết quả xấu hoặc trang trọng).", ex: "大雪のため、電車が遅れた。" }
        };

        // --- 2. VOCABULARY DATA (Day 23 - 87 words) ---
        const vocabData = [
            { "STT": 1, "Kanji": "首", "Nghĩa": "Cổ", "Furigana": "くび", "type": "noun", "conv": { "polite": "首が痛いのだから、休んだらどうか。", "pVi": "Vì cổ đau, nên nghỉ ngơi thì sao?", "casual": "首痛いんだから休めば？", "cVi": "Cổ đau thì nghỉ đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 2, "Kanji": "痒い", "Nghĩa": "Ngứa", "Furigana": "かゆい", "type": "adj", "conv": { "polite": "蚊に刺されて痒いのだから、薬を塗ったらどうか。", "pVi": "Vì bị muỗi đốt ngứa, nên bôi thuốc thì sao?", "casual": "蚊に刺されてかゆいなら薬塗れば？", "cVi": "Ngứa do muỗi đốt thì bôi thuốc đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 3, "Kanji": "大人しい", "Nghĩa": "Trầm tính/Hiền lành", "Furigana": "おとなしい", "type": "adj", "conv": { "polite": "彼は大人しいのだから、無理に話させないほうがいい。", "pVi": "Vì anh ấy trầm tính, nên không nên ép anh ấy nói chuyện.", "casual": "彼大人しいんだから無理させないほうがいいよ。", "cVi": "Nó hiền mà, đừng ép nó nói.", "gIds": ["no_dakara"] } },
            { "STT": 4, "Kanji": "我慢強い", "Nghĩa": "Kiên nhẫn/Chịu đựng giỏi", "Furigana": "がまんづよい", "type": "adj", "conv": { "polite": "彼は我慢強いのだから、大丈夫だろう。", "pVi": "Vì anh ấy giỏi chịu đựng, nên chắc không sao đâu.", "casual": "彼我慢強いから大丈夫でしょ。", "cVi": "Hắn lì đòn lắm, không sao đâu.", "gIds": ["no_dakara"] } },
            { "STT": 5, "Kanji": "けち", "Nghĩa": "Keo kiệt", "Furigana": "けち", "type": "adj", "conv": { "polite": "彼はけちなのに対して、弟は気前がいい。", "pVi": "Anh ấy keo kiệt, ngược lại em trai lại hào phóng.", "casual": "彼はケチだけど弟は気前いいよね。", "cVi": "Hắn keo kiệt mà em trai lại thoáng.", "gIds": ["ni_taishite"] } },
            { "STT": 6, "Kanji": "我儘", "Nghĩa": "Ích kỷ", "Furigana": "わがまま", "type": "adj", "conv": { "polite": "彼女はわがままな反面、優しいところもある。", "pVi": "Cô ấy ích kỷ nhưng mặt khác cũng có điểm hiền lành.", "casual": "彼女わがままだけど優しいとこもあるよ。", "cVi": "Cổ ích kỷ nhưng cũng có lúc hiền.", "gIds": ["hanmen"] } },
            { "STT": 7, "Kanji": "積極的", "Nghĩa": "Tích cực", "Furigana": "せっきょくてき", "type": "adj", "conv": { "polite": "彼は積極的な一方、少しせっかちだ。", "pVi": "Anh ấy tích cực nhưng đồng thời hơi nóng vội.", "casual": "彼積極的だけどせっかちだよね。", "cVi": "Hắn năng nổ nhưng hơi vội vàng.", "gIds": ["ippou_de"] } },
            { "STT": 8, "Kanji": "消極的", "Nghĩa": "Tiêu cực/Thụ động", "Furigana": "しょうきょくてき", "type": "adj", "conv": { "polite": "彼女は消極的なのなら、もっと自信を持たせたらどうか。", "pVi": "Nếu cô ấy tiêu cực, nên cho cô ấy tự tin hơn thì sao?", "casual": "彼女消極的ならもっと自信持たせたら？", "cVi": "Cổ thụ động thì giúp cổ tự tin lên xem.", "gIds": ["no_nara", "tara_douka"] } },
            { "STT": 9, "Kanji": "満足", "Nghĩa": "Mãn nguyện/Hài lòng", "Furigana": "まんぞく", "type": "adj", "conv": { "polite": "満足な生活を送るためには、努力が必要だ。", "pVi": "Để có một cuộc sống mãn nguyện, cần phải nỗ lực.", "casual": "満足な生活には努力が必要だよ。", "cVi": "Muốn sống sướng thì phải cố gắng.", "gIds": ["tame_ni"] } },
            { "STT": 10, "Kanji": "不満", "Nghĩa": "Bất mãn", "Furigana": "ふまん", "type": "adj", "conv": { "polite": "彼は不満な顔をしているのだから、何かあったのだろう。", "pVi": "Vì anh ấy đang có vẻ mặt bất mãn, nên chắc có chuyện gì đó rồi.", "casual": "不満そうな顔してるから何かあったんでしょ。", "cVi": "Mặt bí xị thế kia chắc có biến rồi.", "gIds": ["no_dakara"] } },
            { "STT": 11, "Kanji": "不安", "Nghĩa": "Bất an", "Furigana": "ふあん", "type": "adj", "conv": { "polite": "不安な気持ちのままでは、何もできない。", "pVi": "Nếu cứ trong trạng thái bất an thì không thể làm gì cả.", "casual": "不安なままじゃ何にもできないよ。", "cVi": "Cứ lo lắng thế thì chả làm được gì đâu.", "gIds": ["tewa_dewa"] } },
            { "STT": 12, "Kanji": "大変", "Nghĩa": "Vất vả/Khó khăn", "Furigana": "たいへん", "type": "adj", "conv": { "polite": "仕事が大変なのだから、休んだらどうか。", "pVi": "Vì công việc vất vả, nên nghỉ ngơi thì sao?", "casual": "仕事大変なんだから休めば？", "cVi": "Việc nhiều thế thì nghỉ tí đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 13, "Kanji": "無理", "Nghĩa": "Vô lý/Quá sức", "Furigana": "むり", "type": "adj", "conv": { "polite": "無理な計画は立てないに限る。", "pVi": "Tốt nhất là không nên lập kế hoạch vô lý.", "casual": "無理な計画は立てないに限るよ。", "cVi": "Đừng lên kế hoạch ảo tưởng là tốt nhất.", "gIds": ["ni_kagiru"] } },
            { "STT": 14, "Kanji": "不注意", "Nghĩa": "Bất cẩn", "Furigana": "ふちゅうい", "type": "adj", "conv": { "polite": "不注意な事故は、運転手の不注意から起こった。", "pVi": "Tai nạn do không chú ý xảy ra từ sự bất cẩn của tài xế.", "casual": "不注意な事故は不注意から起きたんだ。", "cVi": "Tai nạn là do sơ ý mà ra.", "gIds": [] } },
            { "STT": 15, "Kanji": "楽", "Nghĩa": "Thoải mái/Nhàn hạ", "Furigana": "らく", "type": "adj", "conv": { "polite": "楽な生活を送るために、努力している。", "pVi": "Tôi đang nỗ lực để có một cuộc sống thoải mái.", "casual": "楽な生活のために頑張ってる。", "cVi": "Cày cuốc để sau này sướng.", "gIds": ["tame_ni"] } },
            { "STT": 16, "Kanji": "面倒", "Nghĩa": "Phiền phức", "Furigana": "めんどう", "type": "adj", "conv": { "polite": "面倒な仕事は、他の人に頼んだらどうか。", "pVi": "Công việc phiền phức, nên nhờ người khác thì sao?", "casual": "面倒な仕事は誰かに頼めば？", "cVi": "Việc phiền quá thì nhờ ai đó đi.", "gIds": ["tara_douka"] } },
            { "STT": 17, "Kanji": "手続き", "Nghĩa": "Thủ tục", "Furigana": "てつづき", "type": "noun", "conv": { "polite": "手続きは複雑な反面、必要なことだ。", "pVi": "Thủ tục phức tạp nhưng mặt khác lại cần thiết.", "casual": "手続き複雑だけど必要だよね。", "cVi": "Thủ tục lằng nhằng nhưng phải làm thôi.", "gIds": ["hanmen"] } },
            { "STT": 18, "Kanji": "失礼", "Nghĩa": "Thất lễ/Vô phép", "Furigana": "しつれい", "type": "adj", "conv": { "polite": "失礼な態度に対して、怒りを感じた。", "pVi": "Tôi cảm thấy tức giận đối với thái độ mất lịch sự.", "casual": "失礼な態度にムカついた。", "cVi": "Thái độ láo toét làm tớ điên tiết.", "gIds": ["ni_taishite"] } },
            { "STT": 19, "Kanji": "当然", "Nghĩa": "Đương nhiên", "Furigana": "とうぜん", "type": "adj", "conv": { "polite": "努力すれば成功するのは当然だ。", "pVi": "Nỗ lực thì thành công là điều đương nhiên.", "casual": "努力すれば成功して当然だよ。", "cVi": "Cố gắng thì thành công là cái chắc.", "gIds": [] } },
            { "STT": 20, "Kanji": "意外", "Nghĩa": "Ngoài dự đoán/Bất ngờ", "Furigana": "いがい", "type": "adj", "conv": { "polite": "意外な結果になったのだから、もう一度確認したらどうか。", "pVi": "Vì đã có kết quả ngoài ý muốn, nên xác nhận lại một lần nữa thì sao?", "casual": "意外な結果だからもう一回確認してみたら？", "cVi": "Kết quả lạ quá, check lại xem.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 21, "Kanji": "調査", "Nghĩa": "Điều tra", "Furigana": "ちょうさ", "type": "noun", "conv": { "polite": "調査の結果は、予想に反して意外なものだった。", "pVi": "Kết quả điều tra trái với dự đoán, thật bất ngờ.", "casual": "調査結果、予想外だったよ。", "cVi": "Kết quả điều tra bất ngờ thật.", "gIds": ["ni_taishite"] } },
            { "STT": 22, "Kanji": "事故", "Nghĩa": "Tai nạn", "Furigana": "じこ", "type": "noun", "conv": { "polite": "事故を起こさないに限る。", "pVi": "Tốt nhất là không nên gây tai nạn.", "casual": "事故起こさないに限るよ。", "cVi": "Đừng gây tai nạn là tốt nhất.", "gIds": ["ni_kagiru"] } },
            { "STT": 23, "Kanji": "結構", "Nghĩa": "Khá tốt/Được", "Furigana": "けっこう", "type": "adj", "conv": { "polite": "この料理は結構美味しいのだから、食べてみたらどうか。", "pVi": "Vì món ăn này khá ngon, nên thử ăn thì sao?", "casual": "これ結構美味しいから食べてみなよ。", "cVi": "Món này ngon phết đấy, ăn thử đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 24, "Kanji": "派手", "Nghĩa": "Lòe loẹt/Sặc sỡ", "Furigana": "はで", "type": "adj", "conv": { "polite": "派手な服は着ないに限る。", "pVi": "Tốt nhất là không nên mặc quần áo lòe loẹt.", "casual": "派手な服は着ないほうがいいよ。", "cVi": "Đừng mặc đồ màu mè quá.", "gIds": ["ni_kagiru"] } },
            { "STT": 25, "Kanji": "地味", "Nghĩa": "Giản dị/Đơn giản", "Furigana": "じみ", "type": "adj", "conv": { "polite": "彼女は地味な反面、とても魅力的だ。", "pVi": "Cô ấy giản dị nhưng mặt khác lại rất quyến rũ.", "casual": "彼女地味だけど魅力的だよね。", "cVi": "Cổ giản dị mà cuốn hút ghê.", "gIds": ["hanmen"] } },
            { "STT": 26, "Kanji": "おしゃれ", "Nghĩa": "Sành điệu/Thời trang", "Furigana": "おしゃれ", "type": "adj", "conv": { "polite": "おしゃれな服を着る一方、機能性も重視している。", "pVi": "Vừa mặc quần áo thời trang, đồng thời cũng chú trọng đến tính năng.", "casual": "おしゃれしつつ機能性も大事にしてる。", "cVi": "Mặc đẹp nhưng cũng phải tiện dụng.", "gIds": ["ippou_de"] } },
            { "STT": 27, "Kanji": "変", "Nghĩa": "Lạ/Kỳ quặc", "Furigana": "へん", "type": "adj", "conv": { "polite": "変な音がするのだから、確認したらどうか。", "pVi": "Vì có tiếng động lạ, nên kiểm tra thì sao?", "casual": "変な音するから確認してみれば？", "cVi": "Có tiếng gì lạ lắm, check thử đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 28, "Kanji": "不思議", "Nghĩa": "Kỳ lạ/Bí ẩn", "Furigana": "ふしぎ", "type": "adj", "conv": { "polite": "不思議な現象に対して、科学者は研究している。", "pVi": "Đối với hiện tượng kỳ lạ, các nhà khoa học đang nghiên cứu.", "casual": "不思議な現象を科学者が研究してるって。", "cVi": "Mấy ổng đang nghiên cứu hiện tượng lạ đó.", "gIds": ["ni_taishite"] } },
            { "STT": 29, "Kanji": "増し", "Nghĩa": "Tốt hơn/Đỡ hơn", "Furigana": "まし", "type": "adj", "conv": { "polite": "状況は少し増しになった反面、まだ問題は残っている。", "pVi": "Tình hình đã tốt hơn một chút nhưng mặt khác vấn đề vẫn còn tồn tại.", "casual": "マシになったけどまだ問題あるよ。", "cVi": "Đỡ hơn rồi nhưng vẫn còn vấn đề.", "gIds": ["hanmen"] } },
            { "STT": 30, "Kanji": "無駄", "Nghĩa": "Lãng phí/Vô ích", "Furigana": "むだ", "type": "adj", "conv": { "polite": "無駄な時間を過ごすのはやめたらどうか。", "pVi": "Việc lãng phí thời gian, nên dừng lại thì sao?", "casual": "無駄な時間過ごすのやめたら？", "cVi": "Đừng tốn thời gian vô bổ nữa.", "gIds": ["tara_douka"] } },
            { "STT": 31, "Kanji": "自由", "Nghĩa": "Tự do", "Furigana": "じゆう", "type": "adj", "conv": { "polite": "自由な生活は素晴らしい。", "pVi": "Cuộc sống tự do thật tuyệt vời.", "casual": "自由な生活って最高。", "cVi": "Sống tự do là nhất.", "gIds": [] } },
            { "STT": 32, "Kanji": "不自由", "Nghĩa": "Tàn tật/Bất tiện", "Furigana": "ふじゆう", "type": "adj", "conv": { "polite": "体が不自由なのだから、手伝ってあげたらどうか。", "pVi": "Vì cơ thể không được tự do, nên giúp đỡ họ thì sao?", "casual": "体が不自由なんだから手伝ってあげなよ。", "cVi": "Người ta tàn tật thì giúp một tay đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 33, "Kanji": "暖まる", "Nghĩa": "Ấm lên (tự)", "Furigana": "あたたまる", "type": "verb", "conv": { "polite": "部屋がなかなか暖まらないのなら、ヒーターをつけたらどうか。", "pVi": "Nếu phòng mãi mà không ấm lên, nên bật máy sưởi thì sao?", "casual": "部屋暖まらないならヒーターつけたら？", "cVi": "Phòng lạnh thế thì bật sưởi đi.", "gIds": ["no_nara", "tara_douka"] } },
            { "STT": 34, "Kanji": "暖める", "Nghĩa": "Làm ấm", "Furigana": "あたためる", "type": "verb", "conv": { "polite": "温かい飲み物で体を暖めた。", "pVi": "Tôi đã làm ấm cơ thể bằng đồ uống nóng.", "casual": "温かい飲み物で体暖めたよ。", "cVi": "Uống đồ nóng cho ấm người.", "gIds": [] } },
            { "STT": 35, "Kanji": "高まる", "Nghĩa": "Cao lên/Tăng lên", "Furigana": "たかまる", "type": "verb", "conv": { "polite": "彼の評価は高まる一方だ。", "pVi": "Đánh giá về anh ấy ngày càng tăng lên.", "casual": "彼の評価、高まる一方だね。", "cVi": "Càng ngày càng được đánh giá cao.", "gIds": ["ippou_de"] } },
            { "STT": 36, "Kanji": "高める", "Nghĩa": "Nâng cao", "Furigana": "たかめる", "type": "verb", "conv": { "polite": "彼は技術を高めるために、毎日練習している。", "pVi": "Anh ấy luyện tập mỗi ngày để nâng cao kỹ thuật.", "casual": "技術高めるために毎日練習してるって。", "cVi": "Hắn tập mỗi ngày để lên trình đấy.", "gIds": ["tame_ni"] } },
            { "STT": 37, "Kanji": "強まる", "Nghĩa": "Mạnh lên", "Furigana": "つよまる", "type": "verb", "conv": { "polite": "風が強まる一方だ。", "pVi": "Gió ngày càng mạnh lên.", "casual": "風、強まる一方だよ。", "cVi": "Gió càng lúc càng to.", "gIds": ["ippou_de"] } },
            { "STT": 38, "Kanji": "強める", "Nghĩa": "Làm mạnh thêm", "Furigana": "つよめる", "type": "verb", "conv": { "polite": "彼は声を強めて、意見を言った。", "pVi": "Anh ấy nâng cao giọng nói và đưa ra ý kiến.", "casual": "彼、声強めて意見言ってた。", "cVi": "Hắn to tiếng nói ý kiến của mình.", "gIds": [] } },
            { "STT": 39, "Kanji": "弱まる", "Nghĩa": "Yếu đi", "Furigana": "よわまる", "type": "verb", "conv": { "polite": "体力が弱まる一方だ。", "pVi": "Thể lực ngày càng yếu đi.", "casual": "体力弱まる一方だよ。", "cVi": "Sức khỏe ngày càng xuống.", "gIds": ["ippou_de"] } },
            { "STT": 40, "Kanji": "弱める", "Nghĩa": "Làm yếu đi/Giảm", "Furigana": "よわめる", "type": "verb", "conv": { "polite": "彼は火を弱めて、煮込んだ。", "pVi": "Anh ấy giảm lửa và hầm.", "casual": "火を弱めて煮込んだよ。", "cVi": "Vặn nhỏ lửa rồi hầm.", "gIds": [] } },
            { "STT": 41, "Kanji": "広まる", "Nghĩa": "Lan rộng", "Furigana": "ひろまる", "type": "verb", "conv": { "polite": "その噂は広まる一方だ。", "pVi": "Tin đồn đó ngày càng lan truyền rộng.", "casual": "噂広まる一方だね。", "cVi": "Tin đồn lan nhanh thật.", "gIds": ["ippou_de"] } },
            { "STT": 42, "Kanji": "広める", "Nghĩa": "Lan truyền/Quảng bá", "Furigana": "ひろめる", "type": "verb", "conv": { "polite": "彼は日本の文化を世界に広めるために努力している。", "pVi": "Anh ấy đang nỗ lực để truyền bá văn hóa Nhật Bản ra thế giới.", "casual": "日本文化広めるために頑張ってるよ。", "cVi": "Đang cố gắng quảng bá văn hóa Nhật.", "gIds": ["tame_ni"] } },
            { "STT": 43, "Kanji": "深まる", "Nghĩa": "Sâu sắc thêm", "Furigana": "ふかまる", "type": "verb", "conv": { "polite": "友情は深まる一方だ。", "pVi": "Tình bạn ngày càng sâu sắc.", "casual": "友情深まる一方だね。", "cVi": "Tình bạn càng ngày càng thắm thiết.", "gIds": ["ippou_de"] } },
            { "STT": 44, "Kanji": "深める", "Nghĩa": "Làm sâu sắc", "Furigana": "ふかめる", "type": "verb", "conv": { "polite": "彼は理解を深めるために、質問をした。", "pVi": "Anh ấy đã đặt câu hỏi để làm sâu sắc thêm sự hiểu biết.", "casual": "理解深めるために質問したんだ。", "cVi": "Hỏi để hiểu sâu hơn.", "gIds": ["tame_ni"] } },
            { "STT": 45, "Kanji": "世話", "Nghĩa": "Chăm sóc", "Furigana": "せわ", "type": "noun", "conv": { "polite": "彼は困っている人に対して、いつも世話をする。", "pVi": "Anh ấy luôn giúp đỡ những người gặp khó khăn.", "casual": "彼、困ってる人の世話よくするよね。", "cVi": "Hắn hay giúp người khác lắm.", "gIds": ["ni_taishite"] } },
            { "STT": 46, "Kanji": "家庭", "Nghĩa": "Gia đình", "Furigana": "かてい", "type": "noun", "conv": { "polite": "家庭の平和は大切だ。", "pVi": "Hòa bình gia đình là quan trọng.", "casual": "家庭の平和大事だよ。", "cVi": "Gia đình êm ấm là quan trọng nhất.", "gIds": [] } },
            { "STT": 47, "Kanji": "厳しい", "Nghĩa": "Nghiêm khắc", "Furigana": "きびしい", "type": "adj", "conv": { "polite": "先生は生徒に対して厳しい。", "pVi": "Giáo viên nghiêm khắc đối với học sinh.", "casual": "先生生徒に厳しいよね。", "cVi": "Thầy nghiêm với học sinh ghê.", "gIds": ["ni_taishite"] } },
            { "STT": 48, "Kanji": "易しい", "Nghĩa": "Dễ", "Furigana": "やさしい", "type": "adj", "conv": { "polite": "この問題は易しいのだから、すぐに解けるだろう。", "pVi": "Vì vấn đề này dễ, nên chắc giải quyết được ngay thôi.", "casual": "これ易しいからすぐ解けるでしょ。", "cVi": "Bài này dễ ợt, giải xong ngay thôi.", "gIds": ["no_dakara"] } },
            { "STT": 49, "Kanji": "協力する", "Nghĩa": "Hợp tác", "Furigana": "きょうりょくする", "type": "verb", "conv": { "polite": "みんなで協力する一方、自分の意見も大切にしている。", "pVi": "Mọi người cùng hợp tác, đồng thời cũng trân trọng ý kiến của mình.", "casual": "協力しつつ自分の意見も大事にしてる。", "cVi": "Vừa hợp tác vừa giữ chính kiến.", "gIds": ["ippou_de"] } },
            { "STT": 50, "Kanji": "保護", "Nghĩa": "Bảo hộ/Bảo vệ", "Furigana": "ほご", "type": "noun", "conv": { "polite": "環境保護に対して、何ができるだろうか。", "pVi": "Đối với việc bảo vệ môi trường, chúng ta có thể làm gì?", "casual": "環境保護に対して何ができるかな。", "cVi": "Mình làm gì để bảo vệ môi trường đây?", "gIds": ["ni_taishite"] } },
            { "STT": 51, "Kanji": "感謝する", "Nghĩa": "Cảm tạ/Biết ơn", "Furigana": "かんしゃする", "type": "verb", "conv": { "polite": "感謝の気持ちを伝えるのだから、手紙を書いたらどうか。", "pVi": "Vì muốn bày tỏ lòng biết ơn, nên viết thư thì sao?", "casual": "感謝伝えたいなら手紙書いたら？", "cVi": "Muốn cảm ơn thì viết thư đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 52, "Kanji": "お詫び", "Nghĩa": "Xin lỗi", "Furigana": "おわび", "type": "noun", "conv": { "polite": "彼は自分の間違いに対して、お詫びをした。", "pVi": "Anh ấy đã xin lỗi về lỗi lầm của mình.", "casual": "彼、間違いに対して謝ったよ。", "cVi": "Nó xin lỗi vì sai rồi.", "gIds": ["ni_taishite"] } },
            { "STT": 53, "Kanji": "迷惑をかける", "Nghĩa": "Làm phiền", "Furigana": "めいわくをかける", "type": "phrase", "conv": { "polite": "人に迷惑をかけるのはやめたらどうか。", "pVi": "Việc làm phiền người khác, nên dừng lại thì sao?", "casual": "人に迷惑かけるのやめなよ。", "cVi": "Đừng làm phiền người ta nữa.", "gIds": ["tara_douka"] } },
            { "STT": 54, "Kanji": "お辞儀", "Nghĩa": "Cúi chào", "Furigana": "おじぎ", "type": "noun", "conv": { "polite": "日本人はお辞儀をする一方、握手もする。", "pVi": "Người Nhật vừa cúi chào, đồng thời cũng bắt tay.", "casual": "日本人お辞儀もするし握手もするよね。", "cVi": "Người Nhật vừa cúi chào vừa bắt tay.", "gIds": ["ippou_de"] } },
            { "STT": 55, "Kanji": "丁寧", "Nghĩa": "Lịch sự/Cẩn thận", "Furigana": "ていねい", "type": "adj", "conv": { "polite": "彼は丁寧な反面、少し冷たい印象がある。", "pVi": "Anh ấy lịch sự nhưng mặt khác lại có ấn tượng hơi lạnh lùng.", "casual": "彼丁寧だけどちょっと冷たいよね。", "cVi": "Hắn lịch sự nhưng hơi lạnh lùng.", "gIds": ["hanmen"] } },
            { "STT": 56, "Kanji": "握手", "Nghĩa": "Bắt tay", "Furigana": "あくしゅ", "type": "noun", "conv": { "polite": "握手をするのは、挨拶の一つだ。", "pVi": "Việc bắt tay là một trong những cách chào hỏi.", "casual": "握手は挨拶の一つだよね。", "cVi": "Bắt tay là chào hỏi mà.", "gIds": [] } },
            { "STT": 57, "Kanji": "意地悪する", "Nghĩa": "Chơi xấu", "Furigana": "いじわるする", "type": "verb", "conv": { "polite": "意地悪な人に対して、どう対応したらいいだろうか。", "pVi": "Đối với người khó tính, nên đối phó thế nào nhỉ?", "casual": "意地悪な人にはどう対応すればいい？", "cVi": "Gặp người xấu tính thì làm sao giờ?", "gIds": ["ni_taishite"] } },
            { "STT": 58, "Kanji": "悪戯する", "Nghĩa": "Nghịch ngợm", "Furigana": "いたずらする", "type": "verb", "conv": { "polite": "子供が悪戯をするのは、元気な証拠だ。", "pVi": "Việc trẻ con nghịch ngợm là bằng chứng của sự khỏe mạnh.", "casual": "子供のいたずらは元気な証拠だよ。", "cVi": "Trẻ con nghịch là khỏe đấy.", "gIds": [] } },
            { "STT": 59, "Kanji": "節約する", "Nghĩa": "Tiết kiệm", "Furigana": "せつやくする", "type": "verb", "conv": { "polite": "お金を節約する一方、健康も大切にしている。", "pVi": "Vừa tiết kiệm tiền, đồng thời cũng coi trọng sức khỏe.", "casual": "節約しつつ健康も大事にしてる。", "cVi": "Vừa tiết kiệm vừa giữ sức khỏe.", "gIds": ["ippou_de"] } },
            { "STT": 60, "Kanji": "生活費", "Nghĩa": "Phí sinh hoạt", "Furigana": "せいかつひ", "type": "noun", "conv": { "polite": "生活費は、地域によって違うのだから、よく調べたらどうか。", "pVi": "Vì chi phí sinh hoạt khác nhau tùy theo vùng, nên tìm hiểu kỹ thì sao?", "casual": "生活費場所で違うから調べたら？", "cVi": "Phí sinh hoạt tùy chỗ, tìm hiểu đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 61, "Kanji": "経営する", "Nghĩa": "Kinh doanh", "Furigana": "けいえいする", "type": "verb", "conv": { "polite": "会社を経営するのは大変な反面、やりがいもある。", "pVi": "Việc quản lý công ty vất vả nhưng mặt khác cũng có ý nghĩa.", "casual": "経営大変だけどやりがいあるよね。", "cVi": "Kinh doanh mệt nhưng vui.", "gIds": ["hanmen"] } },
            { "STT": 62, "Kanji": "反省する", "Nghĩa": "Kiểm điểm", "Furigana": "はんせいする", "type": "verb", "conv": { "polite": "自分の間違いを反省するのだから、許してあげたらどうか。", "pVi": "Vì anh ấy đang kiểm điểm lỗi lầm của mình, nên tha thứ cho anh ấy thì sao?", "casual": "反省してるんだから許してあげなよ。", "cVi": "Nó hối lỗi rồi thì tha cho nó đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 63, "Kanji": "実行する", "Nghĩa": "Thực hiện", "Furigana": "じっこうする", "type": "verb", "conv": { "polite": "計画を実行する一方、問題点も常に確認している。", "pVi": "Vừa thực hiện kế hoạch, đồng thời cũng luôn kiểm tra các vấn đề.", "casual": "実行しつつ問題もチェックしてる。", "cVi": "Vừa làm vừa check lỗi.", "gIds": ["ippou_de"] } },
            { "STT": 64, "Kanji": "進歩する", "Nghĩa": "Tiến bộ", "Furigana": "しんぽする", "type": "verb", "conv": { "polite": "彼の日本語は進歩する一方だ。", "pVi": "Tiếng Nhật của anh ấy ngày càng tiến bộ.", "casual": "彼の日本語進歩する一方だね。", "cVi": "Tiếng Nhật của hắn lên trình ghê.", "gIds": ["ippou_de"] } },
            { "STT": 65, "Kanji": "変化する", "Nghĩa": "Thay đổi", "Furigana": "へんかする", "type": "verb", "conv": { "polite": "世界は常に変化しているのだから、適応したらどうか。", "pVi": "Vì thế giới luôn thay đổi, nên thích nghi thì sao?", "casual": "世界変わってるんだから適応しなきゃ。", "cVi": "Thế giới thay đổi rồi, thích nghi đi.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 66, "Kanji": "発達する", "Nghĩa": "Phát triển", "Furigana": "はったつする", "type": "verb", "conv": { "polite": "子供の成長は発達する一方だ。", "pVi": "Sự phát triển của trẻ em ngày càng tiến bộ.", "casual": "子供の成長すごいよね。", "cVi": "Trẻ con lớn nhanh thật.", "gIds": ["ippou_de"] } },
            { "STT": 67, "Kanji": "体力", "Nghĩa": "Thể lực", "Furigana": "たいりょく", "type": "noun", "conv": { "polite": "体力が低下する一方だ。", "pVi": "Thể lực ngày càng suy giảm.", "casual": "体力落ちる一方だよ。", "cVi": "Sức khỏe ngày càng yếu.", "gIds": ["ippou_de"] } },
            { "STT": 68, "Kanji": "低下", "Nghĩa": "Suy giảm", "Furigana": "ていか", "type": "noun", "conv": { "polite": "学力低下に対して、教育者は対策を考えるべきだ。", "pVi": "Đối với việc suy giảm học lực, các nhà giáo dục nên nghĩ ra biện pháp đối phó.", "casual": "学力低下、対策考えないとね。", "cVi": "Học lực kém đi, phải tính sao chứ.", "gIds": ["ni_taishite"] } },
            { "STT": 69, "Kanji": "若者", "Nghĩa": "Giới trẻ", "Furigana": "わかもの", "type": "noun", "conv": { "polite": "若者に対して、社会はもっと理解を示すべきだ。", "pVi": "Đối với giới trẻ, xã hội nên thể hiện sự thấu hiểu hơn.", "casual": "若者にもっと理解示さないとね。", "cVi": "Phải hiểu cho tụi trẻ chứ.", "gIds": ["ni_taishite"] } },
            { "STT": 70, "Kanji": "出場する", "Nghĩa": "Tham dự", "Furigana": "しゅつじょうする", "type": "verb", "conv": { "polite": "彼は試合に出場する一方、学業も疎かにしない。", "pVi": "Anh ấy vừa tham gia trận đấu, đồng thời cũng không lơ là việc học.", "casual": "試合出つつ勉強もちゃんとしてる。", "cVi": "Vừa đấu giải vừa học hành đàng hoàng.", "gIds": ["ippou_de"] } },
            { "STT": 71, "Kanji": "活躍する", "Nghĩa": "Hoạt động tích cực", "Furigana": "かつやくする", "type": "verb", "conv": { "polite": "彼は世界で活躍する一方、故郷も大切にしている。", "pVi": "Anh ấy vừa hoạt động tích cực trên thế giới, đồng thời cũng trân trọng quê hương.", "casual": "世界で活躍しつつ故郷も大事にしてるよ。", "cVi": "Nổi tiếng thế giới nhưng vẫn nhớ quê.", "gIds": ["ippou_de"] } },
            { "STT": 72, "Kanji": "競争する", "Nghĩa": "Cạnh tranh", "Furigana": "きょうそうする", "type": "verb", "conv": { "polite": "競争が激しいのだから、努力したらどうか。", "pVi": "Vì sự cạnh tranh gay gắt, nên nỗ lực thì sao?", "casual": "競争激しいからもっと頑張ったら？", "cVi": "Cạnh tranh ghê lắm, cố lên.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 73, "Kanji": "成績", "Nghĩa": "Thành tích", "Furigana": "せいせき", "type": "noun", "conv": { "polite": "彼の成績は上がる一方だ。", "pVi": "Thành tích của anh ấy ngày càng tăng.", "casual": "成績上がる一方だね。", "cVi": "Điểm số ngày càng cao.", "gIds": ["ippou_de"] } },
            { "STT": 74, "Kanji": "応援する", "Nghĩa": "Cổ vũ", "Furigana": "おうえんする", "type": "verb", "conv": { "polite": "彼は友達を応援する一方、自分も成長している。", "pVi": "Anh ấy vừa cổ vũ bạn bè, đồng thời bản thân cũng đang trưởng thành.", "casual": "友達応援しつつ自分も成長してる。", "cVi": "Cổ vũ bạn mà mình cũng lớn khôn.", "gIds": ["ippou_de"] } },
            { "STT": 75, "Kanji": "拍手する", "Nghĩa": "Vỗ tay", "Furigana": "はくしゅする", "type": "verb", "conv": { "polite": "彼の演奏に対して、観客は拍手をした。", "pVi": "Đối với màn trình diễn của anh ấy, khán giả đã vỗ tay.", "casual": "演奏に拍手したよ。", "cVi": "Vỗ tay cho màn trình diễn đó.", "gIds": ["ni_taishite"] } },
            { "STT": 76, "Kanji": "噂する", "Nghĩa": "Đồn đại", "Furigana": "うわさする", "type": "verb", "conv": { "polite": "彼の噂は広まる一方だ。", "pVi": "Tin đồn về anh ấy ngày càng lan rộng.", "casual": "噂広まる一方だね。", "cVi": "Tin đồn lan nhanh thật.", "gIds": ["ippou_de"] } },
            { "STT": 77, "Kanji": "情報", "Nghĩa": "Thông tin", "Furigana": "じょうほう", "type": "noun", "conv": { "polite": "彼は常に新しい情報を集める一方、古い情報も整理している。", "pVi": "Anh ấy luôn thu thập thông tin mới, đồng thời cũng sắp xếp thông tin cũ.", "casual": "新しい情報集めつつ古いの整理してる。", "cVi": "Vừa gom tin mới vừa lọc tin cũ.", "gIds": ["ippou_de"] } },
            { "STT": 78, "Kanji": "流行する", "Nghĩa": "Lưu hành/Thịnh hành", "Furigana": "りゅうこうする", "type": "verb", "conv": { "polite": "このファッションは流行する一方だ。", "pVi": "Thời trang này ngày càng phổ biến.", "casual": "これ流行る一方だね。", "cVi": "Cái này đang hot dần đều.", "gIds": ["ippou_de"] } },
            { "STT": 79, "Kanji": "交換する", "Nghĩa": "Trao đổi", "Furigana": "こうかんする", "type": "verb", "conv": { "polite": "彼は意見を交換する一方、自分の意見も主張している。", "pVi": "Anh ấy vừa trao đổi ý kiến, đồng thời cũng khẳng định ý kiến của mình.", "casual": "意見交換しつつ主張もしてる。", "cVi": "Vừa trao đổi vừa giữ lập trường.", "gIds": ["ippou_de"] } },
            { "STT": 80, "Kanji": "宣伝する", "Nghĩa": "Tuyên truyền", "Furigana": "せんでんする", "type": "verb", "conv": { "polite": "彼は新製品を宣伝する一方、顧客の意見も聞いている。", "pVi": "Anh ấy vừa quảng bá sản phẩm mới, đồng thời cũng lắng nghe ý kiến của khách hàng.", "casual": "宣伝しつつ意見も聞いてるよ。", "cVi": "Vừa quảng cáo vừa nghe khách nói.", "gIds": ["ippou_de"] } },
            { "STT": 81, "Kanji": "広告", "Nghĩa": "Quảng cáo", "Furigana": "こうこく", "type": "noun", "conv": { "polite": "広告は商品の売上を上げるのだから、もっと工夫したらどうか。", "pVi": "Vì quảng cáo giúp tăng doanh số bán hàng, nên cải thiện thêm thì sao?", "casual": "広告売上上げるから工夫したら？", "cVi": "Quảng cáo tăng doanh thu đấy, làm kỹ vào.", "gIds": ["no_dakara", "tara_douka"] } },
            { "STT": 82, "Kanji": "注目する", "Nghĩa": "Chú ý", "Furigana": "ちゅうもくする", "type": "verb", "conv": { "polite": "彼の行動は、常に注目される一方だ。", "pVi": "Hành động của anh ấy ngày càng được chú ý.", "casual": "彼の行動注目される一方だね。", "cVi": "Ai cũng để ý hành động của hắn.", "gIds": ["ippou_de"] } },
            { "STT": 83, "Kanji": "通訳する", "Nghĩa": "Thông dịch", "Furigana": "つうやくする", "type": "verb", "conv": { "polite": "彼は日本語と英語を通訳する一方、中国語も勉強している。", "pVi": "Anh ấy vừa thông dịch tiếng Nhật và tiếng Anh, đồng thời cũng học tiếng Trung.", "casual": "通訳しつつ中国語も勉強してる。", "cVi": "Vừa dịch vừa học tiếng Trung.", "gIds": ["ippou_de"] } },
            { "STT": 84, "Kanji": "翻訳する", "Nghĩa": "Biên dịch", "Furigana": "ほんやくする", "type": "verb", "conv": { "polite": "この本を翻訳するのに時間がかかる。", "pVi": "Việc biên dịch cuốn sách này tốn thời gian.", "casual": "翻訳するの時間かかるな。", "cVi": "Dịch sách này lâu thật.", "gIds": [] } },
            { "STT": 85, "Kanji": "伝言する", "Nghĩa": "Nhắn tin/Để lại lời nhắn", "Furigana": "でんごんする", "type": "verb", "conv": { "polite": "彼は伝言を残す一方、すぐに連絡もしている。", "pVi": "Anh ấy vừa để lại lời nhắn, đồng thời cũng liên lạc ngay.", "casual": "伝言残しつつ連絡もしてる。", "cVi": "Vừa nhắn lại vừa gọi luôn.", "gIds": ["ippou_de"] } },
            { "STT": 86, "Kanji": "報告する", "Nghĩa": "Báo cáo", "Furigana": "ほうこくする", "type": "verb", "conv": { "polite": "彼は報告書を作成する一方、次のプロジェクトも計画している。", "pVi": "Anh ấy vừa lập báo cáo, đồng thời cũng lên kế hoạch cho dự án tiếp theo.", "casual": "報告書作りつつ次も計画してる。", "cVi": "Vừa làm báo cáo vừa tính cái sau.", "gIds": ["ippou_de"] } },
            { "STT": 87, "Kanji": "混雑する", "Nghĩa": "Đông đúc/Hỗn loạn", "Furigana": "こんざつする", "type": "verb", "conv": { "polite": "駅はいつも混雑しているのだから、早めに出たらどうか。", "pVi": "Vì nhà ga luôn đông đúc, nên đi sớm thì sao?", "casual": "駅混んでるから早く出たら？", "cVi": "Ga đông lắm, đi sớm đi.", "gIds": ["no_dakara", "tara_douka"] } }
        ];

        // --- 3. KANJI DETAILS (Updated for Day 23) ---
        const kanjiDetails = {
            "首": { hanviet: "THỦ", mean: "Cổ/Đầu", on: "シュ", kun: "くび", radicals: "Thủ (首)", tipImg: "Cái đầu.", tipSoundOn: "**Shu**to thủ đô.", tipSoundKun: "**Kubi** cổ.", words: [{w:"首 (くび)", m:"Cổ"}, {w:"手首 (てくび)", m:"Cổ tay"}] },
            "痒": { hanviet: "DƯƠNG", mean: "Ngứa", on: "ヨウ", kun: "かゆ.い", radicals: "Nạch (疒) + Dương (羊)", tipImg: "Bệnh (疒) do lông cừu (羊) gây ngứa.", tipSoundOn: "", tipSoundKun: "**Kayu**i ngứa.", words: [{w:"痒い (かゆい)", m:"Ngứa"}] },
            "我": { hanviet: "NGÃ", mean: "Tôi/Ta", on: "ガ", kun: "われ", radicals: "Qua (戈)", tipImg: "Tay cầm qua (戈) tự vệ.", tipSoundOn: "**Ga**man chịu đựng.", tipSoundKun: "**Ware** ta.", words: [{w:"我慢 (がまん)", m:"Chịu đựng"}, {w:"我儘 (わがまま)", m:"Ích kỷ"}] },
            "慢": { hanviet: "MẠN", mean: "Ngạo mạn/Chậm", on: "マン", kun: "", radicals: "Tâm (忄) + Mạn (曼)", tipImg: "Tâm (忄) kiêu ngạo.", tipSoundOn: "Ga**man** chịu đựng.", words: [{w:"自慢 (じまん)", m:"Tự mãn"}] },
            "儘": { hanviet: "TẪN", mean: "Cứ để nguyên", on: "ジン", kun: "まま", radicals: "Nhân (亻) + Tận (盡)", tipImg: "Người (亻) tận (盡) lực cứ làm theo ý mình.", tipSoundOn: "", tipSoundKun: "Waga**mama** ích kỷ.", words: [{w:"気儘 (きまま)", m:"Tùy ý"}] },
            "積": { hanviet: "TÍCH", mean: "Tích tụ", on: "セキ", kun: "つ.む", radicals: "Hòa (禾) + Trách (責)", tipImg: "Lúa (禾) chất đống là trách (責) nhiệm.", tipSoundOn: "**Sek**kyoku tích cực.", tipSoundKun: "**Tsu**mu chất.", words: [{w:"積極的 (せっきょくてき)", m:"Tích cực"}] },
            "極": { hanviet: "CỰC", mean: "Cực độ/Rất", on: "キョク", kun: "きわ.める", radicals: "Mộc (木) + Cức (亟)", tipImg: "Cây (木) mọc nhanh cực (亟) độ.", tipSoundOn: "Sek**kyoku** tích cực.", tipSoundKun: "**Kiwa**meru bồi dưỡng.", words: [{w:"消極的 (しょうきょくてき)", m:"Tiêu cực"}] },
            "消": { hanviet: "TIÊU", mean: "Tiêu diệt/Tắt", on: "ショウ", kun: "き.える", radicals: "Thủy (氵) + Tiếu (肖)", tipImg: "Nước (氵) làm tan biến (肖).", tipSoundOn: "**Shou**kyoku tiêu cực.", tipSoundKun: "**Ki**eru tắt.", words: [{w:"消化 (しょうか)", m:"Tiêu hóa"}] },
            "満": { hanviet: "MÃN", mean: "Thỏa mãn/Đầy", on: "マン", kun: "み.ちる", radicals: "Thủy (氵)", tipImg: "Nước tràn đầy.", tipSoundOn: "**Man**zoku thỏa mãn.", tipSoundKun: "**Mi**chiru đầy.", words: [{w:"満足 (まんぞく)", m:"Hài lòng"}, {w:"不満 (ふまん)", m:"Bất mãn"}] },
            "不": { hanviet: "BẤT", mean: "Không", on: "フ, ブ", kun: "", radicals: "Nhất (一)", tipImg: "Chim bay lên trời không quay lại.", tipSoundOn: "**Fu**an bất an.", words: [{w:"不満 (ふまん)", m:"Bất mãn"}, {w:"不安 (ふあん)", m:"Bất an"}] },
            "変": { hanviet: "BIẾN", mean: "Thay đổi/Lạ", on: "ヘン", kun: "か.わる", radicals: "Phốc (攵)", tipImg: "Thay đổi.", tipSoundOn: "Tai**hen** vất vả.", tipSoundKun: "**Ka**waru thay đổi.", words: [{w:"大変 (たいへん)", m:"Vất vả"}, {w:"変 (へん)", m:"Lạ"}] },
            "無": { hanviet: "VÔ", mean: "Không có", on: "ム", kun: "な.い", radicals: "Hỏa (灬)", tipImg: "Lửa thiêu rụi không còn gì.", tipSoundOn: "**Mu**ri vô lý.", tipSoundKun: "**Na**i không có.", words: [{w:"無理 (むり)", m:"Vô lý"}, {w:"無駄 (むだ)", m:"Lãng phí"}] },
            "理": { hanviet: "LÝ", mean: "Lý lẽ", on: "リ", kun: "", radicals: "Ngọc (王)", tipImg: "Vua cai trị có lý lẽ.", tipSoundOn: "Mu**ri** vô lý.", words: [{w:"理由 (りゆう)", m:"Lý do"}] },
            "注": { hanviet: "CHÚ", mean: "Rót/Chú ý", on: "チュウ", kun: "そそ.ぐ", radicals: "Thủy (氵) + Chủ (主)", tipImg: "Chủ (主) rót nước (氵).", tipSoundOn: "Fu**chuu**i bất cẩn.", tipSoundKun: "**Soso**gu rót.", words: [{w:"不注意 (ふちゅうい)", m:"Bất cẩn"}, {w:"注目 (ちゅうもく)", m:"Chú ý"}] },
            "意": { hanviet: "Ý", mean: "Ý kiến/Ý nghĩa", on: "イ", kun: "", radicals: "Tâm (心) + Âm (音)", tipImg: "Âm (音) thanh từ tâm (心) là ý.", tipSoundOn: "Fuchuu**i** bất cẩn.", words: [{w:"意味 (いみ)", m:"Ý nghĩa"}, {w:"意外 (いがい)", m:"Ngoài dự đoán"}] },
            "楽": { hanviet: "LẠC/NHẠC", mean: "Vui/Nhạc", on: "ラク, ガク", kun: "たの.しい", radicals: "Mộc (木)", tipImg: "Trống gỗ chơi nhạc vui vẻ.", tipSoundOn: "**Raku** nhàn hạ.", tipSoundKun: "**Tano**shii vui.", words: [{w:"楽 (らく)", m:"Thoải mái"}, {w:"音楽 (おんがく)", m:"Âm nhạc"}] },
            "面": { hanviet: "DIỆN", mean: "Mặt/Bề mặt", on: "メン", kun: "おもて", radicals: "Diện (面)", tipImg: "Khuôn mặt.", tipSoundOn: "**Men**dou phiền phức.", tipSoundKun: "**Omote** mặt trước.", words: [{w:"面倒 (めんどう)", m:"Phiền phức"}, {w:"反面 (はんめん)", m:"Mặt khác"}] },
            "倒": { hanviet: "ĐẢO", mean: "Đổ/Ngã", on: "トウ", kun: "たお.れる", radicals: "Nhân (亻)", tipImg: "Người ngã.", tipSoundOn: "Men**dou** phiền phức.", tipSoundKun: "**Tao**reru đổ.", words: [{w:"倒産 (とうさん)", m:"Phá sản"}] },
            "続": { hanviet: "TỤC", mean: "Tiếp tục", on: "ゾク", kun: "つづ.く", radicals: "Mịch (糸)", tipImg: "Sợi chỉ nối tiếp.", tipSoundOn: "Tetsu**zuki** thủ tục.", tipSoundKun: "**Tsuzu**ku tiếp tục.", words: [{w:"手続き (てつづき)", m:"Thủ tục"}] },
            "失": { hanviet: "THẤT", mean: "Mất/Lỗi", on: "シツ", kun: "うしな.う", radicals: "Đại (大)", tipImg: "Mất mát lớn.", tipSoundOn: "**Shitsu**rei thất lễ.", tipSoundKun: "**Ushina**u mất.", words: [{w:"失礼 (しつれい)", m:"Thất lễ"}] },
            "礼": { hanviet: "LỄ", mean: "Lễ nghi", on: "レイ", kun: "", radicals: "Thị (礻)", tipImg: "Cúng bái thần linh đúng lễ.", tipSoundOn: "Shitsu**rei** thất lễ.", words: [{w:"お礼 (おれい)", m:"Cảm ơn"}] },
            "当": { hanviet: "ĐƯƠNG", mean: "Đúng/Trúng", on: "トウ", kun: "あ.たる", radicals: "Tiểu (⺌)", tipImg: "Đương nhiên.", tipSoundOn: "**Tou**zen đương nhiên.", tipSoundKun: "**A**taru trúng.", words: [{w:"当然 (とうぜん)", m:"Đương nhiên"}] },
            "然": { hanviet: "NHIÊN", mean: "Tự nhiên", on: "ゼン", kun: "", radicals: "Hỏa (灬)", tipImg: "Cháy tự nhiên.", tipSoundOn: "Tou**zen** đương nhiên.", words: [{w:"全然 (ぜんぜん)", m:"Hoàn toàn"}] },
            "外": { hanviet: "NGOẠI", mean: "Ngoài", on: "ガイ", kun: "そと", radicals: "Tối (夕) + Bốc (卜)", tipImg: "Bói buổi tối ở ngoài.", tipSoundOn: "I**gai** ngoài dự tính.", tipSoundKun: "**Soto** bên ngoài.", words: [{w:"意外 (いがい)", m:"Ngoài ý muốn"}, {w:"外国 (がいこく)", m:"Nước ngoài"}] },
            "調": { hanviet: "ĐIỀU", mean: "Điều tra/Giai điệu", on: "チョウ", kun: "しら.べる", radicals: "Ngôn (言) + Chu (周)", tipImg: "Đi khắp chu (周) vi hỏi (言) để điều tra.", tipSoundOn: "**Chou**sa điều tra.", tipSoundKun: "**Shira**beru tìm hiểu.", words: [{w:"調査 (ちょうさ)", m:"Điều tra"}] },
            "査": { hanviet: "TRA", mean: "Kiểm tra", on: "サ", kun: "", radicals: "Mộc (木)", tipImg: "Kiểm tra cây.", tipSoundOn: "Chou**sa** điều tra.", words: [{w:"検査 (けんさ)", m:"Kiểm tra"}] },
            "故": { hanviet: "CỐ", mean: "Sự cố/Cũ", on: "コ", kun: "ゆえ", radicals: "Phốc (攴)", tipImg: "Đánh vào cái cũ gây sự cố.", tipSoundOn: "Ji**ko** tai nạn.", words: [{w:"事故 (じこ)", m:"Tai nạn"}] },
            "構": { hanviet: "CẤU", mean: "Cấu tạo", on: "コウ", kun: "かま.う", radicals: "Mộc (木)", tipImg: "Cấu tạo gỗ.", tipSoundOn: "Kek**kou** khá tốt.", tipSoundKun: "**Kama**u quan tâm.", words: [{w:"結構 (けっこう)", m:"Khá tốt"}] },
            "派": { hanviet: "PHÁI", mean: "Phái/Nhóm", on: "ハ", kun: "", radicals: "Thủy (氵)", tipImg: "Dòng nước chia phái.", tipSoundOn: "**Ha**de lòe loẹt.", words: [{w:"立派 (りっぱ)", m:"Tuyệt vời"}] },
            "地": { hanviet: "ĐỊA", mean: "Đất", on: "チ, ジ", kun: "", radicals: "Thổ (土)", tipImg: "Đất.", tipSoundOn: "**Ji**mi giản dị.", words: [{w:"地味 (じみ)", m:"Giản dị"}, {w:"地下 (ちか)", m:"Dưới đất"}] },
            "味": { hanviet: "VỊ", mean: "Mùi vị", on: "ミ", kun: "あじ", radicals: "Khẩu (口) + Vị (未)", tipImg: "Miệng nếm vị chưa (未) biết.", tipSoundOn: "Ji**mi** giản dị.", tipSoundKun: "**Aji** vị.", words: [{w:"意味 (いみ)", m:"Ý nghĩa"}] },
            "増": { hanviet: "TĂNG", mean: "Tăng lên", on: "ゾウ", kun: "ま.す", radicals: "Thổ (土) + Tăng (曾)", tipImg: "Đất tăng thêm.", tipSoundOn: "**Ma**shi tốt hơn.", tipSoundKun: "**Fu**eru tăng.", words: [{w:"増える (ふえる)", m:"Tăng"}] },
            "駄": { hanviet: "ĐÀ", mean: "Vô ích/Ngựa thồ", on: "ダ", kun: "", radicals: "Mã (馬) + Thái (太)", tipImg: "Ngựa béo (太) vô dụng.", tipSoundOn: "Mu**da** lãng phí.", words: [{w:"無駄 (むだ)", m:"Lãng phí"}] },
            "由": { hanviet: "DO", mean: "Lý do", on: "ユウ, ユ", kun: "よし", radicals: "Điền (田)", tipImg: "Lý do từ ruộng.", tipSoundOn: "Ji**yuu** tự do.", words: [{w:"自由 (じゆう)", m:"Tự do"}, {w:"理由 (りゆう)", m:"Lý do"}] },
            "暖": { hanviet: "NOÃN", mean: "Ấm áp", on: "ダン", kun: "あたた.かい", radicals: "Nhật (日) + Viên (爰)", tipImg: "Mặt trời sưởi ấm.", tipSoundOn: "**Dan**bou máy sưởi.", tipSoundKun: "**Atata**maru ấm lên.", words: [{w:"暖まる (あたたまる)", m:"Ấm lên"}, {w:"暖かい (あたたかい)", m:"Ấm áp"}] },
            "高": { hanviet: "CAO", mean: "Cao", on: "コウ", kun: "たか.い", radicals: "Cao (高)", tipImg: "Tòa tháp cao.", tipSoundOn: "Sai**kou** tuyệt nhất.", tipSoundKun: "**Taka**maru tăng cao.", words: [{w:"高める (たかめる)", m:"Nâng cao"}] },
            "強": { hanviet: "CƯỜNG", mean: "Mạnh", on: "キョウ", kun: "つよ.い", radicals: "Cung (弓)", tipImg: "Cung mạnh.", tipSoundOn: "Ben**kyou** học.", tipSoundKun: "**Tsuyo**maru mạnh lên.", words: [{w:"強まる (つよまる)", m:"Mạnh lên"}] },
            "弱": { hanviet: "NHƯỢC", mean: "Yếu", on: "ジャク", kun: "よわ.い", radicals: "Cung (弓)", tipImg: "Cung yếu.", tipSoundOn: "**Jaku**ten điểm yếu.", tipSoundKun: "**Yowa**maru yếu đi.", words: [{w:"弱める (よわめる)", m:"Làm yếu"}] },
            "広": { hanviet: "QUẢNG", mean: "Rộng", on: "コウ", kun: "ひろ.い", radicals: "Nghiễm (广)", tipImg: "Nhà rộng.", tipSoundOn: "**Kou**koku quảng cáo.", tipSoundKun: "**Hiro**maru lan rộng.", words: [{w:"広める (ひろめる)", m:"Loan tin"}] },
            "深": { hanviet: "THÂM", mean: "Sâu", on: "シン", kun: "ふか.い", radicals: "Thủy (氵)", tipImg: "Nước sâu.", tipSoundOn: "**Shin**koku nghiêm trọng.", tipSoundKun: "**Fuka**maru sâu sắc thêm.", words: [{w:"深める (ふかめる)", m:"Làm sâu sắc"}] },
            "庭": { hanviet: "ĐÌNH", mean: "Sân vườn", on: "テイ", kun: "にわ", radicals: "Nghiễm (广) + Đình (廷)", tipImg: "Sân đình trong nhà.", tipSoundOn: "Ka**tei** gia đình.", tipSoundKun: "**Niwa** vườn.", words: [{w:"家庭 (かてい)", m:"Gia đình"}] },
            "厳": { hanviet: "NGHIÊM", mean: "Nghiêm khắc", on: "ゲン", kun: "きび.しい", radicals: "Khẩu (口)", tipImg: "Nghiêm khắc dạy bảo.", tipSoundOn: "**Gen**juu nghiêm trọng.", tipSoundKun: "**Kibi**shii nghiêm khắc.", words: [{w:"厳しい (きびしい)", m:"Nghiêm khắc"}] },
            "易": { hanviet: "DỊ", mean: "Dễ/Hoán đổi", on: "エキ, イ", kun: "やさ.しい", radicals: "Nhật (日)", tipImg: "Mặt trời thay đổi dễ dàng.", tipSoundOn: "Bou**eki** mậu dịch.", tipSoundKun: "**Yasa**shii dễ.", words: [{w:"易しい (やさしい)", m:"Dễ"}] },
            "協": { hanviet: "HIỆP", mean: "Hiệp lực", on: "キョウ", kun: "", radicals: "Thập (十) + Lực (力)", tipImg: "Mười sức lực hợp lại.", tipSoundOn: "**Kyou**ryoku hợp tác.", words: [{w:"協力 (きょうりょく)", m:"Hợp tác"}] },
            "護": { hanviet: "HỘ", mean: "Bảo hộ", on: "ゴ", kun: "まも.る", radicals: "Ngôn (言)", tipImg: "Lời nói bảo vệ.", tipSoundOn: "**Ho**go bảo hộ.", words: [{w:"看護 (かんご)", m:"Chăm sóc"}] },
            "謝": { hanviet: "TẠ", mean: "Cảm tạ/Xin lỗi", on: "シャ", kun: "あやま.る", radicals: "Ngôn (言) + Xạ (射)", tipImg: "Bắn lời nói cảm tạ.", tipSoundOn: "Kan**sha** cảm tạ.", tipSoundKun: "**Ayama**ru xin lỗi.", words: [{w:"感謝 (かんしゃ)", m:"Biết ơn"}] },
            "詫": { hanviet: "SÁ", mean: "Xin lỗi", on: "タ", kun: "わび.る", radicals: "Ngôn (言) + Trạch (宅)", tipImg: "Đến nhà nói lời xin lỗi.", tipSoundOn: "", tipSoundKun: "O**wabi** lời xin lỗi.", words: [{w:"お詫び (おわび)", m:"Xin lỗi"}] },
            "迷": { hanviet: "MÊ", mean: "Lạc đường/Mê muội", on: "メイ", kun: "まよ.う", radicals: "Xước (⻌) + Mễ (米)", tipImg: "Lạc đường đi mua gạo.", tipSoundOn: "**Mei**waku phiền phức.", tipSoundKun: "**Mayo**u lạc.", words: [{w:"迷う (まよう)", m:"Lạc đường"}] },
            "惑": { hanviet: "HOẶC", mean: "Mê hoặc", on: "ワク", kun: "まど.う", radicals: "Tâm (心) + Hoặc (或)", tipImg: "Tâm nghi hoặc.", tipSoundOn: "Mei**waku** phiền phức.", words: [{w:"惑星 (わくせい)", m:"Hành tinh"}] },
            "辞": { hanviet: "TỪ", mean: "Từ bỏ/Từ ngữ", on: "ジ", kun: "や.める", radicals: "Thiệt (辛)", tipImg: "Lời nói cay đắng từ biệt.", tipSoundOn: "O**ji**gi cúi chào.", tipSoundKun: "**Ya**meru từ bỏ.", words: [{w:"辞書 (じしょ)", m:"Từ điển"}] },
            "儀": { hanviet: "NGHI", mean: "Nghi thức", on: "ギ", kun: "", radicals: "Nhân (亻) + Nghĩa (義)", tipImg: "Người làm việc nghĩa đúng nghi thức.", tipSoundOn: "Oji**gi** cúi chào.", words: [{w:"儀式 (ぎしき)", m:"Nghi thức"}] },
            "握": { hanviet: "ÁC", mean: "Nắm/Cầm", on: "アク", kun: "にぎ.る", radicals: "Thủ (扌) + Ốc (屋)", tipImg: "Tay nắm lấy nhà.", tipSoundOn: "**Aku**shu bắt tay.", tipSoundKun: "**Nigi**ru nắm.", words: [{w:"握る (にぎる)", m:"Nắm"}] },
            "戯": { hanviet: "HÍ", mean: "Vui chơi", on: "ギ", kun: "たわむ.れる", radicals: "Qua (戈)", tipImg: "Chơi đùa với giáo mác (nguy hiểm).", tipSoundOn: "Yuugi trò chơi.", tipSoundKun: "Ita**zura** nghịch ngợm.", words: [{w:"悪戯 (いたずら)", m:"Nghịch ngợm"}] },
            "節": { hanviet: "TIẾT", mean: "Tiết kiệm/Khớp", on: "セツ", kun: "ふし", radicals: "Trúc (竹)", tipImg: "Đốt tre.", tipSoundOn: "**Setsu**yaku tiết kiệm.", tipSoundKun: "**Fushi** khớp xương.", words: [{w:"季節 (きせつ)", m:"Mùa"}] },
            "約": { hanviet: "ƯỚC", mean: "Lời hứa/Khoảng", on: "ヤク", kun: "", radicals: "Mịch (糸)", tipImg: "Buộc chỉ ước hẹn.", tipSoundOn: "Setsu**yaku** tiết kiệm.", words: [{w:"約束 (やくそく)", m:"Lời hứa"}] },
            "経": { hanviet: "KINH", mean: "Kinh qua/Kinh tế", on: "ケイ", kun: "へ.る", radicals: "Mịch (糸)", tipImg: "Sợi chỉ dệt kinh sách.", tipSoundOn: "**Kei**ei kinh doanh.", tipSoundKun: "**He**ru trải qua.", words: [{w:"経済 (けいざい)", m:"Kinh tế"}] },
            "営": { hanviet: "DOANH", mean: "Kinh doanh", on: "エイ", kun: "いとな.む", radicals: "Hỏa (火 - biến thể)", tipImg: "Đốt lửa trại doanh trại.", tipSoundOn: "Kei**ei** kinh doanh.", tipSoundKun: "**Itona**mu điều hành.", words: [{w:"営業 (えいぎょう)", m:"Kinh doanh"}] },
            "省": { hanviet: "TỈNH", mean: "Tỉnh ngộ/Tiết kiệm", on: "セイ, ショウ", kun: "はぶ.く", radicals: "Mục (目) + Thiểu (少)", tipImg: "Mắt nhìn ít đi để tiết kiệm/tự kiểm điểm.", tipSoundOn: "Han**sei** kiểm điểm.", tipSoundKun: "**Habu**ku lược bỏ.", words: [{w:"省く (はぶく)", m:"Lược bỏ"}] },
            "実": { hanviet: "THỰC", mean: "Sự thật/Quả", on: "ジツ", kun: "み", radicals: "Miên (宀)", tipImg: "Trong nhà có của cải thực sự.", tipSoundOn: "**Jik**kou thực hành.", tipSoundKun: "**Mi** quả.", words: [{w:"事実 (じじつ)", m:"Sự thật"}] },
            "躍": { hanviet: "DƯỢC", mean: "Nhảy lên", on: "ヤク", kun: "おど.る", radicals: "Túc (足)", tipImg: "Chân nhảy như chim.", tipSoundOn: "Katsu**yaku** hoạt động tích cực.", tipSoundKun: "**Odo**ru nhảy.", words: [{w:"飛躍 (ひやく)", m:"Bước nhảy vọt"}] },
            "競": { hanviet: "CẠNH", mean: "Cạnh tranh", on: "キョウ", kun: "きそ.う", radicals: "Lập (立) + Huynh (兄)", tipImg: "Hai người anh đứng cạnh tranh nhau.", tipSoundOn: "**Kyou**sou cạnh tranh.", tipSoundKun: "**Kiso**u thi đua.", words: [{w:"競争 (きょうそう)", m:"Cạnh tranh"}] },
            "拍": { hanviet: "PHÁCH", mean: "Vỗ/Nhịp", on: "ハク", kun: "", radicals: "Thủ (扌) + Bạch (白)", tipImg: "Tay vỗ ra nhịp trắng.", tipSoundOn: "**Haku**shu vỗ tay.", words: [{w:"拍手 (はくしゅ)", m:"Vỗ tay"}] },
            "噂": { hanviet: "ĐỒN", mean: "Lời đồn", on: "ソン", kun: "うわさ", radicals: "Khẩu (口) + Tôn (尊)", tipImg: "Lời nói tôn kính là tin đồn (?).", tipSoundOn: "", tipSoundKun: "**Uwasa** lời đồn.", words: [{w:"噂 (うわさ)", m:"Tin đồn"}] },
            "換": { hanviet: "HOÁN", mean: "Hoán đổi", on: "カン", kun: "か.える", radicals: "Thủ (扌)", tipImg: "Tay đổi đồ.", tipSoundOn: "Kou**kan** trao đổi.", tipSoundKun: "**Ka**eru đổi.", words: [{w:"乗り換え (のりかえ)", m:"Đổi xe"}] },
            "宣": { hanviet: "TUYÊN", mean: "Tuyên truyền", on: "セン", kun: "", radicals: "Miên (宀)", tipImg: "Tuyên bố trong nhà.", tipSoundOn: "**Sen**den tuyên truyền.", words: [{w:"宣言 (せんげん)", m:"Tuyên ngôn"}] },
            "告": { hanviet: "CÁO", mean: "Thông báo", on: "コク", kun: "つ.げる", radicals: "Khẩu (口)", tipImg: "Miệng con bò thông báo.", tipSoundOn: "Kou**koku** quảng cáo.", tipSoundKun: "**Tsu**geru thông báo.", words: [{w:"報告 (ほうこく)", m:"Báo cáo"}] },
            "翻": { hanviet: "PHIÊN", mean: "Phiên dịch/Lật", on: "ホン", kun: "ひるがえ.る", radicals: "Vũ (羽)", tipImg: "Cánh chim lật qua lật lại.", tipSoundOn: "**Hon**yaku biên dịch.", words: [{w:"翻訳 (ほんやく)", m:"Biên dịch"}] },
            "混": { hanviet: "HỖN", mean: "Hỗn loạn/Trộn", on: "コン", kun: "ま.ぜる", radicals: "Thủy (氵) + Côn (昆)", tipImg: "Nước côn trùng trộn lẫn.", tipSoundOn: "**Kon**zatsu hỗn tạp.", tipSoundKun: "**Ma**zeru trộn.", words: [{w:"混ぜる (まぜる)", m:"Trộn"}] }
        };

        // --- 4. APP LOGIC ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }

        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }

        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
