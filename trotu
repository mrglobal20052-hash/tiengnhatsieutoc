<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Trợ từ Tiếng Nhật (Japanese Particles)</title>
    <meta name="description" content="Học các trợ từ tiếng Nhật (Joshi) qua bảng tra cứu chi tiết, ví dụ, và luyện gõ tương tác. Cải thiện ngữ pháp tiếng Nhật của bạn một cách hiệu quả.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            /* Padding-bottom sẽ được thiết lập động bằng JavaScript */
            padding-bottom: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid #e5e7eb;
            vertical-align: top;
        }
        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #4b5563;
            font-size: 0.875rem;
            text-transform: uppercase;
        }
        tbody tr:nth-child(odd) {
            background-color: #f9fafb;
        }
        tbody tr:hover {
            background-color: #eef2ff;
        }
        .toggle-button {
            background-color: #4f46e5;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .toggle-button:hover {
            background-color: #4338ca;
        }
        .play-button {
            background-color: #10b981;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: inline-block;
        }
        .play-button:hover {
            background-color: #059669;
        }
        .hidden-text {
            display: none;
        }
        .fixed-typing-practice {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #ffffff;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            z-index: 1000;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .detail-row {
            background-color: #eef2ff;
        }
        .expand-button {
            background-color: #6366f1;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.75rem;
        }
        .expand-button:hover {
            background-color: #4f46e5;
        }
        .detail-content {
            background-color: #f0f2f5;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .detail-content h5 {
            font-weight: 600;
            color: #1e3a8a;
            margin-top: 0.5rem;
            margin-bottom: 0.25rem;
        }
        .detail-content p, .detail-content li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="p-4">
    <div class="container bg-white shadow-lg rounded-lg p-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-4 text-center">Học Trợ từ Tiếng Nhật (助詞 - Joshi)</h1>

        <div class="flex flex-wrap gap-4 mb-6">
            <button id="toggleRomanji" class="toggle-button">Ẩn Romanji</button>
            <button id="toggleFurigana" class="toggle-button">Ẩn Furigana</button>
        </div>

        <div class="mb-6 bg-blue-50 p-4 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Trợ từ (助詞 - Joshi) là gì?</h3>
            <p class="text-gray-600">
                Trợ từ là những từ ngắn được sử dụng trong ngữ pháp tiếng Nhật để chỉ mối quan hệ giữa các từ trong một câu. Chúng thường đứng sau danh từ, động từ, tính từ và xác định vai trò ngữ pháp của từ đó (ví dụ: chủ ngữ, tân ngữ, địa điểm, thời gian). Việc sử dụng đúng trợ từ là cực kỳ quan trọng để xây dựng câu có nghĩa và tự nhiên.
            </p>
        </div>

        <div class="overflow-x-auto">
            <table id="particleTable" class="min-w-full">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">STT</th>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">Trợ từ</th>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">Cách đọc</th>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">Ý nghĩa chính</th>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">Câu ví dụ</th>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">Phát âm</th>
                        <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600">Chi tiết</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <!-- Các hàng trợ từ sẽ được chèn vào đây bởi JavaScript -->
                </tbody>
            </table>
        </div>

        <div id="typingPracticeSection" class="mt-8 p-4 bg-blue-50 rounded-lg shadow-md fixed-typing-practice">
            <h3 class="text-xl font-bold text-blue-800 mb-4">Luyện gõ trợ từ</h3>
            <p class="text-gray-700 mb-2">Gõ trợ từ hoặc câu ví dụ tiếng Nhật từ bảng trên vào ô dưới đây và nhấn "Kiểm tra".</p>
            <input type="text" id="userInput" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 mb-3 text-gray-800" placeholder="Gõ tiếng Nhật vào đây...">
            <button id="checkButton" class="toggle-button bg-green-600 hover:bg-green-700">Kiểm tra</button>
            <div id="feedback" class="mt-3 text-lg font-semibold"></div>
        </div>
    </div>

    <footer class="text-center py-4 text-gray-600 text-sm mt-8">
        <p>AzaCan 2025. All rights reserved.</p>
    </footer>

    <script>
        // Dữ liệu trợ từ tiếng Nhật dưới dạng chuỗi JSON
        const japaneseParticlesString = `[
            {
                "STT": 1,
                "Particle": "は",
                "Reading": "wa",
                "VietnameseMeaning": "Chỉ chủ đề (là, thì, ở)",
                "ExampleSentence": {
                    "Japanese": "私は学生です。",
                    "Furigana": "わたしはがくせいです。",
                    "Romanji": "Watashi wa gakusei desu.",
                    "VietnameseMeaning": "Tôi là học sinh."
                },
                "Details": {
                    "DetailedUsage": "Đánh dấu chủ đề của câu. Chủ đề là cái mà người nói muốn nói về. Nó nhấn mạnh vào phần thông tin (vị ngữ) đứng sau nó.",
                    "Nuances": "Thường được so sánh với 'が'. 'は' dùng cho thông tin đã biết hoặc để tạo sự tương phản. Ví dụ: 'ビールは飲みますが、ワインは飲みません。' (Bia thì tôi uống, nhưng rượu vang thì không).",
                    "MoreExamples": [
                        { "Japanese": "今日は暑いです。", "Furigana": "きょうはあついです。", "Romanji": "Kyou wa atsui desu.", "VietnameseMeaning": "Hôm nay trời nóng." },
                        { "Japanese": "日本語は面白いです。", "Furigana": "にほんごはおもしろいです。", "Romanji": "Nihongo wa omoshiroi desu.", "VietnameseMeaning": "Tiếng Nhật thì thú vị." }
                    ]
                }
            },
            {
                "STT": 2,
                "Particle": "が",
                "Reading": "ga",
                "VietnameseMeaning": "Chỉ chủ ngữ",
                "ExampleSentence": {
                    "Japanese": "猫が好きです。",
                    "Furigana": "ねこがすきです。",
                    "Romanji": "Neko ga suki desu.",
                    "VietnameseMeaning": "Tôi thích mèo."
                },
                "Details": {
                    "DetailedUsage": "Đánh dấu chủ ngữ của hành động hoặc trạng thái. Nó nhấn mạnh vào chính chủ ngữ đó. Thường dùng khi giới thiệu thông tin mới hoặc trong các mệnh đề phụ.",
                    "Nuances": "Khi từ để hỏi (誰, 何, どれ) là chủ ngữ, câu trả lời phải dùng 'が'. Ví dụ: '誰が来ましたか？' - '田中さんが来ました。' (Ai đã đến vậy? - Anh Tanaka đã đến.)",
                    "MoreExamples": [
                        { "Japanese": "雨が降っています。", "Furigana": "あめがふっています。", "Romanji": "Ame ga futte imasu.", "VietnameseMeaning": "Trời đang mưa." },
                        { "Japanese": "足が痛いです。", "Furigana": "あしがいたいです。", "Romanji": "Ashi ga itai desu.", "VietnameseMeaning": "Chân tôi bị đau." }
                    ]
                }
            },
            {
                "STT": 3,
                "Particle": "を",
                "Reading": "o",
                "VietnameseMeaning": "Chỉ tân ngữ trực tiếp",
                "ExampleSentence": {
                    "Japanese": "本を読みます。",
                    "Furigana": "ほんをよみます。",
                    "Romanji": "Hon o yomimasu.",
                    "VietnameseMeaning": "Tôi đọc sách."
                },
                "Details": {
                    "DetailedUsage": "Đánh dấu danh từ là tân ngữ trực tiếp của một ngoại động từ (động từ yêu cầu một đối tượng tác động).",
                    "Nuances": "Cũng được dùng để chỉ nơi chốn mà một hành động di chuyển diễn ra. Ví dụ: '公園を散歩します。' (Đi dạo trong công viên). '橋を渡ります。' (Đi qua cầu).",
                    "MoreExamples": [
                        { "Japanese": "音楽を聴きます。", "Furigana": "おんがくをききます。", "Romanji": "Ongaku o kikimasu.", "VietnameseMeaning": "Tôi nghe nhạc." },
                        { "Japanese": "角を曲がります。", "Furigana": "かどをまがります。", "Romanji": "Kado o magarimasu.", "VietnameseMeaning": "Rẽ ở góc đường." }
                    ]
                }
            },
            {
                "STT": 4,
                "Particle": "に",
                "Reading": "ni",
                "VietnameseMeaning": "Chỉ thời gian, địa điểm, mục tiêu",
                "ExampleSentence": {
                    "Japanese": "日曜日に教会へ行きます。",
                    "Furigana": "にちようびにきょうかいへいきます。",
                    "Romanji": "Nichiyoubi ni kyoukai e ikimasu.",
                    "VietnameseMeaning": "Tôi đi nhà thờ vào Chủ Nhật."
                },
                "Details": {
                    "DetailedUsage": "Có rất nhiều cách dùng: 1. Chỉ thời điểm cụ thể (７時に). 2. Chỉ đích đến của sự di chuyển (日本に行きます). 3. Chỉ sự tồn tại của vật/người ở một nơi (机の上にあります). 4. Chỉ mục đích (買い物に行きます). 5. Chỉ đối tượng của hành động (友達に会います).",
                    "Nuances": "Khi chỉ đích đến, 'に' và 'へ' khá tương đồng, nhưng 'へ' nhấn mạnh hướng đi hơn là điểm đến cuối cùng.",
                    "MoreExamples": [
                        { "Japanese": "７時に起きます。", "Furigana": "しちじにおきます。", "Romanji": "Shichiji ni okimasu.", "VietnameseMeaning": "Tôi thức dậy lúc 7 giờ." },
                        { "Japanese": "椅子に座ってください。", "Furigana": "いすにすわってください。", "Romanji": "Isu ni suwatte kudasai.", "VietnameseMeaning": "Xin hãy ngồi vào ghế." }
                    ]
                }
            },
            {
                "STT": 5,
                "Particle": "へ",
                "Reading": "e",
                "VietnameseMeaning": "Chỉ phương hướng",
                "ExampleSentence": {
                    "Japanese": "大阪へ行きます。",
                    "Furigana": "おおさかへいきます。",
                    "Romanji": "Oosaka e ikimasu.",
                    "VietnameseMeaning": "Tôi đi đến Osaka."
                },
                "Details": {
                    "DetailedUsage": "Đánh dấu phương hướng của hành động di chuyển. Nó nhấn mạnh vào 'hướng đi về phía' một nơi nào đó.",
                    "Nuances": "Trong văn nói hiện đại, 'に' thường được dùng thay cho 'へ' để chỉ đích đến. 'へ' mang sắc thái trang trọng hoặc văn viết hơn một chút.",
                    "MoreExamples": [
                        { "Japanese": "右へ曲がってください。", "Furigana": "みぎへまがってください。", "Romanji": "Migi e magatte kudasai.", "VietnameseMeaning": "Xin hãy rẽ về phía bên phải." },
                        { "Japanese": "未来へ進もう。", "Furigana": "みらいへすすめもう。", "Romanji": "Mirai e susumou.", "VietnameseMeaning": "Hãy cùng tiến về tương lai." }
                    ]
                }
            },
            {
                "STT": 6,
                "Particle": "で",
                "Reading": "de",
                "VietnameseMeaning": "Chỉ địa điểm, phương tiện",
                "ExampleSentence": {
                    "Japanese": "レストランで食べます。",
                    "Furigana": "レストランでたべます。",
                    "Romanji": "Resutoran de tabemasu.",
                    "VietnameseMeaning": "Tôi ăn ở nhà hàng."
                },
                "Details": {
                    "DetailedUsage": "1. Chỉ nơi hành động xảy ra (図書館で勉強します). 2. Chỉ phương tiện hoặc công cụ (バスで来ます, ペンで書きます). 3. Chỉ nguyên nhân (病気で休みました). 4. Chỉ phạm vi (世界で一番).",
                    "Nuances": "Không nhầm lẫn với 'に' khi chỉ địa điểm. 'で' dùng cho nơi diễn ra hành động, trong khi 'に' dùng cho nơi tồn tại của vật/người (東京に住んでいます - Tôi sống ở Tokyo).",
                    "MoreExamples": [
                        { "Japanese": "電車で会社へ行きます。", "Furigana": "でんしゃでかいしゃへいきます。", "Romanji": "Densha de kaisha e ikimasu.", "VietnameseMeaning": "Tôi đi làm bằng tàu điện." },
                        { "Japanese": "風邪で学校を休みました。", "Furigana": "かぜでがっこうをやすみました。", "Romanji": "Kaze de gakkou o yasumimashita.", "VietnameseMeaning": "Tôi đã nghỉ học vì bị cảm." }
                    ]
                }
            },
            {
                "STT": 7,
                "Particle": "の",
                "Reading": "no",
                "VietnameseMeaning": "Chỉ sự sở hữu (của)",
                "ExampleSentence": {
                    "Japanese": "私の本です。",
                    "Furigana": "わたしのほんです。",
                    "Romanji": "Watashi no hon desu.",
                    "VietnameseMeaning": "Đây là sách của tôi."
                },
                "Details": {
                    "DetailedUsage": "Kết nối hai danh từ. 1. Chỉ sự sở hữu (あなたのカバン). 2. Chỉ vị trí (机の上). 3. Chỉ thuộc tính, chất liệu (日本語の先生, 木の椅子).",
                    "Nuances": "Có thể dùng để danh từ hóa động từ hoặc cả mệnh đề. Ví dụ: '本を読むのが好きです。' (Tôi thích việc đọc sách).",
                    "MoreExamples": [
                        { "Japanese": "これは日本の車です。", "Furigana": "これはにほんのくるまです。", "Romanji": "Kore wa Nihon no kuruma desu.", "VietnameseMeaning": "Đây là xe hơi của Nhật." },
                        { "Japanese": "田中さんの電話番号を知っていますか。", "Furigana": "たなかさんのでんわばんごうをしっていますか。", "Romanji": "Tanaka-san no denwa bangou o shitte imasu ka.", "VietnameseMeaning": "Bạn có biết số điện thoại của anh Tanaka không?" }
                    ]
                }
            },
            {
                "STT": 8,
                "Particle": "と",
                "Reading": "to",
                "VietnameseMeaning": "Và, với",
                "ExampleSentence": {
                    "Japanese": "パンと卵を買いました。",
                    "Furigana": "パンとたまごをかいました。",
                    "Romanji": "Pan to tamago o kaimashita.",
                    "VietnameseMeaning": "Tôi đã mua bánh mì và trứng."
                },
                "Details": {
                    "DetailedUsage": "1. Liệt kê một danh sách đầy đủ, toàn diện (AとB). 2. Chỉ người cùng thực hiện hành động (友達と話します). 3. Trích dẫn trực tiếp (「はい」と言いました). 4. Chỉ kết quả tự nhiên (春になると、暖かくなる).",
                    "Nuances": "Để liệt kê không đầy đủ (vân vân), dùng 'や'. Ví dụ: '机の上に本やペンなどがあります。' (Trên bàn có sách, bút, v.v...)",
                    "MoreExamples": [
                        { "Japanese": "昨日、友達と映画を見ました。", "Furigana": "きのう、ともだちとえいがをみました。", "Romanji": "Kinou, tomodachi to eiga o mimashita.", "VietnameseMeaning": "Hôm qua tôi đã xem phim với bạn." },
                        { "Japanese": "彼は「さようなら」と言った。", "Furigana": "かれは「さようなら」といった。", "Romanji": "Kare wa 'sayounara' to itta.", "VietnameseMeaning": "Anh ấy đã nói 'Tạm biệt'." }
                    ]
                }
            },
            {
                "STT": 9,
                "Particle": "も",
                "Reading": "mo",
                "VietnameseMeaning": "Cũng, đến mức",
                "ExampleSentence": {
                    "Japanese": "私も学生です。",
                    "Furigana": "わたしもがくせいです。",
                    "Romanji": "Watashi mo gakusei desu.",
                    "VietnameseMeaning": "Tôi cũng là học sinh."
                },
                "Details": {
                    "DetailedUsage": "1. Thể hiện sự tương đồng, thay thế cho は, が, を (私も行きます). 2. Nhấn mạnh số lượng lớn hoặc mức độ cao (１時間も待ちました - Đã đợi đến cả 1 tiếng).",
                    "Nuances": "Khi dùng với dạng phủ định, nó có nghĩa là 'cũng không'. Ví dụ: '何も食べませんでした。' (Tôi đã không ăn gì cả).",
                    "MoreExamples": [
                        { "Japanese": "昨日も雨でした。", "Furigana": "きのうもあめでした。", "Romanji": "Kinou mo ame deshita.", "VietnameseMeaning": "Hôm qua cũng mưa." },
                        { "Japanese": "１０人も来ました。", "Furigana": "じゅうにんもきました。", "Romanji": "Juunin mo kimashita.", "VietnameseMeaning": "Có đến 10 người đã đến." }
                    ]
                }
            },
            {
                "STT": 10,
                "Particle": "から",
                "Reading": "kara",
                "VietnameseMeaning": "Từ, vì",
                "ExampleSentence": {
                    "Japanese": "９時から働きます。",
                    "Furigana": "くじから はたらきます。",
                    "Romanji": "Kuji kara hatarakimasu.",
                    "VietnameseMeaning": "Tôi làm việc từ 9 giờ."
                },
                "Details": {
                    "DetailedUsage": "1. Chỉ điểm bắt đầu về thời gian hoặc không gian (東京から). 2. Chỉ nguyên liệu (ワインはぶどうから作られます). 3. Chỉ nguyên nhân, lý do (時間がないから、行きません).",
                    "Nuances": "Thường đi cặp với 'まで' (đến). 'から' chỉ lý do mang tính chủ quan của người nói, trong khi 'ので' (node) chỉ lý do khách quan hơn.",
                    "MoreExamples": [
                        { "Japanese": "家から駅まで歩きます。", "Furigana": "いえからえきまであるきます。", "Romanji": "Ie kara eki made arukimasu.", "VietnameseMeaning": "Tôi đi bộ từ nhà đến ga." },
                        { "Japanese": "危ないですから、触らないでください。", "Furigana": "あぶないですから、さわらないでください。", "Romanji": "Abunai desu kara, sawaranaide kudasai.", "VietnameseMeaning": "Vì nguy hiểm nên xin đừng chạm vào." }
                    ]
                }
            },
            {
                "STT": 11,
                "Particle": "まで",
                "Reading": "made",
                "VietnameseMeaning": "Đến, cho đến khi",
                "ExampleSentence": {
                    "Japanese": "５時まで働きます。",
                    "Furigana": "ごじまではたらきます。",
                    "Romanji": "Goji made hatarakimasu.",
                    "VietnameseMeaning": "Tôi làm việc đến 5 giờ."
                },
                "Details": {
                    "DetailedUsage": "Chỉ điểm kết thúc về thời gian hoặc không gian. Nó ngụ ý rằng hành động hoặc trạng thái kéo dài liên tục cho đến điểm đó.",
                    "Nuances": "Phân biệt với 'までに' (made ni). 'まで' chỉ hành động kéo dài đến một thời điểm, còn 'までに' chỉ hạn chót mà một hành động phải được hoàn thành. Ví dụ: '５時までにレポートを出してください。' (Hãy nộp báo cáo trước 5 giờ).",
                    "MoreExamples": [
                        { "Japanese": "次の駅までお願いします。", "Furigana": "つぎのえきまでおねがいします。", "Romanji": "Tsugi no eki made onegaishimasu.", "VietnameseMeaning": "Làm ơn cho tôi đến ga tiếp theo." },
                        { "Japanese": "子供から大人まで楽しめます。", "Furigana": "こどもからおとなまでたのしめます。", "Romanji": "Kodomo kara otona made tanoshimemasu.", "VietnameseMeaning": "Từ trẻ em đến người lớn đều có thể thưởng thức." }
                    ]
                }
            },
            {
                "STT": 12,
                "Particle": "や",
                "Reading": "ya",
                "VietnameseMeaning": "Và (liệt kê không đầy đủ)",
                "ExampleSentence": {
                    "Japanese": "机の上に本やペンがあります。",
                    "Furigana": "つくえのうえにほんやペンがあります。",
                    "Romanji": "Tsukue no ue ni hon ya pen ga arimasu.",
                    "VietnameseMeaning": "Trên bàn có sách và bút (và những thứ khác)."
                },
                "Details": {
                    "DetailedUsage": "Dùng để liệt kê một vài ví dụ tiêu biểu từ một danh sách dài hơn. Thường đi kèm với 'など' ở cuối.",
                    "Nuances": "Khác với 'と' (dùng để liệt kê đầy đủ). Dùng 'や' khi bạn không muốn hoặc không thể liệt kê tất cả mọi thứ.",
                    "MoreExamples": [
                        { "Japanese": "スーパーで野菜や果物を買いました。", "Furigana": "スーパーでやさいやくだものをかいました。", "Romanji": "Suupaa de yasai ya kudamono o kaimashita.", "VietnameseMeaning": "Tôi đã mua rau và trái cây ở siêu thị." },
                        { "Japanese": "休みの日には、掃除や洗濯などをします。", "Furigana": "やすみのひには、そうじやせんたくなどをします。", "Romanji": "Yasumi no hi niwa, souji ya sentaku nado o shimasu.", "VietnameseMeaning": "Vào ngày nghỉ, tôi làm những việc như dọn dẹp và giặt giũ." }
                    ]
                }
            }
        ]`;

        // Phân tích cú pháp chuỗi JSON thành đối tượng JavaScript
        const japaneseParticles = JSON.parse(japaneseParticlesString);

        // Lấy các phần tử DOM cần thiết
        const particleTableBody = document.querySelector('#particleTable tbody');
        const toggleRomanjiButton = document.getElementById('toggleRomanji');
        const toggleFuriganaButton = document.getElementById('toggleFurigana');
        const userInput = document.getElementById('userInput');
        const checkButton = document.getElementById('checkButton');
        const feedbackDiv = document.getElementById('feedback');
        const typingPracticeSection = document.getElementById('typingPracticeSection');

        // Biến trạng thái để kiểm soát hiển thị Romanji và Furigana
        let showRomanji = false; // Mặc định ẩn Romanji
        let showFurigana = true;

        /**
         * Hàm phát âm văn bản tiếng Nhật.
         * Sử dụng SpeechSynthesis API của trình duyệt.
         * @param {string} text - Văn bản cần phát âm.
         */
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP'; // Đặt ngôn ngữ là tiếng Nhật
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            } else {
                feedbackDiv.textContent = 'Trình duyệt của bạn không hỗ trợ phát âm.';
                feedbackDiv.style.color = 'red';
            }
        }

        /**
         * Hàm cập nhật hiển thị của các văn bản Romanji và Furigana.
         */
        function updateTextVisibility() {
            document.querySelectorAll('.romanji-text').forEach(span => {
                span.classList.toggle('hidden-text', !showRomanji);
            });
            document.querySelectorAll('.furigana-text').forEach(span => {
                span.classList.toggle('hidden-text', !showFurigana);
            });

            toggleRomanjiButton.textContent = showRomanji ? 'Ẩn Romanji' : 'Hiện Romanji';
            toggleFuriganaButton.textContent = showFurigana ? 'Ẩn Furigana' : 'Hiện Furigana';
        }

        /**
         * Hàm hiển thị các hàng trợ từ vào bảng.
         */
        function renderTable() {
            particleTableBody.innerHTML = ''; // Xóa các hàng hiện có
            japaneseParticles.forEach(item => {
                const row = document.createElement('tr');
                row.dataset.particleId = item.STT;

                row.innerHTML = `
                    <td class="py-3 px-4 text-sm text-gray-700">${item.STT}</td>
                    <td class="py-3 px-4 text-lg font-bold text-indigo-700">${item.Particle}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${item.Reading}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${item.VietnameseMeaning}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">
                        <span class="japanese-text">${item.ExampleSentence.Japanese}</span><br>
                        <span class="furigana-text text-blue-600">${item.ExampleSentence.Furigana}</span>
                        <span class="romanji-text text-gray-500">${item.ExampleSentence.Romanji}</span><br>
                        <span class="text-green-700">${item.ExampleSentence.VietnameseMeaning}</span>
                    </td>
                    <td class="py-3 px-4 text-sm text-gray-700">
                        <button class="play-button" onclick="speakText('${item.ExampleSentence.Japanese.replace(/'/g, "\\'")}')">Phát âm</button>
                    </td>
                    <td class="py-3 px-4 text-sm text-gray-700">
                        <button class="expand-button" data-action="expand">Chi tiết</button>
                    </td>
                `;
                particleTableBody.appendChild(row);

                // Tạo hàng chi tiết ẩn
                const detailRow = document.createElement('tr');
                detailRow.classList.add('detail-row', 'hidden-text');
                detailRow.dataset.particleId = item.STT;
                
                let moreExamplesHTML = item.Details.MoreExamples.map(ex => `
                    <li class="ml-4 list-disc">
                        <span class="japanese-text">${ex.Japanese}</span><br>
                        <span class="furigana-text text-blue-600">${ex.Furigana}</span>
                        <span class="romanji-text text-gray-500">${ex.Romanji}</span><br>
                        <span class="text-green-700">${ex.VietnameseMeaning}</span>
                        <button class="play-button" onclick="speakText('${ex.Japanese.replace(/'/g, "\\'")}')">Nghe</button>
                    </li>
                `).join('');

                detailRow.innerHTML = `
                    <td colspan="7" class="p-4">
                        <div class="detail-content">
                            <h5 class="text-md font-semibold">Cách dùng chi tiết:</h5>
                            <p>${item.Details.DetailedUsage}</p>
                            <h5 class="text-md font-semibold">Lưu ý / So sánh:</h5>
                            <p>${item.Details.Nuances}</p>
                            <h5 class="text-md font-semibold">Ví dụ thêm:</h5>
                            <ul>${moreExamplesHTML}</ul>
                        </div>
                    </td>
                `;
                particleTableBody.appendChild(detailRow);
            });
            updateTextVisibility();
        }

        /**
         * Hàm chuẩn hóa văn bản để so sánh.
         * @param {string} text - Văn bản cần chuẩn hóa.
         * @returns {string} Văn bản đã chuẩn hóa.
         */
        function normalizeText(text) {
            return text.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~() ]/g,"").replace(/\s/g, '');
        }

        /**
         * Hàm tính toán và đặt padding-bottom cho body.
         */
        function setBodyPadding() {
            const footerHeight = typingPracticeSection.offsetHeight;
            document.body.style.paddingBottom = `${footerHeight + 20}px`;
        }

        // Lắng nghe sự kiện click cho nút kiểm tra
        checkButton.addEventListener('click', () => {
            const userInputText = normalizeText(userInput.value);
            if (!userInputText) return;
            
            let isCorrect = false;

            for (const item of japaneseParticles) {
                const textsToCompare = [
                    item.Particle,
                    item.Reading,
                    item.ExampleSentence.Japanese,
                    item.ExampleSentence.Furigana
                ];
                item.Details.MoreExamples.forEach(ex => {
                    textsToCompare.push(ex.Japanese, ex.Furigana);
                });

                if (textsToCompare.some(text => normalizeText(text) === userInputText)) {
                    isCorrect = true;
                    break;
                }
            }

            if (isCorrect) {
                feedbackDiv.textContent = '🎉 Đúng rồi!';
                feedbackDiv.style.color = 'green';
                userInput.value = '';
            } else {
                feedbackDiv.textContent = 'Sai rồi. Hãy thử lại!';
                feedbackDiv.style.color = 'red';
            }
        });
        
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                checkButton.click();
            }
        });

        // Lắng nghe sự kiện click cho nút bật/tắt Romanji
        toggleRomanjiButton.addEventListener('click', () => {
            showRomanji = !showRomanji;
            updateTextVisibility();
        });

        // Lắng nghe sự kiện click cho nút bật/tắt Furigana
        toggleFuriganaButton.addEventListener('click', () => {
            showFurigana = !showFurigana;
            updateTextVisibility();
        });

        // Lắng nghe sự kiện click cho các nút mở rộng/thu gọn
        particleTableBody.addEventListener('click', (event) => {
            const button = event.target.closest('.expand-button');
            if (button) {
                const row = button.closest('tr');
                const particleId = row.dataset.particleId;
                const detailRow = document.querySelector(`.detail-row[data-particle-id="${particleId}"]`);

                if (detailRow) {
                    detailRow.classList.toggle('hidden-text');
                    button.textContent = detailRow.classList.contains('hidden-text') ? 'Chi tiết' : 'Thu gọn';
                    updateTextVisibility();
                }
            }
        });

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', () => {
            renderTable();
            setBodyPadding();
        });
        window.addEventListener('resize', setBodyPadding);
    </script>
</body>
</html>
