<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 8: Kỹ năng & Hoạt động</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 8: Kỹ năng & Hoạt động</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">泳ぎます</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">およぎます</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Bơi</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 8 (N5 - N4)</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (N5 - N4) ---
        const grammarRepo = {
            "dictionary_form": { title: "Thể từ điển (V-ru)", formula: "Vる", desc: "N5: Dạng cơ bản của động từ, dùng cho tương lai/thói quen.", ex: "辞書で調べます。" },
            "shumi": { title: "Sở thích", formula: "趣味は N / Vる ことです", desc: "N4: Nói về sở thích.", ex: "私の趣味は音楽を聞くことです。" },
            "koto_ga_dekiru": { title: "Khả năng", formula: "Vる + ことができる", desc: "N4: Có thể làm gì đó.", ex: "ピアノを弾くことができます。" },
            "mae_ni": { title: "Trước khi", formula: "Vる/Nの + 前に", desc: "N4: Làm gì trước một hành động khác.", ex: "寝る前に歯を磨きます。" },
            "tari_tari": { title: "Liệt kê hành động", formula: "Vたり Vたり します", desc: "N4: Làm những việc như A, B (không theo thứ tự).", ex: "休みの日は本を読んだり、テレビを見たりします。" },
            "ta_form": { title: "Thể quá khứ ngắn", formula: "Vた", desc: "N5: Dùng trong văn nói thân mật kể chuyện quá khứ.", ex: "昨日、映画見た？" },
            "nagara": { title: "Vừa...vừa...", formula: "V(bỏ masu) + ながら", desc: "N4: Hai hành động song song.", ex: "音楽を聞きながら勉強します。" },
            "te_kudasai": { title: "Hãy...", formula: "Vてください", desc: "N5: Yêu cầu, nhờ vả lịch sự.", ex: "ここに名前を書いてください。" },
            "nai_de": { title: "Không làm mà...", formula: "Vないで", desc: "N4: Trạng thái không làm V1 mà làm V2.", ex: "朝ごはんを食べないで学校へ行きました。" },
            "wa_desu": { title: "Cấu trúc định danh", formula: "N1 は N2 です", desc: "N5: Khẳng định N1 là N2.", ex: "これはペンです。" },
            "wo_particle": { title: "Trợ từ O", formula: "N + を + V", desc: "N5: Chỉ đối tượng tác động của hành động.", ex: "ご飯を食べます。" },
            "de_method": { title: "Bằng cách nào", formula: "N(phương tiện) + で", desc: "N5: Phương tiện, cách thức di chuyển/thực hiện.", ex: "バスで行きます。" },
            "ni_place": { title: "Ở/Tại (Tồn tại/Đích đến)", formula: "N + に", desc: "N5: Chỉ nơi tồn tại hoặc điểm đến.", ex: "ホテルに泊まります。" },
            "ga_aru": { title: "Có (sở hữu/tồn tại)", formula: "N + が ある", desc: "N5: Có đồ vật, sự việc.", ex: "時間があります。" },
            "te_iru": { title: "Đang/Trạng thái", formula: "Vている", desc: "N5/N4: Hành động đang diễn ra hoặc kết quả trạng thái.", ex: "雨が降っています。" },
            "koto_ga_aru": { title: "Đã từng", formula: "Vた + ことが（ある）", desc: "N4: Kinh nghiệm trong quá khứ.", ex: "日本へ行ったことがあります。" },
            "te_oku": { title: "Làm sẵn", formula: "Vておく", desc: "N4: Chuẩn bị sẵn cho tương lai.", ex: "予約しておきます。" },
            "kinshi": { title: "Cấm đoán", formula: "Vる + な / N + 禁止", desc: "N4: Cấm không được làm gì.", ex: "ここでタバコを吸うな。" },
            "potential": { title: "Thể khả năng", formula: "Vれる / Vられる", desc: "N4: Có thể làm gì (dạng ngắn của koto ga dekiru).", ex: "日本語が話せます。" },
            "volitional": { title: "Thể ý định", formula: "Vよう", desc: "N4: Dùng trong văn nói thân mật để rủ rê hoặc tỏ ý định.", ex: "行こう！" },
            "mashou": { title: "Cùng làm nhé", formula: "Vましょう", desc: "N5: Rủ rê, đề nghị.", ex: "帰りましょう。" },
            "to_omou": { title: "Nghĩ rằng", formula: "～と 思います", desc: "N4: Biểu thị suy nghĩ, phỏng đoán.", ex: "明日雨が降ると思います。" },
            "ba_yokatta": { title: "Giá mà...", formula: "Vば + よかった", desc: "N3: Hối tiếc về việc đã không làm.", ex: "もっと勉強すればよかった。" },
            "tara": { title: "Nếu/Sau khi", formula: "Vたら", desc: "N4: Điều kiện giả định hoặc hành động nối tiếp.", ex: "雨が降ったら、行きません。" },
            "te_mo": { title: "Cho dù/Cũng được", formula: "Vても", desc: "N4: Nhượng bộ hoặc cho phép.", ex: "高くても買います。" },
            "tsumori": { title: "Dự định", formula: "Vる/ない + つもり", desc: "N4: Dự định làm hoặc không làm gì (khá chắc chắn).", ex: "来年、日本へ留学するつもりです。" }
        };

        // --- 2. VOCABULARY DATA (Day 8: Skills & Activities) ---
        const vocabData = [
            { "STT": 1, "Kanji": "泳ぎます", "Nghĩa": "Bơi", "Furigana": "およぎます", "type": "verb", "conv": { "polite": "泳ぐことができますか。", "pVi": "Bạn có biết bơi không?", "casual": "泳げる？", "cVi": "Biết bơi không?", "gIds": ["koto_ga_dekiru", "potential"] } },
            { "STT": 2, "Kanji": "洗います", "Nghĩa": "Rửa", "Furigana": "あらいます", "type": "verb", "conv": { "polite": "食事の前に手を洗います。", "pVi": "Tôi rửa tay trước khi ăn.", "casual": "食べる前に手洗う。", "cVi": "Rửa tay trước khi ăn.", "gIds": ["mae_ni"] } },
            { "STT": 3, "Kanji": "弾きます", "Nghĩa": "Chơi (đàn)", "Furigana": "ひきます", "type": "verb", "conv": { "polite": "ピアノを弾くことができます。", "pVi": "Tôi có thể chơi piano.", "casual": "ピアノ弾けるよ。", "cVi": "Tớ chơi được piano đấy.", "gIds": ["koto_ga_dekiru", "potential"] } },
            { "STT": 4, "Kanji": "歌います", "Nghĩa": "Hát", "Furigana": "うたいます", "type": "verb", "conv": { "polite": "歌を歌うのが好きです。", "pVi": "Tôi thích hát.", "casual": "歌うの好き。", "cVi": "Thích hát.", "gIds": ["shumi"] } },
            { "STT": 5, "Kanji": "集めます", "Nghĩa": "Sưu tầm", "Furigana": "あつめます", "type": "verb", "conv": { "polite": "切手を集めるのが趣味です。", "pVi": "Sở thích của tôi là sưu tập tem.", "casual": "切手集めるのが趣味。", "cVi": "Sở thích là sưu tập tem.", "gIds": ["shumi"] } },
            { "STT": 6, "Kanji": "捨てます", "Nghĩa": "Vứt bỏ", "Furigana": "すてます", "type": "verb", "conv": { "polite": "ここにゴミを捨てないでください。", "pVi": "Xin đừng vứt rác ở đây.", "casual": "ここゴミ捨て禁止。", "cVi": "Cấm vứt rác ở đây.", "gIds": ["nai_de", "kinshi"] } },
            { "STT": 7, "Kanji": "換えます", "Nghĩa": "Đổi", "Furigana": "かえます", "type": "verb", "conv": { "polite": "円をドルに換えます。", "pVi": "Tôi đổi tiền Yên sang Đô la.", "casual": "円をドルに換える。", "cVi": "Đổi Yên sang Đô.", "gIds": ["wo_particle"] } },
            { "STT": 8, "Kanji": "運転します", "Nghĩa": "Lái xe", "Furigana": "うんてんします", "type": "verb", "conv": { "polite": "車の運転ができます。", "pVi": "Tôi có thể lái xe hơi.", "casual": "運転できるよ。", "cVi": "Lái xe được đấy.", "gIds": ["koto_ga_dekiru"] } },
            { "STT": 9, "Kanji": "予約します", "Nghĩa": "Đặt chỗ", "Furigana": "よやくします", "type": "verb", "conv": { "polite": "ホテルを予約しておきます。", "pVi": "Tôi sẽ đặt khách sạn sẵn.", "casual": "ホテル予約しとく。", "cVi": "Tớ đặt khách sạn sẵn cho.", "gIds": ["te_oku"] } },
            { "STT": 10, "Kanji": "見学します", "Nghĩa": "Tham quan", "Furigana": "けんがくします", "type": "verb", "conv": { "polite": "工場を見学します。", "pVi": "Tôi tham quan nhà máy.", "casual": "工場見学する。", "cVi": "Đi tham quan nhà máy.", "gIds": [] } },
            { "STT": 11, "Kanji": "習います", "Nghĩa": "Học (từ ai)", "Furigana": "ならいます", "type": "verb", "conv": { "polite": "ピアノを習いたいです。", "pVi": "Tôi muốn học piano.", "casual": "ピアノ習いたい。", "cVi": "Muốn học piano.", "gIds": ["tai"] } },
            { "STT": 12, "Kanji": "乗ります", "Nghĩa": "Lên xe/Cưỡi", "Furigana": "のります", "type": "verb", "conv": { "polite": "馬に乗ったことがありますか。", "pVi": "Bạn đã từng cưỡi ngựa chưa?", "casual": "馬に乗ったことある？", "cVi": "Cưỡi ngựa bao giờ chưa?", "gIds": ["koto_ga_aru"] } },
            { "STT": 13, "Kanji": "登ります", "Nghĩa": "Leo núi", "Furigana": "のぼります", "type": "verb", "conv": { "polite": "山に登るのが好きです。", "pVi": "Tôi thích leo núi.", "casual": "山登るの好き。", "cVi": "Thích leo núi.", "gIds": ["shumi"] } },
            { "STT": 14, "Kanji": "入ります", "Nghĩa": "Vào", "Furigana": "はいります", "type": "verb", "conv": { "polite": "お風呂に入ってから寝ます。", "pVi": "Sau khi tắm xong tôi sẽ ngủ.", "casual": "お風呂入ってから寝る。", "cVi": "Tắm xong rồi ngủ.", "gIds": ["te_form_cause"] } },
            { "STT": 15, "Kanji": "浴びます", "Nghĩa": "Tắm", "Furigana": "あびます", "type": "verb", "conv": { "polite": "シャワーを浴びます。", "pVi": "Tôi tắm vòi sen.", "casual": "シャワー浴びる。", "cVi": "Tắm đây.", "gIds": ["wo_particle"] } },
            { "STT": 16, "Kanji": "泊まります", "Nghĩa": "Trọ lại", "Furigana": "とまります", "type": "verb", "conv": { "polite": "友達の家に泊まります。", "pVi": "Tôi trọ lại nhà bạn.", "casual": "友達んちに泊まる。", "cVi": "Ngủ lại nhà bạn.", "gIds": ["ni_place"] } },
            { "STT": 17, "Kanji": "ピアノ", "Nghĩa": "Piano", "Furigana": "ピアノ", "type": "noun", "conv": { "polite": "ピアノが弾けますか。", "pVi": "Bạn có chơi được piano không?", "casual": "ピアノ弾ける？", "cVi": "Chơi được piano không?", "gIds": ["potential"] } },
            { "STT": 18, "Kanji": "ギター", "Nghĩa": "Ghi-ta", "Furigana": "ギター", "type": "noun", "conv": { "polite": "ギターを弾くことができます。", "pVi": "Tôi có thể chơi ghi-ta.", "casual": "ギター弾けるよ。", "cVi": "Chơi được ghi-ta đấy.", "gIds": ["koto_ga_dekiru"] } },
            { "STT": 19, "Kanji": "スキー", "Nghĩa": "Trượt tuyết", "Furigana": "スキー", "type": "activity", "conv": { "polite": "スキーに行きましょう。", "pVi": "Cùng đi trượt tuyết nào.", "casual": "スキー行こう。", "cVi": "Đi trượt tuyết đi.", "gIds": ["mashou", "volitional"] } },
            { "STT": 20, "Kanji": "歌", "Nghĩa": "Bài hát", "Furigana": "うた", "type": "noun", "conv": { "polite": "日本の歌を歌います。", "pVi": "Tôi hát bài hát Nhật Bản.", "casual": "日本の歌歌う。", "cVi": "Hát nhạc Nhật.", "gIds": ["wo_particle"] } },
            { "STT": 21, "Kanji": "現金", "Nghĩa": "Tiền mặt", "Furigana": "げんきん", "type": "noun", "conv": { "polite": "現金で払わなければなりません。", "pVi": "Phải trả bằng tiền mặt.", "casual": "現金で払わなきゃ。", "cVi": "Phải trả tiền mặt.", "gIds": ["nakucha"] } },
            { "STT": 22, "Kanji": "趣味", "Nghĩa": "Sở thích", "Furigana": "しゅみ", "type": "noun", "conv": { "polite": "趣味は何ですか。", "pVi": "Sở thích của bạn là gì?", "casual": "趣味は何？", "cVi": "Sở thích là gì?", "gIds": ["wa_desu"] } },
            { "STT": 23, "Kanji": "日記", "Nghĩa": "Nhật ký", "Furigana": "にっき", "type": "noun", "conv": { "polite": "毎日日記を書いています。", "pVi": "Tôi viết nhật ký mỗi ngày.", "casual": "毎日日記書いてる。", "cVi": "Ngày nào cũng viết nhật ký.", "gIds": ["te_iru"] } },
            { "STT": 24, "Kanji": "お祈り", "Nghĩa": "Cầu nguyện", "Furigana": "おいのり", "type": "activity", "conv": { "polite": "お祈りをします。", "pVi": "Tôi cầu nguyện.", "casual": "お祈りする。", "cVi": "Cầu nguyện đây.", "gIds": [] } },
            { "STT": 25, "Kanji": "課長", "Nghĩa": "Trưởng nhóm", "Furigana": "かちょう", "type": "noun", "conv": { "polite": "課長に相談します。", "pVi": "Tôi sẽ thảo luận với trưởng nhóm.", "casual": "課長に相談する。", "cVi": "Hỏi ý kiến tổ trưởng.", "gIds": [] } },
            { "STT": 26, "Kanji": "部長", "Nghĩa": "Trưởng phòng", "Furigana": "ぶちょう", "type": "noun", "conv": { "polite": "部長は厳しいです。", "pVi": "Trưởng phòng nghiêm khắc lắm.", "casual": "部長、厳しいね。", "cVi": "Trưởng phòng khó tính ghê.", "gIds": ["wa_desu"] } },
            { "STT": 27, "Kanji": "社長", "Nghĩa": "Giám đốc", "Furigana": "しゃちょう", "type": "noun", "conv": { "polite": "社長にお会いしました。", "pVi": "Tôi đã gặp giám đốc.", "casual": "社長に会ったよ。", "cVi": "Gặp giám đốc rồi.", "gIds": ["ta_form"] } },
            { "STT": 28, "Kanji": "動物", "Nghĩa": "Động vật", "Furigana": "どうぶつ", "type": "noun", "conv": { "polite": "動物が好きです。", "pVi": "Tôi thích động vật.", "casual": "動物好き。", "cVi": "Thích động vật.", "gIds": ["wa_desu"] } },
            { "STT": 29, "Kanji": "馬", "Nghĩa": "Con ngựa", "Furigana": "うま", "type": "noun", "conv": { "polite": "馬に乗ることができます。", "pVi": "Tôi có thể cưỡi ngựa.", "casual": "馬に乗れる。", "cVi": "Cưỡi ngựa được đấy.", "gIds": ["koto_ga_dekiru", "potential"] } },
            { "STT": 30, "Kanji": "牧場", "Nghĩa": "Trang trại", "Furigana": "ぼくじょう", "type": "place", "conv": { "polite": "牧場へ行きたいです。", "pVi": "Tôi muốn đi trang trại.", "casual": "牧場行きたい。", "cVi": "Muốn đi trang trại.", "gIds": ["tai"] } },
            { "STT": 31, "Kanji": "インターネット", "Nghĩa": "Internet", "Furigana": "インターネット", "type": "noun", "conv": { "polite": "インターネットで調べます。", "pVi": "Tôi tra cứu trên internet.", "casual": "ネットで調べる。", "cVi": "Tra mạng xem.", "gIds": ["de_method"] } },
            { "STT": 32, "Kanji": "写真", "Nghĩa": "Ảnh", "Furigana": "しゃしん", "type": "noun", "conv": { "polite": "写真を撮ってもいいですか。", "pVi": "Tôi chụp ảnh được không?", "casual": "写真撮っていい？", "cVi": "Chụp ảnh nhé?", "gIds": ["te_mo_ii"] } },
            { "STT": 33, "Kanji": "段々", "Nghĩa": "Dần dần", "Furigana": "だんだん", "type": "noun", "conv": { "polite": "だんだん寒くなります。", "pVi": "Trời dần dần trở lạnh.", "casual": "だんだん寒くなるね。", "cVi": "Lạnh dần rồi nhỉ.", "gIds": [] } },
            { "STT": 34, "Kanji": "初めて", "Nghĩa": "Lần đầu tiên", "Furigana": "はじめて", "type": "noun", "conv": { "polite": "初めて日本へ来ました。", "pVi": "Lần đầu tiên tôi đến Nhật.", "casual": "初めて日本に来た。", "cVi": "Lần đầu đến Nhật đấy.", "gIds": ["ta_form"] } },
            { "STT": 35, "Kanji": "未だ", "Nghĩa": "Chưa", "Furigana": "まだ", "type": "noun", "conv": { "polite": "まだ食べていません。", "pVi": "Tôi vẫn chưa ăn.", "casual": "まだ食べてない。", "cVi": "Vẫn chưa ăn.", "gIds": ["te_iru"] } },
            { "STT": 36, "Kanji": "もう", "Nghĩa": "Đã... rồi", "Furigana": "もう", "type": "noun", "conv": { "polite": "もう帰りましたか。", "pVi": "Đã về rồi à?", "casual": "もう帰った？", "cVi": "Về rồi á?", "gIds": ["ta_form"] } },
            { "STT": 37, "Kanji": "本当", "Nghĩa": "Thật sự", "Furigana": "ほんとう", "type": "noun", "conv": { "polite": "本当ですか。", "pVi": "Thật vậy ạ?", "casual": "本当？", "cVi": "Thật á?", "gIds": ["wa_desu"] } },
            { "STT": 38, "Kanji": "します", "Nghĩa": "Làm/Chơi", "Furigana": "します", "type": "verb", "conv": { "polite": "テニスをします。", "pVi": "Tôi chơi tennis.", "casual": "テニスする。", "cVi": "Chơi tennis.", "gIds": [] } },
            { "STT": 39, "Kanji": "来ます", "Nghĩa": "Đến", "Furigana": "きます", "type": "verb", "conv": { "polite": "また来てください。", "pVi": "Hãy lại đến nhé.", "casual": "また来てね。", "cVi": "Lại đến nha.", "gIds": ["te_kudasai"] } },
            { "STT": 40, "Kanji": "食べます", "Nghĩa": "Ăn", "Furigana": "たべます", "type": "verb", "conv": { "polite": "寿司を食べたことがありますか。", "pVi": "Bạn đã từng ăn sushi chưa?", "casual": "寿司食べたことある？", "cVi": "Ăn sushi bao giờ chưa?", "gIds": ["koto_ga_aru"] } },
            { "STT": 41, "Kanji": "飲みます", "Nghĩa": "Uống", "Furigana": "のみます", "type": "verb", "conv": { "polite": "お酒を飲みすぎないでください。", "pVi": "Xin đừng uống quá nhiều rượu.", "casual": "飲みすぎないでね。", "cVi": "Đừng uống nhiều quá.", "gIds": ["nai_de"] } },
            { "STT": 42, "Kanji": "見ます", "Nghĩa": "Xem", "Furigana": "みます", "type": "verb", "conv": { "polite": "映画を見に行きます。", "pVi": "Tôi đi xem phim.", "casual": "映画見に行く。", "cVi": "Đi xem phim đây.", "gIds": ["ni_iku"] } },
            { "STT": 43, "Kanji": "聞きます", "Nghĩa": "Nghe", "Furigana": "ききます", "type": "verb", "conv": { "polite": "音楽を聞くのが好きです。", "pVi": "Tôi thích nghe nhạc.", "casual": "音楽聞くの好き。", "cVi": "Thích nghe nhạc.", "gIds": ["shumi"] } },
            { "STT": 44, "Kanji": "書きます", "Nghĩa": "Viết", "Furigana": "かきます", "type": "verb", "conv": { "polite": "レポートを書かなければなりません。", "pVi": "Tôi phải viết báo cáo.", "casual": "レポート書かなきゃ。", "cVi": "Phải viết báo cáo thôi.", "gIds": ["nakucha"] } },
            { "STT": 45, "Kanji": "読みます", "Nghĩa": "Đọc", "Furigana": "よみます", "type": "verb", "conv": { "polite": "本を読んだりします。", "pVi": "Tôi làm những việc như đọc sách.", "casual": "本読んだりする。", "cVi": "Toàn đọc sách các kiểu.", "gIds": ["tari_tari"] } },
            { "STT": 46, "Kanji": "話します", "Nghĩa": "Nói chuyện", "Furigana": "はなします", "type": "verb", "conv": { "polite": "日本語を話すことができます。", "pVi": "Tôi có thể nói tiếng Nhật.", "casual": "日本語話せる。", "cVi": "Nói được tiếng Nhật.", "gIds": ["koto_ga_dekiru", "potential"] } },
            { "STT": 47, "Kanji": "買います", "Nghĩa": "Mua", "Furigana": "かいます", "type": "verb", "conv": { "polite": "高いですが、買います。", "pVi": "Đắt nhưng tôi vẫn mua.", "casual": "高いけど、買う。", "cVi": "Đắt nhưng vẫn mua.", "gIds": ["te_mo"] } },
            { "STT": 48, "Kanji": "会います", "Nghĩa": "Gặp", "Furigana": "あいます", "type": "verb", "conv": { "polite": "友達に会う約束があります。", "pVi": "Tôi có hẹn gặp bạn.", "casual": "友達に会う約束がある。", "cVi": "Có hẹn với bạn.", "gIds": ["ga_aru"] } },
            { "STT": 49, "Kanji": "待ちます", "Nghĩa": "Đợi", "Furigana": "まちます", "type": "verb", "conv": { "polite": "ここで待ってください。", "pVi": "Hãy đợi ở đây.", "casual": "ここで待ってて。", "cVi": "Đợi ở đây nhé.", "gIds": ["te_kudasai"] } },
            { "STT": 50, "Kanji": "撮ります", "Nghĩa": "Chụp (ảnh)", "Furigana": "とります", "type": "verb", "conv": { "polite": "写真を撮ってもいいですか。", "pVi": "Tôi chụp ảnh được không?", "casual": "写真撮っていい？", "cVi": "Chụp ảnh được không?", "gIds": ["te_mo_ii"] } },
            { "STT": 51, "Kanji": "分かります", "Nghĩa": "Hiểu", "Furigana": "わかります", "type": "verb", "conv": { "polite": "意味が分かりますか。", "pVi": "Bạn có hiểu nghĩa không?", "casual": "意味分かる？", "cVi": "Hiểu nghĩa không?", "gIds": [] } },
            { "STT": 52, "Kanji": "あります", "Nghĩa": "Có (vật)", "Furigana": "あります", "type": "verb", "conv": { "polite": "お金があります。", "pVi": "Tôi có tiền.", "casual": "お金ある。", "cVi": "Có tiền.", "gIds": ["ga_aru"] } },
            { "STT": 53, "Kanji": "います", "Nghĩa": "Có (người)", "Furigana": "います", "type": "verb", "conv": { "polite": "あそこに先生がいます。", "pVi": "Thầy giáo ở đằng kia.", "casual": "あそこに先生いる。", "cVi": "Thầy ở kia kìa.", "gIds": ["te_iru"] } },
            { "STT": 54, "Kanji": "遊びます", "Nghĩa": "Chơi", "Furigana": "あそびます", "type": "verb", "conv": { "polite": "遊びに行きましょう。", "pVi": "Cùng đi chơi nào.", "casual": "遊びに行こう。", "cVi": "Đi chơi đi.", "gIds": ["mashou", "volitional"] } },
            { "STT": 55, "Kanji": "帰ります", "Nghĩa": "Về", "Furigana": "かえります", "type": "verb", "conv": { "polite": "もう帰らなければなりません。", "pVi": "Tôi phải về rồi.", "casual": "もう帰らなきゃ。", "cVi": "Phải về rồi.", "gIds": ["nakucha"] } },
            { "STT": 56, "Kanji": "行きます", "Nghĩa": "Đi", "Furigana": "いきます", "type": "verb", "conv": { "polite": "どこへ行きますか。", "pVi": "Bạn đi đâu đấy?", "casual": "どこ行く？", "cVi": "Đi đâu thế?", "gIds": [] } },
            { "STT": 57, "Kanji": "寝ます", "Nghĩa": "Ngủ", "Furigana": "ねます", "type": "verb", "conv": { "polite": "早く寝たほうがいいですよ。", "pVi": "Nên ngủ sớm đi.", "casual": "早く寝たほうがいいよ。", "cVi": "Ngủ sớm đi thì hơn.", "gIds": ["ba_yokatta"] } },
            { "STT": 58, "Kanji": "起きます", "Nghĩa": "Thức dậy", "Furigana": "おきます", "type": "verb", "conv": { "polite": "毎朝6時に起きます。", "pVi": "Sáng nào tôi cũng dậy lúc 6h.", "casual": "毎朝6時に起きる。", "cVi": "Toàn dậy lúc 6h.", "gIds": [] } },
            { "STT": 59, "Kanji": "始まります", "Nghĩa": "Bắt đầu", "Furigana": "はじまります", "type": "verb", "conv": { "polite": "授業が始まります。", "pVi": "Giờ học bắt đầu.", "casual": "授業始まるよ。", "cVi": "Vào học rồi.", "gIds": [] } },
            { "STT": 60, "Kanji": "終わります", "Nghĩa": "Kết thúc", "Furigana": "おわります", "type": "verb", "conv": { "polite": "もう終わりましたか。", "pVi": "Đã xong chưa?", "casual": "もう終わった？", "cVi": "Xong chưa?", "gIds": ["ta_form"] } },
            { "STT": 61, "Kanji": "友達", "Nghĩa": "Bạn bè", "Furigana": "ともだち", "type": "noun", "conv": { "polite": "友達と映画を見ました。", "pVi": "Tôi đã xem phim với bạn.", "casual": "友達と映画見た。", "cVi": "Đi xem phim với bạn.", "gIds": ["ta_form"] } },
            { "STT": 62, "Kanji": "中国", "Nghĩa": "Trung Quốc", "Furigana": "ちゅうごく", "type": "place", "conv": { "polite": "中国へ行ったことがあります。", "pVi": "Tôi đã từng đi Trung Quốc.", "casual": "中国行ったことある。", "cVi": "Đi Trung Quốc rồi.", "gIds": ["koto_ga_aru"] } },
            { "STT": 63, "Kanji": "日本", "Nghĩa": "Nhật Bản", "Furigana": "にほん", "type": "place", "conv": { "polite": "日本に住みたいです。", "pVi": "Tôi muốn sống ở Nhật.", "casual": "日本に住みたいな。", "cVi": "Muốn sống ở Nhật ghê.", "gIds": ["tai"] } },
            { "STT": 64, "Kanji": "手紙", "Nghĩa": "Thư", "Furigana": "てがみ", "type": "noun", "conv": { "polite": "手紙を書きました。", "pVi": "Tôi đã viết thư.", "casual": "手紙書いた。", "cVi": "Viết thư rồi.", "gIds": ["ta_form"] } },
            { "STT": 65, "Kanji": "山", "Nghĩa": "Núi", "Furigana": "やま", "type": "place", "conv": { "polite": "山がきれいです。", "pVi": "Núi đẹp.", "casual": "山きれい。", "cVi": "Núi đẹp ghê.", "gIds": ["wa_desu"] } },
            { "STT": 66, "Kanji": "川", "Nghĩa": "Sông", "Furigana": "かわ", "type": "place", "conv": { "polite": "川で泳ぎます。", "pVi": "Bơi ở sông.", "casual": "川で泳ぐ。", "cVi": "Bơi sông.", "gIds": ["de_method"] } },
            { "STT": 67, "Kanji": "海", "Nghĩa": "Biển", "Furigana": "うみ", "type": "place", "conv": { "polite": "海へ行きたいです。", "pVi": "Tôi muốn đi biển.", "casual": "海行きたい。", "cVi": "Muốn đi biển.", "gIds": ["tai"] } },
            { "STT": 68, "Kanji": "車", "Nghĩa": "Xe hơi", "Furigana": "くるま", "type": "noun", "conv": { "polite": "車を持っています。", "pVi": "Tôi có xe hơi.", "casual": "車持ってる。", "cVi": "Có xe hơi đấy.", "gIds": ["te_iru"] } },
            { "STT": 69, "Kanji": "自転車", "Nghĩa": "Xe đạp", "Furigana": "じてんしゃ", "type": "noun", "conv": { "polite": "自転車で行きます。", "pVi": "Tôi đi bằng xe đạp.", "casual": "自転車で行く。", "cVi": "Đi xe đạp.", "gIds": ["de_method"] } },
            { "STT": 70, "Kanji": "電車", "Nghĩa": "Tàu điện", "Furigana": "でんしゃ", "type": "noun", "conv": { "polite": "電車が遅れました。", "pVi": "Tàu điện bị trễ.", "casual": "電車遅れた。", "cVi": "Tàu trễ rồi.", "gIds": ["ta_form"] } },
            { "STT": 71, "Kanji": "バス", "Nghĩa": "Xe buýt", "Furigana": "バス", "type": "noun", "conv": { "polite": "バスに乗ります。", "pVi": "Tôi lên xe buýt.", "casual": "バス乗る。", "cVi": "Lên xe buýt.", "gIds": [] } },
            { "STT": 72, "Kanji": "飛行機", "Nghĩa": "Máy bay", "Furigana": "ひこうき", "type": "noun", "conv": { "polite": "飛行機は速いです。", "pVi": "Máy bay nhanh.", "casual": "飛行機速いね。", "cVi": "Máy bay nhanh thật.", "gIds": ["wa_desu"] } },
            { "STT": 73, "Kanji": "船", "Nghĩa": "Tàu thủy", "Furigana": "ふね", "type": "noun", "conv": { "polite": "船に乗ったことがありますか。", "pVi": "Bạn đã đi tàu thủy bao giờ chưa?", "casual": "船乗ったことある？", "cVi": "Đi tàu bao giờ chưa?", "gIds": ["koto_ga_aru"] } },
            { "STT": 74, "Kanji": "歩いて", "Nghĩa": "Đi bộ", "Furigana": "あるいて", "type": "noun", "conv": { "polite": "歩いて帰ります。", "pVi": "Tôi đi bộ về.", "casual": "歩いて帰る。", "cVi": "Đi bộ về.", "gIds": ["de_method"] } },
            { "STT": 75, "Kanji": "人", "Nghĩa": "Người", "Furigana": "ひと", "type": "noun", "conv": { "polite": "あの人は誰ですか。", "pVi": "Người kia là ai?", "casual": "あの人誰？", "cVi": "Ai kia?", "gIds": ["wa_desu"] } },
            { "STT": 76, "Kanji": "学生", "Nghĩa": "Học sinh", "Furigana": "がくせい", "type": "noun", "conv": { "polite": "私は学生です。", "pVi": "Tôi là học sinh.", "casual": "俺、学生。", "cVi": "Tớ là học sinh.", "gIds": ["wa_desu"] } },
            { "STT": 77, "Kanji": "先生", "Nghĩa": "Giáo viên", "Furigana": "せんせい", "type": "noun", "conv": { "polite": "先生に聞きます。", "pVi": "Tôi hỏi giáo viên.", "casual": "先生に聞く。", "cVi": "Hỏi thầy.", "gIds": [] } },
            { "STT": 78, "Kanji": "学校", "Nghĩa": "Trường học", "Furigana": "がっこう", "type": "place", "conv": { "polite": "学校へ行きます。", "pVi": "Tôi đi đến trường.", "casual": "学校行く。", "cVi": "Đi học đây.", "gIds": ["ni_iku"] } },
            { "STT": 79, "Kanji": "会社", "Nghĩa": "Công ty", "Furigana": "かいしゃ", "type": "place", "conv": { "polite": "会社を休みました。", "pVi": "Tôi đã nghỉ làm.", "casual": "会社休んだ。", "cVi": "Nghỉ làm rồi.", "gIds": ["ta_form"] } },
            { "STT": 80, "Kanji": "病院", "Nghĩa": "Bệnh viện", "Furigana": "びょういん", "type": "place", "conv": { "polite": "病院へ行きます。", "pVi": "Tôi đi bệnh viện.", "casual": "病院行く。", "cVi": "Đi viện.", "gIds": ["ni_iku"] } },
            { "STT": 81, "Kanji": "銀行", "Nghĩa": "Ngân hàng", "Furigana": "ぎんこう", "type": "place", "conv": { "polite": "銀行でお金を下ろします。", "pVi": "Tôi rút tiền ở ngân hàng.", "casual": "銀行でお金下ろす。", "cVi": "Rút tiền ở ngân hàng.", "gIds": ["de_method"] } },
            { "STT": 82, "Kanji": "郵便局", "Nghĩa": "Bưu điện", "Furigana": "ゆうびんきょく", "type": "place", "conv": { "polite": "郵便局はどこですか。", "pVi": "Bưu điện ở đâu?", "casual": "郵便局どこ？", "cVi": "Bưu điện ở đâu?", "gIds": ["wa_doko"] } },
            { "STT": 83, "Kanji": "図書館", "Nghĩa": "Thư viện", "Furigana": "としょかん", "type": "place", "conv": { "polite": "図書館で勉強します。", "pVi": "Tôi học ở thư viện.", "casual": "図書館で勉強する。", "cVi": "Học ở thư viện.", "gIds": ["de_place"] } },
            { "STT": 84, "Kanji": "映画館", "Nghĩa": "Rạp phim", "Furigana": "えいがかん", "type": "place", "conv": { "polite": "映画館へ行きます。", "pVi": "Tôi đi rạp chiếu phim.", "casual": "映画館行く。", "cVi": "Ra rạp phim.", "gIds": ["ni_iku"] } },
            { "STT": 85, "Kanji": "公園", "Nghĩa": "Công viên", "Furigana": "こうえん", "type": "place", "conv": { "polite": "公園を散歩します。", "pVi": "Tôi đi dạo công viên.", "casual": "公園散歩する。", "cVi": "Đi dạo công viên.", "gIds": [] } },
            { "STT": 86, "Kanji": "店", "Nghĩa": "Cửa hàng", "Furigana": "みせ", "type": "place", "conv": { "polite": "店に入ります。", "pVi": "Tôi vào cửa hàng.", "casual": "店に入る。", "cVi": "Vào quán.", "gIds": [] } },
            { "STT": 87, "Kanji": "駅", "Nghĩa": "Nhà ga", "Furigana": "えき", "type": "place", "conv": { "polite": "駅まで歩きます。", "pVi": "Tôi đi bộ đến ga.", "casual": "駅まで歩く。", "cVi": "Đi bộ ra ga.", "gIds": [] } },
            { "STT": 88, "Kanji": "空", "Nghĩa": "Bầu trời", "Furigana": "そら", "type": "place", "conv": { "polite": "空が青いです。", "pVi": "Bầu trời xanh.", "casual": "空青いね。", "cVi": "Trời xanh thật.", "gIds": ["wa_desu"] } }
        ];

        // --- 3. KANJI DETAILS (Tips & Mnemonics) ---
        const kanjiDetails = {
            "泳": { hanviet: "VỊNH", mean: "Bơi", on: "エイ", kun: "およ.ぐ", radicals: "Thủy (氵) + Vĩnh (永)", tipImg: "Nước (氵) chảy vĩnh (永) cửu.", tipSoundOn: "**Ei** bơi.", tipSoundKun: "**Oyo**gu bơi.", words: [{w:"泳ぎます (およぎます)", m:"Bơi"}, {w:"水泳 (すいえい)", m:"Bơi lội"}] },
            "弾": { hanviet: "ĐÀN", mean: "Chơi đàn/Viên đạn", on: "ダン", kun: "ひ.く", radicals: "Cung (弓) + Đơn (単)", tipImg: "Cung (弓) bắn đơn (単) độc.", tipSoundOn: "**Dan** hoàn.", tipSoundKun: "**Hi**ku chơi đàn.", words: [{w:"弾きます (ひきます)", m:"Chơi đàn"}] },
            "集": { hanviet: "TẬP", mean: "Tập hợp", on: "シュウ", kun: "あつ.める", radicals: "Chuy (隹) + Mộc (木)", tipImg: "Chim (隹) đậu trên cây (木) tập hợp.", tipSoundOn: "**Shuu** tập.", tipSoundKun: "**Atsu**meru tập.", words: [{w:"集めます (あつめます)", m:"Tập hợp/Sưu tầm"}, {w:"集中 (しゅうちゅう)", m:"Tập trung"}] },
            "捨": { hanviet: "XẢ", mean: "Vứt bỏ", on: "シャ", kun: "す.てる", radicals: "Thủ (扌) + Xá (舍)", tipImg: "Tay (扌) vứt cái nhà (舍) cũ.", tipSoundOn: "**Sha** xả.", tipSoundKun: "**Su**teru vứt.", words: [{w:"捨てます (すてます)", m:"Vứt bỏ"}] },
            "換": { hanviet: "HOÁN", mean: "Hoán đổi", on: "カン", kun: "か.える", radicals: "Thủ (扌) + Hoán (奂)", tipImg: "Tay (扌) hoán đổi to (奂) lớn.", tipSoundOn: "**Kan** hoán.", tipSoundKun: "**Ka**eru đổi.", words: [{w:"換えます (かえます)", m:"Trao đổi/Đổi tiền"}, {w:"交換 (こうかん)", m:"Trao đổi"}] },
            "運": { hanviet: "VẬN", mean: "Vận chuyển/Lái xe", on: "ウン", kun: "はこ.ぶ", radicals: "Xước (⻌) + Quân (軍)", tipImg: "Quân (軍) đội di chuyển (⻌).", tipSoundOn: "**Un**ten lái xe.", tipSoundKun: "**Hako**bu vận chuyển.", words: [{w:"運転 (うんてん)", m:"Lái xe"}, {w:"運動 (うんどう)", m:"Vận động"}] },
            "転": { hanviet: "CHUYỂN", mean: "Lăn/Chuyển", on: "テン", kun: "ころ.ぶ", radicals: "Xa (車) + Vân (云)", tipImg: "Xe (車) chở mây (云).", tipSoundOn: "Un**ten** chuyển.", tipSoundKun: "**Koro**bu ngã.", words: [{w:"運転 (うんてん)", m:"Lái xe"}, {w:"自転車 (じてんしゃ)", m:"Xe đạp"}] },
            "習": { hanviet: "TẬP", mean: "Học tập", on: "シュウ", kun: "なら.う", radicals: "Vũ (羽) + Bạch (白)", tipImg: "Chim non tập vỗ cánh trắng (白).", tipSoundOn: "**Shuu** tập.", tipSoundKun: "**Nara**u học.", words: [{w:"習います (ならいます)", m:"Học"}, {w:"練習 (れんしゅう)", m:"Luyện tập"}] },
            "乗": { hanviet: "THỪA", mean: "Lên xe", on: "ジョウ", kun: "の.る", radicals: "Thiên (千) + Mộc (木)", tipImg: "Lúa (禾) trên xe.", tipSoundOn: "**Jou** thừa.", tipSoundKun: "**No**ru lên.", words: [{w:"乗ります (のります)", m:"Lên xe/Cưỡi"}, {w:"乗車 (じょうしゃ)", m:"Lên tàu"}] },
            "登": { hanviet: "ĐĂNG", mean: "Leo", on: "トウ", kun: "のぼ.る", radicals: "Bát (癶) + Đậu (豆)", tipImg: "Hai chân đạp lên hạt đậu (豆).", tipSoundOn: "**Tou** đăng.", tipSoundKun: "**No**boru leo.", words: [{w:"登ります (のぼります)", m:"Leo núi"}, {w:"登山 (とざん)", m:"Leo núi"}] },
            "入": { hanviet: "NHẬP", mean: "Vào", on: "ニュウ", kun: "はい.る", radicals: "Nhập (入)", tipImg: "Người đi vào.", tipSoundOn: "**Nyuu** nhập.", tipSoundKun: "**Hai**ru vào.", words: [{w:"入ります (はいります)", m:"Vào/Tắm bồn"}, {w:"入口 (いりぐち)", m:"Cửa vào"}] },
            "浴": { hanviet: "DỤC", mean: "Tắm", on: "ヨク", kun: "あ.びる", radicals: "Thủy (氵) + Cốc (谷)", tipImg: "Nước (氵) chảy trong thung lũng (谷).", tipSoundOn: "**Yoku** dục.", tipSoundKun: "**Abi**ru tắm.", words: [{w:"浴びます (あびます)", m:"Tắm (vòi sen)"}, {w:"浴室 (よくしつ)", m:"Phòng tắm"}] },
            "趣": { hanviet: "THÚ", mean: "Hứng thú", on: "シュ", kun: "", radicals: "Tẩu (走) + Thủ (取)", tipImg: "Chạy (走) đi lấy (取) hứng thú.", tipSoundOn: "**Shu**mi sở thích.", tipSoundKun: "", words: [{w:"趣味 (しゅみ)", m:"Sở thích"}] },
            "味": { hanviet: "VỊ", mean: "Vị/Ý nghĩa", on: "ミ", kun: "あじ", radicals: "Khẩu (口) + Vị (未)", tipImg: "Miệng (口) nếm cây chưa chín (未).", tipSoundOn: "Shu**mi** vị.", tipSoundKun: "**Aji** vị.", words: [{w:"趣味 (しゅみ)", m:"Sở thích"}, {w:"意味 (いみ)", m:"Ý nghĩa"}] },
            "夢": { hanviet: "MỘNG", mean: "Giấc mơ", on: "ム", kun: "ゆめ", radicals: "Thảo (艹) + Mắt (罒) + Tịch (夕)", tipImg: "Cỏ (艹) mắt (罒) trong đêm (夕) mơ.", tipSoundOn: "**Mu** mộng.", tipSoundKun: "**Yume** mơ.", words: [{w:"夢 (ゆめ)", m:"Giấc mơ"}] },
            "日": { hanviet: "NHẬT", mean: "Ngày", on: "ニチ, ジツ", kun: "ひ, か", radicals: "Nhật (日)", tipImg: "Mặt trời.", tipSoundOn: "**Nik**ki nhật ký.", tipSoundKun: "**Hi** ngày.", words: [{w:"日記 (にっき)", m:"Nhật ký"}, {w:"日曜日 (にちようび)", m:"Chủ nhật"}] },
            "記": { hanviet: "KÝ", mean: "Ghi chép", on: "キ", kun: "しる.す", radicals: "Ngôn (言) + Kỷ (己)", tipImg: "Lời nói (言) của bản thân (己).", tipSoundOn: "Nik**ki** ký.", tipSoundKun: "**Shiru**su ghi.", words: [{w:"日記 (にっき)", m:"Nhật ký"}, {w:"記入 (きにゅう)", m:"Điền vào"}] },
            "祈": { hanviet: "KỲ", mean: "Cầu nguyện", on: "キ", kun: "いの.る", radicals: "Kỳ (礻) + Cân (斤)", tipImg: "Thần đất (礻) cầm rìu (斤) cầu nguyện.", tipSoundOn: "**Ki** kỳ.", tipSoundKun: "O**ino**ri cầu nguyện.", words: [{w:"お祈り (おいのり)", m:"Cầu nguyện"}, {w:"祈願 (きがん)", m:"Lời cầu nguyện"}] },
            "課": { hanviet: "KHÓA", mean: "Bài học/Khoa", on: "カ", kun: "", radicals: "Ngôn (言) + Quả (果)", tipImg: "Lời nói (言) và quả (果).", tipSoundOn: "**Ka**chou trưởng khoa.", tipSoundKun: "", words: [{w:"課長 (かちょう)", m:"Trưởng khoa/Trưởng nhóm"}, {w:"第〜課 (だい〜か)", m:"Bài số..."}] },
            "長": { hanviet: "TRƯỜNG/TRƯỞNG", mean: "Dài/Trưởng", on: "チョウ", kun: "なが.い", radicals: "Trường (長)", tipImg: "Tóc dài bay.", tipSoundOn: "Ka**chou** trưởng.", tipSoundKun: "**Naga**i dài.", words: [{w:"課長 (かちょう)", m:"Trưởng nhóm"}, {w:"社長 (しゃちょう)", m:"Giám đốc"}] },
            "部": { hanviet: "BỘ", mean: "Bộ phận", on: "ブ", kun: "", radicals: "Lập (立) + Khẩu (口) + Ấp (阝)", tipImg: "Đứng (立) ở miệng (口) ấp (阝).", tipSoundOn: "**Bu**chou trưởng phòng.", tipSoundKun: "", words: [{w:"部長 (ぶちょう)", m:"Trưởng phòng"}, {w:"部屋 (へや)", m:"Phòng"}] },
            "社": { hanviet: "XÃ", mean: "Công ty/Đền", on: "シャ", kun: "やしろ", radicals: "Kỳ (礻) + Thổ (土)", tipImg: "Thần đất (礻) ở vùng đất (土).", tipSoundOn: "**Sha**chou giám đốc.", tipSoundKun: "**Yashiro** đền.", words: [{w:"社長 (しゃちょう)", m:"Giám đốc"}, {w:"会社 (かいしゃ)", m:"Công ty"}] },
            "動": { hanviet: "ĐỘNG", mean: "Động vật/Chuyển động", on: "ドウ", kun: "うご.く", radicals: "Lực (力) + Trọng (重)", tipImg: "Dùng sức (力) chuyển trọng (重) lượng.", tipSoundOn: "**Dou**butsu động vật.", tipSoundKun: "**Ugo**ku động.", words: [{w:"動物 (どうぶつ)", m:"Động vật"}, {w:"運動 (うんどう)", m:"Vận động"}] },
            "物": { hanviet: "VẬT", mean: "Đồ vật", on: "ブツ", kun: "もの", radicals: "Ngưu (牛) + Vật (勿)", tipImg: "Con bò (牛) chê không (勿) phải vật.", tipSoundOn: "Dou**butsu** vật.", tipSoundKun: "**Mono** vật.", words: [{w:"動物 (どうぶつ)", m:"Động vật"}, {w:"買い物 (かいもの)", m:"Mua sắm"}] },
            "馬": { hanviet: "MÃ", mean: "Con ngựa", on: "バ", kun: "うま", radicals: "Mã (馬)", tipImg: "Hình con ngựa.", tipSoundOn: "**Ba** mã.", tipSoundKun: "**Uma** ngựa.", words: [{w:"馬 (うま)", m:"Con ngựa"}, {w:"乗馬 (じょうば)", m:"Cưỡi ngựa"}] },
            "牧": { hanviet: "MỤC", mean: "Chăn nuôi", on: "ボク", kun: "まき", radicals: "Ngưu (牛) + Phộc (攵)", tipImg: "Con bò (牛) bị đánh (攵) đi chăn.", tipSoundOn: "**Boku**jou trang trại.", tipSoundKun: "**Maki** chăn.", words: [{w:"牧場 (ぼくじょう)", m:"Trang trại chăn nuôi"}] },
            "場": { hanviet: "TRƯỜNG", mean: "Nơi chốn", on: "ジョウ", kun: "ば", radicals: "Thổ (土) + Dương (昜)", tipImg: "Đất (土) có mặt trời (昜).", tipSoundOn: "Boku**jou** trường.", tipSoundKun: "**Ba** nơi.", words: [{w:"牧場 (ぼくじょう)", m:"Trang trại"}, {w:"場所 (ばしょ)", m:"Nơi chốn"}] },
            "歌": { hanviet: "CA", mean: "Bài hát", on: "カ", kun: "うた", radicals: "Khả (可) + Khiếm (欠)", tipImg: "Hai người ca hát.", tipSoundOn: "**Ka** ca.", tipSoundKun: "**Uta** bài hát.", words: [{w:"歌 (うた)", m:"Bài hát"}, {w:"歌います (うたいます)", m:"Hát"}] },
            "真": { hanviet: "CHÂN", mean: "Thật/Ảnh", on: "シン", kun: "ま", radicals: "Mục (目)", tipImg: "Mười mắt nhìn chân thật.", tipSoundOn: "**Sha**shin ảnh.", tipSoundKun: "**Ma** thật.", words: [{w:"写真 (しゃしん)", m:"Bức ảnh"}, {w:"真実 (しんじつ)", m:"Sự thật"}] },
            "写": { hanviet: "TẢ", mean: "Sao chép/Chụp", on: "シャ", kun: "うつ.す", radicals: "Mịch (冖) + Dữ (与)", tipImg: "Mũ (冖) cho người (与) sao chép.", tipSoundOn: "**Sha**shin tả.", tipSoundKun: "**Utsu**su chụp.", words: [{w:"写真 (しゃしん)", m:"Bức ảnh"}, {w:"写生 (しゃせい)", m:"Vẽ phác"}] },
            "初": { hanviet: "SƠ", mean: "Đầu tiên", on: "ショ", kun: "はじ.めて", radicals: "Y (衣) + Đao (刀)", tipImg: "Áo (衣) bị dao (刀) cắt lần đầu.", tipSoundOn: "**Sho** sơ.", tipSoundKun: "**Haji**mete lần đầu.", words: [{w:"初めて (はじめて)", m:"Lần đầu tiên"}, {w:"初級 (しょきゅう)", m:"Sơ cấp"}] },
            "本": { hanviet: "BẢN", mean: "Sách/Thật", on: "ホン", kun: "もと", radicals: "Mộc (木)", tipImg: "Gốc cây.", tipSoundOn: "**Hon**tou thật sự.", tipSoundKun: "**Moto** gốc.", words: [{w:"本当 (ほんとう)", m:"Thật sự"}, {w:"本 (ほん)", m:"Sách"}] },
            "当": { hanviet: "ĐƯƠNG", mean: "Đúng/Trúng", on: "トウ", kun: "あ.たる", radicals: "Tiểu (小)", tipImg: "Tay nhỏ (⺌) cầm trượng (彐) trên ruộng (田).", tipSoundOn: "Hon**tou** đương.", tipSoundKun: "**A**taru trúng.", words: [{w:"本当 (ほんとう)", m:"Thật sự"}, {w:"弁当 (べんとう)", m:"Cơm hộp"}] },
            "洗": { hanviet: "TẨY", mean: "Rửa", on: "セン", kun: "あら.う", radicals: "Thủy (氵) + Tiên (先)", tipImg: "Nước (氵) tẩy sạch trước (先).", tipSoundOn: "**Sen**taku giặt.", tipSoundKun: "**Ara**u rửa.", words: [{w:"洗います (あらいます)", m:"Rửa"}, {w:"洗濯 (せんたく)", m:"Giặt giũ"}] },
            "予": { hanviet: "DỰ", mean: "Dự báo", on: "ヨ", kun: "", radicals: "Dự (予)", tipImg: "Cái mâu (矛) dự báo.", tipSoundOn: "**Yo**yaku đặt trước.", tipSoundKun: "", words: [{w:"予約 (よやく)", m:"Đặt trước"}, {w:"予定 (よてい)", m:"Dự định"}] },
            "約": { hanviet: "ƯỚC", mean: "Lời hứa", on: "ヤク", kun: "", radicals: "Mịch (糸) + Chước (勺)", tipImg: "Sợi chỉ (糸) buộc cái muôi (勺) là lời hứa.", tipSoundOn: "Yo**yaku** đặt trước.", tipSoundKun: "**Yaku**soku lời hứa.", words: [{w:"予約 (よやく)", m:"Đặt trước"}, {w:"約束 (やくそく)", m:"Lời hứa"}] },
            "見": { hanviet: "KIẾN", mean: "Nhìn", on: "ケン", kun: "み.る", radicals: "Mục (目)", tipImg: "Mắt trên chân đi kiến tập.", tipSoundOn: "**Ken**gaku kiến tập.", tipSoundKun: "**Mi**ru nhìn.", words: [{w:"見学 (けんがく)", m:"Tham quan"}, {w:"見ます (みます)", m:"Nhìn"}] },
            "学": { hanviet: "HỌC", mean: "Học", on: "ガク", kun: "まな.ぶ", radicals: "Tử (子)", tipImg: "Đứa trẻ đội mũ đi học.", tipSoundOn: "Ken**gaku** kiến tập.", tipSoundKun: "**Mana**bu học.", words: [{w:"見学 (けんがく)", m:"Tham quan"}, {w:"学生 (がくせい)", m:"Học sinh"}] },
            "泊": { hanviet: "BẠC", mean: "Trọ lại", on: "ハク", kun: "と.まる", radicals: "Thủy (氵) + Bạch (白)", tipImg: "Nước (氵) trắng (白) ở bến bạc.", tipSoundOn: "Shuku**haku** trọ.", tipSoundKun: "**To**maru trọ.", words: [{w:"泊まります (とまります)", m:"Trọ lại"}] },
            "現": { hanviet: "HIỆN", mean: "Hiện tại", on: "ゲン", kun: "あらわ.れる", radicals: "Vương (王) + Kiến (見)", tipImg: "Vua nhìn hiện thực.", tipSoundOn: "**Gen**kin hiện kim.", tipSoundKun: "**Arawa**reru xuất hiện.", words: [{w:"現金 (げんきん)", m:"Tiền mặt"}, {w:"表現 (ひょうげん)", m:"Biểu hiện"}] },
            "金": { hanviet: "KIM", mean: "Tiền/Vàng", on: "キン", kun: "かね", radicals: "Kim (金)", tipImg: "Vàng chôn dưới đất.", tipSoundOn: "Gen**kin** kim.", tipSoundKun: "**Kane** tiền.", words: [{w:"現金 (げんきん)", m:"Tiền mặt"}, {w:"お金 (おかね)", m:"Tiền"}] },
            "来": { hanviet: "LAI", mean: "Đến", on: "ライ", kun: "く.る", radicals: "Mộc (木)", tipImg: "Người đến nấp sau cây (木).", tipSoundOn: "**Rai**getsu tháng sau.", tipSoundKun: "**Ku**ru đến.", words: [{w:"来ます (きます)", m:"Đến"}, {w:"来週 (らいしゅう)", m:"Tuần sau"}] },
            "食": { hanviet: "THỰC", mean: "Ăn", on: "ショク", kun: "た.べる", radicals: "Thực (食)", tipImg: "Người tốt (艮) có lương thực.", tipSoundOn: "**Shoku**ji bữa ăn.", tipSoundKun: "**Ta**beru ăn.", words: [{w:"食べます (たべます)", m:"Ăn"}, {w:"食事 (しょくじ)", m:"Bữa ăn"}] },
            "飲": { hanviet: "ẨM", mean: "Uống", on: "イン", kun: "の.む", radicals: "Thực (饣) + Khiếm (欠)", tipImg: "Ăn (饣) xong thiếu (欠) nước uống.", tipSoundOn: "**In**ryou đồ uống.", tipSoundKun: "**No**mu uống.", words: [{w:"飲みます (のみます)", m:"Uống"}] },
            "聞": { hanviet: "VĂN", mean: "Nghe", on: "ブン", kun: "き.く", radicals: "Môn (門) + Nhĩ (耳)", tipImg: "Tai (耳) ở cổng (門) nghe tin.", tipSoundOn: "Shin**bun** báo.", tipSoundKun: "**Ki**ku nghe.", words: [{w:"聞きます (ききます)", m:"Nghe"}, {w:"新聞 (しんぶん)", m:"Báo"}] },
            "書": { hanviet: "THƯ", mean: "Viết", on: "ショ", kun: "か.く", radicals: "Duật (聿) + Nhật (日)", tipImg: "Tay cầm bút viết.", tipSoundOn: "Doku**sho** đọc sách.", tipSoundKun: "**Ka**ku viết.", words: [{w:"書きます (かきます)", m:"Viết"}, {w:"辞書 (じしょ)", m:"Từ điển"}] },
            "読": { hanviet: "ĐỘC", mean: "Đọc", on: "ドク", kun: "よ.む", radicals: "Ngôn (言) + Mại (売)", tipImg: "Nói (言) bán (売) sách cho độc giả.", tipSoundOn: "**Doku**sho độc thư.", tipSoundKun: "**Yo**mu đọc.", words: [{w:"読みます (よみます)", m:"Đọc"}, {w:"読書 (どくしょ)", m:"Đọc sách"}] },
            "話": { hanviet: "THOẠI", mean: "Nói chuyện", on: "ワ", kun: "はな.す", radicals: "Ngôn (言) + Thiệt (舌)", tipImg: "Lời nói (言) bằng lưỡi (舌).", tipSoundOn: "Kai**wa** hội thoại.", tipSoundKun: "**Hana**su nói.", words: [{w:"話します (はなします)", m:"Nói chuyện"}, {w:"電話 (でんわ)", m:"Điện thoại"}] },
            "買": { hanviet: "MÃI", mean: "Mua", on: "バイ", kun: "か.う", radicals: "Võng (罒) + Bối (貝)", tipImg: "Lưới (罒) chụp tiền (貝) để mua.", tipSoundOn: "**Bai**bai mua bán.", tipSoundKun: "**Ka**u mua.", words: [{w:"買います (かいます)", m:"Mua"}, {w:"買い物 (かいもの)", m:"Mua sắm"}] },
            "会": { hanviet: "HỘI", mean: "Gặp", on: "カイ", kun: "あ.う", radicals: "Nhân (人)", tipImg: "Hai người gặp nhau dưới mái nhà.", tipSoundOn: "**Kai**sha công ty.", tipSoundKun: "**A**u gặp.", words: [{w:"会います (あいます)", m:"Gặp"}, {w:"会社 (かいしゃ)", m:"Công ty"}] },
            "待": { hanviet: "ĐÃI", mean: "Đợi", on: "タイ", kun: "ま.つ", radicals: "Xích (彳) + Tự (寺)", tipImg: "Đứng (彳) ở chùa (寺) đợi.", tipSoundOn: "Shoo**tai** chiêu đãi.", tipSoundKun: "**Ma**tsu đợi.", words: [{w:"待ちます (まちます)", m:"Đợi"}, {w:"招待 (しょうたい)", m:"Mời"}] },
            "撮": { hanviet: "TOÁT", mean: "Chụp ảnh", on: "サツ", kun: "と.る", radicals: "Thủ (扌) + Tối (最)", tipImg: "Tay (扌) cầm máy chụp tối (最) ngày.", tipSoundOn: "**Satsu**ei quay phim.", tipSoundKun: "**To**ru chụp.", words: [{w:"撮ります (とります)", m:"Chụp ảnh"}, {w:"撮影 (さつえい)", m:"Quay phim"}] },
            "分": { hanviet: "PHÂN", mean: "Hiểu/Phút", on: "フン, ブン", kun: "わ.かる", radicals: "Đao (刀)", tipImg: "Dùng dao (刀) chia tám (八) phần.", tipSoundOn: "Go**fun** 5 phút.", tipSoundKun: "**Wa**karu hiểu.", words: [{w:"分かります (わかります)", m:"Hiểu"}, {w:"半分 (はんぶん)", m:"Một nửa"}] },
            "遊": { hanviet: "DU", mean: "Chơi", on: "ユウ", kun: "あそ.ぶ", radicals: "Xước (⻌) + Phương (方)", tipImg: "Trẻ con cầm cờ đi chơi.", tipSoundOn: "**Yuu**enchi khu vui chơi.", tipSoundKun: "**Aso**bu chơi.", words: [{w:"遊びます (あそびます)", m:"Chơi"}, {w:"遊園地 (ゆうえんち)", m:"Công viên giải trí"}] },
            "帰": { hanviet: "QUY", mean: "Về", on: "キ", kun: "かえ.る", radicals: "Đao (刂)", tipImg: "Cầm dao (刂) đi về nhà.", tipSoundOn: "**Ki**koku về nước.", tipSoundKun: "**Kae**ru về.", words: [{w:"帰ります (かえります)", m:"Về"}, {w:"帰国 (きこく)", m:"Về nước"}] },
            "寝": { hanviet: "TẨM", mean: "Ngủ", on: "シン", kun: "ね.る", radicals: "Miên (宀)", tipImg: "Trong nhà cầm tấm phản đi ngủ.", tipSoundOn: "**Shin**shitsu phòng ngủ.", tipSoundKun: "**Ne**ru ngủ.", words: [{w:"寝ます (ねます)", m:"Ngủ"}, {w:"寝坊 (ねぼう)", m:"Ngủ nướng"}] },
            "起": { hanviet: "KHỞI", mean: "Dậy", on: "キ", kun: "お.きる", radicals: "Tẩu (走) + Kỷ (己)", tipImg: "Tự mình (己) chạy (走) dậy.", tipSoundOn: "**Ki**shou thức dậy.", tipSoundKun: "**O**kiru dậy.", words: [{w:"起きます (おきます)", m:"Thức dậy"}, {w:"早起き (はやおき)", m:"Dậy sớm"}] },
            "始": { hanviet: "THỦY", mean: "Bắt đầu", on: "シ", kun: "はじ.まる", radicals: "Nữ (女) + Thai (台)", tipImg: "Người nữ (女) bắt đầu lên đài (台).", tipSoundOn: "Kai**shi** khai mạc.", tipSoundKun: "**Haji**maru bắt đầu.", words: [{w:"始まります (はじまります)", m:"Bắt đầu"}, {w:"年始 (ねんし)", m:"Đầu năm"}] },
            "終": { hanviet: "CHUNG", mean: "Kết thúc", on: "シュウ", kun: "お.わる", radicals: "Mịch (糸) + Đông (冬)", tipImg: "Sợi chỉ (糸) mùa đông (冬) là kết thúc.", tipSoundOn: "**Shuu**ryou kết thúc.", tipSoundKun: "**O**waru xong.", words: [{w:"終わります (おわります)", m:"Kết thúc"}, {w:"終電 (しゅうでん)", m:"Chuyến tàu cuối"}] },
            "達": { hanviet: "ĐẠT", mean: "Đạt đến/Bạn", on: "タツ", kun: "たち", radicals: "Xước (⻌) + Dương (羊)", tipImg: "Dắt dê (羊) đi (⻌) đạt đích.", tipSoundOn: "Hatsu**tatsu** phát đạt.", tipSoundKun: "Tomo**dachi** bạn bè.", words: [{w:"友達 (ともだち)", m:"Bạn bè"}, {w:"配達 (はいたつ)", m:"Chuyển phát"}] },
            "中": { hanviet: "TRUNG", mean: "Trong/Trung", on: "チュウ", kun: "なか", radicals: "Côn (丨)", tipImg: "Ở giữa.", tipSoundOn: "**Chuu**goku Trung Quốc.", tipSoundKun: "**Naka** trong.", words: [{w:"中国 (ちゅうごく)", m:"Trung Quốc"}, {w:"中 (なか)", m:"Bên trong"}] },
            "手": { hanviet: "THỦ", mean: "Tay", on: "シュ", kun: "て", radicals: "Thủ (手)", tipImg: "Hình bàn tay.", tipSoundOn: "**Shu**jutsu phẫu thuật.", tipSoundKun: "**Te** tay.", words: [{w:"手紙 (てがみ)", m:"Thư"}, {w:"手 (て)", m:"Tay"}] },
            "紙": { hanviet: "CHỈ", mean: "Giấy", on: "シ", kun: "かみ", radicals: "Mịch (糸) + Thị (氏)", tipImg: "Sợi chỉ (糸) làm thành giấy thị (氏).", tipSoundOn: "You**shi** giấy.", tipSoundKun: "**Kami** giấy.", words: [{w:"手紙 (てがみ)", m:"Thư"}, {w:"紙 (かみ)", m:"Giấy"}] },
            "自": { hanviet: "TỰ", mean: "Tự mình", on: "ジ", kun: "みずか.ら", radicals: "Tự (自)", tipImg: "Mắt (目) có cái phẩy là tự.", tipSoundOn: "**Ji**tensha xe đạp.", tipSoundKun: "**Mizuka**ra tự mình.", words: [{w:"自転車 (じてんしゃ)", m:"Xe đạp"}, {w:"自分 (じぶん)", m:"Bản thân"}] },
            "電": { hanviet: "ĐIỆN", mean: "Điện", on: "デン", kun: "", radicals: "Vũ (雨)", tipImg: "Mưa (雨) có sét là điện.", tipSoundOn: "**Den**sha tàu điện.", tipSoundKun: "", words: [{w:"電車 (でんしゃ)", m:"Tàu điện"}, {w:"電気 (でんき)", m:"Điện"}] },
            "飛": { hanviet: "PHI", mean: "Bay", on: "ヒ", kun: "と.ぶ", radicals: "Phi (飛)", tipImg: "Con chim đang bay lên.", tipSoundOn: "**Hi**kouki máy bay.", tipSoundKun: "**To**bu bay.", words: [{w:"飛行機 (ひこうき)", m:"Máy bay"}, {w:"飛ばす (とばす)", m:"Làm cho bay"}] },
            "機": { hanviet: "CƠ", mean: "Máy móc", on: "キ", kun: "はた", radicals: "Mộc (木) + Cơ (幾)", tipImg: "Cây (木) bên cạnh mấy (幾) cái máy.", tipSoundOn: "Hikou**ki** máy bay.", tipSoundKun: "**Hata** khung cửi.", words: [{w:"飛行機 (ひこうき)", m:"Máy bay"}, {w:"機械 (きかい)", m:"Cơ khí"}] },
            "船": { hanviet: "THUYỀN", mean: "Tàu", on: "セン", kun: "ふね", radicals: "Chu (舟)", tipImg: "Cái thuyền (舟) đi qua tám (八) cái cửa (口).", tipSoundOn: "Fuu**sen** khinh khí cầu.", tipSoundKun: "**Fune** tàu.", words: [{w:"船 (ふね)", m:"Tàu thủy"}, {w:"船長 (せんちょう)", m:"Thuyền trưởng"}] },
            "歩": { hanviet: "BỘ", mean: "Đi bộ", on: "ホ", kun: "ある.く", radicals: "Chỉ (止) + Thiểu (少)", tipImg: "Dừng (止) lại một chút (少) để đi bộ.", tipSoundOn: "San**po** đi dạo.", tipSoundKun: "**Aru**ku đi bộ.", words: [{w:"歩いて (あるいて)", m:"Đi bộ"}, {w:"散歩 (さんぽ)", m:"Tản bộ"}] },
            "先": { hanviet: "TIÊN", mean: "Trước", on: "セン", kun: "さき", radicals: "Nhân (儿)", tipImg: "Người đi trước.", tipSoundOn: "**Sen**sei thầy giáo.", tipSoundKun: "**Saki** trước.", words: [{w:"先生 (せんせい)", m:"Giáo viên"}, {w:"先月 (せんげつ)", m:"Tháng trước"}] },
            "校": { hanviet: "HIỆU", mean: "Trường", on: "コウ", kun: "", radicals: "Mộc (木) + Giao (交)", tipImg: "Giao lưu ở trường.", tipSoundOn: "Gak**kou** trường học.", tipSoundKun: "", words: [{w:"学校 (がっこう)", m:"Trường học"}, {w:"高校 (こうこう)", m:"Cấp 3"}] },
            "病": { hanviet: "BỆNH", mean: "Ốm", on: "ビョウ", kun: "や.む", radicals: "Nạch (疒) + Bính (丙)", tipImg: "Người ốm nằm trên giường (疒) trong nhà (丙).", tipSoundOn: "**Byou**in bệnh viện.", tipSoundKun: "**Ya**mu ốm.", words: [{w:"病院 (びょういん)", m:"Bệnh viện"}, {w:"病気 (びょうき)", m:"Ốm"}] },
            "院": { hanviet: "VIỆN", mean: "Viện", on: "イン", kun: "", radicals: "Phụ (阝) + Hoàn (完)", tipImg: "Gò đất (阝) có mái nhà (宀) hoàn hảo (元).", tipSoundOn: "Byou**in** bệnh viện.", tipSoundKun: "", words: [{w:"病院 (びょういん)", m:"Bệnh viện"}, {w:"大学院 (だいがくいん)", m:"Cao học"}] },
            "銀": { hanviet: "NGÂN", mean: "Bạc", on: "ギン", kun: "", radicals: "Kim (金) + Cấn (艮)", tipImg: "Kim loại (金) tốt (艮) là bạc.", tipSoundOn: "**Gin**kou ngân hàng.", tipSoundKun: "", words: [{w:"銀行 (ぎんこう)", m:"Ngân hàng"}, {w:"水銀 (すいぎん)", m:"Thủy ngân"}] },
            "郵": { hanviet: "BƯU", mean: "Bưu chính", on: "ユウ", kun: "", radicals: "Thùy (垂) + Phụ (阝)", tipImg: "Vùng đất (阝) xa xôi (垂) cần gửi thư.", tipSoundOn: "**Yuu**binkyoku bưu điện.", tipSoundKun: "", words: [{w:"郵便局 (ゆうびんきょく)", m:"Bưu điện"}] },
            "便": { hanviet: "TIỆN", mean: "Tiện/Thư", on: "ベン, ビン", kun: "たよ.り", radicals: "Nhân (亻) + Canh (更)", tipImg: "Người (亻) canh (更) cửa rất tiện.", tipSoundOn: "Yuu**bin** thư.", tipSoundKun: "**Tayo**ri tin tức.", words: [{w:"郵便局 (ゆうびんきょく)", m:"Bưu điện"}, {w:"便利 (べんり)", m:"Tiện lợi"}] },
            "局": { hanviet: "CỤC", mean: "Cục/Phòng", on: "キョク", kun: "", radicals: "Thi (尸) + Bao (勹) + Khẩu (口)", tipImg: "Xác chết (尸) trong cái bao (勹) ở cục cảnh sát.", tipSoundOn: "Yuubin**kyoku** cục.", tipSoundKun: "", words: [{w:"郵便局 (ゆうびんきょく)", m:"Bưu điện"}, {w:"薬局 (やっきょく)", m:"Hiệu thuốc"}] },
            "図": { hanviet: "ĐỒ", mean: "Bản đồ", on: "ズ, ト", kun: "はか.る", radicals: "Vi (囗)", tipImg: "Bản đồ trong khung.", tipSoundOn: "**To**shokan thư viện.", tipSoundKun: "**Haka**ru đo.", words: [{w:"図書館 (としょかん)", m:"Thư viện"}, {w:"地図 (ちず)", m:"Bản đồ"}] },
            "館": { hanviet: "QUÁN", mean: "Tòa nhà", on: "カン", kun: "やかた", radicals: "Thực (食) + Quan (官)", tipImg: "Nơi ăn uống (食) của quan (官) lại.", tipSoundOn: "Tosho**kan** thư viện.", tipSoundKun: "**Yakata** nhà.", words: [{w:"図書館 (としょかん)", m:"Thư viện"}, {w:"映画館 (えいがかん)", m:"Rạp phim"}] },
            "映": { hanviet: "ÁNH", mean: "Chiếu", on: "エイ", kun: "うつ.る", radicals: "Nhật (日) + Ương (央)", tipImg: "Mặt trời (日) chiếu ở trung ương (央).", tipSoundOn: "**Ei**ga phim.", tipSoundKun: "**Utsu**ru phản chiếu.", words: [{w:"映画 (えいが)", m:"Phim"}, {w:"上映 (じょうえい)", m:"Trình chiếu"}] },
            "画": { hanviet: "HỌA", mean: "Tranh", on: "ガ, カク", kun: "", radicals: "Điền (田)", tipImg: "Ruộng (田) vẽ trong khung.", tipSoundOn: "Ei**ga** họa.", tipSoundKun: "", words: [{w:"映画館 (えいがかん)", m:"Rạp phim"}, {w:"計画 (けいかく)", m:"Kế hoạch"}] },
            "公": { hanviet: "CÔNG", mean: "Công cộng", on: "コウ", kun: "おおやけ", radicals: "Bát (八) + Tư (厶)", tipImg: "Bát (八) riêng tư (ム) chia cho công chúng.", tipSoundOn: "**Kou**en công viên.", tipSoundKun: "**Ooyake** công cộng.", words: [{w:"公園 (こうえん)", m:"Công viên"}, {w:"公務員 (こうむいん)", m:"Công chức"}] },
            "園": { hanviet: "VIÊN", mean: "Vườn", on: "エン", kun: "その", radicals: "Vi (囗) + Viên (袁)", tipImg: "Vùng đất (口) xa (袁) làm vườn.", tipSoundOn: "Kou**en** công viên.", tipSoundKun: "**Sono** vườn.", words: [{w:"公園 (こうえん)", m:"Công viên"}, {w:"動物園 (どうぶつえん)", m:"Sở thú"}] },
            "店": { hanviet: "ĐIẾM", mean: "Cửa hàng", on: "テン", kun: "みせ", radicals: "Nghiễm (广) + Chiếm (占)", tipImg: "Trong nhà (广) xem bói (占) để mở quán.", tipSoundOn: "**Ten**in nhân viên.", tipSoundKun: "**Mise** tiệm.", words: [{w:"店 (みせ)", m:"Cửa hàng"}, {w:"店員 (てんいん)", m:"Nhân viên"}] },
            "駅": { hanviet: "DỊCH", mean: "Ga", on: "エキ", kun: "", radicals: "Mã (馬) + Xích (尺)", tipImg: "Ngựa (馬) thồ hàng (尺) ra ga.", tipSoundOn: "**Eki** ga.", tipSoundKun: "", words: [{w:"駅 (えき)", m:"Nhà ga"}, {w:"駅長 (えきちょう)", m:"Trưởng ga"}] }
        };

        // --- 4. APP LOGIC (Standard Day 1 Logic) ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                document.getElementById('detailTipSound').innerHTML = fmt(d.tipSoundOn + " / " + d.tipSoundKun || ''); 
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
