<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 26: Tự động từ & Tha động từ (2)</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base Settings */
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* UI Components */
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Logic CSS */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially for animation */
        #strokeAnimContainer svg path { opacity: 0; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 26: Tự động từ & Tha động từ (2)</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">落ちる</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">おちる</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Rơi / Rụng</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại & Ví dụ</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- MOBILE DRAWER -->
        <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none flex">
            <div id="drawerBackdrop" class="absolute inset-0 bg-gray-900/50 opacity-0 transition-opacity" onclick="toggleDrawer()"></div>
            <div id="drawerContent" class="relative w-72 bg-white h-full shadow-2xl transition-transform -translate-x-full flex flex-col pointer-events-auto">
                <div class="p-4 bg-indigo-700 text-white flex justify-between items-center">
                    <h2 class="font-bold">Danh sách từ vựng</h2>
                    <button onclick="toggleDrawer()"><i class="fas fa-times"></i></button>
                </div>
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <input type="text" id="mobileSearchInput" placeholder="Tìm kiếm nhanh..." class="w-full px-4 py-2 bg-white border border-gray-200 rounded-xl text-sm outline-none">
                </div>
                <div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 26</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (Day 26) ---
        const grammarRepo = {
            "te_shimau": { title: "Lỡ / Hoàn thành", formula: "Vて + しまう", desc: "Diễn tả sự hối tiếc vì đã lỡ làm điều gì đó, hoặc diễn tả sự hoàn tất của hành động.", ex: "財布を落としてしまった。" },
            "koto_ni_naru": { title: "Được quyết định là", formula: "Vる/Vない + ことになる", desc: "Diễn tả một quyết định được đưa ra bởi người khác hoặc do hoàn cảnh, không phải do ý chí người nói.", ex: "来月、転勤することになった。" },
            "koto_ni_suru": { title: "Quyết định làm", formula: "Vる/Vない + ことにする", desc: "Diễn tả quyết định chủ quan của người nói.", ex: "今日からタバコをやめることにした。" },
            "you_ni_suru": { title: "Cố gắng làm", formula: "Vる/Vない + ようにする", desc: "Diễn tả sự nỗ lực, cố gắng để làm hoặc không làm gì đó.", ex: "毎日野菜を食べるようにしている。" },
            "you_ni_naru": { title: "Trở nên / Có thể", formula: "Vる(khả năng) + ようになる", desc: "Diễn tả sự thay đổi trạng thái, từ không thể thành có thể.", ex: "日本語が話せるようになった。" },
            "te_aru": { title: "Có (được làm sẵn)", formula: "Vて(tha) + ある", desc: "Diễn tả trạng thái kết quả của một hành động có chủ ý còn lưu lại.", ex: "壁に絵が掛けてある。" },
            "te_iru": { title: "Đang / Có (tự)", formula: "Vて(tự) + いる", desc: "Diễn tả trạng thái kết quả của một hành động tự nhiên hoặc đang diễn ra.", ex: "ドアが開いている。" },
            "bakari": { title: "Toàn là", formula: "N + ばかり", desc: "Chỉ toàn là, chỉ có...", ex: "この店は女性客ばかりだ。" },
            "no_de": { title: "Vì... nên...", formula: "Thể thường + ので", desc: "Nguyên nhân, lý do khách quan.", ex: "雨が降っているので、試合は中止だ。" },
            "tame_ni": { title: "Vì... / Để...", formula: "Thể thường + ため(に)", desc: "Nguyên nhân hoặc mục đích.", ex: "健康のために走る。" },
            "te_kudasai": { title: "Hãy... / Xin hãy...", formula: "Vて + ください", desc: "Yêu cầu, nhờ vả lịch sự.", ex: "ちょっと待ってください。" },
            "mashou_ka": { title: "Tôi... nhé? / Chúng ta...", formula: "Vましょう + か", desc: "Đề nghị làm giúp người khác hoặc rủ rê cùng làm.", ex: "荷物を持ちましょうか。" },
            "te_kara": { title: "Sau khi...", formula: "Vて + から", desc: "Chỉ thứ tự hành động.", ex: "手を洗ってから食べます。" },
            "ba_form": { title: "Nếu...", formula: "Vば / Aければ / Nなら", desc: "Câu điều kiện.", ex: "安ければ買います。" },
            "passive": { title: "Bị / Được (Bị động)", formula: "Vられる", desc: "Câu bị động.", ex: "先生に褒められた。" },
            "te_kureru": { title: "...cho tôi", formula: "Vて + くれる", desc: "Ai đó làm gì cho mình (người nói biết ơn).", ex: "友達が本を貸してくれた。" },
            "koto_ga_dekiru": { title: "Có thể...", formula: "Vる + ことが出来る", desc: "Khả năng làm việc gì đó.", ex: "泳ぐことができます。" },
            "yasui_nikui": { title: "Dễ / Khó...", formula: "V(bỏ mas) + やすい/にくい", desc: "Tính chất dễ hoặc khó thực hiện.", ex: "このペンは書きやすい。" },
            "ta_hou_ga_ii": { title: "Nên...", formula: "Vた + ほうがいい", desc: "Lời khuyên nên làm gì đó.", ex: "早く寝たほうがいい。" },
            "naide_kudasai": { title: "Xin đừng...", formula: "Vないで + ください", desc: "Yêu cầu đừng làm gì.", ex: "行かないでください。" },
            "te_kuremasenka": { title: "Làm ơn...", formula: "Vて + くれませんか", desc: "Nhờ vả lịch sự.", ex: "教えてくれませんか。" },
            "te_iku": { title: "...đi / ...rồi đi", formula: "Vて + いく", desc: "Hành động di chuyển ra xa hoặc làm xong rồi đi.", ex: "連れて行ってください。" },
            "te_form": { title: "Và / Rồi", formula: "Vて", desc: "Nối các hành động theo trình tự thời gian.", ex: "朝起きて、ご飯を食べます。" }
        };

        // --- 2. VOCABULARY DATA (Day 26 - 87 words) ---
        const vocabData = [
            { "STT": 1, "Kanji": "落ちる", "Nghĩa": "Rơi/Rụng", "Furigana": "おちる", "type": "verb", "conv": { "polite": "猿も木から落ちるということわざがあります。", "pVi": "Có câu tục ngữ là 'Khỉ cũng ngã cây'.", "casual": "猿も木から落ちるって言うよね。", "cVi": "Người giỏi cũng có lúc sai mà.", "gIds": [] } },
            { "STT": 2, "Kanji": "落とす", "Nghĩa": "Làm rơi/Đánh rơi", "Furigana": "おとす", "type": "verb", "conv": { "polite": "財布を落としてしまいました。", "pVi": "Tôi đã lỡ đánh rơi ví rồi.", "casual": "財布落としちゃった。", "cVi": "Rơi mất ví rồi.", "gIds": ["te_shimau"] } },
            { "STT": 3, "Kanji": "消える", "Nghĩa": "Tắt/Biến mất", "Furigana": "きえる", "type": "verb", "conv": { "polite": "電気が突然消えてしまいました。", "pVi": "Điện đột nhiên tắt mất rồi.", "casual": "電気消えちゃったよ。", "cVi": "Mất điện rồi.", "gIds": ["te_shimau"] } },
            { "STT": 4, "Kanji": "消す", "Nghĩa": "Tắt/Xóa", "Furigana": "けす", "type": "verb", "conv": { "polite": "部屋を出るときは電気を消すようにしています。", "pVi": "Khi ra khỏi phòng tôi cố gắng tắt điện.", "casual": "出る時は電気消すようにしてる。", "cVi": "Ra ngoài nhớ tắt điện nhé.", "gIds": ["you_ni_suru"] } },
            { "STT": 5, "Kanji": "付く", "Nghĩa": "Dính/Bật", "Furigana": "つく", "type": "verb", "conv": { "polite": "服にインクが付いてしまいました。", "pVi": "Mực đã dính vào quần áo mất rồi.", "casual": "服にインク付いちゃった。", "cVi": "Mực dây ra áo rồi.", "gIds": ["te_shimau"] } },
            { "STT": 6, "Kanji": "付ける", "Nghĩa": "Gắn/Bật/Chấm", "Furigana": "つける", "type": "verb", "conv": { "polite": "パンにジャムを付けて食べます。", "pVi": "Tôi chấm mứt vào bánh mì rồi ăn.", "casual": "パンにジャム付けて食べるよ。", "cVi": "Phết mứt vào bánh mì ăn đi.", "gIds": ["te_form"] } },
            { "STT": 7, "Kanji": "効く", "Nghĩa": "Có hiệu quả", "Furigana": "きく", "type": "verb", "conv": { "polite": "この薬はよく効きます。", "pVi": "Thuốc này rất hiệu quả.", "casual": "この薬めっちゃ効くよ。", "cVi": "Thuốc này nhạy lắm.", "gIds": [] } },
            { "STT": 8, "Kanji": "流行る", "Nghĩa": "Lưu hành/Thịnh hành", "Furigana": "はやる", "type": "verb", "conv": { "polite": "今、この歌が流行っています。", "pVi": "Bây giờ bài hát này đang thịnh hành.", "casual": "今この歌流行ってるよね。", "cVi": "Bài này đang hot đấy.", "gIds": ["te_iru"] } },
            { "STT": 9, "Kanji": "経つ", "Nghĩa": "Trôi qua", "Furigana": "たつ", "type": "verb", "conv": { "polite": "日本に来てから、もう3年経ちました。", "pVi": "Từ khi đến Nhật đã 3 năm trôi qua.", "casual": "日本に来てもう3年経ったよ。", "cVi": "Sang Nhật được 3 năm rồi.", "gIds": ["te_kara"] } },
            { "STT": 10, "Kanji": "間に合う", "Nghĩa": "Kịp", "Furigana": "まにあう", "type": "verb", "conv": { "polite": "走れば電車に間に合います。", "pVi": "Nếu chạy thì sẽ kịp tàu.", "casual": "走れば間に合うよ。", "cVi": "Chạy là kịp đấy.", "gIds": ["ba_form"] } },
            { "STT": 11, "Kanji": "合わせる", "Nghĩa": "Điều chỉnh/Hợp", "Furigana": "あわせる", "type": "verb", "conv": { "polite": "時計の針を合わせました。", "pVi": "Tôi đã chỉnh lại kim đồng hồ.", "casual": "時計合わせたよ。", "cVi": "Chỉnh đồng hồ rồi.", "gIds": [] } },
            { "STT": 12, "Kanji": "通う", "Nghĩa": "Đi lại (thường xuyên)", "Furigana": "かよう", "type": "verb", "conv": { "polite": "毎日ジムに通うことにしました。", "pVi": "Tôi đã quyết định đi tập gym mỗi ngày.", "casual": "毎日ジム通うことにしたんだ。", "cVi": "Tớ quyết định đi gym hàng ngày rồi.", "gIds": ["koto_ni_suru"] } },
            { "STT": 13, "Kanji": "込む", "Nghĩa": "Đông đúc", "Furigana": "こむ", "type": "verb", "conv": { "polite": "電車が込んでいて、疲れました。", "pVi": "Tàu điện đông đúc nên tôi mệt.", "casual": "電車混んでて疲れた。", "cVi": "Tàu đông quá mệt ghê.", "gIds": ["te_iru", "no_de"] } },
            { "STT": 14, "Kanji": "すれ違う", "Nghĩa": "Đi lướt qua nhau", "Furigana": "すれちがう", "type": "verb", "conv": { "polite": "道で先生とすれ違いました。", "pVi": "Tôi đã đi lướt qua thầy giáo trên đường.", "casual": "道で先生とすれ違ったよ。", "cVi": "Vừa lướt qua thầy trên đường xong.", "gIds": [] } },
            { "STT": 15, "Kanji": "掛かる", "Nghĩa": "Tốn/Mất/Treo", "Furigana": "かかる", "type": "verb", "conv": { "polite": "この仕事は時間が掛かります。", "pVi": "Công việc này tốn thời gian.", "casual": "これ時間かかるよ。", "cVi": "Cái này tốn thời gian lắm.", "gIds": [] } },
            { "STT": 16, "Kanji": "掛ける", "Nghĩa": "Treo/Đắp/Tốn", "Furigana": "かける", "type": "verb", "conv": { "polite": "壁に絵が掛けてあります。", "pVi": "Bức tranh được treo sẵn trên tường.", "casual": "壁に絵が掛けてあるね。", "cVi": "Tranh treo trên tường kìa.", "gIds": ["te_aru"] } },
            { "STT": 17, "Kanji": "動く", "Nghĩa": "Chuyển động/Hoạt động", "Furigana": "うごく", "type": "verb", "conv": { "polite": "この時計は動いていません。", "pVi": "Cái đồng hồ này không chạy.", "casual": "この時計動いてないよ。", "cVi": "Đồng hồ này chết rồi.", "gIds": ["te_iru"] } },
            { "STT": 18, "Kanji": "動かす", "Nghĩa": "Làm chuyển động/Vận hành", "Furigana": "うごかす", "type": "verb", "conv": { "polite": "重い家具を動かしました。", "pVi": "Tôi đã di chuyển đồ nội thất nặng.", "casual": "重い家具動かしたんだ。", "cVi": "Tớ vừa kê lại mấy đồ nặng.", "gIds": [] } },
            { "STT": 19, "Kanji": "離れる", "Nghĩa": "Rời xa/Cách xa", "Furigana": "はなれる", "type": "verb", "conv": { "polite": "故郷を離れることになりました。", "pVi": "Việc tôi rời xa quê hương đã được quyết định.", "casual": "故郷離れることになったよ。", "cVi": "Tớ sắp phải xa quê rồi.", "gIds": ["koto_ni_naru"] } },
            { "STT": 20, "Kanji": "離す", "Nghĩa": "Tách ra/Buông", "Furigana": "はなす", "type": "verb", "conv": { "polite": "手を離さないでください。", "pVi": "Xin đừng buông tay.", "casual": "手離さないでね。", "cVi": "Đừng buông tay nhé.", "gIds": ["naide_kudasai"] } },
            { "STT": 21, "Kanji": "ぶつかる", "Nghĩa": "Va chạm/Đâm vào", "Furigana": "ぶつかる", "type": "verb", "conv": { "polite": "自転車とぶつかってしまいました。", "pVi": "Tôi đã lỡ va vào xe đạp.", "casual": "自転車とぶつかっちゃった。", "cVi": "Đâm phải xe đạp rồi.", "gIds": ["te_shimau"] } },
            { "STT": 22, "Kanji": "ぶつける", "Nghĩa": "Đâm vào/Húc vào", "Furigana": "ぶつける", "type": "verb", "conv": { "polite": "不注意で車を壁にぶつけてしまいました。", "pVi": "Do bất cẩn tôi đã lỡ húc xe vào tường.", "casual": "車ぶつけちゃった。", "cVi": "Tớ húc xe vào tường rồi.", "gIds": ["te_shimau"] } },
            { "STT": 23, "Kanji": "こぼれる", "Nghĩa": "Bị tràn/Đổ", "Furigana": "こぼれる", "type": "verb", "conv": { "polite": "水がこぼれていますよ。", "pVi": "Nước đang tràn ra kìa.", "casual": "水こぼれてるよ！", "cVi": "Nước tràn kìa!", "gIds": ["te_iru"] } },
            { "STT": 24, "Kanji": "こぼす", "Nghĩa": "Làm tràn/Làm đổ", "Furigana": "こぼす", "type": "verb", "conv": { "polite": "ジュースをこぼさないようにしてください。", "pVi": "Hãy cố gắng đừng làm đổ nước ép.", "casual": "ジュースこぼさないでね。", "cVi": "Đừng làm đổ nước đấy.", "gIds": ["you_ni_suru"] } },
            { "STT": 25, "Kanji": "ふく", "Nghĩa": "Lau/Chùi", "Furigana": "ふく", "type": "verb", "conv": { "polite": "テーブルをきれいにふきました。", "pVi": "Tôi đã lau bàn sạch sẽ.", "casual": "テーブルふいといたよ。", "cVi": "Tớ lau bàn rồi.", "gIds": [] } },
            { "STT": 26, "Kanji": "片付く", "Nghĩa": "Được dọn dẹp/Ngăn nắp", "Furigana": "かたづく", "type": "verb", "conv": { "polite": "部屋が片付いていません。", "pVi": "Phòng chưa được dọn dẹp.", "casual": "部屋片付いてないじゃん。", "cVi": "Phòng bừa bộn thế.", "gIds": ["te_iru"] } },
            { "STT": 27, "Kanji": "片付ける", "Nghĩa": "Dọn dẹp", "Furigana": "かたづける", "type": "verb", "conv": { "polite": "週末に部屋を片付けることにしました。", "pVi": "Tôi đã quyết định dọn phòng vào cuối tuần.", "casual": "週末片付けることにした。", "cVi": "Cuối tuần tớ sẽ dọn phòng.", "gIds": ["koto_ni_suru"] } },
            { "STT": 28, "Kanji": "包む", "Nghĩa": "Bọc/Gói", "Furigana": "つつむ", "type": "verb", "conv": { "polite": "プレゼントをきれいに包んでくれました。", "pVi": "Họ đã gói quà đẹp cho tôi.", "casual": "プレゼント包んでもらった。", "cVi": "Được gói quà đẹp ghê.", "gIds": ["te_kureru"] } },
            { "STT": 29, "Kanji": "張る", "Nghĩa": "Dán", "Furigana": "はる", "type": "verb", "conv": { "polite": "壁にポスターが張ってあります。", "pVi": "Poster được dán sẵn trên tường.", "casual": "ポスター張ってあるね。", "cVi": "Có poster dán trên tường kìa.", "gIds": ["te_aru"] } },
            { "STT": 30, "Kanji": "無くなる", "Nghĩa": "Mất/Hết", "Furigana": "なくなる", "type": "verb", "conv": { "polite": "やる気が無くなってしまいました。", "pVi": "Tôi đã lỡ mất hết hứng thú rồi.", "casual": "やる気なくなっちゃった。", "cVi": "Hết hứng rồi.", "gIds": ["te_shimau"] } },
            { "STT": 31, "Kanji": "無くす", "Nghĩa": "Làm mất", "Furigana": "なくす", "type": "verb", "conv": { "polite": "パスポートを無くさないようにしてください。", "pVi": "Hãy cố gắng đừng làm mất hộ chiếu.", "casual": "パスポート無くさないでね。", "cVi": "Đừng làm mất hộ chiếu đấy.", "gIds": ["you_ni_suru"] } },
            { "STT": 32, "Kanji": "足りる", "Nghĩa": "Đủ", "Furigana": "たりる", "type": "verb", "conv": { "polite": "時間が足りなくて、全部できませんでした。", "pVi": "Vì không đủ thời gian nên tôi không làm hết được.", "casual": "時間足りなくて無理だった。", "cVi": "Thiếu giờ nên chịu thôi.", "gIds": ["no_de"] } },
            { "STT": 33, "Kanji": "残る", "Nghĩa": "Còn lại/Sót lại", "Furigana": "のこる", "type": "verb", "conv": { "polite": "料理がたくさん残っています。", "pVi": "Thức ăn còn thừa rất nhiều.", "casual": "料理めっちゃ残ってる。", "cVi": "Thức ăn còn đầy ra đấy.", "gIds": ["te_iru"] } },
            { "STT": 34, "Kanji": "残す", "Nghĩa": "Để lại/Bỏ thừa", "Furigana": "のこす", "type": "verb", "conv": { "polite": "ご飯を残してしまいました。", "pVi": "Tôi đã lỡ để thừa cơm.", "casual": "ご飯残しちゃった。", "cVi": "Bỏ thừa cơm mất rồi.", "gIds": ["te_shimau"] } },
            { "STT": 35, "Kanji": "腐る", "Nghĩa": "Thiu/Thối/Hỏng", "Furigana": "くさる", "type": "verb", "conv": { "polite": "この牛乳は腐っているかもしれません。", "pVi": "Sữa này có lẽ bị hỏng rồi.", "casual": "これ腐ってるかも。", "cVi": "Cái này chắc thiu rồi.", "gIds": ["te_iru"] } },
            { "STT": 36, "Kanji": "剥ける", "Nghĩa": "Bị lột/Bong", "Furigana": "むける", "type": "verb", "conv": { "polite": "日焼けで皮がむけてしまいました。", "pVi": "Da bị bong tróc do cháy nắng mất rồi.", "casual": "皮むけちゃった。", "cVi": "Da bong hết rồi.", "gIds": ["te_shimau"] } },
            { "STT": 37, "Kanji": "剥く", "Nghĩa": "Bóc/Gọt", "Furigana": "むく", "type": "verb", "conv": { "polite": "リンゴの皮をむきましょうか。", "pVi": "Để tôi gọt vỏ táo cho nhé?", "casual": "リンゴむこうか？", "cVi": "Gọt táo không?", "gIds": ["mashou_ka"] } },
            { "STT": 38, "Kanji": "滑る", "Nghĩa": "Trượt", "Furigana": "すべる", "type": "verb", "conv": { "polite": "道が凍っていて滑りやすいです。", "pVi": "Đường đóng băng nên dễ trượt.", "casual": "滑りやすいから気をつけて。", "cVi": "Trơn lắm cẩn thận đấy.", "gIds": ["yasui_nikui", "te_iru"] } },
            { "STT": 39, "Kanji": "積もる", "Nghĩa": "Chất đống/Tích tụ", "Furigana": "つもる", "type": "verb", "conv": { "polite": "雪がたくさん積もっています。", "pVi": "Tuyết đang chất đống rất nhiều.", "casual": "雪めっちゃ積もってる。", "cVi": "Tuyết dày ghê.", "gIds": ["te_iru"] } },
            { "STT": 40, "Kanji": "積む", "Nghĩa": "Chất lên/Tích lũy", "Furigana": "つむ", "type": "verb", "conv": { "polite": "経験を積むために、留学することにしました。", "pVi": "Tôi quyết định du học để tích lũy kinh nghiệm.", "casual": "経験積むために留学する。", "cVi": "Đi du học để lấy kinh nghiệm.", "gIds": ["koto_ni_suru", "tame_ni"] } },
            { "STT": 41, "Kanji": "空く", "Nghĩa": "Trống/Rảnh/Thủng", "Furigana": "あく", "type": "verb", "conv": { "polite": "靴下に穴が空いてしまいました。", "pVi": "Tất bị thủng lỗ mất rồi.", "casual": "靴下穴空いちゃった。", "cVi": "Tất thủng lỗ rồi.", "gIds": ["te_shimau"] } },
            { "STT": 42, "Kanji": "空ける", "Nghĩa": "Làm trống/Đục lỗ", "Furigana": "あける", "type": "verb", "conv": { "polite": "予定を空けておいてください。", "pVi": "Hãy để trống lịch trình nhé.", "casual": "予定空けといて。", "cVi": "Để dành lịch nhé.", "gIds": ["te_aru"] } },
            { "STT": 43, "Kanji": "下がる", "Nghĩa": "Hạ xuống/Giảm (tự)", "Furigana": "さがる", "type": "verb", "conv": { "polite": "熱が下がって、楽になりました。", "pVi": "Sốt đã hạ nên tôi thấy thoải mái hơn.", "casual": "熱下がって楽になった。", "cVi": "Hạ sốt rồi, khỏe re.", "gIds": ["te_form"] } },
            { "STT": 44, "Kanji": "下げる", "Nghĩa": "Hạ/Giảm (tha)", "Furigana": "さげる", "type": "verb", "conv": { "polite": "音量を下げてください。", "pVi": "Hãy giảm âm lượng xuống.", "casual": "音下げて。", "cVi": "Vặn nhỏ loa đi.", "gIds": ["te_kudasai"] } },
            { "STT": 45, "Kanji": "冷える", "Nghĩa": "Lạnh đi/Cóng", "Furigana": "ひえる", "type": "verb", "conv": { "polite": "ビールがよく冷えています。", "pVi": "Bia đang được ướp lạnh ngắt.", "casual": "ビール冷えてるよ。", "cVi": "Bia lạnh đấy.", "gIds": ["te_iru"] } },
            { "STT": 46, "Kanji": "冷やす", "Nghĩa": "Làm lạnh", "Furigana": "ひやす", "type": "verb", "conv": { "polite": "頭を冷やしたほうがいいですよ。", "pVi": "Bạn nên làm mát đầu (bình tĩnh lại) đi.", "casual": "頭冷やしなよ。", "cVi": "Bình tĩnh lại đi.", "gIds": ["ta_hou_ga_ii"] } },
            { "STT": 47, "Kanji": "冷める", "Nghĩa": "Nguội đi", "Furigana": "さめる", "type": "verb", "conv": { "polite": "スープが冷めてしまいました。", "pVi": "Súp đã bị nguội mất rồi.", "casual": "スープ冷めちゃった。", "cVi": "Súp nguội ngắt rồi.", "gIds": ["te_shimau"] } },
            { "STT": 48, "Kanji": "冷ます", "Nghĩa": "Làm nguội", "Furigana": "さます", "type": "verb", "conv": { "polite": "お茶を冷ましてから飲みます。", "pVi": "Tôi làm nguội trà rồi mới uống.", "casual": "冷ましてから飲むね。", "cVi": "Để nguội rồi uống.", "gIds": ["te_kara"] } },
            { "STT": 49, "Kanji": "燃える", "Nghĩa": "Cháy", "Furigana": "もえる", "type": "verb", "conv": { "polite": "家が燃えています！", "pVi": "Nhà đang cháy kìa!", "casual": "家燃えてる！", "cVi": "Cháy nhà kìa!", "gIds": ["te_iru"] } },
            { "STT": 50, "Kanji": "燃やす", "Nghĩa": "Đốt", "Furigana": "もやす", "type": "verb", "conv": { "polite": "ゴミは燃やさないようにしてください。", "pVi": "Xin đừng đốt rác.", "casual": "ゴミ燃やさないで。", "cVi": "Đừng có đốt rác.", "gIds": ["you_ni_suru"] } },
            { "STT": 51, "Kanji": "沸く", "Nghĩa": "Sôi/Hào hứng", "Furigana": "わく", "type": "verb", "conv": { "polite": "お湯が沸きました。", "pVi": "Nước đã sôi rồi.", "casual": "お湯沸いたよ。", "cVi": "Nước sôi rồi đấy.", "gIds": [] } },
            { "STT": 52, "Kanji": "沸かす", "Nghĩa": "Đun sôi", "Furigana": "わかす", "type": "verb", "conv": { "polite": "お茶を沸かしましょうか。", "pVi": "Để tôi đun trà nhé?", "casual": "お茶沸かそうか？", "cVi": "Đun trà không?", "gIds": ["mashou_ka"] } },
            { "STT": 53, "Kanji": "鳴る", "Nghĩa": "Kêu/Reo", "Furigana": "なる", "type": "verb", "conv": { "polite": "電話が鳴っていますよ。", "pVi": "Điện thoại đang reo kìa.", "casual": "電話鳴ってる。", "cVi": "Điện thoại kêu kìa.", "gIds": ["te_iru"] } },
            { "STT": 54, "Kanji": "鳴らす", "Nghĩa": "Làm kêu/Bấm chuông", "Furigana": "ならす", "type": "verb", "conv": { "polite": "チャイムを鳴らしましたが、誰もいません。", "pVi": "Tôi đã bấm chuông nhưng không có ai.", "casual": "チャイム鳴らしたけどいない。", "cVi": "Bấm chuông rồi mà chả thấy ai.", "gIds": [] } },
            { "STT": 55, "Kanji": "役立つ", "Nghĩa": "Có ích/Hữu ích", "Furigana": "やくだつ", "type": "verb", "conv": { "polite": "この本はとても役に立ちます。", "pVi": "Cuốn sách này rất có ích.", "casual": "これ役立つよ。", "cVi": "Cái này tiện lắm.", "gIds": [] } },
            { "STT": 56, "Kanji": "役立てる", "Nghĩa": "Ứng dụng/Sử dụng", "Furigana": "やくだてる", "type": "verb", "conv": { "polite": "経験を仕事に役立てたいです。", "pVi": "Tôi muốn ứng dụng kinh nghiệm vào công việc.", "casual": "経験を役立てたい。", "cVi": "Muốn dùng kinh nghiệm vào việc gì đó.", "gIds": [] } },
            { "STT": 57, "Kanji": "倒れる", "Nghĩa": "Đổ/Ngã (tự)", "Furigana": "たおれる", "type": "verb", "conv": { "polite": "台風で木が倒れてしまいました。", "pVi": "Cây đã bị đổ do bão mất rồi.", "casual": "木が倒れちゃった。", "cVi": "Cây đổ mất tiêu rồi.", "gIds": ["te_shimau"] } },
            { "STT": 58, "Kanji": "倒す", "Nghĩa": "Làm đổ/Đánh bại", "Furigana": "たおす", "type": "verb", "conv": { "polite": "花瓶を倒さないように注意してください。", "pVi": "Hãy chú ý để không làm đổ bình hoa.", "casual": "花瓶倒さないでね。", "cVi": "Cẩn thận kẻo đổ bình hoa.", "gIds": ["you_ni_suru"] } },
            { "STT": 59, "Kanji": "起きる", "Nghĩa": "Thức dậy/Xảy ra", "Furigana": "おきる", "type": "verb", "conv": { "polite": "毎朝6時に起きることにしています。", "pVi": "Tôi quyết định dậy lúc 6 giờ mỗi sáng.", "casual": "6時に起きることにしてる。", "cVi": "Tớ toàn dậy lúc 6h thôi.", "gIds": ["koto_ni_suru"] } },
            { "STT": 60, "Kanji": "起こす", "Nghĩa": "Đánh thức/Gây ra", "Furigana": "おこす", "type": "verb", "conv": { "polite": "明日の朝、私を起こしてくれませんか。", "pVi": "Sáng mai đánh thức tôi được không?", "casual": "明日起こして。", "cVi": "Mai gọi tớ dậy nhé.", "gIds": ["te_kuremasenka"] } },
            { "STT": 61, "Kanji": "尋ねる", "Nghĩa": "Hỏi (thăm)", "Furigana": "たずねる", "type": "verb", "conv": { "polite": "道を尋ねられました。", "pVi": "Tôi đã được hỏi đường.", "casual": "道尋ねられたよ。", "cVi": "Có người hỏi đường tớ.", "gIds": ["passive"] } },
            { "STT": 62, "Kanji": "呼ぶ", "Nghĩa": "Gọi", "Furigana": "よぶ", "type": "verb", "conv": { "polite": "タクシーを呼びましょうか。", "pVi": "Tôi gọi taxi nhé?", "casual": "タクシー呼ぼうか？", "cVi": "Gọi taxi không?", "gIds": ["mashou_ka"] } },
            { "STT": 63, "Kanji": "叫ぶ", "Nghĩa": "Hét/Gào", "Furigana": "さけぶ", "type": "verb", "conv": { "polite": "大声で叫ばないでください。", "pVi": "Xin đừng hét lớn.", "casual": "叫ばないでよ。", "cVi": "Đừng có gào lên thế.", "gIds": ["naide_kudasai"] } },
            { "STT": 64, "Kanji": "黙る", "Nghĩa": "Im lặng", "Furigana": "だまる", "type": "verb", "conv": { "polite": "彼は急に黙ってしまいました。", "pVi": "Anh ấy đột nhiên im lặng mất rồi.", "casual": "急に黙っちゃった。", "cVi": "Tự nhiên im re.", "gIds": ["te_shimau"] } },
            { "STT": 65, "Kanji": "飼う", "Nghĩa": "Nuôi (vật nuôi)", "Furigana": "かう", "type": "verb", "conv": { "polite": "犬を飼うことになりました。", "pVi": "Gia đình tôi đã quyết định nuôi chó.", "casual": "犬飼うことになった。", "cVi": "Nhà tớ sắp nuôi chó đấy.", "gIds": ["koto_ni_naru"] } },
            { "STT": 66, "Kanji": "数える", "Nghĩa": "Đếm", "Furigana": "かぞえる", "type": "verb", "conv": { "polite": "人数を数えてください。", "pVi": "Hãy đếm số người đi.", "casual": "人数数えて。", "cVi": "Đếm người đi.", "gIds": ["te_kudasai"] } },
            { "STT": 67, "Kanji": "乾く", "Nghĩa": "Khô", "Furigana": "かわく", "type": "verb", "conv": { "polite": "洗濯物がまだ乾いていません。", "pVi": "Đồ giặt vẫn chưa khô.", "casual": "まだ乾いてないよ。", "cVi": "Vẫn chưa khô đâu.", "gIds": ["te_iru"] } },
            { "STT": 68, "Kanji": "乾かす", "Nghĩa": "Làm khô", "Furigana": "かわかす", "type": "verb", "conv": { "polite": "ドライヤーで髪を乾かします。", "pVi": "Tôi làm khô tóc bằng máy sấy.", "casual": "髪乾かすね。", "cVi": "Sấy tóc đây.", "gIds": [] } },
            { "STT": 69, "Kanji": "畳む", "Nghĩa": "Gấp/Xếp", "Furigana": "たたむ", "type": "verb", "conv": { "polite": "洗濯物を畳んでおきました。", "pVi": "Tôi đã gấp sẵn đồ giặt rồi.", "casual": "洗濯物畳んどいたよ。", "cVi": "Tớ gấp quần áo rồi.", "gIds": ["te_aru"] } },
            { "STT": 70, "Kanji": "誘う", "Nghĩa": "Mời/Rủ", "Furigana": "さそう", "type": "verb", "conv": { "polite": "彼女をデートに誘うことにしました。", "pVi": "Tôi đã quyết định mời cô ấy đi hẹn hò.", "casual": "デートに誘うことにした。", "cVi": "Quyết định rủ em ấy đi chơi rồi.", "gIds": ["koto_ni_suru"] } },
            { "STT": 71, "Kanji": "奢る", "Nghĩa": "Chiêu đãi/Khao", "Furigana": "おごる", "type": "verb", "conv": { "polite": "今日は私が奢ります。", "pVi": "Hôm nay tôi khao.", "casual": "今日はおごるよ。", "cVi": "Nay tớ bao.", "gIds": [] } },
            { "STT": 72, "Kanji": "預かる", "Nghĩa": "Trông nom/Giữ hộ", "Furigana": "あずかる", "type": "verb", "conv": { "polite": "荷物を預かりましょうか。", "pVi": "Để tôi giữ hành lý giúp nhé?", "casual": "荷物預かろうか？", "cVi": "Tớ giữ đồ cho nhé?", "gIds": ["mashou_ka"] } },
            { "STT": 73, "Kanji": "預ける", "Nghĩa": "Gửi/Ký gửi", "Furigana": "あずける", "type": "verb", "conv": { "polite": "銀行にお金を預けました。", "pVi": "Tôi đã gửi tiền vào ngân hàng.", "casual": "銀行に預けたよ。", "cVi": "Gửi ngân hàng rồi.", "gIds": [] } },
            { "STT": 74, "Kanji": "決まる", "Nghĩa": "Được quyết định", "Furigana": "きまる", "type": "verb", "conv": { "polite": "日程が決まりました。", "pVi": "Lịch trình đã được quyết định.", "casual": "日程決まったよ。", "cVi": "Chốt lịch rồi.", "gIds": [] } },
            { "STT": 75, "Kanji": "決める", "Nghĩa": "Quyết định", "Furigana": "きめる", "type": "verb", "conv": { "polite": "進路を早く決めるようにしてください。", "pVi": "Hãy cố gắng quyết định con đường tương lai sớm.", "casual": "早く決めなよ。", "cVi": "Quyết nhanh đi.", "gIds": ["you_ni_suru"] } },
            { "STT": 76, "Kanji": "写る", "Nghĩa": "Được chụp/Chiếu", "Furigana": "うつる", "type": "verb", "conv": { "polite": "この写真、よく写っていますね。", "pVi": "Bức ảnh này chụp đẹp (lên hình tốt) nhỉ.", "casual": "これよく写ってるね。", "cVi": "Ảnh này ăn ảnh ghê.", "gIds": ["te_iru"] } },
            { "STT": 77, "Kanji": "写す", "Nghĩa": "Chụp/Sao chép", "Furigana": "うつす", "type": "verb", "conv": { "polite": "黒板の字をノートに写しました。", "pVi": "Tôi đã chép chữ trên bảng vào vở.", "casual": "ノートに写したよ。", "cVi": "Chép vào vở rồi.", "gIds": [] } },
            { "STT": 78, "Kanji": "思い出す", "Nghĩa": "Nhớ ra/Nhớ lại", "Furigana": "おもいだす", "type": "verb", "conv": { "polite": "名前を思い出せません。", "pVi": "Tôi không thể nhớ ra tên.", "casual": "名前思い出せない。", "cVi": "Chả nhớ tên là gì.", "gIds": ["koto_ga_dekiru"] } },
            { "STT": 79, "Kanji": "教わる", "Nghĩa": "Được dạy/Học", "Furigana": "おそわる", "type": "verb", "conv": { "polite": "先生に日本語を教わっています。", "pVi": "Tôi đang được thầy giáo dạy tiếng Nhật.", "casual": "先生に教わってるよ。", "cVi": "Đang học thầy đấy.", "gIds": ["te_iru"] } },
            { "STT": 80, "Kanji": "断る", "Nghĩa": "Từ chối", "Furigana": "ことわる", "type": "verb", "conv": { "polite": "招待を断ってしまいました。", "pVi": "Tôi đã lỡ từ chối lời mời rồi.", "casual": "断っちゃった。", "cVi": "Tớ từ chối mất rồi.", "gIds": ["te_shimau"] } },
            { "STT": 81, "Kanji": "見つかる", "Nghĩa": "Được tìm thấy", "Furigana": "みつかる", "type": "verb", "conv": { "polite": "鍵が見つかりました。", "pVi": "Chìa khóa đã được tìm thấy.", "casual": "鍵見つかったよ。", "cVi": "Thấy chìa khóa rồi.", "gIds": [] } },
            { "STT": 82, "Kanji": "見つける", "Nghĩa": "Tìm thấy", "Furigana": "みつける", "type": "verb", "conv": { "polite": "良い仕事を見つけることができました。", "pVi": "Tôi đã tìm được công việc tốt.", "casual": "いい仕事見つけたよ。", "cVi": "Kiếm được việc ngon rồi.", "gIds": ["koto_ga_dekiru"] } },
            { "STT": 83, "Kanji": "捕まる", "Nghĩa": "Bị bắt", "Furigana": "つかまる", "type": "verb", "conv": { "polite": "犯人が捕まりました。", "pVi": "Tội phạm đã bị bắt.", "casual": "犯人捕まったって。", "cVi": "Tên tội phạm bị tóm rồi.", "gIds": [] } },
            { "STT": 84, "Kanji": "捕まえる", "Nghĩa": "Bắt/Tóm", "Furigana": "つかまえる", "type": "verb", "conv": { "polite": "警察が泥棒を捕まえました。", "pVi": "Cảnh sát đã bắt được kẻ trộm.", "casual": "泥棒捕まえたよ。", "cVi": "Tóm được trộm rồi.", "gIds": [] } },
            { "STT": 85, "Kanji": "乗る", "Nghĩa": "Lên xe", "Furigana": "のる", "type": "verb", "conv": { "polite": "バスに乗って行きます。", "pVi": "Tôi sẽ đi bằng xe buýt.", "casual": "バスに乗ってく。", "cVi": "Tớ đi xe buýt.", "gIds": ["te_iku"] } },
            { "STT": 86, "Kanji": "乗せる", "Nghĩa": "Cho lên xe/Chở", "Furigana": "のせる", "type": "verb", "conv": { "polite": "駅まで乗せていってください。", "pVi": "Hãy chở tôi đến nhà ga.", "casual": "駅まで乗せてって。", "cVi": "Chở tớ ra ga với.", "gIds": ["te_iku", "te_kudasai"] } },
            { "STT": 87, "Kanji": "降りる", "Nghĩa": "Xuống xe", "Furigana": "おりる", "type": "verb", "conv": { "polite": "次の駅で降ります。", "pVi": "Tôi sẽ xuống ở ga tiếp theo.", "casual": "次で降りるよ。", "cVi": "Tớ xuống ga sau.", "gIds": [] } }
        ];

        // --- 3. KANJI DETAILS (Updated for Day 26) ---
        const kanjiDetails = {
            "落": { hanviet: "LẠC", mean: "Rơi/Rụng", on: "ラク", kun: "お.ちる", radicals: "Thảo (艹) + Lạc (洛)", tipImg: "Lá (艹) rơi lạc (洛) lõng.", tipSoundOn: "**Raku**dai thi trượt.", tipSoundKun: "**O**chiru rơi.", words: [{w:"落ちる (おちる)", m:"Rơi"}, {w:"落とす (おとす)", m:"Làm rơi"}] },
            "消": { hanviet: "TIÊU", mean: "Tiêu diệt/Tắt", on: "ショウ", kun: "き.える", radicals: "Thủy (氵) + Tiếu (肖)", tipImg: "Nước (氵) làm tan biến (肖).", tipSoundOn: "**Shou**kaki bình cứu hỏa.", tipSoundKun: "**Ki**eru tắt.", words: [{w:"消える (きえる)", m:"Tắt/Biến mất"}, {w:"消す (けす)", m:"Xóa/Tắt"}] },
            "付": { hanviet: "PHÓ", mean: "Gắn/Dính", on: "フ", kun: "つ.く", radicals: "Nhân (亻) + Thốn (寸)", tipImg: "Người trao tấc lòng.", tipSoundOn: "Ki**fu** quyên góp.", tipSoundKun: "**Tsu**ku dính.", words: [{w:"付く (つく)", m:"Dính"}, {w:"付ける (つける)", m:"Gắn/Bật"}] },
            "効": { hanviet: "HIỆU", mean: "Hiệu quả", on: "コウ", kun: "き.く", radicals: "Lực (力) + Giao (交)", tipImg: "Dùng lực (力) giao (交) tiếp có hiệu quả.", tipSoundOn: "**Kou**ka hiệu quả.", tipSoundKun: "**Ki**ku có tác dụng.", words: [{w:"効く (きく)", m:"Có hiệu quả"}] },
            "流": { hanviet: "LƯU", mean: "Chảy", on: "リュウ", kun: "なが.れる", radicals: "Thủy (氵)", tipImg: "Dòng nước chảy.", tipSoundOn: "**Ryuu**kou lưu hành.", tipSoundKun: "**Naga**reru chảy.", words: [{w:"流行る (はやる)", m:"Thịnh hành"}, {w:"流れる (ながれる)", m:"Chảy"}] },
            "経": { hanviet: "KINH", mean: "Trải qua/Kinh tế", on: "ケイ", kun: "へ.る", radicals: "Mịch (糸)", tipImg: "Sợi chỉ thời gian.", tipSoundOn: "**Kei**zai kinh tế.", tipSoundKun: "**Ta**tsu trôi qua (thời gian).", words: [{w:"経つ (たつ)", m:"Trôi qua"}] },
            "合": { hanviet: "HỢP", mean: "Hợp/Vừa", on: "ゴウ", kun: "あ.う", radicals: "Nhân (人) + Nhất (一) + Khẩu (口)", tipImg: "Người một nhà ăn chung.", tipSoundOn: "Shuu**gou** tập hợp.", tipSoundKun: "**A**waseru điều chỉnh.", words: [{w:"間に合う (まにあう)", m:"Kịp"}, {w:"合わせる (あわせる)", m:"Điều chỉnh"}] },
            "通": { hanviet: "THÔNG", mean: "Đi qua/Thông suốt", on: "ツウ", kun: "とお.る", radicals: "Xước (⻌)", tipImg: "Đi thông qua.", tipSoundOn: "Kou**tsuu** giao thông.", tipSoundKun: "**Kayo**u đi lại.", words: [{w:"通う (かよう)", m:"Đi làm/Đi học"}] },
            "込": { hanviet: "VÀO", mean: "Đông/Vào", on: "", kun: "こ.む", radicals: "Xước (⻌) + Nhập (入)", tipImg: "Đi (⻌) nhập (入) vào đám đông.", tipSoundOn: "", tipSoundKun: "**Ko**mu đông đúc.", words: [{w:"込む (こむ)", m:"Đông đúc"}] },
            "違": { hanviet: "VI", mean: "Sai/Khác", on: "イ", kun: "ちが.う", radicals: "Xước (⻌)", tipImg: "Đi trái đường.", tipSoundOn: "**I**han vi phạm.", tipSoundKun: "Sure**chiga**u đi lướt qua.", words: [{w:"すれ違う (すれちがう)", m:"Đi lướt qua"}] },
            "掛": { hanviet: "QUẢI", mean: "Treo", on: "カ", kun: "か.ける", radicals: "Thủ (扌) + Quái (卦)", tipImg: "Tay treo quẻ bói.", tipSoundOn: "", tipSoundKun: "**Ka**karu tốn/mất.", words: [{w:"掛かる (かかる)", m:"Tốn/Mất"}, {w:"掛ける (かける)", m:"Treo/Đắp"}] },
            "動": { hanviet: "ĐỘNG", mean: "Chuyển động", on: "ドウ", kun: "うご.く", radicals: "Lực (力) + Trọng (重)", tipImg: "Dùng lực đẩy vật nặng.", tipSoundOn: "Ji**dou** tự động.", tipSoundKun: "**Ugo**ku chuyển động.", words: [{w:"動く (うごく)", m:"Chuyển động"}, {w:"動かす (うごかす)", m:"Làm chuyển động"}] },
            "離": { hanviet: "LY", mean: "Rời xa", on: "リ", kun: "はな.れる", radicals: "Chuy (隹)", tipImg: "Chim bay đi ly biệt.", tipSoundOn: "**Ri**kon ly hôn.", tipSoundKun: "**Hana**reru rời xa.", words: [{w:"離れる (はなれる)", m:"Rời xa"}, {w:"離す (はなす)", m:"Tách ra"}] },
            "倒": { hanviet: "ĐẢO", mean: "Đổ/Ngã", on: "トウ", kun: "たお.れる", radicals: "Nhân (亻)", tipImg: "Người ngã.", tipSoundOn: "**Tou**san phá sản.", tipSoundKun: "**Tao**reru đổ.", words: [{w:"倒れる (たおれる)", m:"Đổ"}, {w:"倒す (たおす)", m:"Làm đổ/Hạ gục"}] },
            "起": { hanviet: "KHỞI", mean: "Thức dậy", on: "キ", kun: "お.きる", radicals: "Tẩu (走) + Kỷ (己)", tipImg: "Chạy (走) dậy.", tipSoundOn: "**Ki**shou thức dậy.", tipSoundKun: "**O**kosu đánh thức.", words: [{w:"起きる (おきる)", m:"Dậy/Xảy ra"}, {w:"起こす (おこす)", m:"Đánh thức/Gây ra"}] },
            "尋": { hanviet: "TẦM", mean: "Hỏi thăm", on: "ジン", kun: "たず.ねる", radicals: "Thốn (寸)", tipImg: "Tay dò hỏi.", tipSoundOn: "", tipSoundKun: "**Tazu**neru hỏi.", words: [{w:"尋ねる (たずねる)", m:"Hỏi"}] },
            "呼": { hanviet: "HÔ", mean: "Gọi", on: "コ", kun: "よ.ぶ", radicals: "Khẩu (口)", tipImg: "Miệng hô to.", tipSoundOn: "Ko**kyuu** hô hấp.", tipSoundKun: "**Yo**bu gọi.", words: [{w:"呼ぶ (よぶ)", m:"Gọi"}] },
            "叫": { hanviet: "KHIẾU", mean: "Hét", on: "キョウ", kun: "さけ.ぶ", radicals: "Khẩu (口)", tipImg: "Miệng hét to.", tipSoundOn: "Zek**kyou** tuyệt khiếu.", tipSoundKun: "**Sake**bu hét.", words: [{w:"叫ぶ (さけぶ)", m:"Hét"}] },
            "黙": { hanviet: "MẶC", mean: "Im lặng", on: "モク", kun: "だま.る", radicals: "Hắc (黒) + Khuyển (犬)", tipImg: "Chó đen im lặng.", tipSoundOn: "Chin**moku** trầm mặc.", tipSoundKun: "**Dama**ru im lặng.", words: [{w:"黙る (だまる)", m:"Im lặng"}] },
            "飼": { hanviet: "TỰ", mean: "Nuôi", on: "シ", kun: "か.う", radicals: "Thực (饣) + Ty (司)", tipImg: "Cho ăn để cai quản.", tipSoundOn: "**Shi**iku nuôi nấng.", tipSoundKun: "**Ka**u nuôi.", words: [{w:"飼う (かう)", m:"Nuôi (vật)"}] },
            "数": { hanviet: "SỐ", mean: "Đếm", on: "スウ", kun: "かぞ.える", radicals: "Phốc (攴)", tipImg: "Đánh dấu đếm.", tipSoundOn: "**Suu**gaku toán học.", tipSoundKun: "**Kazo**eru đếm.", words: [{w:"数える (かぞえる)", m:"Đếm"}] },
            "乾": { hanviet: "CAN", mean: "Khô", on: "カン", kun: "かわ.く", radicals: "Ất (乙) + Nhật (日)", tipImg: "Mặt trời làm khô.", tipSoundOn: "**Kan**pai cạn ly.", tipSoundKun: "**Kawa**ku khô.", words: [{w:"乾く (かわく)", m:"Khô"}, {w:"乾かす (かわかす)", m:"Làm khô"}] },
            "畳": { hanviet: "ĐIỆP", mean: "Gấp/Chiếu", on: "ジョウ", kun: "たた.む", radicals: "Điền (田)", tipImg: "Gấp chiếu trên ruộng (?).", tipSoundOn: "Ta**tami** chiếu.", tipSoundKun: "**Tata**mu gấp.", words: [{w:"畳む (たたむ)", m:"Gấp/Xếp"}] },
            "誘": { hanviet: "DỤ", mean: "Mời/Dụ", on: "ユウ", kun: "さそ.う", radicals: "Ngôn (言) + Tú (秀)", tipImg: "Lời nói tú lệ dụ dỗ.", tipSoundOn: "Kan**yuu** khuyến dụ.", tipSoundKun: "**Saso**u mời/rủ.", words: [{w:"誘う (さそう)", m:"Mời/Rủ"}] },
            "預": { hanviet: "DỰ", mean: "Gửi/Giữ", on: "ヨ", kun: "あず.ける", radicals: "Hiệt (頁)", tipImg: "Gửi trước (dự).", tipSoundOn: "**Yo**kin tiền gửi.", tipSoundKun: "**Azu**karu trông nom.", words: [{w:"預かる (あずかる)", m:"Trông nom"}, {w:"預ける (あずける)", m:"Gửi"}] },
            "決": { hanviet: "QUYẾT", mean: "Quyết định", on: "ケツ", kun: "き.める", radicals: "Thủy (氵)", tipImg: "Dòng nước quyết liệt.", tipSoundOn: "**Ket**tei quyết định.", tipSoundKun: "**Ki**maru được quyết định.", words: [{w:"決まる (きまる)", m:"Được quyết định"}, {w:"決める (きめる)", m:"Quyết định"}] },
            "写": { hanviet: "TẢ", mean: "Sao chép/Chụp", on: "シャ", kun: "うつ.す", radicals: "Mịch (冖)", tipImg: "Sao chép dưới mái nhà.", tipSoundOn: "**Sha**shin bức ảnh.", tipSoundKun: "**Utsu**ru được chụp.", words: [{w:"写る (うつる)", m:"Được chụp"}, {w:"写す (うつす)", m:"Chụp/Chép"}] },
            "教": { hanviet: "GIÁO", mean: "Dạy", on: "キョウ", kun: "おし.える", radicals: "Phốc (攴)", tipImg: "Đánh khẽ để dạy.", tipSoundOn: "**Kyou**shitsu phòng học.", tipSoundKun: "**Oso**waru được dạy.", words: [{w:"教わる (おそわる)", m:"Được dạy"}] },
            "断": { hanviet: "ĐOẠN", mean: "Từ chối/Cắt", on: "ダン", kun: "ことわ.る", radicals: "Cân (斤)", tipImg: "Dùng rìu cắt đoạn.", tipSoundOn: "Han**dan** phán đoán.", tipSoundKun: "**Kotowa**ru từ chối.", words: [{w:"断る (ことわる)", m:"Từ chối"}] },
            "見": { hanviet: "KIẾN", mean: "Nhìn", on: "ケン", kun: "み.る", radicals: "Kiến (見)", tipImg: "Con mắt.", tipSoundOn: "Haik**ken** bái kiến.", tipSoundKun: "**Mitsu**keru tìm thấy.", words: [{w:"見つかる (みつかる)", m:"Được tìm thấy"}, {w:"見つける (みつける)", m:"Tìm thấy"}] },
            "捕": { hanviet: "BỘ", mean: "Bắt", on: "ホ", kun: "つか.まえる", radicals: "Thủ (扌) + Phụ (甫)", tipImg: "Tay bắt lấy.", tipSoundOn: "Tai**ho** bắt giữ.", tipSoundKun: "**Tsuka**maru bị bắt.", words: [{w:"捕まる (つかまる)", m:"Bị bắt"}, {w:"捕まえる (つかまえる)", m:"Bắt"}] },
            "乗": { hanviet: "THỪA", mean: "Lên xe", on: "ジョウ", kun: "の.る", radicals: "Thảo (艹)", tipImg: "Ngồi lên cây.", tipSoundOn: "**Jou**sha lên xe.", tipSoundKun: "**No**seru chở.", words: [{w:"乗る (のる)", m:"Lên xe"}, {w:"乗せる (のせる)", m:"Chở"}] },
            "降": { hanviet: "GIÁNG", mean: "Xuống/Rơi", on: "コウ", kun: "お.りる", radicals: "Ấp (阝)", tipImg: "Đi xuống núi.", tipSoundOn: "Ka**kou** hạ xuống.", tipSoundKun: "**O**riru xuống xe.", words: [{w:"降りる (おりる)", m:"Xuống xe"}, {w:"降ろす (おろす)", m:"Cho xuống"}] }
        };

        // --- 4. APP LOGIC ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }

        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }

        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
