<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 24: Đi kèm & Mức độ</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base Settings */
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* UI Components */
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Logic CSS */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially for animation */
        #strokeAnimContainer svg path { opacity: 0; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 24: Đi kèm & Mức độ</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">予想</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">よそう</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Dự đoán</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại & Ví dụ</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- MOBILE DRAWER -->
        <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none flex">
            <div id="drawerBackdrop" class="absolute inset-0 bg-gray-900/50 opacity-0 transition-opacity" onclick="toggleDrawer()"></div>
            <div id="drawerContent" class="relative w-72 bg-white h-full shadow-2xl transition-transform -translate-x-full flex flex-col pointer-events-auto">
                <div class="p-4 bg-indigo-700 text-white flex justify-between items-center">
                    <h2 class="font-bold">Danh sách từ vựng</h2>
                    <button onclick="toggleDrawer()"><i class="fas fa-times"></i></button>
                </div>
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <input type="text" id="mobileSearchInput" placeholder="Tìm kiếm nhanh..." class="w-full px-4 py-2 bg-white border border-gray-200 rounded-xl text-sm outline-none">
                </div>
                <div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 24</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (Day 24) ---
        const grammarRepo = {
            "toori": { title: "Đúng như / Theo như", formula: "Vる/Vた/Nの + とおり", desc: "Thực hiện hành động hoặc sự việc xảy ra giống hệt như mẫu/dự đoán.", ex: "予想のとおり、彼が勝った。" },
            "kurai_nara": { title: "Nếu... thì thà... còn hơn", formula: "Vる + くらいなら", desc: "So sánh tiêu cực: Nếu phải làm A (điều không muốn) thì thà làm B (còn đỡ hơn).", ex: "彼に謝るくらいなら、死んだほうがましだ。" },
            "tabi_ni": { title: "Cứ mỗi lần", formula: "Vる/Nの + たびに", desc: "Mỗi khi hành động A xảy ra thì hành động B cũng xảy ra (thường là quy luật/thói quen).", ex: "この曲を聞くたびに、故郷を思い出す。" },
            "tsuide_ni": { title: "Nhân tiện", formula: "Vる/Vた/Nの + ついでに", desc: "Làm hành động B tận dụng cơ hội khi làm hành động A.", ex: "買い物のついでに、本屋に寄った。" },
            "to_iu_yori": { title: "Nói là... thì đúng hơn", formula: "A というより B", desc: "Dùng để đính chính, B diễn tả bản chất chính xác hơn A.", ex: "彼は医者というより、科学者だ。" },
            "to_iwarete_iru": { title: "Người ta nói rằng", formula: "Thể thường + と言われている", desc: "Diễn tả nhận định chung của xã hội, dư luận.", ex: "納豆は体にいいと言われている。" },
            "wa_nai": { title: "Không có... bằng", formula: "N + くらい/ほど + ...はない", desc: "So sánh nhất: Không có gì đạt đến mức độ của N.", ex: "彼ぐらい親切な人はいない。" },
            "ni_kagiru": { title: "Tốt nhất là", formula: "Vる/Vない/N + に限る", desc: "Đưa ra lời khuyên chủ quan, cho rằng cách đó là tốt nhất.", ex: "風邪を引いた時は寝るに限る。" },
            "tame_ni": { title: "Vì... (Nguyên nhân)", formula: "Thể thường + ため(に)", desc: "Chỉ nguyên nhân dẫn đến kết quả (thường là kết quả xấu hoặc trang trọng).", ex: "大雪のため、電車が遅れた。" },
            "no_de": { title: "Vì... nên...", formula: "Thể thường + ので", desc: "Nêu lý do, nguyên nhân một cách nhẹ nhàng, khách quan.", ex: "用事があるので、先に帰ります。" },
            "tara_douka": { title: "Thử... xem sao?", formula: "Vたら + どうか", desc: "Đưa ra lời khuyên hoặc đề xuất một cách nhẹ nhàng.", ex: "少し休んだらどうですか。" }
        };

        // --- 2. VOCABULARY DATA (Day 24 - 87 words) ---
        const vocabData = [
            { "STT": 1, "Kanji": "予想", "Nghĩa": "Dự đoán", "Furigana": "よそう", "type": "noun", "conv": { "polite": "予想どおり、Aチームが優勝しました。", "pVi": "Đúng như dự đoán, đội A đã vô địch.", "casual": "予想通りだったね。", "cVi": "Đúng như dự đoán ha.", "gIds": ["toori"] } },
            { "STT": 2, "Kanji": "独身", "Nghĩa": "Độc thân", "Furigana": "どくしん", "type": "noun", "conv": { "polite": "嫌いな人と結婚するくらいなら、独身でいたいです。", "pVi": "Nếu phải kết hôn với người mình ghét, thà tôi độc thân còn hơn.", "casual": "あいつと結婚するくらいなら独身がいい。", "cVi": "Cưới hắn thì thà ế còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 3, "Kanji": "電話", "Nghĩa": "Điện thoại", "Furigana": "でんわ", "type": "noun", "conv": { "polite": "母は私が電話をかけるたびに、心配します。", "pVi": "Cứ mỗi lần tôi gọi điện, mẹ lại lo lắng.", "casual": "電話するたびに心配されるよ。", "cVi": "Cứ gọi là bị lo.", "gIds": ["tabi_ni"] } },
            { "STT": 4, "Kanji": "手紙", "Nghĩa": "Thư", "Furigana": "てがみ", "type": "noun", "conv": { "polite": "銀行へ行くついでにこの手紙を出してください。", "pVi": "Tiện thể đến ngân hàng anh gửi cho em lá thư này nhé.", "casual": "ついでに手紙出してきて。", "cVi": "Tiện thể gửi thư hộ cái.", "gIds": ["tsuide_ni"] } },
            { "STT": 5, "Kanji": "強制", "Nghĩa": "Cưỡng chế/Ép buộc", "Furigana": "きょうせい", "type": "noun", "conv": { "polite": "彼の言い方は勧めているというより、強制しているようです。", "pVi": "Cách nói của anh ấy có vẻ như đang ép buộc hơn là khuyên nhủ.", "casual": "勧めというより強制だね。", "cVi": "Ép buộc chứ khuyên gì.", "gIds": ["to_iu_yori"] } },
            { "STT": 6, "Kanji": "納豆", "Nghĩa": "Đậu nát-tô", "Furigana": "なっとう", "type": "noun", "conv": { "polite": "納豆は体にいいと言われています。", "pVi": "Đậu tương lên men được cho là tốt cho sức khỏe.", "casual": "納豆って体にいいらしいよ。", "cVi": "Nghe bảo natto tốt lắm.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 7, "Kanji": "動物", "Nghĩa": "Động vật", "Furigana": "どうぶつ", "type": "noun", "conv": { "polite": "リーさんぐらい動物好きなひとはいません。", "pVi": "Không có ai yêu động vật hơn Ly.", "casual": "リーさんほど動物好きな人いないよ。", "cVi": "Chả ai yêu động vật bằng Ly đâu.", "gIds": ["wa_nai"] } },
            { "STT": 8, "Kanji": "計画", "Nghĩa": "Kế hoạch", "Furigana": "けいかく", "type": "noun", "conv": { "polite": "計画どおりに進んでいます。", "pVi": "Mọi việc đang tiến triển đúng theo kế hoạch.", "casual": "計画通りだよ。", "cVi": "Đúng kế hoạch rồi.", "gIds": ["toori"] } },
            { "STT": 9, "Kanji": "指示", "Nghĩa": "Chỉ thị", "Furigana": "しじ", "type": "noun", "conv": { "polite": "指示のとおりにやってください。", "pVi": "Hãy làm đúng theo chỉ thị.", "casual": "指示通りにやって。", "cVi": "Làm theo chỉ thị đi.", "gIds": ["toori"] } },
            { "STT": 10, "Kanji": "期待", "Nghĩa": "Kỳ vọng", "Furigana": "きたい", "type": "noun", "conv": { "polite": "期待どおりの結果が出ました。", "pVi": "Đã có kết quả đúng như kỳ vọng.", "casual": "期待通りの結果だね。", "cVi": "Kết quả y như mong đợi.", "gIds": ["toori"] } },
            { "STT": 11, "Kanji": "希望", "Nghĩa": "Nguyện vọng/Hy vọng", "Furigana": "きぼう", "type": "noun", "conv": { "polite": "希望どおりの部屋が見つかりました。", "pVi": "Tôi đã tìm thấy căn phòng đúng như nguyện vọng.", "casual": "希望通りの部屋あったよ。", "cVi": "Tìm được phòng ưng ý rồi.", "gIds": ["toori"] } },
            { "STT": 12, "Kanji": "辞める", "Nghĩa": "Từ bỏ/Nghỉ việc", "Furigana": "やめる", "type": "verb", "conv": { "polite": "彼に謝るくらいなら、会社を辞めます。", "pVi": "Nếu phải xin lỗi hắn, tôi thà nghỉ việc còn hơn.", "casual": "謝るくらいなら辞めるよ。", "cVi": "Xin lỗi hắn thì thà nghỉ còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 13, "Kanji": "捨てる", "Nghĩa": "Vứt bỏ", "Furigana": "すてる", "type": "verb", "conv": { "polite": "彼にあげるくらいなら、捨てたほうがいいです。", "pVi": "Nếu phải cho hắn thì thà vứt đi còn hơn.", "casual": "あげるくらいなら捨てる。", "cVi": "Cho nó thì thà vứt đi.", "gIds": ["kurai_nara"] } },
            { "STT": 14, "Kanji": "諦める", "Nghĩa": "Bỏ cuộc", "Furigana": "あきらめる", "type": "verb", "conv": { "polite": "負けるくらいなら、途中で諦めたくないです。", "pVi": "Nếu phải thua cuộc, tôi không muốn bỏ cuộc giữa chừng (câu này hơi lạ, sửa: Thà thua còn hơn bỏ cuộc?). No, context: Rather than give up, I'll try.", "casual": "諦めるくらいなら死ぬ気でやる。", "cVi": "Thà chết còn hơn bỏ cuộc.", "gIds": ["kurai_nara"] } },
            { "STT": 15, "Kanji": "失敗", "Nghĩa": "Thất bại", "Furigana": "しっぱい", "type": "noun", "conv": { "polite": "失敗するたびに、強くなります。", "pVi": "Mỗi lần thất bại, tôi lại mạnh mẽ hơn.", "casual": "失敗するたびに強くなるね。", "cVi": "Cứ sai là lại khôn ra.", "gIds": ["tabi_ni"] } },
            { "STT": 16, "Kanji": "散歩", "Nghĩa": "Đi dạo", "Furigana": "さんぽ", "type": "noun", "conv": { "polite": "散歩のついでに、パンを買ってきました。", "pVi": "Nhân tiện đi dạo, tôi đã mua bánh mì về.", "casual": "散歩ついでにパン買ってきた。", "cVi": "Tiện đi dạo mua bánh mì luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 17, "Kanji": "コンビニ", "Nghĩa": "Cửa hàng tiện lợi", "Furigana": "こんびに", "type": "noun", "conv": { "polite": "コンビニへ行くついでに、お金をおろしました。", "pVi": "Nhân tiện đi konbini, tôi đã rút tiền.", "casual": "コンビニついでにお金おろした。", "cVi": "Tiện ra konbini rút tiền luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 18, "Kanji": "綺麗", "Nghĩa": "Đẹp/Sạch", "Furigana": "きれい", "type": "adj", "conv": { "polite": "彼女は綺麗というより、可愛いです。", "pVi": "Cô ấy nói là dễ thương thì đúng hơn là đẹp.", "casual": "きれいっていうか、可愛いよね。", "cVi": "Không hẳn đẹp mà là dễ thương.", "gIds": ["to_iu_yori"] } },
            { "STT": 19, "Kanji": "冷たい", "Nghĩa": "Lạnh lùng", "Furigana": "つめたい", "type": "adj", "conv": { "polite": "彼は冷たいというより、シャイなんです。", "pVi": "Anh ấy nói là nhút nhát thì đúng hơn là lạnh lùng.", "casual": "冷たいんじゃなくてシャイなんだよ。", "cVi": "Hắn không lạnh lùng đâu, ngại đấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 20, "Kanji": "厳しい", "Nghĩa": "Nghiêm khắc", "Furigana": "きびしい", "type": "adj", "conv": { "polite": "先生は厳しいというより、熱心です。", "pVi": "Thầy giáo nói là nhiệt tình thì đúng hơn là nghiêm khắc.", "casual": "厳しいっていうか熱心だよね。", "cVi": "Nghiêm gì, thầy nhiệt tình đấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 21, "Kanji": "伝統", "Nghĩa": "Truyền thống", "Furigana": "でんとう", "type": "noun", "conv": { "polite": "これは日本の伝統だと言われています。", "pVi": "Đây được cho là truyền thống của Nhật Bản.", "casual": "これ日本の伝統らしいよ。", "cVi": "Cái này là truyền thống Nhật đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 22, "Kanji": "幽霊", "Nghĩa": "Ma", "Furigana": "ゆうれい", "type": "noun", "conv": { "polite": "ここには幽霊が出ると言われています。", "pVi": "Người ta đồn rằng ở đây có ma xuất hiện.", "casual": "ここ幽霊出るらしいよ。", "cVi": "Chỗ này có ma đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 23, "Kanji": "野球", "Nghĩa": "Bóng chày", "Furigana": "やきゅう", "type": "noun", "conv": { "polite": "野球ぐらい面白いスポーツはありません。", "pVi": "Không có môn thể thao nào thú vị hơn bóng chày.", "casual": "野球ほど面白いもんないよ。", "cVi": "Chả gì hay bằng bóng chày.", "gIds": ["wa_nai"] } },
            { "STT": 24, "Kanji": "季節", "Nghĩa": "Mùa", "Furigana": "きせつ", "type": "noun", "conv": { "polite": "秋ぐらい過ごしやすい季節はありません。", "pVi": "Không có mùa nào dễ chịu hơn mùa thu.", "casual": "秋ほどいい季節ないよね。", "cVi": "Mùa thu là sướng nhất.", "gIds": ["wa_nai"] } },
            { "STT": 25, "Kanji": "景色", "Nghĩa": "Phong cảnh", "Furigana": "けしき", "type": "noun", "conv": { "polite": "ここぐらい景色がきれいな場所はありません。", "pVi": "Không có nơi nào phong cảnh đẹp hơn nơi này.", "casual": "ここほどきれいな場所ないよ。", "cVi": "Chả đâu đẹp bằng đây.", "gIds": ["wa_nai"] } },
            { "STT": 26, "Kanji": "規則", "Nghĩa": "Quy tắc", "Furigana": "きそく", "type": "noun", "conv": { "polite": "規則どおりに行動してください。", "pVi": "Hãy hành động đúng theo quy tắc.", "casual": "規則通りにしてね。", "cVi": "Làm đúng luật đi.", "gIds": ["toori"] } },
            { "STT": 27, "Kanji": "説明書", "Nghĩa": "Sách hướng dẫn", "Furigana": "せつめいしょ", "type": "noun", "conv": { "polite": "説明書のとおりに組み立てました。", "pVi": "Tôi đã lắp ráp đúng theo sách hướng dẫn.", "casual": "説明書通りに作ったよ。", "cVi": "Lắp y như sách chỉ rồi.", "gIds": ["toori"] } },
            { "STT": 28, "Kanji": "無理", "Nghĩa": "Vô lý/Quá sức", "Furigana": "むり", "type": "adj", "conv": { "polite": "無理するくらいなら、休んだほうがいいです。", "pVi": "Nếu phải cố quá sức thì thà nghỉ ngơi còn hơn.", "casual": "無理するくらいなら休みなよ。", "cVi": "Cố quá thì nghỉ đi.", "gIds": ["kurai_nara"] } },
            { "STT": 29, "Kanji": "我慢", "Nghĩa": "Chịu đựng", "Furigana": "がまん", "type": "noun", "conv": { "polite": "我慢するくらいなら、言ったほうがいいです。", "pVi": "Nếu phải chịu đựng thì thà nói ra còn hơn.", "casual": "我慢するくらいなら言っちゃえよ。", "cVi": "Nhịn làm gì, nói toẹt ra đi.", "gIds": ["kurai_nara"] } },
            { "STT": 30, "Kanji": "会う", "Nghĩa": "Gặp", "Furigana": "あう", "type": "verb", "conv": { "polite": "会うたびに、彼はきれいになっています。", "pVi": "Mỗi lần gặp, cô ấy lại đẹp ra.", "casual": "会うたびにきれいになるね。", "cVi": "Gặp lần nào cũng thấy xinh lên.", "gIds": ["tabi_ni"] } },
            { "STT": 31, "Kanji": "旅行", "Nghĩa": "Du lịch", "Furigana": "りょこう", "type": "noun", "conv": { "polite": "旅行のたびに、お土産を買います。", "pVi": "Mỗi lần đi du lịch, tôi đều mua quà.", "casual": "旅行のたびに土産買うんだ。", "cVi": "Đi chơi lần nào cũng mua quà.", "gIds": ["tabi_ni"] } },
            { "STT": 32, "Kanji": "用事", "Nghĩa": "Việc bận", "Furigana": "ようじ", "type": "noun", "conv": { "polite": "用事のついでに、友達に会いました。", "pVi": "Nhân tiện đi có việc, tôi đã gặp bạn.", "casual": "用事ついでに友達に会った。", "cVi": "Tiện đi công chuyện ghé thăm bạn luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 33, "Kanji": "掃除", "Nghĩa": "Dọn dẹp", "Furigana": "そうじ", "type": "noun", "conv": { "polite": "掃除のついでに、洗濯もしました。", "pVi": "Tiện thể dọn dẹp, tôi giặt đồ luôn.", "casual": "掃除ついでに洗濯もしたよ。", "cVi": "Tiện dọn nhà giặt đồ luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 34, "Kanji": "天才", "Nghĩa": "Thiên tài", "Furigana": "てんさい", "type": "noun", "conv": { "polite": "彼は努力家というより、天才です。", "pVi": "Anh ấy là thiên tài thì đúng hơn là người nỗ lực.", "casual": "努力家っていうか天才だね。", "cVi": "Nó là thiên tài chứ cày cuốc gì.", "gIds": ["to_iu_yori"] } },
            { "STT": 35, "Kanji": "仕事", "Nghĩa": "Công việc", "Furigana": "しごと", "type": "noun", "conv": { "polite": "これは仕事というより、趣味です。", "pVi": "Cái này nói là sở thích thì đúng hơn là công việc.", "casual": "仕事っていうか趣味だよ。", "cVi": "Làm vì đam mê thôi.", "gIds": ["to_iu_yori"] } },
            { "STT": 36, "Kanji": "文化", "Nghĩa": "Văn hóa", "Furigana": "ぶんか", "type": "noun", "conv": { "polite": "京都は日本の文化の中心だと言われています。", "pVi": "Kyoto được cho là trung tâm văn hóa của Nhật Bản.", "casual": "京都は文化の中心らしいよ。", "cVi": "Kyoto là cái nôi văn hóa đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 37, "Kanji": "成功", "Nghĩa": "Thành công", "Furigana": "せいこう", "type": "noun", "conv": { "polite": "失敗は成功のもとだと言われています。", "pVi": "Thất bại được cho là mẹ thành công.", "casual": "失敗は成功のもとって言うよね。", "cVi": "Thất bại là mẹ thành công mà.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 38, "Kanji": "母", "Nghĩa": "Mẹ", "Furigana": "はは", "type": "noun", "conv": { "polite": "母ぐらい優しい人はいません。", "pVi": "Không có ai hiền hậu hơn mẹ.", "casual": "母さんほど優しい人いないよ。", "cVi": "Chả ai hiền bằng mẹ.", "gIds": ["wa_nai"] } },
            { "STT": 39, "Kanji": "今日", "Nghĩa": "Hôm nay", "Furigana": "きょう", "type": "noun", "conv": { "polite": "今日ぐらい暑い日はありません。", "pVi": "Chưa có ngày nào nóng hơn hôm nay.", "casual": "今日ほど暑い日はないね。", "cVi": "Nay nóng kỷ lục rồi.", "gIds": ["wa_nai"] } },
            { "STT": 40, "Kanji": "命令", "Nghĩa": "Mệnh lệnh", "Furigana": "めいれい", "type": "noun", "conv": { "polite": "命令のとおりに動きました。", "pVi": "Tôi đã hành động đúng theo mệnh lệnh.", "casual": "命令通り動いたよ。", "cVi": "Làm theo lệnh rồi.", "gIds": ["toori"] } },
            { "STT": 41, "Kanji": "想像", "Nghĩa": "Tưởng tượng", "Furigana": "そうぞう", "type": "noun", "conv": { "polite": "想像どおりの素晴らしい景色でした。", "pVi": "Phong cảnh tuyệt vời đúng như tưởng tượng.", "casual": "想像通りの景色だった。", "cVi": "Cảnh đẹp y như tưởng tượng.", "gIds": ["toori"] } },
            { "STT": 42, "Kanji": "待つ", "Nghĩa": "Đợi", "Furigana": "まつ", "type": "verb", "conv": { "polite": "1時間も待つくらいなら、帰ります。", "pVi": "Nếu phải đợi cả tiếng đồng hồ thì thà tôi về còn hơn.", "casual": "1時間も待つなら帰るよ。", "cVi": "Đợi cả tiếng thì về cho xong.", "gIds": ["kurai_nara"] } },
            { "STT": 43, "Kanji": "食べる", "Nghĩa": "Ăn", "Furigana": "たべる", "type": "verb", "conv": { "polite": "これを食べるくらいなら、何も食べないほうがいい。", "pVi": "Nếu phải ăn cái này thì thà nhịn còn hơn.", "casual": "これ食べるなら絶食する。", "cVi": "Ăn cái này thà nhịn đói.", "gIds": ["kurai_nara"] } },
            { "STT": 44, "Kanji": "見る", "Nghĩa": "Nhìn/Xem", "Furigana": "みる", "type": "verb", "conv": { "polite": "あの映画を見るたびに、泣いてしまいます。", "pVi": "Cứ mỗi lần xem phim đó, tôi lại khóc.", "casual": "あの映画見るたびに泣いちゃう。", "cVi": "Xem phim đó lần nào cũng khóc.", "gIds": ["tabi_ni"] } },
            { "STT": 45, "Kanji": "雨", "Nghĩa": "Mưa", "Furigana": "あめ", "type": "noun", "conv": { "polite": "雨が降るたびに、頭が痛くなります。", "pVi": "Cứ mỗi lần trời mưa, tôi lại đau đầu.", "casual": "雨降るたびに頭痛する。", "cVi": "Cứ mưa là đau đầu.", "gIds": ["tabi_ni"] } },
            { "STT": 46, "Kanji": "図書館", "Nghĩa": "Thư viện", "Furigana": "としょかん", "type": "noun", "conv": { "polite": "図書館へ行くついでに、カフェに寄りました。", "pVi": "Tiện thể đi thư viện, tôi ghé vào quán cà phê.", "casual": "図書館ついでにカフェ行った。", "cVi": "Tiện đi thư viện ghé cafe chút.", "gIds": ["tsuide_ni"] } },
            { "STT": 47, "Kanji": "犬", "Nghĩa": "Chó", "Furigana": "いぬ", "type": "noun", "conv": { "polite": "犬の散歩のついでに、ゴミを出しました。", "pVi": "Tiện thể dắt chó đi dạo, tôi đổ rác luôn.", "casual": "犬の散歩ついでにゴミ出した。", "cVi": "Tiện dắt chó đi đổ rác luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 48, "Kanji": "涼しい", "Nghĩa": "Mát mẻ", "Furigana": "すずしい", "type": "adj", "conv": { "polite": "今日は涼しいというより、寒いです。", "pVi": "Hôm nay nói là mát thì đúng hơn là lạnh.", "casual": "涼しいっていうか寒いよ。", "cVi": "Mát gì, lạnh đấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 49, "Kanji": "簡単", "Nghĩa": "Đơn giản", "Furigana": "かんたん", "type": "adj", "conv": { "polite": "それは簡単というより、適当です。", "pVi": "Cái đó nói là đơn giản thì đúng hơn là qua loa.", "casual": "簡単っていうか適当だね。", "cVi": "Đơn giản gì, làm bừa ấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 50, "Kanji": "先生", "Nghĩa": "Giáo viên", "Furigana": "せんせい", "type": "noun", "conv": { "polite": "あの先生は厳しいと言われています。", "pVi": "Thầy giáo đó được cho là nghiêm khắc.", "casual": "あの先生厳しいらしいよ。", "cVi": "Nghe đồn thầy đó gắt lắm.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 51, "Kanji": "日本食", "Nghĩa": "Món ăn Nhật", "Furigana": "にほんしょく", "type": "noun", "conv": { "polite": "日本食はヘルシーだと言われています。", "pVi": "Món ăn Nhật được cho là tốt cho sức khỏe.", "casual": "日本食ってヘルシーらしい。", "cVi": "Đồ Nhật healthy lắm.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 52, "Kanji": "ゲーム", "Nghĩa": "Trò chơi", "Furigana": "げーむ", "type": "noun", "conv": { "polite": "これぐらい面白いゲームはありません。", "pVi": "Không có trò chơi nào thú vị hơn trò này.", "casual": "これほど面白いゲームないよ。", "cVi": "Game này là đỉnh nhất.", "gIds": ["wa_nai"] } },
            { "STT": 53, "Kanji": "親友", "Nghĩa": "Bạn thân", "Furigana": "しんゆう", "type": "noun", "conv": { "polite": "彼ぐらい信頼できる親友はいません。", "pVi": "Không có người bạn thân nào đáng tin cậy hơn anh ấy.", "casual": "彼ほど信頼できるやついないよ。", "cVi": "Nó là thằng bạn tin cậy nhất.", "gIds": ["wa_nai"] } },
            { "STT": 54, "Kanji": "言う", "Nghĩa": "Nói", "Furigana": "いう", "type": "verb", "conv": { "polite": "言ったとおりにしてください。", "pVi": "Hãy làm đúng như đã nói.", "casual": "言った通りにして。", "cVi": "Làm như tớ bảo đi.", "gIds": ["toori"] } },
            { "STT": 55, "Kanji": "書く", "Nghĩa": "Viết", "Furigana": "かく", "type": "verb", "conv": { "polite": "書いたとおりに読みました。", "pVi": "Tôi đã đọc đúng như những gì đã viết.", "casual": "書いた通りに読んだよ。", "cVi": "Đọc y như giấy viết.", "gIds": ["toori"] } },
            { "STT": 56, "Kanji": "住む", "Nghĩa": "Sống", "Furigana": "すむ", "type": "verb", "conv": { "polite": "田舎に住むくらいなら、狭くても都会がいい。", "pVi": "Nếu phải sống ở quê, thà ở nhà chật trên phố còn hơn.", "casual": "田舎住むなら狭くても都会がいい。", "cVi": "Ở quê thà ở phố chật còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 57, "Kanji": "謝る", "Nghĩa": "Xin lỗi", "Furigana": "あやまる", "type": "verb", "conv": { "polite": "彼に謝るくらいなら、絶交します。", "pVi": "Nếu phải xin lỗi hắn, tôi thà tuyệt giao còn hơn.", "casual": "謝るくらいなら絶交する。", "cVi": "Xin lỗi nó thà nghỉ chơi còn hơn.", "gIds": ["kurai_nara"] } },
            { "STT": 58, "Kanji": "誕生日", "Nghĩa": "Sinh nhật", "Furigana": "たんじょうび", "type": "noun", "conv": { "polite": "誕生日のたびに、年を取ったと感じます。", "pVi": "Cứ mỗi lần sinh nhật, tôi lại cảm thấy mình già đi.", "casual": "誕生日のたびに老けたなって思う。", "cVi": "Cứ sinh nhật là thấy già.", "gIds": ["tabi_ni"] } },
            { "STT": 59, "Kanji": "帰国", "Nghĩa": "Về nước", "Furigana": "きこく", "type": "noun", "conv": { "polite": "帰国のたびに、新しいビルが増えています。", "pVi": "Mỗi lần về nước, các tòa nhà mới lại tăng lên.", "casual": "帰るたびにビル増えてる。", "cVi": "Mỗi lần về là thấy nhà mới.", "gIds": ["tabi_ni"] } },
            { "STT": 60, "Kanji": "大阪", "Nghĩa": "Osaka", "Furigana": "おおさか", "type": "noun", "conv": { "polite": "大阪へ行ったついでに、たこ焼きを食べました。", "pVi": "Nhân tiện đi Osaka, tôi đã ăn Takoyaki.", "casual": "大阪ついでにたこ焼き食った。", "cVi": "Tiện đi Osaka ăn bạch tuộc nướng luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 61, "Kanji": "出張", "Nghĩa": "Công tác", "Furigana": "しゅっちょう", "type": "noun", "conv": { "polite": "出張のついでに、観光もしました。", "pVi": "Tiện thể đi công tác, tôi đi tham quan luôn.", "casual": "出張ついでに観光した。", "cVi": "Tiện đi công tác đi chơi luôn.", "gIds": ["tsuide_ni"] } },
            { "STT": 62, "Kanji": "歩く", "Nghĩa": "Đi bộ", "Furigana": "あるく", "type": "verb", "conv": { "polite": "歩くというより、走っていました。", "pVi": "Nói là đi bộ thì đúng hơn là đang chạy.", "casual": "歩くっていうか走ってたね。", "cVi": "Đi gì mà như chạy.", "gIds": ["to_iu_yori"] } },
            { "STT": 63, "Kanji": "賢い", "Nghĩa": "Thông minh", "Furigana": "かしこい", "type": "adj", "conv": { "polite": "彼は賢いというより、ずるいです。", "pVi": "Anh ấy nói là thông minh thì đúng hơn là khôn lỏi.", "casual": "賢いっていうかずるいよ。", "cVi": "Khôn gì, gian ấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 64, "Kanji": "漢字", "Nghĩa": "Chữ Hán", "Furigana": "かんじ", "type": "noun", "conv": { "polite": "漢字は難しいと言われています。", "pVi": "Chữ Hán được cho là khó.", "casual": "漢字は難しいらしい。", "cVi": "Nghe bảo Kanji khó lắm.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 65, "Kanji": "スマホ", "Nghĩa": "Điện thoại thông minh", "Furigana": "すまほ", "type": "noun", "conv": { "polite": "スマホは便利だと言われています。", "pVi": "Smartphone được cho là tiện lợi.", "casual": "スマホ便利らしいね。", "cVi": "Smartphone tiện thật đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 66, "Kanji": "田中", "Nghĩa": "Tanaka", "Furigana": "たなか", "type": "noun", "conv": { "polite": "田中さんぐらい真面目な人はいません。", "pVi": "Không ai nghiêm túc hơn anh Tanaka.", "casual": "田中さんほど真面目な人いないよ。", "cVi": "Chả ai nghiêm túc bằng Tanaka.", "gIds": ["wa_nai"] } },
            { "STT": 67, "Kanji": "富士山", "Nghĩa": "Núi Phú Sĩ", "Furigana": "ふじさん", "type": "noun", "conv": { "polite": "富士山ぐらい高い山は日本にありません。", "pVi": "Ở Nhật không có ngọn núi nào cao hơn núi Phú Sĩ.", "casual": "富士山ほど高い山はないね。", "cVi": "Núi Phú Sĩ là cao nhất Nhật rồi.", "gIds": ["wa_nai"] } },
            { "STT": 68, "Kanji": "夏", "Nghĩa": "Mùa hè", "Furigana": "なつ", "type": "noun", "conv": { "polite": "夏はビールに限ります。", "pVi": "Mùa hè thì bia là nhất.", "casual": "夏はビールに限るね。", "cVi": "Hè uống bia là tuyệt nhất.", "gIds": ["ni_kagiru"] } },
            { "STT": 69, "Kanji": "風邪", "Nghĩa": "Cảm cúm", "Furigana": "かぜ", "type": "noun", "conv": { "polite": "風邪の時は寝るに限ります。", "pVi": "Khi bị cảm thì ngủ là tốt nhất.", "casual": "風邪の時は寝るに限るよ。", "cVi": "Cảm thì cứ ngủ là khỏe.", "gIds": ["ni_kagiru"] } },
            { "STT": 70, "Kanji": "大雪", "Nghĩa": "Tuyết lớn", "Furigana": "おおゆき", "type": "noun", "conv": { "polite": "大雪のため、電車が止まりました。", "pVi": "Do tuyết rơi dày nên tàu điện đã dừng.", "casual": "大雪で電車止まった。", "cVi": "Tuyết dày quá tàu dừng rồi.", "gIds": ["tame_ni"] } },
            { "STT": 71, "Kanji": "事故", "Nghĩa": "Sự cố", "Furigana": "じこ", "type": "noun", "conv": { "polite": "事故のため、道が混んでいます。", "pVi": "Do tai nạn nên đường đang tắc.", "casual": "事故で道混んでるよ。", "cVi": "Tai nạn nên tắc đường.", "gIds": ["tame_ni"] } },
            { "STT": 72, "Kanji": "用事", "Nghĩa": "Việc bận", "Furigana": "ようじ", "type": "noun", "conv": { "polite": "用事があるので、お先に失礼します。", "pVi": "Vì có việc bận nên tôi xin phép về trước.", "casual": "用事あるから先帰るね。", "cVi": "Có việc nên về trước đây.", "gIds": ["no_de"] } },
            { "STT": 73, "Kanji": "時間", "Nghĩa": "Thời gian", "Furigana": "じかん", "type": "noun", "conv": { "polite": "時間がないので、急ぎましょう。", "pVi": "Vì không có thời gian nên hãy nhanh lên.", "casual": "時間ないから急ごう。", "cVi": "Hết giờ rồi, nhanh lên.", "gIds": ["no_de"] } },
            { "STT": 74, "Kanji": "疲れる", "Nghĩa": "Mệt", "Furigana": "つかれる", "type": "verb", "conv": { "polite": "疲れたら、少し休んだらどうですか。", "pVi": "Nếu mệt thì nghỉ một chút xem sao?", "casual": "疲れたら休めば？", "cVi": "Mệt thì nghỉ đi.", "gIds": ["tara_douka"] } },
            { "STT": 75, "Kanji": "わからない", "Nghĩa": "Không hiểu", "Furigana": "わからない", "type": "verb", "conv": { "polite": "わからなかったら、先生に聞いたらどうですか。", "pVi": "Nếu không hiểu thì hỏi thầy giáo xem sao?", "casual": "わかんなかったら先生に聞きなよ。", "cVi": "Không hiểu thì hỏi thầy đi.", "gIds": ["tara_douka"] } },
            { "STT": 76, "Kanji": "思う", "Nghĩa": "Nghĩ", "Furigana": "おもう", "type": "verb", "conv": { "polite": "思ったとおりの結果になりました。", "pVi": "Kết quả đúng như tôi đã nghĩ.", "casual": "思った通りになった。", "cVi": "Đúng như tớ nghĩ.", "gIds": ["toori"] } },
            { "STT": 77, "Kanji": "言う", "Nghĩa": "Nói", "Furigana": "いう", "type": "verb", "conv": { "polite": "母に言うくらいなら、父に言います。", "pVi": "Nếu phải nói với mẹ thì thà nói với bố còn hơn.", "casual": "母さんに言うなら父さんに言うよ。", "cVi": "Thà nói với bố còn hơn nói với mẹ.", "gIds": ["kurai_nara"] } },
            { "STT": 78, "Kanji": "見る", "Nghĩa": "Nhìn", "Furigana": "みる", "type": "verb", "conv": { "polite": "写真を見るたびに、思い出します。", "pVi": "Mỗi lần nhìn ảnh, tôi lại nhớ về kỷ niệm.", "casual": "写真見るたび思い出すな。", "cVi": "Cứ nhìn ảnh là lại nhớ.", "gIds": ["tabi_ni"] } },
            { "STT": 79, "Kanji": "帰る", "Nghĩa": "Về", "Furigana": "かえる", "type": "verb", "conv": { "polite": "家に帰るついでに、スーパーに行きます。", "pVi": "Tiện đường về nhà, tôi đi siêu thị.", "casual": "帰るついでにスーパー寄る。", "cVi": "Tiện đường về ghé siêu thị.", "gIds": ["tsuide_ni"] } },
            { "STT": 80, "Kanji": "走る", "Nghĩa": "Chạy", "Furigana": "はしる", "type": "verb", "conv": { "polite": "走るというより、飛んでいるようです。", "pVi": "Nói là chạy thì đúng hơn là đang bay.", "casual": "走るっていうか飛んでるみたい。", "cVi": "Chạy gì như bay ấy.", "gIds": ["to_iu_yori"] } },
            { "STT": 81, "Kanji": "お茶", "Nghĩa": "Trà", "Furigana": "おちゃ", "type": "noun", "conv": { "polite": "お茶は体にいいと言われています。", "pVi": "Trà được cho là tốt cho cơ thể.", "casual": "お茶って体にいいらしい。", "cVi": "Trà tốt cho sức khỏe đấy.", "gIds": ["to_iwarete_iru"] } },
            { "STT": 82, "Kanji": "勉強", "Nghĩa": "Học", "Furigana": "べんきょう", "type": "noun", "conv": { "polite": "勉強ぐらい嫌いなものはありません。", "pVi": "Không có gì đáng ghét hơn việc học.", "casual": "勉強ほど嫌いなもんないよ。", "cVi": "Ghét nhất là học.", "gIds": ["wa_nai"] } },
            { "STT": 83, "Kanji": "寝る", "Nghĩa": "Ngủ", "Furigana": "ねる", "type": "verb", "conv": { "polite": "休日は寝るに限ります。", "pVi": "Ngày nghỉ thì ngủ là nhất.", "casual": "休みは寝るに限る。", "cVi": "Nghỉ thì cứ ngủ cho sướng.", "gIds": ["ni_kagiru"] } },
            { "STT": 84, "Kanji": "台風", "Nghĩa": "Bão", "Furigana": "たいふう", "type": "noun", "conv": { "polite": "台風のため、学校が休みになりました。", "pVi": "Do bão nên trường học được nghỉ.", "casual": "台風で学校休みになった。", "cVi": "Bão nên được nghỉ học.", "gIds": ["tame_ni"] } },
            { "STT": 85, "Kanji": "熱", "Nghĩa": "Sốt", "Furigana": "ねつ", "type": "noun", "conv": { "polite": "熱があるので、休みます。", "pVi": "Vì bị sốt nên tôi nghỉ.", "casual": "熱あるから休むわ。", "cVi": "Sốt rồi, nghỉ đây.", "gIds": ["no_de"] } },
            { "STT": 86, "Kanji": "頭痛", "Nghĩa": "Đau đầu", "Furigana": "ずつう", "type": "noun", "conv": { "polite": "頭痛がするなら、薬を飲んだらどうですか。", "pVi": "Nếu đau đầu thì uống thuốc xem sao?", "casual": "頭痛いなら薬飲みなよ。", "cVi": "Đau đầu thì uống thuốc đi.", "gIds": ["tara_douka"] } },
            { "STT": 87, "Kanji": "教える", "Nghĩa": "Dạy", "Furigana": "おしえる", "type": "verb", "conv": { "polite": "教えたとおりにやってみてください。", "pVi": "Hãy làm thử đúng như tôi đã dạy.", "casual": "教えた通りにやってみて。", "cVi": "Làm y như tớ bảo xem.", "gIds": ["toori"] } }
        ];

        // --- 3. KANJI DETAILS (Updated for Day 24) ---
        const kanjiDetails = {
            "予": { hanviet: "DỰ", mean: "Dự báo/Sẵn", on: "ヨ", kun: "あらかじ.め", radicals: "Mã (予)", tipImg: "Dự báo trước.", tipSoundOn: "**Yo**sou dự đoán.", words: [{w:"予想 (よそう)", m:"Dự đoán"}, {w:"予定 (よてい)", m:"Dự định"}] },
            "想": { hanviet: "TƯỞNG", mean: "Tưởng tượng", on: "ソウ, ソ", kun: "", radicals: "Tương (相) + Tâm (心)", tipImg: "Tâm (心) tương (相) tư tưởng nhớ.", tipSoundOn: "Yo**sou** dự đoán.", words: [{w:"理想 (りそう)", m:"Lý tưởng"}] },
            "独": { hanviet: "ĐỘC", mean: "Đơn độc", on: "ドク", kun: "ひと.り", radicals: "Khuyển (犭) + Trùng (虫)", tipImg: "Con chó (犭) nhìn con sâu (虫) một mình.", tipSoundOn: "**Doku**shin độc thân.", tipSoundKun: "**Hito**ri một mình.", words: [{w:"独身 (どくしん)", m:"Độc thân"}] },
            "身": { hanviet: "THÂN", mean: "Thân thể", on: "シン", kun: "み", radicals: "Thân (身)", tipImg: "Hình dáng cơ thể.", tipSoundOn: "Doku**shin** độc thân.", tipSoundKun: "**Mi**bounin góa phụ.", words: [{w:"身体 (しんたい)", m:"Thân thể"}] },
            "納": { hanviet: "NẠP", mean: "Nộp/Thu", on: "ノウ, ナッ", kun: "おさ.める", radicals: "Mịch (糸) + Nội (内)", tipImg: "Mang lụa (糸) vào trong (内) nộp.", tipSoundOn: "**Nat**tou đậu nát-tô.", tipSoundKun: "**Osa**meru nộp.", words: [{w:"納得 (なっとく)", m:"Lý giải"}] },
            "豆": { hanviet: "ĐẬU", mean: "Hạt đậu", on: "トウ, ズ", kun: "まめ", radicals: "Đậu (豆)", tipImg: "Hạt đậu trong bát.", tipSoundOn: "Nat**tou** đậu nát-tô.", tipSoundKun: "**Mame** đậu.", words: [{w:"大豆 (だいず)", m:"Đậu nành"}] },
            "期": { hanviet: "KỲ", mean: "Thời kỳ", on: "キ", kun: "", radicals: "Kỳ (其) + Nguyệt (月)", tipImg: "Trăng (月) lên đúng kỳ (其).", tipSoundOn: "**Ki**tai kỳ vọng.", words: [{w:"期間 (きかん)", m:"Thời gian"}] },
            "待": { hanviet: "ĐÃI", mean: "Đợi/Tiếp đãi", on: "タイ", kun: "ま.つ", radicals: "Xích (彳) + Tự (寺)", tipImg: "Đứng ở chùa (寺) đợi (彳).", tipSoundOn: "Ki**tai** kỳ vọng.", tipSoundKun: "**Ma**tsu đợi.", words: [{w:"招待 (しょうたい)", m:"Chiêu đãi"}] },
            "望": { hanviet: "VỌNG", mean: "Hy vọng", on: "ボウ, モウ", kun: "のぞ.む", radicals: "Vong (亡) + Nguyệt (月) + Vương (王)", tipImg: "Vua (王) mất (亡) nhìn trăng (月) hy vọng.", tipSoundOn: "Ki**bou** hy vọng.", tipSoundKun: "**Nozo**mu mong muốn.", words: [{w:"希望 (きぼう)", m:"Hy vọng"}] },
            "散": { hanviet: "TÁN", mean: "Tản bộ/Rơi rụng", on: "サン", kun: "ち.る", radicals: "Phốc (攵)", tipImg: "Đánh cho tan tác.", tipSoundOn: "**San**po đi dạo.", tipSoundKun: "**Chi**ru rơi rụng.", words: [{w:"解散 (かいさん)", m:"Giải tán"}] },
            "歩": { hanviet: "BỘ", mean: "Đi bộ", on: "ホ, ブ", kun: "ある.く", radicals: "Chỉ (止) + Thiểu (少)", tipImg: "Dừng (止) lại một chút (少) rồi đi bộ.", tipSoundOn: "San**po** đi dạo.", tipSoundKun: "**Aru**ku đi bộ.", words: [{w:"歩道 (ほどう)", m:"Vỉa hè"}] },
            "綺": { hanviet: "KHỶ", mean: "Đẹp", on: "キ", kun: "", radicals: "Mịch (糸) + Kỳ (奇)", tipImg: "Vải lụa (糸) kỳ (奇) lạ đẹp mắt.", tipSoundOn: "**Ki**rei đẹp.", words: [{w:"綺麗 (きれい)", m:"Đẹp/Sạch"}] },
            "麗": { hanviet: "LỆ", mean: "Đẹp đẽ", on: "レイ", kun: "うるわ.しい", radicals: "Lộc (鹿)", tipImg: "Con hươu (鹿) đẹp.", tipSoundOn: "Ki**rei** đẹp.", words: [{w:"華麗 (かれい)", m:"Tráng lệ"}] },
            "伝": { hanviet: "TRUYỀN", mean: "Truyền đạt", on: "デン", kun: "つた.える", radicals: "Nhân (亻) + Vân (云)", tipImg: "Người (亻) nói (云) truyền tin.", tipSoundOn: "**Den**tou truyền thống.", tipSoundKun: "**Tsuta**eru nhắn.", words: [{w:"手伝う (てつだう)", m:"Giúp đỡ"}] },
            "統": { hanviet: "THỐNG", mean: "Thống nhất", on: "トウ", kun: "す.べる", radicals: "Mịch (糸) + Sung (充)", tipImg: "Dùng dây (糸) buộc đầy (充) để thống nhất.", tipSoundOn: "Den**tou** truyền thống.", words: [{w:"大統領 (だいとうりょう)", m:"Tổng thống"}] },
            "景": { hanviet: "CẢNH", mean: "Phong cảnh", on: "ケイ", kun: "", radicals: "Nhật (日) + Kinh (京)", tipImg: "Mặt trời (日) chiếu kinh (京) thành tạo cảnh.", tipSoundOn: "**Ke**shiki phong cảnh.", words: [{w:"風景 (ふうけい)", m:"Phong cảnh"}] },
            "色": { hanviet: "SẮC", mean: "Màu sắc", on: "ショク, シキ", kun: "いろ", radicals: "Sắc (色)", tipImg: "Màu sắc.", tipSoundOn: "Ke**shiki** phong cảnh.", tipSoundKun: "**Iro** màu.", words: [{w:"色々 (いろいろ)", m:"Nhiều loại"}] },
            "規": { hanviet: "QUY", mean: "Quy tắc", on: "キ", kun: "", radicals: "Phu (夫) + Kiến (見)", tipImg: "Chồng (夫) nhìn (見) quy tắc.", tipSoundOn: "**Ki**soku quy tắc.", words: [{w:"規則 (きそく)", m:"Quy tắc"}] },
            "則": { hanviet: "TẮC", mean: "Quy tắc", on: "ソク", kun: "", radicals: "Bối (貝) + Đao (刂)", tipImg: "Dùng dao (刂) chia tiền (貝) theo quy tắc.", tipSoundOn: "Ki**soku** quy tắc.", words: [{w:"法則 (ほうそく)", m:"Định luật"}] },
            "説": { hanviet: "THUYẾT", mean: "Giải thích", on: "セツ", kun: "と.く", radicals: "Ngôn (言) + Duyệt (兑)", tipImg: "Nói (言) lời vui vẻ (兑) để thuyết phục.", tipSoundOn: "**Setsu**mei giải thích.", tipSoundKun: "**To**ku giải thích.", words: [{w:"説明 (せつめい)", m:"Giải thích"}] },
            "明": { hanviet: "MINH", mean: "Sáng", on: "メイ", kun: "あか.るい", radicals: "Nhật (日) + Nguyệt (月)", tipImg: "Mặt trời và mặt trăng đều sáng.", tipSoundOn: "Setsu**mei** giải thích.", tipSoundKun: "**Aka**rui sáng.", words: [{w:"明日 (あした)", m:"Ngày mai"}] },
            "旅": { hanviet: "LỮ", mean: "Du lịch", on: "リョ", kun: "たび", radicals: "Phương (方)", tipImg: "Người đi phương xa du lịch.", tipSoundOn: "**Ryo**kou du lịch.", tipSoundKun: "**Tabi** chuyến đi.", words: [{w:"旅行 (りょこう)", m:"Du lịch"}] },
            "行": { hanviet: "HÀNH", mean: "Đi", on: "コウ, ギョウ", kun: "い.く", radicals: "Hành (行)", tipImg: "Ngã tư đường.", tipSoundOn: "Ryo**kou** du lịch.", tipSoundKun: "**I**ku đi.", words: [{w:"銀行 (ぎんこう)", m:"Ngân hàng"}] },
            "掃": { hanviet: "TẢO", mean: "Quét", on: "ソウ", kun: "は.く", radicals: "Thủ (扌) + Tảo (帚)", tipImg: "Tay (扌) cầm chổi (帚) quét.", tipSoundOn: "**Sou**ji dọn dẹp.", tipSoundKun: "**Ha**ku quét.", words: [{w:"掃除 (そうじ)", m:"Dọn dẹp"}] },
            "除": { hanviet: "TRỪ", mean: "Loại bỏ", on: "ジョ", kun: "のぞ.く", radicals: "Ấp (阝) + Dư (余)", tipImg: "Loại bỏ phần dư (余) ở ấp (阝).", tipSoundOn: "Sou**ji** dọn dẹp.", tipSoundKun: "**Nozo**ku loại bỏ.", words: [{w:"削除 (さくじょ)", m:"Xóa bỏ"}] }
        };

        // --- 4. APP LOGIC ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }

        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }

        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
