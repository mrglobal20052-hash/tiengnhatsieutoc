<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AzaKanji - H·ªôi Tho·∫°i & Ng·ªØ Ph√°p (Day 14)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #f3f4f6; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Ruby Text Styling */
        ruby rt { font-size: 0.6em; color: #64748b; user-select: none; }
        .hide-furigana ruby rt { visibility: hidden; }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* Highlight classes for Typing */
        .correct-char { color: #16a34a; font-weight: bold; }
        .incorrect-char { color: #dc2626; text-decoration: underline; font-weight: bold; }
        .correct-input { border-color: #22c55e !important; background-color: #f0fdf4 !important; }
        .wrong-input { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        
        /* Tab Transitions */
        .tab-btn { transition: all 0.3s ease; }
        .tab-active { background-color: #0284c7; color: white; shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-inactive { background-color: #f3f4f6; color: #4b5563; }
        .tab-inactive:hover { background-color: #e5e7eb; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-sky-700 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                    <i class="fas fa-torii-gate text-3xl text-yellow-300"></i>
                    <div>
                        <h1 class="text-xl font-bold uppercase tracking-wider">AzaKanji Kaiwa</h1>
                        <p class="text-xs text-sky-200">H·ªçc H·ªôi Tho·∫°i & Ng·ªØ Ph√°p (Day 14)</p>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="flex bg-sky-800 rounded-lg p-1 text-sm overflow-x-auto">
                    <button id="btn-toggle-furigana" class="px-3 py-1.5 rounded transition hover:bg-sky-600 text-white flex items-center whitespace-nowrap">
                        <i class="fas fa-eye mr-2"></i> Furigana
                    </button>
                    <button id="btn-toggle-romaji" class="px-3 py-1.5 rounded transition hover:bg-sky-600 text-white flex items-center ml-1 whitespace-nowrap">
                        <i class="fas fa-font mr-2"></i> Romaji
                    </button>
                    <button id="btn-toggle-vi" class="px-3 py-1.5 rounded transition bg-white text-sky-800 font-bold ml-1 flex items-center whitespace-nowrap">
                        <i class="fas fa-language mr-2"></i> Ti·∫øng Vi·ªát
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow space-y-8" id="app">
        
        <!-- 1. Conversation Section -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100">
            <div class="bg-sky-50 px-6 py-4 border-b border-sky-100">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <h2 class="text-xl font-bold text-sky-800"><i class="fas fa-comments mr-2"></i>H·ªôi Tho·∫°i: D·ªçn D·∫πp Ph√≤ng</h2>
                    
                    <!-- Mode Tabs -->
                    <div class="flex bg-white rounded-lg p-1 shadow-sm border border-gray-200">
                        <button onclick="switchMode('polite')" id="tab-polite" class="tab-btn tab-active px-4 py-1.5 rounded-md text-sm font-bold">
                            L·ªãch s·ª±
                        </button>
                        <button onclick="switchMode('casual')" id="tab-casual" class="tab-btn tab-inactive px-4 py-1.5 rounded-md text-sm font-bold ml-1">
                            Th√¥ng th∆∞·ªùng
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="p-6 space-y-6" id="conversation-container">
                <!-- Dialogue injected by JS -->
            </div>
        </section>

        <!-- 2. Reading Section -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100">
            <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
                <h2 class="text-xl font-bold text-orange-800"><i class="fas fa-book-open mr-2"></i>B√†i ƒê·ªçc: Ph√≤ng C·ªßa T√¥i</h2>
            </div>
            <div class="p-6">
                <div class="bg-orange-50/30 p-5 rounded-xl border border-orange-100 leading-loose text-lg kanji-font mb-2" id="reading-text">
                    <!-- Reading content injected -->
                </div>
                <div class="text-gray-500 text-sm mb-4 italic hidden romaji-text" id="reading-romaji"></div>
                <div class="text-gray-700 text-sm mb-4 hidden vi-trans border-t border-orange-100 pt-2" id="reading-vi"></div>
                
                <!-- Reading Practice Area -->
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase"><i class="fas fa-keyboard mr-1"></i> Luy·ªán g√µ l·∫°i b√†i ƒë·ªçc:</h4>
                    <textarea id="reading-input" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-200 bg-gray-50 text-base kanji-font h-32" placeholder="G√µ l·∫°i n·ªôi dung b√†i ƒë·ªçc b·∫±ng ti·∫øng Nh·∫≠t v√†o ƒë√¢y..."></textarea>
                    <div id="reading-feedback" class="text-sm mt-2 min-h-[1.5rem]"></div>
                </div>
            </div>
        </section>

        <!-- 3. Grammar Section -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100">
            <div class="bg-purple-50 px-6 py-4 border-b border-purple-100">
                <h2 class="text-xl font-bold text-purple-800"><i class="fas fa-star mr-2"></i>7 ƒêi·ªÉm Ng·ªØ Ph√°p Quan Tr·ªçng</h2>
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4" id="grammar-container">
                <!-- Grammar points injected -->
            </div>
        </section>

        <!-- 4. Vocabulary Cards (FULL LIST) -->
        <section class="fade-in">
            <div class="flex items-center justify-between mb-4 px-2">
                <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-tags mr-2 text-sky-600"></i>T·ª´ V·ª±ng & M·∫πo Nh·ªõ (25 t·ª´)</h2>
                <span class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full shadow-sm">Ph∆∞∆°ng ph√°p AzaKanji</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="vocab-container">
                <!-- Vocab cards injected -->
            </div>
        </section>

        <!-- 5. Quiz Section (10 QUESTIONS) -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100 mb-12">
            <div class="bg-emerald-50 px-6 py-4 border-b border-emerald-100 flex justify-between items-center">
                <h2 class="text-xl font-bold text-emerald-800"><i class="fas fa-question-circle mr-2"></i>B√†i T·∫≠p Th·ª±c H√†nh (10 C√¢u)</h2>
                <span class="text-sm bg-emerald-200 text-emerald-800 px-3 py-1 rounded-full font-bold" id="quiz-score">0/10</span>
            </div>
            <div class="p-6 space-y-6" id="quiz-container">
                <!-- Quiz items injected -->
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 text-center">
                <button onclick="checkQuiz()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-8 rounded-full shadow-lg transform transition active:scale-95">
                    N·ªôp B√†i
                </button>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 AzaKanji Kaiwa. H·ªçc ti·∫øng Nh·∫≠t qua ng·ªØ c·∫£nh th·ª±c t·∫ø.</p>
        </div>
    </footer>

    <script>
        // --- DATA ---
        const lessonData = {
            conversation: {
                polite: [
                    { role: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åï„Çì„ÄÅÈÉ®Â±ã[„Å∏„ÇÑ]„Åå„Åç„Çå„ÅÑ„Åß„Åô„Å≠„ÄÇ„ÇÇ„ÅÜÊéÉÈô§[„Åù„ÅÜ„Åò]„Åó„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„Åã„ÄÇ", romaji: "Suzuki-san, heya ga kirei desu ne. M≈ç s≈çji shite shimaimashita ka.", vi: "Anh Suzuki, ph√≤ng s·∫°ch qu√° nh·ªâ. Anh ƒë√£ d·ªçn xong r·ªìi √†?" },
                    { role: "Suzuki", jp: "„ÅØ„ÅÑ„ÄÅÊúù[„ÅÇ„Åï]„ÅÆ„ÅÜ„Å°„Å´ÂÖ®ÈÉ®[„Åú„Çì„Å∂]„ÇÑ„Å£„Å¶„Åä„Åç„Åæ„Åó„Åü„ÄÇÁ™ì[„Åæ„Å©]„ÇÇÈñã[„ÅÇ]„ÅÑ„Å¶„ÅÑ„Åæ„Åô„Çà„ÄÇ", romaji: "Hai, asa no uchi ni zenbu yatte okimashita. Mado mo aite imasu yo.", vi: "V√¢ng, t√¥i ƒë√£ l√†m s·∫µn h·∫øt trong bu·ªïi s√°ng r·ªìi. C·ª≠a s·ªï c≈©ng ƒëang m·ªü ƒë√≥." },
                    { role: "Tanaka", jp: "„Çè„ÅÇ„ÄÅ„Åô„Åî„ÅÑ„Åß„Åô„ÄÇ„ÅÇ„ÄÅ„Åß„ÇÇ„ÄÅ„ÉÜ„Éº„Éñ„É´„ÅÆ‰∏ä[„ÅÜ„Åà]„ÅÆ„Ç∞„É©„Çπ„ÅåÂâ≤[„Çè]„Çå„Å¶„ÅÑ„Åæ„Åô„Å≠„ÄÇ", romaji: "Waa, sugoi desu. A, demo, tƒìburu no ue no gurasu ga warete imasu ne.", vi: "Woa, gh√™ th·∫≠t. √Ä nh∆∞ng m√† c√°i ly tr√™n b√†n ƒëang v·ª° k√¨a." },
                    { role: "Suzuki", jp: "„Åó„Åæ„Å£„ÅüÔºÅÊéÉÈô§‰∏≠[„Åù„ÅÜ„Åò„Å°„ÇÖ„ÅÜ]„Å´ËêΩ[„Åä]„Å®„Åó„Å¶„ÄÅÂâ≤[„Çè]„Å£„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇ", romaji: "Shimatta! S≈çjich≈´ ni otoshite, watte shimaimashita.", vi: "Ch·∫øt r·ªìi! L√∫c d·ªçn t√¥i l√†m r∆°i v·ª° m·∫•t ti√™u." },
                    { role: "Tanaka", jp: "Êâã‰ºù[„Å¶„Å§„Å†]„ÅÑ„Åæ„Åó„Çá„ÅÜ„Åã„ÄÇÁßÅ[„Çè„Åü„Åó]„ÅØÊù•ÈÄ±[„Çâ„ÅÑ„Åó„ÇÖ„ÅÜ]„Åã„Çâ„ÉÄ„Ç§„Ç®„ÉÉ„Éà„Çí„Åô„Çã„Å§„ÇÇ„Çä„Åß„Åô„Åã„Çâ„ÄÇ", romaji: "Tetsudaimash≈ç ka. Watashi wa raish≈´ kara daietto o suru tsumori desu kara.", vi: "ƒê·ªÉ t√¥i gi√∫p m·ªôt tay nh√©? V√¨ t√¥i d·ª± ƒë·ªãnh ƒÉn ki√™ng t·ª´ tu·∫ßn sau." },
                    { role: "Suzuki", jp: "„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ„Åò„ÇÉ„ÄÅ‰∏ÄÁ∑í[„ÅÑ„Å£„Åó„Çá]„Å´„ÅäÈ°ò[„Å≠„Åå]„ÅÑ„Åó„Åæ„Åô„ÄÇ", romaji: "Arigat≈ç gozaimasu. Ja, issho ni onegaishimasu.", vi: "C·∫£m ∆°n anh. V·∫≠y, phi·ªÅn anh l√†m c√πng t√¥i nh√©." }
                ],
                casual: [
                    { role: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åè„Çì„ÄÅÈÉ®Â±ã[„Å∏„ÇÑ]„Åç„Çå„ÅÑ„Å†„Å≠„ÄÇ„ÇÇ„ÅÜÊéÉÈô§[„Åù„ÅÜ„Åò]„Åó„Å°„ÇÉ„Å£„ÅüÔºü", romaji: "Suzuki-kun, heya kirei da ne. M≈ç s≈çji shichatta?", vi: "Suzuki n√†y, ph√≤ng s·∫°ch th·∫ø. D·ªçn xong r·ªìi h·∫£?" },
                    { role: "Suzuki", jp: "„ÅÜ„Çì„ÄÅÊúù[„ÅÇ„Åï]„ÅÆ„ÅÜ„Å°„Å´ÂÖ®ÈÉ®[„Åú„Çì„Å∂]„ÇÑ„Å£„Å®„ÅÑ„Åü„Çì„Å†„ÄÇÁ™ì[„Åæ„Å©]„ÇÇÈñã[„ÅÇ]„ÅÑ„Å¶„Çã„Çà„ÄÇ", romaji: "Un, asa no uchi ni zenbu yattoita n da. Mado mo aiteru yo.", vi: "·ª™, t·ªõ l√†m s·∫µn h·∫øt s√°ng nay r·ªìi. C·ª≠a s·ªï c≈©ng ƒëang m·ªü ƒë·∫•y." },
                    { role: "Tanaka", jp: "„Åô„Åî„ÅÑ„Å™„ÄÇ„ÅÇ„ÄÅ„Åß„ÇÇ„ÄÅ„ÉÜ„Éº„Éñ„É´„ÅÆ‰∏ä[„ÅÜ„Åà]„ÅÆ„Ç∞„É©„Çπ„ÄÅÂâ≤[„Çè]„Çå„Å¶„Çã„Å≠„ÄÇ", romaji: "Sugoi na. A, demo, tƒìburu no ue no gurasu, wareteru ne.", vi: "Gh√™ nha. √Ä m√† c√°i ly tr√™n b√†n v·ª° k√¨a." },
                    { role: "Suzuki", jp: "„ÇÑ„Å∞„ÅÑÔºÅÊéÉÈô§[„Åù„ÅÜ„Åò]„Åó„Å¶„Çã„Å®„Åç„Å´ËêΩ[„Åä]„Å®„Åó„Å¶„ÄÅÂâ≤[„Çè]„Å£„Å°„ÇÉ„Å£„Åü„Çì„Å†„ÄÇ", romaji: "Yabai! S≈çji shiteru toki ni otoshite, watchatta n da.", vi: "Toang r·ªìi! L√∫c d·ªçn t·ªõ l√†m r∆°i v·ª° m·∫•t ti√™u." },
                    { role: "Tanaka", jp: "Êâã‰ºù[„Å¶„Å§„Å†]„Åä„ÅÜ„Åã„ÄÇ‰ø∫[„Åä„Çå]„ÄÅÊù•ÈÄ±[„Çâ„ÅÑ„Åó„ÇÖ„ÅÜ]„Åã„Çâ„ÉÄ„Ç§„Ç®„ÉÉ„Éà„Åô„Çã„Å§„ÇÇ„Çä„Å†„Åã„Çâ„ÄÇ", romaji: "Tetsuda≈ç ka. Ore, raish≈´ kara daietto suru tsumori dakara.", vi: "T·ªõ gi√∫p m·ªôt tay nh√©? T·ªõ ƒë·ªãnh tu·∫ßn sau ƒÉn ki√™ng m√†." },
                    { role: "Suzuki", jp: "„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÇ„Åò„ÇÉ„ÄÅ„Çà„Çç„Åó„Åè„ÄÇ", romaji: "Arigat≈ç. Ja, yoroshiku.", vi: "C·∫£m ∆°n. V·∫≠y nh·ªù c·∫≠u nh√©." }
                ]
            },
            reading: {
                jp: "ÁßÅ[„Çè„Åü„Åó]„ÅÆÈÉ®Â±ã[„Å∏„ÇÑ]„ÅÆÂ£Å[„Åã„Åπ]„Å´„ÅØ„ÄÅ„Éù„Çπ„Çø„Éº„ÅåË≤º[„ÅØ]„Å£„Å¶„ÅÇ„Çä„Åæ„Åô„ÄÇÊú∫[„Å§„Åè„Åà]„ÅÆ‰∏ä[„ÅÜ„Åà]„Å´„ÅØÊú¨[„Åª„Çì]„Åå‰∏¶[„Å™„Çâ]„Åπ„Å¶„ÅÇ„Çä„Åæ„Åô„ÄÇÈÄ±Êú´[„Åó„ÇÖ„ÅÜ„Åæ„Å§]„Å´ÂèãÈÅî[„Å®„ÇÇ„Å†„Å°]„ÅåÊù•[„Åè]„Çã„ÅÆ„Åß„ÄÅÈÉ®Â±ã[„Å∏„ÇÑ]„Çí„Åç„Çå„ÅÑ„Å´„Åó„Å¶„Åä„Åç„Åæ„Åó„Åü„ÄÇ„Åß„ÇÇ„ÄÅ„ÅÜ„Å£„Åã„Çä„Åó„Å¶„ÄÅ„Ç≥„ÉÉ„Éó„ÇíËêΩ[„Åä]„Å®„Åó„Å¶Ââ≤[„Çè]„Å£„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇÊ∞¥[„Åø„Åö]„ÅåÊµÅ[„Å™„Åå]„Çå„Å¶„ÄÅÂ∫ä[„ÇÜ„Åã]„ÅåÊø°[„Å¨]„Çå„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇÁßÅ„ÅØÊù•Âπ¥[„Çâ„ÅÑ„Å≠„Çì]Âºï[„Å≤]„Å£Ë∂ä[„Åì]„Åô„Å§„ÇÇ„Çä„Åß„Åô„ÄÇÊ¨°[„Å§„Åé]„ÅØ„ÇÇ„Å£„Å®Â∫É[„Å≤„Çç]„ÅÑÈÉ®Â±ã[„Å∏„ÇÑ]„Å´‰Ωè[„Åô]„ÇÇ„ÅÜ„Å®ÊÄù[„Åä„ÇÇ]„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                romaji: "Watashi no heya no kabe ni wa, posutƒÅ ga hatte arimasu. Tsukue no ue ni wa hon ga narabete arimasu. Sh≈´matsu ni tomodachi ga kuru node, heya o kirei ni shite okimashita. Demo, ukkari shite, koppu o otoshite watte shimaimashita. Mizu ga nagarete, yuka ga nurete shimaimashita. Watashi wa rainen hikkosu tsumori desu. Tsugi wa motto hiroi heya ni sumou to omotte imasu.",
                vi: "Tr√™n t∆∞·ªùng ph√≤ng t√¥i c√≥ d√°n poster. Tr√™n b√†n c√≥ x·∫øp s·∫µn s√°ch. V√¨ cu·ªëi tu·∫ßn b·∫°n ƒë·∫øn n√™n t√¥i ƒë√£ d·ªçn ph√≤ng s·∫°ch s·∫Ω tr∆∞·ªõc. Nh∆∞ng v√¨ b·∫•t c·∫©n, t√¥i ƒë√£ l·ª° l√†m r∆°i v√† l√†m v·ª° c·ªëc. N∆∞·ªõc ch·∫£y ra v√† l√†m ∆∞·ªõt s√†n nh√† m·∫•t r·ªìi. T√¥i d·ª± ƒë·ªãnh s·∫Ω chuy·ªÉn nh√† v√†o nƒÉm sau. L·∫ßn t·ªõi, t√¥i ƒë·ªãnh s·∫Ω s·ªëng ·ªü m·ªôt cƒÉn ph√≤ng r·ªông h∆°n."
            },
            grammar: [
                { rule: "V„Å¶„ÅÑ„Åæ„Åô (T·ª± ƒë·ªông t·ª´)", mean: "Di·ªÖn t·∫£ tr·∫°ng th√°i k·∫øt qu·∫£ c√≤n l∆∞u l·∫°i", ex: "Á™ì[„Åæ„Å©]„ÅåÈñã[„ÅÇ]„ÅÑ„Å¶„ÅÑ„Åæ„Åô (C·ª≠a ƒëang m·ªü)" },
                { rule: "V„Å¶„ÅÇ„Çä„Åæ„Åô (Tha ƒë·ªông t·ª´)", mean: "Tr·∫°ng th√°i do ai ƒë√≥ c·ªë t√¨nh l√†m (c√≥ m·ª•c ƒë√≠ch)", ex: "Êú¨[„Åª„Çì]„Åå‰∏¶[„Å™„Çâ]„Åπ„Å¶„ÅÇ„Çä„Åæ„Åô (S√°ch ƒë∆∞·ª£c x·∫øp s·∫µn)" },
                { rule: "V„Å¶„Åä„Åç„Åæ„Åô", mean: "L√†m s·∫µn, l√†m tr∆∞·ªõc ƒë·ªÉ chu·∫©n b·ªã", ex: "ÂàáÁ¨¶[„Åç„Å£„Å∑]„ÇíË≤∑[„Åã]„Å£„Å¶„Åä„Åç„Åæ„Åô (Mua v√© s·∫µn)" },
                { rule: "V„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô", mean: "Ho√†n th√†nh / L·ª° l√†m g√¨ ƒë√≥ (h·ªëi ti·∫øc)", ex: "„Ç∞„É©„Çπ„ÇíÂâ≤[„Çè]„Å£„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü (L·ª° l√†m v·ª° ly)" },
                { rule: "ÔΩû„Å®ÊÄù„Å£„Å¶„ÅÑ„Åæ„Åô", mean: "ƒê·ªãnh l√†m... (D·ª± ƒë·ªãnh trong l√≤ng)", ex: "Êò†Áîª[„Åà„ÅÑ„Åå]„ÇíË¶ã[„Åø]„Å´Ë°å[„ÅÑ]„Åì„ÅÜ„Å®ÊÄù[„Åä„ÇÇ]„Å£„Å¶„ÅÑ„Åæ„Åô (T√¥i ƒë·ªãnh ƒëi xem phim)" },
                { rule: "ÔΩû„Å§„ÇÇ„Çä„Åß„Åô", mean: "D·ª± ƒë·ªãnh l√†m... (Quy·∫øt t√¢m r√µ r√†ng)", ex: "Êó•Êú¨[„Å´„Åª„Çì]„Å∏ÁïôÂ≠¶[„Çä„ÇÖ„ÅÜ„Åå„Åè]„Åô„Çã„Å§„ÇÇ„Çä„Åß„Åô (T√¥i ƒë·ªãnh ƒëi du h·ªçc Nh·∫≠t)" },
                { rule: "Danh t·ª´ h√≥a t√≠nh t·ª´", mean: "Bi·∫øn t√≠nh t·ª´ th√†nh danh t·ª´ (ƒë·ªô...)", ex: "ÂØåÂ£´Â±±[„Åµ„Åò„Åï„Çì]„ÅÆÈ´ò[„Åü„Åã]„Åï„ÅØ3776m„Åß„Åô (ƒê·ªô cao c·ªßa n√∫i Ph√∫ Sƒ© l√†...)" }
            ],
            vocab: [
                { k: "ÊéÉÈô§", h: "„Åù„ÅÜ„Åò", m: "D·ªçn d·∫πp", hv: "T·∫¢O TR·ª™", ti: "Tay (**Êâå**) c·∫ßm ch·ªïi (**Â∏ö**) qu√©t s·∫°ch ƒë·∫•t (**Èòù**) th·ª´a (**‰Ωô**).", ta: "**X√¥ g√¨** (Souji) m√† d·ªçn s·∫°ch th·∫ø." },
                { k: "ÈÉ®Â±ã", h: "„Å∏„ÇÑ", m: "CƒÉn ph√≤ng", hv: "B·ªò ·ªêC", ti: "X√°c ch·∫øt (**Â∞∏**) ƒë·∫øn (**Ëá≥**) ng√¥i nh√† (**Â±ã**) trong b·ªô l·∫°c (**ÈÉ®**).", ta: "**H√™! Ya!** (Heya) v√†o ph√≤ng ƒëi." },
                { k: "Á™ì", h: "„Åæ„Å©", m: "C·ª≠a s·ªï", hv: "SONG", ti: "D∆∞·ªõi l·ªó huy·ªát (**Á©¥**) ri√™ng t∆∞ (**„É†**) c·ªßa tim (**ÂøÉ**) l√† c·ª≠a s·ªï.", ta: "**Ma ƒë·ªô** (Mado) c·ª≠a s·ªï." },
                { k: "Èñã„Åè", h: "„ÅÇ„Åè", m: "M·ªü (t·ª±)", hv: "KHAI", ti: "Hai tay m·ªü c·ªïng (**ÈñÄ**).", ta: "**A! C·ª©** (Aku) m·ªü ra." },
                { k: "Ââ≤„Çå„Çã", h: "„Çè„Çå„Çã", m: "V·ª° (t·ª±)", hv: "C√ÅT", ti: "B·ªã h·∫°i (**ÂÆ≥**) b·ªüi dao (**ÂàÇ**) n√™n v·ª° n√°t.", ta: "**Wa! R√™** (Wareru) r√™n r·ªâ v√¨ v·ª°." },
                { k: "ËêΩ„Å®„Åô", h: "„Åä„Å®„Åô", m: "L√†m r∆°i", hv: "L·∫†C", ti: "C·ªè (**Ëâπ**) v√† n∆∞·ªõc (**Ê∞µ**) r∆°i xu·ªëng m·ªói (**ÂêÑ**) n∆°i.", ta: "**√î t√¥ s∆∞** (Otosu) l√†m r∆°i ƒë·ªì." },
                { k: "Êâã‰ºù„ÅÜ", h: "„Å¶„Å§„Å†„ÅÜ", m: "Gi√∫p ƒë·ª°", hv: "TH·ª¶ TRUY·ªÄN", ti: "Tay (**Êâã**) truy·ªÅn (**‰ºù**) c√¥ng l·ª±c gi√∫p ƒë·ª°.", ta: "**T·∫øt t·ª± ƒë√¢u** (Tetsudau) m√† gi√∫p." },
                { k: "Â£Å", h: "„Åã„Åπ", m: "B·ª©c t∆∞·ªùng", hv: "B√çCH", ti: "T√≠ch (**Ëæü**) l≈©y ƒë·∫•t (**Âúü**) x√¢y t∆∞·ªùng.", ta: "**Ca b√™** (Kabe) v√†o t∆∞·ªùng." },
                { k: "Ë≤º„Çã", h: "„ÅØ„Çã", m: "D√°n", hv: "THI·∫æP", ti: "D√πng ti·ªÅn (**Ë≤ù**) chi·∫øm (**Âç†**) ch·ªó ƒë·ªÉ d√°n.", ta: "**H·∫£? R·ªß** (Haru) d√°n gi·∫•y?" },
                { k: "‰∏¶„Åπ„Çã", h: "„Å™„Çâ„Åπ„Çã", m: "S·∫Øp x·∫øp", hv: "T·ªäNH", ti: "Hai ng∆∞·ªùi ƒë·ª©ng x·∫øp h√†ng (**Á´ã**).", ta: "**Na ra b√™** (Naraberu) x·∫øp h√†ng." },
                { k: "ÈÄ±Êú´", h: "„Åó„ÇÖ„ÅÜ„Åæ„Å§", m: "Cu·ªëi tu·∫ßn", hv: "CHU M·∫†T", ti: "Tu·∫ßn (**ÈÄ±**) k·∫øt th√∫c (**Êú´**).", ta: "**Su** (Shuu) t·∫≠p **m√°t** (matsu) m·∫ª cu·ªëi tu·∫ßn." },
                { k: "ÂèãÈÅî", h: "„Å®„ÇÇ„Å†„Å°", m: "B·∫°n b√®", hv: "H·ªÆU ƒê·∫†T", ti: "H·ªØu (**Âèã**) ƒë·∫°t (**ÈÅî**) ƒë∆∞·ª£c t√¨nh b·∫°n.", ta: "**T√¥** m√¨ **m·ªù** **ƒë√£** **chi** (Tomodachi) cho b·∫°n." },
                { k: "ÊµÅ„Çå„Çã", h: "„Å™„Åå„Çå„Çã", m: "Ch·∫£y", hv: "L∆ØU", ti: "N∆∞·ªõc (**Ê∞µ**) ch·∫£y xi·∫øt.", ta: "**Na** (Naga) d√≤ng n∆∞·ªõc **gh√™** (re) s·ª£." },
                { k: "Â∫ä", h: "„ÇÜ„Åã", m: "S√†n nh√†", hv: "S√ÄNG", ti: "D∆∞·ªõi m√°i nh√† (**Âπø**) c√≥ g·ªó (**Êú®**) l√†m s√†n.", ta: "**Yu** (Yu) **ca** (ka) h√°t tr√™n s√†n." },
                { k: "Êø°„Çå„Çã", h: "„Å¨„Çå„Çã", m: "B·ªã ∆∞·ªõt", hv: "NHU", ti: "N∆∞·ªõc (**Ê∞µ**) v√† m∆∞a (**Èõ®**) l√†m ∆∞·ªõt m·ªÅm.", ta: "**Nu** (Nu) **r√™** (re) ∆∞·ªõt s≈©ng." },
                { k: "Êù•Âπ¥", h: "„Çâ„ÅÑ„Å≠„Çì", m: "NƒÉm sau", hv: "LAI NI√äN", ti: "NƒÉm (**Âπ¥**) t∆∞∆°ng lai (**Êù•**) s·∫Ω ƒë·∫øn.", ta: "**Lai** (Rai) **n·ªán** (nen) nƒÉm sau." },
                { k: "Âºï„Å£Ë∂ä„Åô", h: "„Å≤„Å£„Åì„Åô", m: "Chuy·ªÉn nh√†", hv: "D·∫™N VI·ªÜT", ti: "D·∫´n (**Âºï**) nhau v∆∞·ª£t (**Ë∂ä**) qua n∆°i m·ªõi.", ta: "**H√≠t** (Hi) **c·ªë** (kko) **s·ª©c** (su) chuy·ªÉn nh√†." },
                { k: "Ê¨°", h: "„Å§„Åé", m: "Ti·∫øp theo", hv: "TH·ª®", ti: "Thi·∫øu (**Ê¨†**) bƒÉng (**ÂÜ´**) l·∫ßn sau.", ta: "**S∆∞** (Tsu) **ghi** (gi) ch√∫ l·∫ßn sau." },
                { k: "Â∫É„ÅÑ", h: "„Å≤„Çç„ÅÑ", m: "R·ªông", hv: "QU·∫¢NG", ti: "M√°i nh√† (**Âπø**) t∆∞ (**„É†**) r·ªông l·ªõn.", ta: "**Hi** **r·ªì** (Hiroi) ƒëi ƒë∆∞·ªùng r·ªông." },
                { k: "‰Ωè„ÇÄ", h: "„Åô„ÇÄ", m: "S·ªëng", hv: "TR√ö", ti: "Ng∆∞·ªùi (**‰∫ª**) l√†m ch·ªß (**‰∏ª**) n∆°i ·ªü.", ta: "**Su** (Su) **m√π** (mu) s·ªëng ·ªü ƒë√¢y." },
                { k: "ÊÄù„ÅÜ", h: "„Åä„ÇÇ„ÅÜ", m: "Nghƒ©", hv: "T∆Ø", ti: "Ru·ªông (**Áî∞**) trong tim (**ÂøÉ**) suy t∆∞.", ta: "**√î m√¥** (Omou) b·ªôt gi·∫∑t nghƒ© s·∫°ch." },
                { k: "ÁßÅ", h: "„Çè„Åü„Åó", m: "T√¥i", hv: "T∆Ø", ti: "L√∫a (**Á¶æ**) c·ªßa ri√™ng t∆∞ (**„É†**) t√¥i.", ta: "**Wa ta** (Wata) **si** (shi) m√™ t√¥i." },
                { k: "Êú∫", h: "„Å§„Åè„Åà", m: "C√°i b√†n", hv: "K·ª∂", ti: "G·ªó (**Êú®**) l√†m b√†n trong gi√≥ (**Âá†**).", ta: "**Su** (Tsu) **cu** (ku) **√™** (e) c√°i b√†n." },
                { k: "Êú¨", h: "„Åª„Çì", m: "S√°ch", hv: "B·∫¢N", ti: "G·ªëc c√¢y (**Êú®**) ƒë√°nh d·∫•u m·ªôt n√©t (**‰∏Ä**).", ta: "**H√¥n** (Hon) s√°ch." },
                { k: "ÂÖ®ÈÉ®", h: "„Åú„Çì„Å∂", m: "To√†n b·ªô", hv: "TO√ÄN B·ªò", ti: "Vua (**Áéã**) ƒë·ªôi n√≥n (**ÂÖ•**) ra l·ªánh to√†n b·ªô.", ta: "**D√™n** (Zen) **b·ª±** (bu) to√†n b·ªô." }
            ],
            quiz: [
                { q: "C·ª≠a s·ªï ƒëang m·ªü (T·ª± ƒë·ªông t·ª´ - Tr·∫°ng th√°i)", a: ["Á™ì„ÅåÈñã„ÅÑ„Å¶„ÅÑ„Åæ„Åô", "Á™ì„ÅåÈñã„Åë„Å¶„ÅÑ„Åæ„Åô", "Á™ì„ÅåÈñã„ÅÑ„Å¶„ÅÇ„Çä„Åæ„Åô"], correct: 0 },
                { q: "T√¥i ƒë√£ mua v√© s·∫µn r·ªìi (Chu·∫©n b·ªã)", a: ["ÂàáÁ¨¶„ÇíË≤∑„Å£„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô", "ÂàáÁ¨¶„ÇíË≤∑„Å£„Å¶„Åä„Åç„Åæ„Åô", "ÂàáÁ¨¶„ÇíË≤∑„Å£„Å¶„ÅÑ„Åæ„Åô"], correct: 1 },
                { q: "L·ª° l√†m v·ª° c√°i ly m·∫•t r·ªìi (H·ªëi ti·∫øc)", a: ["„Ç∞„É©„Çπ„ÇíÂâ≤„Çä„Åæ„Åó„Åü", "„Ç∞„É©„Çπ„ÇíÂâ≤„Å£„Å¶„ÅÇ„Çä„Åæ„Åô", "„Ç∞„É©„Çπ„ÇíÂâ≤„Å£„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü"], correct: 2 },
                { q: "Tr√™n t∆∞·ªùng c√≥ d√°n poster (Tr·∫°ng th√°i c√≥ ch·ªß ƒë√≠ch - Tha ƒë·ªông t·ª´)", a: ["„Éù„Çπ„Çø„Éº„ÅåË≤º„Å£„Å¶„ÅÑ„Åæ„Åô", "„Éù„Çπ„Çø„Éº„ÅåË≤º„Å£„Å¶„ÅÇ„Çä„Åæ„Åô", "„Éù„Çπ„Çø„Éº„ÇíË≤º„Å£„Å¶„Åä„Åç„Åæ„Åô"], correct: 1 },
                { q: "T√¥i ƒë·ªãnh nƒÉm sau s·∫Ω chuy·ªÉn nh√† (D·ª± ƒë·ªãnh - Tsumori)", a: ["Âºï„Å£Ë∂ä„Åô„Åù„ÅÜ„Åß„Åô", "Âºï„Å£Ë∂ä„Åô„Å§„ÇÇ„Çä„Åß„Åô", "Âºï„Å£Ë∂ä„Åó„Åù„ÅÜ„Åß„Åô"], correct: 1 },
                { q: "T√¥i ƒë·ªãnh ƒëi xem phim (√ù ƒë·ªãnh - Volitional + To omou)", a: ["Ë¶ã„Çà„ÅÜ„Å®ÊÄù„Å£„Å¶„ÅÑ„Åæ„Åô", "Ë¶ã„Çã„Å§„ÇÇ„Çä„Åß„Åô", "Ë¶ã„Å¶„Åä„Åç„Åæ„Åô"], correct: 0 },
                { q: "ƒê·ªô cao c·ªßa n√∫i Ph√∫ Sƒ© (Danh t·ª´ h√≥a t√≠nh t·ª´)", a: ["È´ò„ÅÑ", "È´ò„Åø", "È´ò„Åï"], correct: 2 },
                { q: "ƒê√®n ƒëang t·∫Øt (T·ª± ƒë·ªông t·ª´ - Tr·∫°ng th√°i)", a: ["ÈõªÊ∞ó„ÅåÊ∂à„Åó„Å¶„ÅÑ„Åæ„Åô", "ÈõªÊ∞ó„ÅåÊ∂à„Åà„Å¶„ÅÑ„Åæ„Åô", "ÈõªÊ∞ó„ÅåÊ∂à„Åó„Å¶„ÅÇ„Çä„Åæ„Åô"], correct: 1 },
                { q: "Vi·∫øt s·∫µn t√™n v√†o ƒë√¢y (Chu·∫©n b·ªã)", a: ["ÂêçÂâç„ÇíÊõ∏„ÅÑ„Å¶„Åä„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ", "ÂêçÂâç„ÇíÊõ∏„ÅÑ„Å¶„Åó„Åæ„Å£„Å¶„Åè„Å†„Åï„ÅÑ", "ÂêçÂâç„ÇíÊõ∏„ÅÑ„Å¶„ÅÇ„Çä„Åæ„Åô"], correct: 0 },
                { q: "L·ª° qu√™n v√≠ ·ªü nh√† m·∫•t r·ªìi (H·ªëi ti·∫øc)", a: ["Âøò„Çå„Å¶„Åä„Åç„Åæ„Åó„Åü", "Âøò„Çå„Å¶„ÅÇ„Çä„Åæ„Åô", "Âøò„Çå„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü"], correct: 2 }
            ]
        };

        // --- STATE ---
        let currentMode = 'polite';
        let showFurigana = true;
        let showRomaji = false;
        let showVi = true;

        // --- UTILS ---
        const parseFurigana = (text) => text.replace(/([^\[\]]+)\[(.+?)\]/g, '<ruby>$1<rt>$2</rt></ruby>');
        const cleanText = (text) => text.replace(/\[.*?\]/g, '');

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(cleanText(text));
                u.lang = 'ja-JP'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        function checkTyping(input, correctText, feedbackDiv) {
            const userText = input.value;
            const targetText = cleanText(correctText);
            let html = '';
            
            for (let i = 0; i < userText.length; i++) {
                if (i >= targetText.length) {
                    html += `<span class="incorrect-char">${userText[i]}</span>`;
                } else if (userText[i] === targetText[i]) {
                    html += `<span class="correct-char">${userText[i]}</span>`;
                } else {
                    html += `<span class="incorrect-char">${userText[i]}</span>`;
                }
            }
            
            feedbackDiv.innerHTML = html;
            
            if (userText === targetText) {
                input.classList.add('correct-input');
                input.classList.remove('wrong-input');
                feedbackDiv.innerHTML += ' <span class="text-green-600 ml-2 font-bold text-xs"><i class="fas fa-check-circle"></i> Ch√≠nh x√°c!</span>';
            } else if (userText.length > 0) {
                input.classList.add('wrong-input');
                input.classList.remove('correct-input');
            } else {
                input.classList.remove('correct-input', 'wrong-input');
            }
        }

        // --- RENDER FUNCTIONS ---
        
        function renderConversation() {
            const container = document.getElementById('conversation-container');
            const lines = lessonData.conversation[currentMode];
            
            container.innerHTML = lines.map((line, idx) => `
                <div class="flex gap-4 fade-in ${line.role === 'Tanaka' ? '' : 'flex-row-reverse'}">
                    <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center font-bold text-white shadow-md ${line.role === 'Tanaka' ? 'bg-blue-500' : 'bg-green-500'}">
                        ${line.role[0]}
                    </div>
                    <div class="flex-1 max-w-[90%]">
                        <div class="text-xs text-gray-500 mb-1 ${line.role === 'Tanaka' ? 'text-left' : 'text-right'}">${line.role}</div>
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-200 relative group transition hover:shadow-md ${line.role === 'Tanaka' ? 'rounded-tl-none' : 'rounded-tr-none bg-green-50'}">
                            <p class="text-lg text-gray-800 kanji-font leading-relaxed mb-1">${parseFurigana(line.jp)}</p>
                            <p class="text-sm text-gray-500 romaji-text hidden italic mb-1">${line.romaji}</p>
                            <p class="text-sm text-gray-500 vi-trans border-t border-gray-100 pt-2 mt-2">${line.vi}</p>
                            <button onclick="speak('${line.jp}')" class="absolute top-2 right-2 text-gray-300 hover:text-sky-600 transition"><i class="fas fa-volume-up"></i></button>
                            
                            <!-- Typing Practice Area -->
                            <div class="mt-3 pt-2 border-t border-gray-100">
                                <input type="text" class="w-full text-sm p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-200 transition bg-gray-50 placeholder-gray-300" 
                                    placeholder="Nghe v√† g√µ l·∫°i c√¢u tr√™n..." 
                                    oninput="checkTyping(this, '${line.jp}', this.nextElementSibling)">
                                <div class="h-5 mt-1 text-sm pl-1 kanji-font"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            updateUI();
        }

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('tab-polite').className = mode === 'polite' ? "tab-btn tab-active px-4 py-1.5 rounded-md text-sm font-bold" : "tab-btn tab-inactive px-4 py-1.5 rounded-md text-sm font-bold ml-1";
            document.getElementById('tab-casual').className = mode === 'casual' ? "tab-btn tab-active px-4 py-1.5 rounded-md text-sm font-bold ml-1" : "tab-btn tab-inactive px-4 py-1.5 rounded-md text-sm font-bold ml-1";
            renderConversation();
        }

        function renderReading() {
            document.getElementById('reading-text').innerHTML = parseFurigana(lessonData.reading.jp);
            document.getElementById('reading-romaji').innerText = lessonData.reading.romaji;
            document.getElementById('reading-vi').innerText = lessonData.reading.vi;
            
            // Setup reading input checker
            const input = document.getElementById('reading-input');
            const feedback = document.getElementById('reading-feedback');
            input.oninput = () => checkTyping(input, lessonData.reading.jp, feedback);

            // Add play button to reading title
            const btn = document.createElement('button');
            btn.className = "mt-4 text-orange-500 hover:text-orange-700 font-bold flex items-center text-sm transition";
            btn.innerHTML = '<i class="fas fa-volume-up mr-2"></i> Nghe b√†i ƒë·ªçc';
            btn.onclick = () => speak(lessonData.reading.jp);
            if(!document.getElementById('reading-play-btn')) {
                btn.id = 'reading-play-btn';
                document.getElementById('reading-text').parentNode.insertBefore(btn, document.getElementById('reading-text').nextSibling);
            }
        }

        function renderGrammar() {
            const container = document.getElementById('grammar-container');
            container.innerHTML = lessonData.grammar.map(g => `
                <div class="bg-white p-5 rounded-xl border border-purple-100 shadow-sm hover:border-purple-300 transition group">
                    <h3 class="font-bold text-purple-700 mb-1 text-lg flex items-center">
                        <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>${g.rule}
                    </h3>
                    <p class="text-gray-600 text-sm mb-3 pl-4">${g.mean}</p>
                    <div class="bg-purple-50 p-3 rounded-lg text-sm text-gray-700 kanji-font relative pl-4">
                        <i class="fas fa-quote-left text-purple-200 absolute top-1 left-1 text-xs"></i>
                        ${parseFurigana(g.ex)}
                        <button onclick="speak('${g.ex}')" class="absolute top-2 right-2 text-purple-300 hover:text-purple-600 transition opacity-0 group-hover:opacity-100"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function renderVocab() {
            const container = document.getElementById('vocab-container');
            container.innerHTML = lessonData.vocab.map(v => `
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 card-hover flex flex-col relative group transition-all duration-300 hover:border-sky-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="text-3xl font-bold text-gray-800 kanji-font mb-1">${v.k}</div>
                            <div class="text-sm text-gray-500">${v.h}</div>
                        </div>
                        <div class="text-xs font-bold text-white bg-gray-400 px-2 py-1 rounded shadow-sm">${v.hv}</div>
                    </div>
                    
                    <div class="text-sky-700 font-bold text-lg mb-3 border-b border-gray-100 pb-2">${v.m}</div>
                    
                    <div class="space-y-2 text-sm text-gray-600 flex-grow">
                        <div class="bg-orange-50 p-2 rounded border border-orange-100">
                            <span class="font-bold text-orange-600">üñºÔ∏è H√¨nh:</span> ${v.ti.replace(/\*\*(.*?)\*\*/g, '<span class="text-red-600 font-bold">$1</span>')}
                        </div>
                        <div class="bg-blue-50 p-2 rounded border border-blue-100">
                            <span class="font-bold text-blue-600">üîä √Çm:</span> ${v.ta.replace(/\*\*(.*?)\*\*/g, '<span class="text-indigo-600 font-bold">$1</span>')}
                        </div>
                    </div>

                    <button onclick="speak('${v.k}')" class="absolute top-3 right-3 text-gray-300 hover:text-sky-500 opacity-0 group-hover:opacity-100 transition bg-white rounded-full w-8 h-8 shadow flex items-center justify-center">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = lessonData.quiz.map((q, idx) => `
                <div class="quiz-item border-b border-gray-100 pb-4 last:border-0">
                    <p class="font-bold text-gray-800 mb-3"><span class="text-emerald-600 mr-2">C√¢u ${idx + 1}:</span> ${q.q}</p>
                    <div class="space-y-2">
                        ${q.a.map((opt, optIdx) => `
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition quiz-option" data-q="${idx}" data-opt="${optIdx}">
                                <input type="radio" name="q${idx}" value="${optIdx}" class="mr-3 text-emerald-600 focus:ring-emerald-500">
                                <span class="kanji-font">${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div class="quiz-feedback hidden mt-3 p-3 rounded-lg text-sm" id="feedback-${idx}"></div>
                </div>
            `).join('');
            
            document.getElementById('quiz-score').innerText = `0/${lessonData.quiz.length}`;
        }

        function checkQuiz() {
            let score = 0;
            lessonData.quiz.forEach((q, idx) => {
                const selected = document.querySelector(`input[name="q${idx}"]:checked`);
                const feedbackEl = document.getElementById(`feedback-${idx}`);
                feedbackEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
                
                if (selected) {
                    const val = parseInt(selected.value);
                    if (val === q.correct) {
                        score++;
                        feedbackEl.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Ch√≠nh x√°c!`;
                        feedbackEl.classList.add('bg-green-100', 'text-green-800');
                    } else {
                        feedbackEl.innerHTML = `<i class="fas fa-times-circle mr-2"></i> Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: <strong>${q.a[q.correct]}</strong>`;
                        feedbackEl.classList.add('bg-red-100', 'text-red-800');
                    }
                } else {
                    feedbackEl.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i> B·∫°n ch∆∞a ch·ªçn ƒë√°p √°n.`;
                    feedbackEl.classList.add('bg-yellow-100', 'text-yellow-800');
                }
            });
            document.getElementById('quiz-score').innerText = `${score}/${lessonData.quiz.length}`;
        }

        // --- CONTROLS ---
        function updateUI() {
            // Toggle Furigana
            const rubyTags = document.querySelectorAll('rt');
            rubyTags.forEach(rt => rt.style.visibility = showFurigana ? 'visible' : 'hidden');
            
            const btnFuri = document.getElementById('btn-toggle-furigana');
            btnFuri.className = showFurigana 
                ? "px-3 py-1.5 rounded transition bg-sky-600 text-white flex items-center shadow" 
                : "px-3 py-1.5 rounded transition bg-gray-200 text-gray-600 flex items-center";

            // Toggle Romaji
            const romajiTexts = document.querySelectorAll('.romaji-text');
            romajiTexts.forEach(el => el.classList.toggle('hidden', !showRomaji));
            
            const btnRomaji = document.getElementById('btn-toggle-romaji');
            btnRomaji.className = showRomaji 
                ? "px-3 py-1.5 rounded transition bg-sky-600 text-white flex items-center shadow ml-1" 
                : "px-3 py-1.5 rounded transition bg-gray-200 text-gray-600 flex items-center ml-1";

            // Toggle Vietnamese
            const viTexts = document.querySelectorAll('.vi-trans');
            viTexts.forEach(p => p.style.display = showVi ? 'block' : 'none');

            const btnVi = document.getElementById('btn-toggle-vi');
            btnVi.className = showVi 
                ? "px-3 py-1.5 rounded transition bg-white text-sky-800 font-bold ml-1 flex items-center border border-sky-200 shadow-sm" 
                : "px-3 py-1.5 rounded transition bg-gray-200 text-gray-500 font-bold ml-1 flex items-center";
        }

        document.getElementById('btn-toggle-furigana').onclick = () => { showFurigana = !showFurigana; updateUI(); };
        document.getElementById('btn-toggle-romaji').onclick = () => { showRomaji = !showRomaji; updateUI(); };
        document.getElementById('btn-toggle-vi').onclick = () => { showVi = !showVi; updateUI(); };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderConversation();
            renderReading();
            renderGrammar();
            renderVocab();
            renderQuiz();
            updateUI();
        });

    </script>
</body>
</html>
