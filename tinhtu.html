<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AzaKanji - T√≠nh T·ª´ Ng·ªØ C·∫£nh N3 (Final with Stroke Order)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #f0fdf4; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #86efac; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4ade80; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-enter { animation: modalIn 0.3s ease-out forwards; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .correct-anim { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .wrong-anim { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* STROKE ORDER STYLES */
        .stroke-path {
            fill: none;
            stroke: #333;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .stroke-grid-box {
            border: 1px solid #e5e7eb;
            background-color: white;
            position: relative;
        }
        /* Dotted lines for kanji grid */
        .stroke-grid-box::after {
            content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%;
            background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px);
            z-index: 0;
        }
        .stroke-grid-box::before {
            content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px;
            background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px);
            z-index: 0;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-green-600 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                    <i class="fas fa-leaf text-3xl text-yellow-300"></i>
                    <div>
                        <h1 class="text-xl font-bold uppercase tracking-wider">AzaKanji Adjectives</h1>
                        <p class="text-xs text-green-100">41 C·∫∑p T√≠nh T·ª´ & Ng·ªØ Ph√°p N5-N3</p>
                    </div>
                </div>
                <div class="flex bg-green-800 rounded-lg p-1 overflow-x-auto">
                    <button onclick="switchTab('learn')" id="tab-learn" class="px-4 py-2 rounded-md text-sm font-bold transition bg-white text-green-800 shadow whitespace-nowrap">
                        <i class="fas fa-book-open mr-2"></i>H·ªçc T·ª´
                    </button>
                    <button onclick="switchTab('quiz')" id="tab-quiz" class="px-4 py-2 rounded-md text-sm font-bold transition text-green-200 hover:text-white whitespace-nowrap">
                        <i class="fas fa-keyboard mr-2"></i>Ki·ªÉm Tra
                    </button>
                    <button onclick="openGrammarModal()" class="px-4 py-2 rounded-md text-sm font-bold transition text-green-200 hover:text-white whitespace-nowrap border-l border-green-700 ml-1">
                        <i class="fas fa-book mr-2"></i>Ng·ªØ Ph√°p
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow relative z-0" id="app-container">
        <!-- LEARN MODE -->
        <div id="learn-section" class="fade-in">
            <div id="content-area" class="space-y-8"></div>
        </div>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden fade-in max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                <div class="bg-gradient-to-r from-green-600 to-teal-600 p-6 text-white flex justify-between items-center">
                    <div><h2 class="text-2xl font-bold">Th·ª≠ Th√°ch T√≠nh T·ª´</h2><p class="text-green-100 text-sm">Nh√¨n Kanji - G√µ Hiragana</p></div>
                    <div class="text-right"><div class="text-xs text-green-200 uppercase font-bold">ƒêi·ªÉm s·ªë</div><div class="text-4xl font-bold" id="score-display">0</div></div>
                </div>
                <div class="p-8 text-center">
                    <div class="mb-8">
                        <div class="text-sm text-gray-500 mb-2 uppercase tracking-wide font-bold">T·ª´ n√†y ƒë·ªçc l√† g√¨?</div>
                        <div id="quiz-kanji" class="text-6xl kanji-font font-bold text-gray-800 mb-4 transition-all"></div>
                        <div id="quiz-meaning" class="text-xl text-green-600 font-bold mb-2"></div>
                    </div>
                    <div class="relative max-w-md mx-auto mb-6">
                        <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none transition kanji-font" placeholder="Nh·∫≠p Hiragana (vd: „ÅÇ„Å§„ÅÑ)" autocomplete="off">
                    </div>
                    <div id="feedback-area" class="hidden rounded-xl p-4 bg-gray-50 border border-gray-200 text-left mb-6">
                        <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                        <div class="text-gray-700 mb-2">
                            ƒê√°p √°n ƒë√∫ng: <span id="correct-answer" class="font-bold text-xl text-green-600 mx-2 kanji-font"></span>
                            <button onclick="playCurrentAudio()" class="text-gray-500 hover:text-green-600"><i class="fas fa-volume-up"></i></button>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-sm text-gray-800">
                            <div class="font-bold text-yellow-800 mb-1"><i class="fas fa-lightbulb mr-1"></i> M·∫πo ghi nh·ªõ:</div>
                            <div id="quiz-tip-img" class="mb-1"></div>
                            <div id="quiz-tip-sound"></div>
                        </div>
                    </div>
                    <div>
                        <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition active:scale-95 text-lg">Ki·ªÉm Tra</button>
                        <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition active:scale-95 text-lg">C√¢u Ti·∫øp Theo <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <div class="mb-4">
                <i class="fas fa-leaf text-2xl text-green-500 mb-2"></i>
                <h3 class="text-lg font-bold text-white">AzaKanji Adjectives</h3>
                <p class="text-sm">H·ªçc T√≠nh t·ª´ ti·∫øng Nh·∫≠t th·∫≠t d·ªÖ d√†ng & vui v·∫ª</p>
            </div>
            <div class="border-t border-gray-700 pt-4 mt-4 text-xs">
                <p>&copy; 2024 AzaKanji Project. Developed for Kanji Lovers.</p>
                <p class="mt-1">D·ªØ li·ªáu bao g·ªìm c√°c c·∫∑p t√≠nh t·ª´ ƒëu√¥i i v√† ƒëu√¥i na th√¥ng d·ª•ng (N5-N4).</p>
            </div>
        </div>
    </footer>

    <!-- CONJUGATION MODAL -->
    <div id="conjugation-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full modal-enter">
                <div class="bg-green-600 px-4 py-4 sm:px-6 flex justify-between items-center text-white">
                    <div><h3 class="text-lg leading-6 font-bold" id="modal-title">Bi·∫øn ƒê·ªïi T√≠nh T·ª´</h3><p class="text-green-100 text-xs">C√°ch d√πng & V√≠ d·ª• c√¢u</p></div>
                    <button onclick="closeModal()" class="text-green-100 hover:text-white focus:outline-none"><i class="fas fa-times text-2xl"></i></button>
                </div>
                <div class="bg-green-50 px-4 py-5 sm:p-6 max-h-[70vh] overflow-y-auto">
                    <div class="flex items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-green-200">
                        <div class="text-5xl kanji-font font-bold text-green-600 mr-4" id="modal-kanji"></div>
                        <div>
                            <div class="text-2xl font-bold text-gray-800" id="modal-hiragana"></div>
                            <div class="text-sm text-gray-500 font-bold uppercase tracking-wide" id="modal-group"></div>
                            <div class="text-lg text-gray-700" id="modal-meaning"></div>
                        </div>
                        <button id="modal-main-audio" class="ml-auto bg-green-50 text-green-600 p-3 rounded-full hover:bg-green-100 transition shadow-sm"><i class="fas fa-volume-up text-xl"></i></button>
                    </div>
                    <div class="space-y-4" id="conjugation-list"></div>
                </div>
                <div class="bg-gray-100 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm" onclick="closeModal()">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GRAMMAR RULES MODAL -->
    <div id="grammar-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeGrammarModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full modal-enter relative">
                <button onclick="closeGrammarModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none z-10"><i class="fas fa-times text-2xl"></i></button>
                <div class="bg-white px-6 py-8 sm:p-8">
                    <h2 class="text-3xl font-extrabold text-green-700 mb-6 text-center border-b pb-4"><i class="fas fa-book-reader mr-2"></i>Quy T·∫Øc Bi·∫øn ƒê·ªïi T√≠nh T·ª´</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
                            <h3 class="text-xl font-bold text-blue-700 mb-4 flex items-center"><span class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">„ÅÑ</span>I-Adj (ƒêu√¥i i)</h3>
                            <ul class="space-y-3 text-gray-700 text-sm">
                                <li class="flex justify-between border-b border-blue-100 pb-2"><span class="font-semibold">Ph·ªß ƒë·ªãnh:</span><span>B·ªè <span class="text-red-600">„ÅÑ</span> + „Åè„Å™„ÅÑ</span></li>
                                <li class="flex justify-between border-b border-blue-100 pb-2"><span class="font-semibold">Qu√° kh·ª©:</span><span>B·ªè <span class="text-red-600">„ÅÑ</span> + „Åã„Å£„Åü</span></li>
                                <li class="flex justify-between border-b border-blue-100 pb-2"><span class="font-semibold">N·ªëi c√¢u (Te):</span><span>B·ªè <span class="text-red-600">„ÅÑ</span> + „Åè„Å¶</span></li>
                                <li class="flex justify-between border-b border-blue-100 pb-2"><span class="font-semibold">Ph√≥ t·ª´:</span><span>B·ªè <span class="text-red-600">„ÅÑ</span> + „Åè</span></li>
                                <li class="flex justify-between border-b border-blue-100 pb-2"><span class="font-semibold">Gi·∫£ ƒë·ªãnh (Ba):</span><span>B·ªè <span class="text-red-600">„ÅÑ</span> + „Åë„Çå„Å∞</span></li>
                            </ul>
                        </div>
                        <div class="bg-green-50 rounded-xl p-6 border border-green-200">
                            <h3 class="text-xl font-bold text-green-700 mb-4 flex items-center"><span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">„Å™</span>Na-Adj (ƒêu√¥i Na)</h3>
                            <ul class="space-y-3 text-gray-700 text-sm">
                                <li class="flex justify-between border-b border-green-100 pb-2"><span class="font-semibold">Ph·ªß ƒë·ªãnh:</span><span>+ „Åò„ÇÉ„Å™„ÅÑ / „Åß„ÅØ„Å™„ÅÑ</span></li>
                                <li class="flex justify-between border-b border-green-100 pb-2"><span class="font-semibold">Qu√° kh·ª©:</span><span>+ „Åß„Åó„Åü / „Å†„Å£„Åü</span></li>
                                <li class="flex justify-between border-b border-green-100 pb-2"><span class="font-semibold">N·ªëi c√¢u (Te):</span><span>+ „Åß</span></li>
                                <li class="flex justify-between border-b border-green-100 pb-2"><span class="font-semibold">Ph√≥ t·ª´:</span><span>+ „Å´</span></li>
                                <li class="flex justify-between border-b border-green-100 pb-2"><span class="font-semibold">Gi·∫£ ƒë·ªãnh (Ba):</span><span>+ „Å™„Çâ(„Å∞)</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 text-center"><button onclick="closeGrammarModal()" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-2 px-8 rounded-full shadow-lg transition">ƒê√£ Hi·ªÉu</button></div>
                </div>
            </div>
        </div>
    </div>

    <!-- STROKE ORDER MODAL (NEW) -->
    <div id="stroke-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeStrokeModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full modal-enter relative">
                
                <div class="bg-green-600 px-4 py-3 flex justify-between items-center text-white">
                    <h3 class="font-bold text-lg"><i class="fas fa-pen-nib mr-2"></i>T·∫≠p Vi·∫øt Kanji: <span id="stroke-modal-char" class="text-2xl ml-2"></span></h3>
                    <button onclick="closeStrokeModal()" class="hover:text-gray-200"><i class="fas fa-times text-xl"></i></button>
                </div>
                
                <div class="p-6 bg-gray-50 max-h-[80vh] overflow-y-auto">
                    <!-- Animation Area -->
                    <div class="flex flex-col md:flex-row gap-8 items-start justify-center">
                        <div class="bg-white p-4 rounded-lg shadow border border-gray-200 text-center">
                            <p class="text-sm text-gray-500 mb-2 font-bold uppercase">M√¥ ph·ªèng n√©t vi·∫øt</p>
                            <div id="stroke-animation-container" class="w-40 h-40 mx-auto bg-white border border-gray-300 relative stroke-grid-box"></div>
                            <button onclick="replayStrokeAnimation()" class="mt-3 text-sm bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200 transition"><i class="fas fa-redo mr-1"></i> Vi·∫øt l·∫°i</button>
                        </div>
                        
                        <!-- Grid Breakdown -->
                        <div class="flex-1">
                            <p class="text-sm text-gray-500 mb-3 font-bold uppercase">Th·ª© t·ª± t·ª´ng n√©t</p>
                            <div id="stroke-grid-container" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- MASTER DATA (ADJECTIVES) ---
        const adjectives = [
            { k: "Â§ß„Åç„ÅÑ", h: "„Åä„Åä„Åç„ÅÑ", m: "to, l·ªõn", t: "i", ti: "Ng∆∞·ªùi dang tay ra (**Â§ß**) l√† **ƒê·∫†I** (to).", ta: "**√î! K√¨a** (**Ookii**) to qu√°." },
            { k: "Â∞è„Åï„ÅÑ", h: "„Å°„ÅÑ„Åï„ÅÑ", m: "nh·ªè, b√©", t: "i", ti: "C√¢y (**‰∫Ö**) b·ªã ch·∫∑t l√†m hai (**ÂÖ´**) l√† **TI·ªÇU** (nh·ªè).", ta: "**Chi** (**Chii**) ti·ªÅn **sai** n√™n mua ƒë·ªì nh·ªè." },
            { k: "È´ò„ÅÑ", h: "„Åü„Åã„ÅÑ", m: "cao, ƒë·∫Øt", t: "i", ti: "ƒê·ª©ng tr√™n c·ªïng th√†nh (**‰∫¨**) nh√¨n **CAO**.", ta: "**Ta c√£i** (**Takai**) v√¨ gi√° ƒë·∫Øt." },
            { k: "‰Ωé„ÅÑ", h: "„Å≤„Åè„ÅÑ", m: "th·∫•p", t: "i", ti: "Ng∆∞·ªùi (**‰∫ª**) c√∫i xu·ªëng g·ªëc c√¢y (**Ê∞ê**) v√¨ **ƒê√ä** (th·∫•p).", ta: "**Hi** h√≥p m√° **c√∫i** (**Hikui**) xu·ªëng th·∫•p." },
            { k: "Èï∑„ÅÑ", h: "„Å™„Åå„ÅÑ", m: "d√†i", t: "i", ti: "√îng tr∆∞·ªüng (**Èï∑**) l√£o t√≥c d√†i.", ta: "**Na** (**Naga**) ƒëi ƒë∆∞·ªùng **d√†i**." },
            { k: "Áü≠„ÅÑ", h: "„Åø„Åò„Åã„ÅÑ", m: "ng·∫Øn", t: "i", ti: "M≈©i t√™n (**Áü¢**) b·∫Øn v√†o h·∫°t ƒë·∫≠u (**Ë±Ü**) **ƒêO·∫¢N** m·ªánh.", ta: "**M√¨** **g√¨** **cai** (**Mijikai**) th·∫ø, ng·∫Øn t≈©n." },
            { k: "Â§™„ÅÑ", h: "„Åµ„Å®„ÅÑ", m: "b√©o, d√†y", t: "i", ti: "ƒê·∫°i (**Â§ß**) th√™m 1 ch·∫•m l√† **TH√ÅI** (qu√° to).", ta: "**Ph√π** (**Futoi**) m·ªè v√¨ b√©o." },
            { k: "Á¥∞„ÅÑ", h: "„Åª„Åù„ÅÑ", m: "g·∫ßy, m·ªèng", t: "i", ti: "S·ª£i t∆° (**Á≥∏**) ·ªü ru·ªông (**Áî∞**) r·∫•t **T·∫æ** (nh·ªè).", ta: "**H·ªì** **S∆°** (**Hosoi**) m·ªèng d√≠nh." },
            { k: "Â∫É„ÅÑ", h: "„Å≤„Çç„ÅÑ", m: "r·ªông", t: "i", ti: "M√°i nh√† (**Âπø**) ch·ª©a ƒë·ªì t∆∞ (**„É†**) **QU·∫¢NG** ƒë·∫°i.", ta: "**Hi** **R·ªì** (**Hiroi**) ƒëi ƒë∆∞·ªùng r·ªông." },
            { k: "Áã≠„ÅÑ", h: "„Åõ„Åæ„ÅÑ", m: "h·∫πp", t: "i", ti: "Con Ch√≥ (**Áä≠**) b·ªã k·∫πp (**Â§π**) ·ªü ch·ªó **HI·ªÜP** (h·∫πp).", ta: "**Xe** **M√£i** (**Semai**) m·ªõi qua ƒë∆∞·ªùng h·∫πp." },
            { k: "Êöë„ÅÑ", h: "„ÅÇ„Å§„ÅÑ", m: "n√≥ng (th·ªùi ti·∫øt)", t: "i", ti: "M·∫∑t tr·ªùi (**Êó•**) chi·∫øu v√†o k·∫ª (**ËÄÖ**) **TH·ª¨** (n√≥ng).", ta: "**A! Tui** (**Atsui**) n√≥ng qu√°." },
            { k: "ÂØí„ÅÑ", h: "„Åï„ÇÄ„ÅÑ", m: "l·∫°nh (th·ªùi ti·∫øt)", t: "i", ti: "·ªû nh√† (**ÂÆÄ**) tr√πm r∆°m r·∫° (**Ëâπ**) c√≥ ng∆∞·ªùi (**‰∫∫**) ƒë√≥ng bƒÉng (**ÂÜ´**) v√¨ **H√ÄN** (l·∫°nh).", ta: "**Sa** **M√π** (**Samui**) tr·ªùi l·∫°nh." },
            { k: "ÁÜ±„ÅÑ", h: "„ÅÇ„Å§„ÅÑ", m: "n√≥ng (v·∫≠t/c·∫£m x√∫c)", t: "i", ti: "Tr·ªìng c√¢y (**Âü∂**) ƒë·ªët l·ª≠a (**ÁÅ¨**) **NHI·ªÜT** t√¨nh.", ta: "**A! Tui** (**Atsui**) b·ªã b·ªèng (v·∫≠t n√≥ng)." },
            { k: "ÂÜ∑„Åü„ÅÑ", h: "„Å§„ÇÅ„Åü„ÅÑ", m: "l·∫°nh (v·∫≠t/th√°i ƒë·ªô)", t: "i", ti: "Ra l·ªánh (**‰ª§**) ƒë√≥ng bƒÉng (**ÂÜ´**) **L√ÉNH** kh·ªëc.", ta: "**T·ª±** **M√™** **T·∫°i** (**Tsumetai**) kem l·∫°nh." },
            { k: "Êöñ„Åã„ÅÑ", h: "„ÅÇ„Åü„Åü„Åã„ÅÑ", m: "·∫•m (th·ªùi ti·∫øt)", t: "i", ti: "Ng√†y (**Êó•**) c√≥ vi·ªán tr·ª£ (**Áà∞**) **NO√ÉN** (·∫•m).", ta: "**A ta ta** (**Atata**) th·∫•y ·∫•m." },
            { k: "Ê∂º„Åó„ÅÑ", h: "„Åô„Åö„Åó„ÅÑ", m: "m√°t m·∫ª", t: "i", ti: "N∆∞·ªõc (**Ê∞µ**) ch·∫£y tr√™n kinh ƒë√¥ (**‰∫¨**) **L∆Ø∆†NG** m√°t.", ta: "**Su su** (**Suzu**) ƒÉn m√°t." },
            { k: "ËâØ„ÅÑ", h: "„ÅÑ„ÅÑ", m: "t·ªët", t: "ii", ti: "Ng∆∞·ªùi con g√°i ƒÉn ·ªü **L∆Ø∆†NG** thi·ªán.", ta: "**I** (**Ii**) nh∆∞ v·∫≠y l√† t·ªët." },
            { k: "ÊÇ™„ÅÑ", h: "„Çè„Çã„ÅÑ", m: "x·∫•u", t: "i", ti: "T√¢m (**ÂøÉ**) nghƒ© ƒëi·ªÅu √°c (**‰∫ú**) l√† **√ÅC** (x·∫•u).", ta: "**Wa! R√πi** (**Warui**) xong, x·∫•u r·ªìi." },
            { k: "Êñ∞„Åó„ÅÑ", h: "„ÅÇ„Åü„Çâ„Åó„ÅÑ", m: "m·ªõi", t: "i", ti: "ƒê·ª©ng (**Á´ã**) tr√™n c√¢y (**Êú®**) d√πng r√¨u (**Êñ§**) l√†m c√°i **T√ÇN** (m·ªõi).", ta: "**A ta ra** (**Atara**) mua ƒë·ªì m·ªõi." },
            { k: "Âè§„ÅÑ", h: "„Åµ„Çã„ÅÑ", m: "c≈©", t: "i", ti: "M∆∞·ªùi (**ÂçÅ**) c√°i mi·ªáng (**Âè£**) k·ªÉ chuy·ªán **C·ªî** (c≈©).", ta: "**Ph√π** **R√πi** (**Furui**) b·ª•i ƒë·ªì c≈©." },
            { k: "Âº∑„ÅÑ", h: "„Å§„Çà„ÅÑ", m: "m·∫°nh", t: "i", ti: "Cung (**Âºì**) b·∫Øn c√¥n tr√πng (**Ëô´**) **C∆Ø·ªúNG** tr√°ng.", ta: "**T·ª±** **Do** (**Tsuyo**) l√† m·∫°nh m·∫Ω." },
            { k: "Âº±„ÅÑ", h: "„Çà„Çè„ÅÑ", m: "y·∫øu", t: "i", ti: "Cung (**Âºì**) g√£y l√¥ng (**ÂΩ°**) l√† **NH∆Ø·ª¢C** (y·∫øu).", ta: "**Gi√≥** **Wai** (**Yowai**) th·ªïi bay ng∆∞·ªùi y·∫øu." },
            { k: "Èõ£„Åó„ÅÑ", h: "„ÇÄ„Åö„Åã„Åó„ÅÑ", m: "kh√≥", t: "i", ti: "Con Chim (**Èöπ**) b·ªã d√≠nh v√†o ƒë·∫•t s√©t (**Â†á**) n√™n g·∫∑p **NAN** (kh√≥).", ta: "**M√π** **D∆∞** **C·∫£** (**Muzuka**) ƒë·ªëng b√†i kh√≥." },
            { k: "Êòì„Åó„ÅÑ", h: "„ÇÑ„Åï„Åó„ÅÑ", m: "d·ªÖ", t: "i", ti: "M·∫∑t tr·ªùi (**Êó•**) chi·∫øu xu·ªëng r·∫°ng r·ª° (**Âãø**) **D·ªä** (d·ªÖ).", ta: "**Ya! Xa** (**Yasa**) th·∫ø m√† d·ªÖ ƒëi." },
            { k: "Áîò„ÅÑ", h: "„ÅÇ„Åæ„ÅÑ", m: "ng·ªçt", t: "i", ti: "Ng·∫≠m (**Âªø**) m·ªôt (**‰∏Ä**) mi·∫øng **CAM** (ng·ªçt).", ta: "**A! Mai** (**Amai**) ƒÉn ƒë·ªì ng·ªçt." },
            { k: "Ëæõ„ÅÑ", h: "„Åã„Çâ„ÅÑ", m: "cay", t: "i", ti: "ƒê·ª©ng (**Á´ã**) m∆∞·ªùi (**ÂçÅ**) l·∫ßn ch·ªãu ƒë·ª±ng **T√ÇN** (cay ƒë·∫Øng).", ta: "**C√†** **Ra** (**Kara**) ƒÉn cay." },
            { k: "Â•Ω„Åç", h: "„Åô„Åç", m: "th√≠ch", t: "na", ti: "Ph·ª• n·ªØ (**Â•≥**) c√≥ con (**Â≠ê**) l√† ƒëi·ªÅu **H·∫¢O** (t·ªët/th√≠ch).", ta: "**Su** **Ki** (**Suki**) th√≠ch ƒÉn su kem." },
            { k: "Â´å„ÅÑ", h: "„Åç„Çâ„ÅÑ", m: "gh√©t", t: "na", ti: "Ph·ª• n·ªØ (**Â•≥**) ki√™m (**ÂÖº**) nhi·ªám nhi·ªÅu qu√° n√™n **HI·ªÄM** (gh√©t).", ta: "**K√¨** **L·∫°** (**Kirai**) ai c≈©ng gh√©t." },
            { k: "‰∏äÊâã", h: "„Åò„Çá„ÅÜ„Åö", m: "gi·ªèi", t: "na", ti: "Tay (**Êâã**) ·ªü tr√™n (**‰∏ä**) l√† **TH∆Ø·ª¢NG TH·ª¶** (gi·ªèi).", ta: "**D√¥** **D·ª±** (**Jouzu**) thi v√¨ gi·ªèi." },
            { k: "‰∏ãÊâã", h: "„Å∏„Åü", m: "k√©m", t: "na", ti: "Tay (**Êâã**) ·ªü d∆∞·ªõi (**‰∏ã**) l√† **H·∫† TH·ª¶** (k√©m).", ta: "**H√©t** **Ta** (**Heta**) v√¨ l√†m k√©m." },
            { k: "„Åç„Çå„ÅÑ", h: "„Åç„Çå„ÅÑ", m: "ƒë·∫πp, s·∫°ch", t: "na", ti: "ƒê·∫°i (**Â§ß**) Kh·∫£ (**ÂèØ**) l√† **K·ª≤** (l·∫°) + Con h∆∞∆°u (**Èπø**) ƒë·∫πp (**È∫ó**).", ta: "**K√¨** **R√™** (**Kirei**) ƒë·∫πp qu√°." },
            { k: "Ë≥ë„ÇÑ„Åã", h: "„Å´„Åé„ÇÑ„Åã", m: "n√°o nhi·ªát", t: "na", ti: "C√≥ ti·ªÅn (**Ë≤ù**) v√†o ng√†y r·ªìng (**Ëæ∞**) th√¨ ch·ª£ r·∫•t **CH·∫®N** (n√°o nhi·ªát).", ta: "**Nghi** **G√¨** (**Nigi**) m√† ·ªìn th·∫ø." },
            { k: "Èùô„Åã", h: "„Åó„Åö„Åã", m: "y√™n tƒ©nh", t: "na", ti: "M√†u xanh (**Èùí**) tranh ƒë·∫•u (**‰∫â**) xong th√¨ **Tƒ®NH**.", ta: "**Si** **D∆∞** **C·∫£** (**Shizuka**) ko gian y√™n tƒ©nh (Xuka)." },
            { k: "‰æøÂà©", h: "„Åπ„Çì„Çä", m: "ti·ªán l·ª£i", t: "na", ti: "Ng∆∞·ªùi (**‰∫ª**) ƒë·ªïi m·ªõi (**Êõ¥**) l√∫a (**Á¶æ**) dao (**ÂàÇ**) **TI·ªÜN L·ª¢I**.", ta: "**B·ªÅn** **B·ªâ** (**Benri**) ti·ªán l·ª£i." },
            { k: "‰∏ç‰æø", h: "„Åµ„Åπ„Çì", m: "b·∫•t ti·ªán", t: "na", ti: "**B·∫§T** (**‰∏ç**) ti·ªán l·ª£i.", ta: "**Ph√π** **B·ªÅn** (**Fuben**) d√πng b·∫•t ti·ªán." },
            { k: "Êöá", h: "„Å≤„Åæ", m: "r·∫£nh r·ªói", t: "na", ti: "Ng√†y (**Êó•**) m∆∞·ª£n (**Âè∫**) th·ªùi gian **H·∫†** (r·∫£nh).", ta: "**Hi** **Ma** (**Hima**) r·∫£nh ƒëi ch∆°i v·ªõi ma." },
            { k: "Âøô„Åó„ÅÑ", h: "„ÅÑ„Åù„Åå„Åó„ÅÑ", m: "b·∫≠n r·ªôn", t: "i", ti: "Tim (**ÂøÑ**) ch·∫øt (**‰∫°**) v√¨ qu√° **MANG** (b·∫≠n).", ta: "**I** **S√¥** **G√†** (**Isoga**) b·∫≠n r·ªôn." }, 
            { k: "Ë¶™Âàá", h: "„Åó„Çì„Åõ„Å§", m: "t·ªët b·ª•ng", t: "na", ti: "Th√¢n (**Ë¶™**) thi·∫øt (**Âàá**) nh∆∞ c·∫Øt ru·ªôt.", ta: "**Xin** **S·∫øp** (**Shinsetsu**) t·ªët b·ª•ng." },
            { k: "ÊúâÂêç", h: "„ÇÜ„ÅÜ„ÇÅ„ÅÑ", m: "n·ªïi ti·∫øng", t: "na", ti: "C√≥ (**Êúâ**) danh (**Âêç**) ti·∫øng.", ta: "**Yu** **M√™** (**Yuumei**) ng∆∞·ªùi n·ªïi ti·∫øng." },
            { k: "Â§ßÂàá", h: "„Åü„ÅÑ„Åõ„Å§", m: "quan tr·ªçng", t: "na", ti: "C·∫Øt (**Âàá**) mi·∫øng to (**Â§ß**) l√† **ƒê·∫†I THI·∫æT** (qu√Ω/quan tr·ªçng).", ta: "**Tai** **S√©t** (**Taisetsu**) ƒë√°nh c√°i quan tr·ªçng." },
            { k: "Â§ß‰∏àÂ§´", h: "„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂", m: "·ªïn, kh√¥ng sao", t: "na", ti: "**ƒê·∫†I TR∆Ø·ª¢NG PHU** (Ng∆∞·ªùi ƒë√†n √¥ng l·ªõn) th√¨ lu√¥n ·ªïn.", ta: "**ƒêai** **D√¥** **B·ª±** (**Daijoubu**) v·∫´n ·ªïn." }
        ];

        // --- GROUPS ---
        const groupsConfig = [
            { title: "1. K√≠ch Th∆∞·ªõc (Size) üìè", color: "blue", ids: ["Â§ß„Åç„ÅÑ","Â∞è„Åï„ÅÑ","È´ò„ÅÑ","‰Ωé„ÅÑ","Èï∑„ÅÑ","Áü≠„ÅÑ","Â§™„ÅÑ","Á¥∞„ÅÑ","Â∫É„ÅÑ","Áã≠„ÅÑ"] },
            { title: "2. Th·ªùi Ti·∫øt & C·∫£m Gi√°c ‚òÄÔ∏è‚ùÑÔ∏è", color: "orange", ids: ["Êöë„ÅÑ","ÂØí„ÅÑ","ÁÜ±„ÅÑ","ÂÜ∑„Åü„ÅÑ","Êöñ„Åã„ÅÑ","Ê∂º„Åó„ÅÑ","„ÅÑ„ÅÑ","ÊÇ™„ÅÑ"] },
            { title: "3. T√≠nh Ch·∫•t (Quality) ‚ú®", color: "purple", ids: ["Êñ∞„Åó„ÅÑ","Âè§„ÅÑ","Âº∑„ÅÑ","Âº±„ÅÑ","Èõ£„Åó„ÅÑ","Êòì„Åó„ÅÑ","Áîò„ÅÑ","Ëæõ„ÅÑ"] },
            { title: "4. ƒê√°nh Gi√° & C·∫£m X√∫c (Na-Adj) üòä", color: "green", ids: ["Â•Ω„Åç","Â´å„ÅÑ","‰∏äÊâã","‰∏ãÊâã","„Åç„Çå„ÅÑ","Ë≥ë„ÇÑ„Åã","Èùô„Åã","‰æøÂà©","‰∏ç‰æø","Êöá","Âøô„Åó„ÅÑ","Ë¶™Âàá","ÊúâÂêç","Â§ßÂàá","Â§ß‰∏àÂ§´"] }
        ];

        const specificAdjExamples = {
            "Â§ß„Åç„ÅÑ": { dict: { ex: "ÂΩº„ÅØÂ§ß„Åç„Å™Â§¢„ÇíÊåÅ„Å£„Å¶„ÅÑ„Çã„ÄÇ", romaji: "Kare wa ookina yume o motte iru.", mean: "Anh ·∫•y mang m·ªôt gi·∫•c m∆° l·ªõn." }, polite: { ex: "„Åì„ÅÆÈù¥„ÅØÂ∞ë„ÅóÂ§ß„Åç„ÅÑ„Åß„Åô„ÄÇ", romaji: "Kono kutsu wa sukoshi ookii desu.", mean: "ƒê√¥i gi√†y n√†y h∆°i r·ªông (to)." }, neg: { ex: "„Åù„Çå„Åª„Å©Â§ß„Åç„Åè„Å™„ÅÑ„Åß„Åô„ÄÇ", romaji: "Sorehodo ookikunai desu.", mean: "N√≥ kh√¥ng to ƒë·∫øn m·ª©c ƒë√≥ ƒë√¢u." }, past: { ex: "Êòî„ÄÅ„Åì„ÅÆÊú®„ÅØ„ÇÇ„Å£„Å®Â§ß„Åç„Åã„Å£„Åü„ÄÇ", romaji: "Mukashi, kono ki wa motto ookikatta.", mean: "Ng√†y x∆∞a c√°i c√¢y n√†y to h∆°n nhi·ªÅu." }, te: { ex: "Èü≥„ÅåÂ§ß„Åç„Åè„Å¶„ÄÅÁú†„Çå„Å™„ÅÑ„ÄÇ", romaji: "Oto ga ookikute, nemurenai.", mean: "Ti·∫øng ·ªìn l·ªõn qu√° kh√¥ng ng·ªß ƒë∆∞·ª£c." }, adv: { ex: "Â≠ê‰æõ„ÅåÂ§ß„Åç„ÅèËÇ≤„Å£„Åü„ÄÇ", romaji: "Kodomo ga ookiku sodatta.", mean: "ƒê·ª©a tr·∫ª ƒë√£ l·ªõn kh√¥n." }, noun: { ex: "Â§ß„Åç„ÅÑ„Éü„Çπ„Çí„Åó„Åü„ÄÇ", romaji: "Ookii misu o shita.", mean: "T√¥i ƒë√£ m·∫Øc m·ªôt l·ªói l·ªõn." } },
            "È´ò„ÅÑ": { dict: { ex: "ÂØåÂ£´Â±±„ÅØÊó•Êú¨„Åß‰∏ÄÁï™È´ò„ÅÑ„ÄÇ", romaji: "Fuji-san wa Nihon de ichiban takai.", mean: "N√∫i Ph√∫ Sƒ© cao nh·∫•t Nh·∫≠t B·∫£n." }, polite: { ex: "Áâ©‰æ°„ÅåÈ´ò„ÅÑ„Åß„Åô„Å≠„ÄÇ", romaji: "Bukka ga takai desu ne.", mean: "V·∫≠t gi√° ƒë·∫Øt ƒë·ªè nh·ªâ." }, neg: { ex: "Áµ¶Êñô„ÅØ„Åù„Çì„Å™„Å´È´ò„Åè„Å™„ÅÑ„ÄÇ", romaji: "Ky≈´ry≈ç wa sonnani takakunai.", mean: "L∆∞∆°ng kh√¥ng cao ƒë·∫øn th·∫ø." }, past: { ex: "ÂÖàÈÄ±„ÅÆÈáéËèú„ÅØÈ´ò„Åã„Å£„Åü„ÄÇ", romaji: "Sensh≈´ no yasai wa takakatta.", mean: "Rau tu·∫ßn tr∆∞·ªõc ƒë·∫Øt l·∫Øm." }, te: { ex: "ÂÄ§ÊÆµ„ÅåÈ´ò„Åè„Å¶„ÄÅË≤∑„Åà„Åæ„Åõ„Çì„ÄÇ", romaji: "Nedan ga takakute, kaemasen.", mean: "Gi√° ƒë·∫Øt qu√°, t√¥i kh√¥ng th·ªÉ mua." }, adv: { ex: "„ÇÇ„Å£„Å®È´ò„ÅèÈ£õ„Å≥„Åü„ÅÑ„ÄÇ", romaji: "Motto takaku tobitai.", mean: "T√¥i mu·ªën bay cao h∆°n n·ªØa." }, noun: { ex: "È´ò„ÅÑ„Éì„É´„Åå‰∏¶„Çì„Åß„ÅÑ„Çã„ÄÇ", romaji: "Takai biru ga narande iru.", mean: "Nh·ªØng t√≤a nh√† cao t·∫ßng x·∫øp h√†ng san s√°t." } },
            // ... (Includes all examples from previous version) ...
            "Âøô„Åó„ÅÑ": { dict: { ex: "Áå´„ÅÆÊâã„ÇÇÂÄü„Çä„Åü„ÅÑ„Åª„Å©Âøô„Åó„ÅÑ„ÄÇ", romaji: "Neko no te mo karitai hodo isogashii.", mean: "B·∫≠n t·ªëi m·∫Øt t·ªëi m≈©i." }, polite: { ex: "ÊúÄËøë„ÄÅ‰ªï‰∫ã„ÅåÂøô„Åó„ÅÑ„Åß„Åô„ÄÇ", romaji: "Saikin, shigoto ga isogashii desu.", mean: "D·∫°o n√†y c√¥ng vi·ªác b·∫≠n r·ªôn." }, neg: { ex: "ÊòéÊó•„ÅØÂøô„Åó„Åè„Å™„ÅÑ„Çà„ÄÇ", romaji: "Ashita wa isogashikunai yo.", mean: "Mai t√¥i kh√¥ng b·∫≠n ƒë√¢u." }, past: { ex: "ÂÖàÊúà„ÅØÁõÆ„ÅåÂõû„Çã„Åª„Å©Âøô„Åó„Åã„Å£„Åü„ÄÇ", romaji: "Sengetsu wa me ga mawaru hodo isogashikatta.", mean: "Th√°ng tr∆∞·ªõc b·∫≠n ch√≥ng c·∫£ m·∫∑t." }, te: { ex: "Âøô„Åó„Åè„Å¶„ÄÅÊòº„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„ÇãÊôÇÈñì„ÇÇ„Å™„ÅÑ„ÄÇ", romaji: "Isogashikute, hirugohan o taberu jikan mo nai.", mean: "B·∫≠n qu√° ƒë·∫øn m·ª©c kh√¥ng c√≥ th·ªùi gian ƒÉn tr∆∞a." }, adv: { ex: "ÊØéÊó•Âøô„Åó„ÅèÂÉç„ÅÑ„Å¶„ÅÑ„Çã„ÄÇ", romaji: "Mainichi isogashiku hataraite iru.", mean: "Ng√†y n√†o c≈©ng l√†m vi·ªác b·∫≠n r·ªôn." }, noun: { ex: "Âøô„Åó„ÅÑÁîüÊ¥ª„ÇíÈÄÅ„Çã„ÄÇ", romaji: "Isogashii seikatsu o okuru.", mean: "S·ªëng m·ªôt cu·ªôc s·ªëng b·∫≠n r·ªôn." } }
        };

        // --- CONJUGATION ENGINE ---
        function conjugate(word) {
            let h = word.h, type = word.t;
            let f = { dict: h, polite: "", neg: "", past: "", te: "", adv: "", noun: "" };
            
            if (type === "i" || type === "ii") {
                let stem = h.slice(0, -1);
                if (type === "ii") stem = "„Çà";
                f.polite = h + "„Åß„Åô"; f.neg = stem + "„Åè„Å™„ÅÑ„Åß„Åô"; f.past = stem + "„Åã„Å£„Åü„Åß„Åô"; f.te = stem + "„Åè„Å¶"; f.adv = stem + "„Åè"; f.noun = h + " + N";
                if (type === "ii") f.dict = "„ÅÑ„ÅÑ („Çà„ÅÑ)";
            } else if (type === "na") {
                f.polite = h + "„Åß„Åô"; f.neg = h + "„Åò„ÇÉ„Å™„ÅÑ„Åß„Åô"; f.past = h + "„Åß„Åó„Åü"; f.te = h + "„Åß"; f.adv = h + "„Å´"; f.noun = h + "„Å™ + N";
            }
            return f;
        }

        function getExamples(word, forms) {
            const specific = specificAdjExamples[word.k];
            if (specific) {
                return [
                    { f: forms.dict, j: specific.dict.ex, r: specific.dict.romaji, v: specific.dict.mean },
                    { f: forms.polite, j: specific.polite.ex, r: specific.polite.romaji, v: specific.polite.mean },
                    { f: forms.neg, j: specific.neg.ex, r: specific.neg.romaji, v: specific.neg.mean },
                    { f: forms.past, j: specific.past.ex, r: specific.past.romaji, v: specific.past.mean },
                    { f: forms.te, j: specific.te.ex, r: specific.te.romaji, v: specific.te.mean },
                    { f: forms.adv, j: specific.adv.ex, r: specific.adv.romaji, v: specific.adv.mean },
                    { f: forms.noun, j: specific.noun.ex, r: specific.noun.romaji, v: specific.noun.mean }
                ];
            }
            let j_ex = "", v_ex = "";
            if (word.t === "i" || word.t === "ii") { j_ex = `„Åì„ÅÆÊñôÁêÜ„ÅØ${word.k}„Åß„Åô„ÄÇ`; v_ex = `M√≥n n√†y ${word.m}.`; } 
            else { j_ex = `ÂΩº„ÅØ${word.k}„Åß„Åô„ÄÇ`; v_ex = `Anh ·∫•y ${word.m}.`; }
            return [
                { f: forms.dict, j: `${word.k}„ÄÇ`, r: `${word.h}.`, v: `(T·ª´ ƒëi·ªÉn) ${word.m}.` },
                { f: forms.polite, j: j_ex, r: `... ${forms.polite}`, v: `(L·ªãch s·ª±) ...` },
                { f: forms.neg, j: `ÂÖ®ÁÑ∂${forms.neg}`, r: `Zenzen ${forms.neg}`, v: `Ho√†n to√†n kh√¥ng ${word.m}.` },
                { f: forms.past, j: `Êòî„ÅØ${forms.past}`, r: `Mukashi wa ${forms.past}`, v: `Ng√†y x∆∞a ƒë√£ ${word.m}.` },
                { f: forms.te, j: `${forms.te}„ÄÅ„ÅÑ„ÅÑ„Åß„Åô„Å≠„ÄÇ`, r: `${forms.te}, ii desu ne.`, v: `${word.m} n√™n t·ªët nh·ªâ.` },
                { f: forms.adv, j: `${forms.adv}„Å™„Çä„Åæ„Åó„Åü„ÄÇ`, r: `${forms.adv} narimashita.`, v: `ƒê√£ tr·ªü n√™n ${word.m}.` },
                { f: forms.noun, j: `${forms.noun.split('+')[0]}‰∫∫„ÄÇ`, r: `... hito.`, v: `Ng∆∞·ªùi ${word.m} (B·ªï nghƒ©a).` }
            ];
        }

        // --- APP LOGIC ---
        let allWords = [];
        const colorMap = { blue: "bg-blue-100 border-blue-400 text-blue-800", green: "bg-green-100 border-green-400 text-green-800", yellow: "bg-yellow-100 border-yellow-400 text-yellow-800", orange: "bg-orange-100 border-orange-400 text-orange-800", teal: "bg-teal-100 border-teal-400 text-teal-800", pink: "bg-pink-100 border-pink-400 text-pink-800", indigo: "bg-indigo-100 border-indigo-400 text-indigo-800", purple: "bg-purple-100 border-purple-400 text-purple-800", gray: "bg-gray-100 border-gray-400 text-gray-800" };
        const btnColorMap = { blue: "bg-blue-500 hover:bg-blue-600", green: "bg-green-500 hover:bg-green-600", yellow: "bg-yellow-500 hover:bg-yellow-600", orange: "bg-orange-500 hover:bg-orange-600", teal: "bg-teal-500 hover:bg-teal-600", pink: "bg-pink-500 hover:bg-pink-600", indigo: "bg-indigo-500 hover:bg-indigo-600", purple: "bg-purple-500 hover:bg-purple-600", gray: "bg-gray-500 hover:bg-gray-600" };

        function renderContent() {
            const container = document.getElementById("content-area");
            container.innerHTML = "";
            groupsConfig.forEach(group => {
                const groupDiv = document.createElement("div");
                groupDiv.className = "bg-white rounded-lg shadow-md overflow-hidden mb-8";
                groupDiv.innerHTML = `<div class="${colorMap[group.color]} px-6 py-4 border-l-8 font-bold text-xl flex justify-between items-center"><span>${group.title}</span></div>`;
                const grid = document.createElement("div");
                grid.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6";
                group.ids.forEach(kanji => {
                    const word = adjectives.find(w => w.k === kanji);
                    if(!word) return;
                    allWords.push(word);
                    const wordStr = encodeURIComponent(JSON.stringify(word));
                    const typeBadge = word.t === 'i' || word.t === 'ii' ? '<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-2">ƒêu√¥i i</span>' : '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">ƒêu√¥i na</span>';
                    const card = document.createElement("div");
                    card.className = "border border-gray-200 rounded-xl p-4 hover:shadow-lg transition duration-200 bg-white flex flex-col relative group";
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-2">
                            <div>
                                <div class="text-3xl kanji-font font-bold text-green-600 cursor-pointer hover:text-green-500 transition" onclick="showStrokeOrder('${word.k}')" title="B·∫•m ƒë·ªÉ t·∫≠p vi·∫øt">${word.k}</div>
                                <button onclick="showStrokeOrder('${word.k}')" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200 mt-1 mb-1 transition"><i class="fas fa-pen-nib mr-1"></i> T·∫≠p vi·∫øt</button>
                                <div class="text-sm text-gray-500 font-bold">${word.h}</div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="openModal('${wordStr}')" class="bg-gray-100 hover:bg-green-100 text-green-600 p-2 rounded-full w-10 h-10 flex items-center justify-center shadow-sm transition"><i class="fas fa-list-ul"></i></button>
                                <button onclick="speak('${word.k}', '${word.h}')" class="${btnColorMap[group.color]} text-white p-2 rounded-full w-10 h-10 flex items-center justify-center shadow-md focus:outline-none transform active:scale-95 transition"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        <div class="mb-2 flex items-center">${typeBadge}<span class="font-bold text-green-700 text-lg">${word.m}</span></div>
                        <div class="mt-auto bg-green-50 rounded-lg p-3 text-sm space-y-2">
                            <div class="text-gray-700 leading-snug"><span class="font-semibold text-gray-900">üñºÔ∏è H√¨nh:</span> ${word.ti.replace(/\*\*(.*?)\*\*/g, '<span class="text-red-600 font-bold">$1</span>')}</div>
                            <div class="text-gray-700 leading-snug border-t border-green-200 pt-2 mt-2"><span class="font-semibold text-gray-900">üîä √Çm:</span> ${word.ta.replace(/\*\*(.*?)\*\*/g, '<span class="text-blue-600 font-bold">$1</span>')}</div>
                        </div>
                    `;
                    grid.appendChild(card);
                });
                groupDiv.appendChild(grid);
                container.appendChild(groupDiv);
            });
        }

        // --- STROKE ORDER LOGIC ---
        function getKanjiHex(kanji) {
            return kanji.charCodeAt(0).toString(16).padStart(5, '0');
        }

        async function fetchKanjiSvg(hex) {
            const url = `https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${hex}.svg`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Not found');
                return await response.text();
            } catch (e) {
                console.error("Error fetching SVG:", e);
                return null;
            }
        }

        async function showStrokeOrder(kanji) {
            const hex = getKanjiHex(kanji);
            const svgContent = await fetchKanjiSvg(hex);
            
            // Create modal if it doesn't exist (reusing structure from previous examples)
            let modal = document.getElementById('stroke-modal');
            if (!modal) {
                // Create modal dynamically if not present in HTML body
                const modalHtml = `
                <div id="stroke-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" role="dialog" aria-modal="true">
                    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeStrokeModal()"></div>
                        <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full modal-enter relative">
                            <div class="bg-green-600 px-4 py-3 flex justify-between items-center text-white">
                                <h3 class="font-bold text-lg"><i class="fas fa-pen-nib mr-2"></i>T·∫≠p Vi·∫øt Kanji: <span id="stroke-modal-char" class="text-2xl ml-2"></span></h3>
                                <button onclick="closeStrokeModal()" class="hover:text-gray-200"><i class="fas fa-times text-xl"></i></button>
                            </div>
                            <div class="p-6 bg-gray-50 max-h-[80vh] overflow-y-auto">
                                <div class="flex flex-col md:flex-row gap-8 items-start justify-center">
                                    <div class="bg-white p-4 rounded-lg shadow border border-gray-200 text-center">
                                        <p class="text-sm text-gray-500 mb-2 font-bold uppercase">M√¥ ph·ªèng n√©t vi·∫øt</p>
                                        <div id="stroke-animation-container" class="w-40 h-40 mx-auto bg-white border border-gray-300 relative stroke-grid-box"></div>
                                        <button onclick="replayStrokeAnimation()" class="mt-3 text-sm bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200 transition"><i class="fas fa-redo mr-1"></i> Vi·∫øt l·∫°i</button>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-500 mb-3 font-bold uppercase">Th·ª© t·ª± t·ª´ng n√©t</p>
                                        <div id="stroke-grid-container" class="flex flex-wrap gap-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                modal = document.getElementById('stroke-modal');
            }
            
            document.getElementById('stroke-modal').classList.remove('hidden');
            document.getElementById('stroke-modal-char').innerText = kanji;
            
            const animContainer = document.getElementById('stroke-animation-container');
            const gridContainer = document.getElementById('stroke-grid-container');
            
            if (!svgContent) {
                animContainer.innerHTML = "<p class='p-4 text-red-500'>Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</p>";
                gridContainer.innerHTML = "";
                return;
            }

            // 1. Animation Setup
            animContainer.innerHTML = svgContent;
            const mainSvg = animContainer.querySelector('svg');
            mainSvg.setAttribute('width', '100%');
            mainSvg.setAttribute('height', '100%');
            
            const paths = mainSvg.querySelectorAll('path');
            paths.forEach((path) => {
                const length = path.getTotalLength();
                path.style.strokeDasharray = length;
                path.style.strokeDashoffset = length;
                path.style.stroke = "#333";
                path.style.strokeWidth = "4";
                path.style.fill = "none";
                path.style.strokeLinecap = "round";
                path.style.strokeLinejoin = "round";
            });
            
            currentStrokeSvg = mainSvg;
            replayStrokeAnimation();

            // 2. Grid Setup
            gridContainer.innerHTML = '';
            const numStrokes = paths.length;
            
            for (let i = 0; i < numStrokes; i++) {
                const stepBox = document.createElement('div');
                stepBox.className = "w-20 h-20 bg-white border border-gray-200 relative stroke-grid-box flex items-center justify-center";
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgContent, "image/svg+xml");
                const svgClone = doc.querySelector('svg');
                svgClone.setAttribute('width', '100%');
                svgClone.setAttribute('height', '100%');
                
                // Hide numbers in grid view if preferred, or keep them. Jisho keeps them.
                // KanjiVG numbers are in <g id="kvg:StrokeNumbers_...">
                // We'll keep them for clarity but make them subtle.
                
                const clonePaths = svgClone.querySelectorAll('path');
                clonePaths.forEach((p, pIdx) => {
                    p.style.fill = "none";
                    p.style.strokeLinecap = "round";
                    p.style.strokeLinejoin = "round";
                    
                    if (pIdx < i) {
                        p.style.stroke = "#9ca3af"; // Past strokes gray
                        p.style.strokeWidth = "3";
                    } else if (pIdx === i) {
                        p.style.stroke = "#000"; // Current stroke black/bold
                        p.style.strokeWidth = "4";
                    } else {
                        p.style.display = "none"; // Future strokes hidden
                    }
                });
                
                stepBox.appendChild(svgClone);
                gridContainer.appendChild(stepBox);
            }
        }

        let currentStrokeSvg = null;

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            
            paths.forEach(p => {
                p.style.transition = 'none';
                p.style.strokeDashoffset = p.getTotalLength();
            });

            void currentStrokeSvg.offsetWidth; // Trigger reflow

            let delay = 0;
            const duration = 0.5;
            
            paths.forEach((p) => {
                p.style.transition = `stroke-dashoffset ${duration}s ease-in-out ${delay}s`;
                p.style.strokeDashoffset = '0';
                delay += duration;
            });
        }

        function closeStrokeModal() {
            document.getElementById('stroke-modal').classList.add('hidden');
        }

        // --- MODAL LOGIC (CONJUGATION) ---
        function openModal(wordStr) {
            const word = JSON.parse(decodeURIComponent(wordStr));
            const forms = conjugate(word);
            const examples = getExamples(word, forms);
            document.getElementById("modal-kanji").innerText = word.k;
            document.getElementById("modal-hiragana").innerText = word.h;
            document.getElementById("modal-meaning").innerText = word.m;
            document.getElementById("modal-group").innerText = (word.t === 'i' || word.t === 'ii') ? "T√≠nh t·ª´ ƒëu√¥i I" : "T√≠nh t·ª´ ƒëu√¥i NA";
            const btn = document.getElementById("modal-main-audio");
            btn.onclick = () => speak(word.k, word.h);
            const list = document.getElementById("conjugation-list");
            list.innerHTML = "";
            const labels = ["T·ª´ ƒëi·ªÉn", "L·ªãch s·ª± (Desu)", "Ph·ªß ƒë·ªãnh (Kunai/Janai)", "Qu√° kh·ª© (Katta/Datta)", "N·ªëi (Kute/De)", "Ph√≥ t·ª´ (Ku/Ni)", "B·ªï nghƒ©a cho Danh t·ª´"];
            examples.forEach((ex, i) => {
                const row = `
                <div class="bg-white border border-gray-200 rounded-lg p-4 hover:border-green-300 transition">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold uppercase text-gray-400 tracking-wider">${labels[i]}</span>
                        <div class="flex items-center">
                            <span class="text-xl font-bold text-green-700 kanji-font mr-3">${Object.values(forms)[i]}</span>
                            <button onclick="speak('${Object.values(forms)[i]}', '')" class="text-green-400 hover:text-green-600 bg-green-50 hover:bg-green-100 rounded-full w-8 h-8 flex items-center justify-center transition"><i class="fas fa-volume-up text-sm"></i></button>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded p-3 text-sm relative group">
                        <div class="font-bold text-gray-800 kanji-font mb-1 text-lg">${ex.j}</div>
                        <div class="text-gray-500 text-xs italic mb-1">${ex.r}</div>
                        <div class="text-gray-700">${ex.v}</div>
                        <button onclick="speak('${ex.j}', '')" class="absolute top-2 right-2 text-green-400 hover:text-green-600 bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-sm"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>`;
                list.innerHTML += row;
            });
            document.getElementById("conjugation-modal").classList.remove("hidden");
        }

        function closeModal() { document.getElementById("conjugation-modal").classList.add("hidden"); }
        function openGrammarModal() { document.getElementById("grammar-modal").classList.remove("hidden"); }
        function closeGrammarModal() { document.getElementById("grammar-modal").classList.add("hidden"); }
        
        function switchTab(m) {
            document.getElementById("learn-section").classList.toggle("hidden", m!=="learn");
            document.getElementById("quiz-section").classList.toggle("hidden", m!=="quiz");
            document.getElementById("tab-learn").className = m==="learn" ? "px-4 py-2 rounded-md text-sm font-bold transition bg-white text-green-900 shadow whitespace-nowrap" : "px-4 py-2 rounded-md text-sm font-bold transition text-green-200 whitespace-nowrap";
            document.getElementById("tab-quiz").className = m==="quiz" ? "px-4 py-2 rounded-md text-sm font-bold transition bg-white text-green-900 shadow whitespace-nowrap" : "px-4 py-2 rounded-md text-sm font-bold transition text-green-200 whitespace-nowrap";
            if(m==="quiz") nextQuestion();
        }

        let currentQ = null, score = 0;
        function nextQuestion() {
            document.getElementById("feedback-area").classList.add("hidden");
            document.getElementById("btn-check").classList.remove("hidden");
            document.getElementById("btn-next").classList.add("hidden");
            document.getElementById("quiz-input").value = "";
            document.getElementById("quiz-input").disabled = false;
            document.getElementById("quiz-input").focus();
            
            const uniqueWords = Array.from(new Set(allWords.map(a => a.k))).map(k => allWords.find(a => a.k === k));
            currentQ = uniqueWords[Math.floor(Math.random() * uniqueWords.length)];
            
            document.getElementById("quiz-kanji").innerText = currentQ.k;
            document.getElementById("quiz-meaning").innerText = currentQ.m;
            document.getElementById("quiz-kanji").className = "text-6xl kanji-font font-bold text-gray-800 mb-4 transition-all";
        }

        function checkAnswer() {
            const val = document.getElementById("quiz-input").value.trim();
            if(!val) return;
            document.getElementById("quiz-input").disabled = true;
            const correct = val === currentQ.h;
            const k = document.getElementById("quiz-kanji");
            if(correct) {
                score+=10; k.className = "text-6xl kanji-font font-bold text-green-600 mb-4 transition-all correct-anim";
                document.getElementById("feedback-title").innerHTML = '<i class="fas fa-check-circle text-green-600 mr-2"></i> Ch√≠nh x√°c!';
                document.getElementById("feedback-title").className = "font-bold text-lg mb-2 flex items-center text-green-700";
            } else {
                score=Math.max(0, score-5); k.className = "text-6xl kanji-font font-bold text-red-600 mb-4 transition-all wrong-anim";
                document.getElementById("feedback-title").innerHTML = '<i class="fas fa-times-circle text-red-600 mr-2"></i> Sai r·ªìi!';
                document.getElementById("feedback-title").className = "font-bold text-lg mb-2 flex items-center text-red-700";
            }
            document.getElementById("score-display").innerText = score;
            document.getElementById("correct-answer").innerText = currentQ.h;
            document.getElementById("quiz-tip-img").innerHTML = `<span class="font-bold text-gray-700">üñºÔ∏è H√¨nh:</span> ` + currentQ.ti.replace(/\*\*(.*?)\*\*/g, '<span class="text-red-600 font-bold">$1</span>');
            document.getElementById("quiz-tip-sound").innerHTML = `<span class="font-bold text-gray-700">üîä √Çm:</span> ` + currentQ.ta.replace(/\*\*(.*?)\*\*/g, '<span class="text-blue-600 font-bold">$1</span>');
            
            document.getElementById("feedback-area").classList.remove("hidden");
            document.getElementById("btn-check").classList.add("hidden");
            document.getElementById("btn-next").classList.remove("hidden");
            document.getElementById("btn-next").focus();
        }

        function playCurrentAudio() { if(currentQ) speak(currentQ.k, currentQ.h); }
        function speak(t, h) {
            if('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(t);
                u.lang = 'ja-JP'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }
        document.getElementById("quiz-input").addEventListener("keypress", function(e) { if(e.key==="Enter") checkAnswer(); });
        document.addEventListener('DOMContentLoaded', renderContent);
    </script>
</body>
</html>
