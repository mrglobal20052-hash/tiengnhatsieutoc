<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AzaKanji - Master Hub & 214 B·ªô Th·ªß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #f0f9ff; overflow-x: hidden; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .tab-active { background-color: #0369a1; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-inactive { background-color: #e0f2fe; color: #0c4a6e; }

        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); }
        
        /* Dashboard Styling */
        .day-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #e0f2fe; }
        .day-card:hover { transform: translateY(-5px); border-color: #0ea5e9; box-shadow: 0 12px 20px -5px rgba(14, 165, 233, 0.15); }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-sky-700 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <!-- Standardized Logo, Title and Slogan -->
                <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                    <i class="fas fa-torii-gate text-3xl text-yellow-400"></i>
                    <div>
                        <h1 class="text-xl font-bold uppercase tracking-wider leading-none">AZAKANJI</h1>
                        <p class="text-xs text-sky-200 mt-1">Kanji si√™u t·ªëc, h·ªçc r·ªông hi·ªÉu s√¢u</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 overflow-x-auto max-w-full pb-1 md:pb-0">
                    <div class="flex bg-sky-800 rounded-lg p-1">
                        <button onclick="switchView('dashboard')" id="tab-dashboard" class="px-4 py-2 rounded-md text-sm font-bold transition whitespace-nowrap tab-active">
                            <i class="fas fa-th-large mr-2"></i>L·ªô Tr√¨nh 24 Ng√†y
                        </button>
                        <button onclick="switchView('radicals')" id="tab-radicals" class="px-4 py-2 rounded-md text-sm font-bold transition whitespace-nowrap tab-inactive ml-1">
                            <i class="fas fa-shapes mr-2"></i>214 B·ªô Th·ªß
                        </button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="px-4 py-2 rounded-md text-sm font-bold transition whitespace-nowrap tab-inactive ml-1">
                            <i class="fas fa-gamepad mr-2"></i>Ki·ªÉm Tra
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Global Search Hub -->
    <div class="bg-white/90 backdrop-blur-md shadow-sm sticky top-[64px] z-30 border-b border-sky-100">
        <div class="container mx-auto px-4 py-4">
            <div class="relative max-w-2xl mx-auto">
                <input type="text" id="global-search" placeholder="G√µ Kanji, B·ªô th·ªß, Nghƒ©a ho·∫∑c √Çm ƒë·ªçc b·∫•t k·ª≥..." class="w-full pl-12 pr-4 py-3 rounded-2xl border-2 border-sky-100 focus:outline-none focus:ring-4 focus:ring-sky-200 focus:border-sky-400 bg-sky-50/30 text-lg transition-all">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-sky-400 text-xl"></i>
                
                <!-- Search Suggestions / Results -->
                <div id="search-results-overlay" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-sky-100 p-4 max-h-[60vh] overflow-y-auto fade-in">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 flex-grow" id="app-container">
        
        <!-- DASHBOARD SECTION (Menu 24 ng√†y) -->
        <div id="dashboard-section" class="fade-in">
            <div class="mb-8 bg-white p-5 rounded-2xl shadow-sm border-l-4 border-sky-500">
                <h3 class="text-xl font-bold text-gray-800">L·ªô tr√¨nh 24 ng√†y chinh ph·ª•c Kanji</h3>
                <p class="text-sm text-gray-600 mt-1">H·ªá th·ªëng b√†i h·ªçc h·ªôi tho·∫°i, ng·ªØ ph√°p v√† 80 ch·ªØ Kanji m·ªói ng√†y theo ti√™u chu·∫©n cao c·∫•p.</p>
            </div>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4" id="days-menu">
                <!-- Day cards generated by JS -->
            </div>
        </div>

        <!-- RADICALS SECTION -->
        <div id="learn-section" class="hidden fade-in">
            <div class="mb-6 bg-white p-4 rounded-xl shadow-sm border-l-4 border-sky-500">
                <h3 class="text-lg font-bold text-gray-800">214 B·ªô Th·ªß H√°n T·ª±</h3>
                <p class="text-sm text-gray-600">G·ªëc r·ªÖ gi√∫p ghi nh·ªõ Kanji b·ªÅn v·ªØng qua ph∆∞∆°ng ph√°p chi·∫øt t·ª±.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="kanji-grid">
                <!-- 214 cards -->
            </div>
        </div>

        <!-- QUIZ SECTION -->
        <div id="quiz-section" class="hidden fade-in max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                <div class="bg-gradient-to-r from-sky-600 to-indigo-600 p-6 text-white flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-bold">Th·ª≠ Th√°ch Ph·∫£n X·∫°</h2>
                        <p class="text-sky-100 text-xs mt-1">√în t·∫≠p 214 b·ªô th·ªß</p>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-sky-200 uppercase font-bold">ƒêi·ªÉm s·ªë</div>
                        <div class="text-3xl font-bold" id="score-display">0</div>
                    </div>
                </div>
                <div class="p-6 md:p-8">
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                        <div id="quiz-progress" class="bg-sky-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div id="question-area" class="text-center mb-8">
                        <div class="text-gray-500 text-sm font-bold mb-4">C√¢u h·ªèi <span id="q-current">1</span> / 10</div>
                        <div class="mb-4"><span class="text-7xl kanji-font font-bold text-gray-800" id="quiz-kanji-display"></span></div>
                        <div class="text-lg text-gray-600 font-medium" id="quiz-question-text">B·ªô th·ªß n√†y c√≥ nghƒ©a l√† g√¨?</div>
                    </div>
                    <div id="options-area" class="grid grid-cols-2 gap-4 mb-6"></div>
                    <div id="feedback-area" class="hidden bg-gray-50 rounded-xl p-4 border border-gray-200 text-left animate-fade-in">
                        <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                        <p id="feedback-detail" class="text-gray-600 text-sm mb-3"></p>
                        <button onclick="nextQuestion()" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 rounded-lg shadow transition">Ti·∫øp t·ª•c</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- STROKE ORDER MODAL -->
    <div id="stroke-modal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm" onclick="closeStrokeModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl w-full modal-enter relative">
                <div class="bg-sky-600 px-4 py-3 flex justify-between items-center text-white">
                    <h3 class="font-bold text-lg"><i class="fas fa-pen-nib mr-2"></i>T·∫≠p Vi·∫øt: <span id="stroke-modal-char" class="text-2xl ml-2 font-bold"></span></h3>
                    <button onclick="closeStrokeModal()" class="hover:text-gray-200 p-2"><i class="fas fa-times text-xl"></i></button>
                </div>
                <div class="p-4 md:p-6 bg-gray-50 max-h-[80vh] overflow-y-auto">
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div class="bg-white p-4 rounded-lg shadow border border-gray-200 text-center w-full md:w-auto">
                            <div id="stroke-animation-container" class="w-40 h-40 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center"></div>
                            <button onclick="replayStrokeAnimation()" class="mt-3 text-sm bg-sky-100 text-sky-700 px-4 py-2 rounded font-bold w-full">Vi·∫øt l·∫°i</button>
                        </div>
                        <div class="flex-1 w-full" id="stroke-grid-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- MASTER DATA ---
        const radicalsData = [
            { id: 1, char: "‰∏Ä", h: "NH·∫§T", v: "M·ªôt", on: "„Ç§„ÉÅ", kun: "„Å≤„Å®", ti: "M·ªôt n√©t ngang (**Nh·∫•t ‰∏Ä**) ƒë∆°n gi·∫£n.", ta: "**Y chi** (Ichi) chi·∫øc ƒë≈©a cho **H√≠ T√¥** (Hito)." },
            { id: 2, char: "‰∏®", h: "C·ªîN", v: "N√©t s·ªï", on: "„Ç≥„É≥", kun: "„Åü„Å¶", ti: "M·ªôt n√©t th·∫≥ng ƒë·ª©ng (**C·ªïn ‰∏®**) xuy√™n qua t√¢m.", ta: "**C√¥n** (Kon) ƒë·ªì c·∫ßm c√¢y **Ta T√™** (Tate) th·∫≥ng ƒë·ª©ng." },
            { id: 3, char: "‰∏∂", h: "CH·ª¶", v: "ƒêi·ªÉm", on: "„Ç∑„É•", kun: "„Å°„Çá„Åº", ti: "M·ªôt d·∫•u ch·∫•m (**Ch·ªß ‰∏∂**) nh·ªè quan tr·ªçng.", ta: "**Su** (Shu) h√†o r∆°i m·ªôt **Ch√¥ B√¥** (Chobo) ch·∫•m nh·ªè." },
            { id: 9, char: "‰∫∫", h: "NH√ÇN", v: "Ng∆∞·ªùi", on: "„Ç∏„É≥", kun: "„Å≤„Å®", ti: "H√¨nh d√°ng m·ªôt con ng∆∞·ªùi (**Nh√¢n ‰∫∫**) ƒëang b∆∞·ªõc ƒëi.", ta: "**Jin** (Jin) l√† ng∆∞·ªùi **H√≠ T√¥** (Hito)." },
            { id: 61, char: "ÂøÉ", h: "T√ÇM", v: "Tim", on: "„Ç∑„É≥", kun: "„Åì„Åì„Çç", ti: "H√¨nh tr√°i tim (**T√¢m ÂøÉ**) c√≥ c√°c ngƒÉn.", ta: "**Xin** (Shin) tr√°i tim **C√¥ C√¥ R√¥** (Kokoro)." },
            { id: 140, char: "Ëâπ", h: "TH·∫¢O", v: "C·ªè", on: "„ÇΩ„Ç¶", kun: "„Åè„Åï", ti: "Hai m·∫ßm c√¢y (**Th·∫£o Ëâπ**) m·ªçc t·ª´ ƒë·∫•t.", ta: "**X√¥** (Sou) ch·∫≠u ƒë·∫ßy c·ªè **C∆∞ Xa** (Kusa)." },
            { id: 149, char: "Ë®Ä", h: "NG√îN", v: "N√≥i", on: "„Ç≤„É≥", kun: "„ÅÑ", ti: "M·ªìm (**Kh·∫©u Âè£**) ph√°t ra nƒÉm (**Ng≈© ‰∫î**) l·ªùi n√≥i (**Ng√¥n Ë®Ä**).", ta: "**Ghen** (Gen) t·ªã v√¨ l·ªùi n√≥i **I** (I) h·ªát nhau." },
            { id: 173, char: "Èõ®", h: "V≈®", v: "M∆∞a", on: "„Ç¶", kun: "„ÅÇ„ÇÅ", ti: "N∆∞·ªõc (**Th·ªßy Ê∞µ**) r∆°i t·ª´ tr·ªùi qua c·ª≠a s·ªï (**V≈© Èõ®**).", ta: "**U** (U) s·∫ßu v√¨ m∆∞a **A M√™** (Ame)." },
            { id: 212, char: "Èæç", h: "LONG", v: "R·ªìng", on: "„É™„É•„Ç¶", kun: "„Åü„Å§", ti: "Con r·ªìng (**Long Èæç**) bay l∆∞·ª£n tr√™n m√¢y.", ta: "**Riu** (Ryuu) riu r·ªìng **Ta T∆∞** (Tatsu)." },
            { id: 214, char: "Èæ†", h: "D∆Ø·ª¢C", v: "S√°o", on: "„É§„ÇØ", kun: "fue", ti: "·ªêng s√°o (**D∆∞·ª£c Èæ†**) nhi·ªÅu l·ªó √¢m vang.", ta: "**D·∫° C∆∞** (Yaku) th·ªïi **Phu √ä** (Fue)." }
            // L∆∞u √Ω: Th√™m ƒë·∫ßy ƒë·ªß 214 b·ªô th·ªß t∆∞∆°ng ·ª©ng...
        ];

        const globalKanjiIndex = [
            { char: "Á©çÊ•µÏ†Å", day: 23, hv: "T√≠ch C·ª±c ƒê√≠ch", mean: "T√≠ch c·ª±c" },
            { char: "ÂÅ•Â∫∑", day: 23, hv: "Ki·ªán Khang", mean: "S·ª©c kh·ªèe" },
            { char: "ÁµêÂ©ö", day: 20, hv: "K·∫øt H√¥n", mean: "L·ªÖ c∆∞·ªõi" },
            { char: "ÂÖàÁîü", day: 1, hv: "Ti√™n Sinh", mean: "Th·∫ßy gi√°o" }
        ];

        // --- CORE UI LOGIC ---
        function switchView(view) {
            document.getElementById('dashboard-section').classList.toggle('hidden', view !== 'dashboard');
            document.getElementById('learn-section').classList.toggle('hidden', view !== 'radicals');
            document.getElementById('quiz-section').classList.add('hidden');
            
            document.getElementById('tab-dashboard').className = `px-4 py-2 rounded-md text-sm font-bold transition ${view === 'dashboard' ? 'tab-active' : 'tab-inactive'}`;
            document.getElementById('tab-radicals').className = `px-4 py-2 rounded-md text-sm font-bold transition ${view === 'radicals' ? 'tab-active' : 'tab-inactive'} ml-1`;
            document.getElementById('tab-quiz').className = `px-4 py-2 rounded-md text-sm font-bold transition tab-inactive ml-1`;
        }

        function switchTab(tab) {
            if (tab === 'quiz') {
                document.getElementById('dashboard-section').classList.add('hidden');
                document.getElementById('learn-section').classList.add('hidden');
                document.getElementById('quiz-section').classList.remove('hidden');
                document.getElementById('tab-dashboard').className = "px-4 py-2 rounded-md text-sm font-bold transition tab-inactive";
                document.getElementById('tab-radicals').className = "px-4 py-2 rounded-md text-sm font-bold transition tab-inactive ml-1";
                document.getElementById('tab-quiz').className = "px-4 py-2 rounded-md text-sm font-bold transition tab-active ml-1";
                startQuiz();
            }
        }

        // --- DASHBOARD RENDER (Simplified) ---
        function renderDashboard() {
            const menu = document.getElementById('days-menu');
            let html = '';
            for (let i = 1; i <= 24; i++) {
                html += `
                    <a href="https://tiengnhatsieutoc.com/kanji${i}.html" target="_blank" class="day-card bg-white p-6 rounded-2xl text-center shadow-sm flex flex-col items-center justify-center gap-3 group">
                        <div class="w-14 h-14 rounded-full bg-sky-100 text-sky-600 flex items-center justify-center font-black group-hover:bg-sky-600 group-hover:text-white transition-all text-lg shadow-inner">
                            ${i}
                        </div>
                        <div class="text-sm font-black text-sky-900 group-hover:text-sky-600 transition-colors uppercase tracking-wide">Ng√†y ${i}</div>
                    </a>
                `;
            }
            menu.innerHTML = html;
        }

        // --- GLOBAL SEARCH HUB LOGIC ---
        document.getElementById('global-search').addEventListener('input', (e) => {
            const val = e.target.value.trim().toLowerCase();
            const resultsBox = document.getElementById('search-results-overlay');
            
            if (!val) {
                resultsBox.classList.add('hidden');
                renderRadicals(radicalsData);
                return;
            }

            const filteredRadicals = radicalsData.filter(r => 
                r.char.includes(val) || r.h.toLowerCase().includes(val) || r.v.toLowerCase().includes(val)
            );
            renderRadicals(filteredRadicals);

            const foundKanji = globalKanjiIndex.filter(k => 
                k.char.includes(val) || k.hv.toLowerCase().includes(val) || k.mean.toLowerCase().includes(val)
            );

            if (foundKanji.length > 0) {
                resultsBox.classList.remove('hidden');
                resultsBox.innerHTML = `
                    <div class="mb-3 text-[10px] font-black text-sky-500 uppercase tracking-widest border-b border-sky-100 pb-2">K·∫æT QU·∫¢ T·ª™ L·ªò TR√åNH 24 NG√ÄY:</div>
                    <div class="grid gap-2">
                        ${foundKanji.map(k => `
                            <a href="https://tiengnhatsieutoc.com/kanji${k.day}.html" target="_blank" class="flex items-center justify-between p-3 bg-sky-50 rounded-xl hover:bg-sky-100 transition border border-sky-100">
                                <div class="flex items-center gap-4">
                                    <span class="text-3xl kanji-font font-bold text-gray-800">${k.char}</span>
                                    <div>
                                        <div class="text-sm font-bold text-gray-700">${k.hv} - ${k.mean}</div>
                                        <div class="text-[10px] text-sky-600 font-bold uppercase">Ngu·ªìn: B√†i h·ªçc Ng√†y ${k.day}</div>
                                    </div>
                                </div>
                                <i class="fas fa-external-link-alt text-sky-300 text-xs"></i>
                            </a>
                        `).join('')}
                    </div>
                `;
            } else {
                resultsBox.classList.add('hidden');
            }
        });

        // --- RENDER RADICALS ---
        function renderRadicals(data) {
            const grid = document.getElementById('kanji-grid');
            grid.innerHTML = data.map((k) => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition duration-300 flex flex-col group fade-in">
                    <div class="bg-sky-50 p-4 border-b border-sky-100 flex justify-between items-start">
                        <div class="flex gap-4 items-center">
                            <div class="w-14 h-14 bg-white rounded-lg flex items-center justify-center border-2 border-sky-200 cursor-pointer hover:border-sky-400 transition" onclick="showStrokeOrder('${k.char}')">
                                <span class="text-3xl font-bold kanji-font text-gray-800">${k.char}</span>
                            </div>
                            <div>
                                <div class="text-red-600 font-bold text-lg">${k.h}</div>
                                <div class="text-gray-500 text-[10px] font-bold uppercase">${k.v}</div>
                            </div>
                        </div>
                        <button onclick="showStrokeOrder('${k.char}')" class="text-sky-500 hover:text-sky-700 bg-white rounded-full p-2 w-8 h-8 flex items-center justify-center shadow-sm border border-sky-100"><i class="fas fa-pen-nib text-xs"></i></button>
                    </div>
                    
                    <div class="p-4 space-y-3 z-10 flex-grow flex flex-col">
                        <div class="grid grid-cols-2 gap-2 text-sm text-center">
                            <div class="bg-gray-50 rounded p-2 border border-gray-100 relative group/on">
                                <span class="text-[9px] uppercase font-bold text-gray-400">On</span><br>
                                <span class="font-bold text-sky-800">${k.on}</span>
                                <button onclick="speak('${k.on}')" class="absolute -top-1 -right-1 bg-white shadow-sm w-5 h-5 rounded-full text-sky-500 text-[10px] opacity-0 group-hover/on:opacity-100 transition"><i class="fas fa-volume-up"></i></button>
                            </div>
                            <div class="bg-gray-50 rounded p-2 border border-gray-100 relative group/kun">
                                <span class="text-[9px] uppercase font-bold text-gray-400">Kun</span><br>
                                <span class="font-bold text-sky-800">${k.kun}</span>
                                <button onclick="speak('${k.kun}')" class="absolute -top-1 -right-1 bg-white shadow-sm w-5 h-5 rounded-full text-sky-500 text-[10px] opacity-0 group-hover/kun:opacity-100 transition"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="bg-orange-50 p-2 rounded text-[11px] text-orange-900 border border-orange-100">
                                <span class="font-bold text-orange-600 mr-1">üñºÔ∏è H√¨nh:</span> ${k.ti.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-red-600">$1</span>')}
                            </div>
                            <div class="bg-blue-50 p-2 rounded text-[11px] text-blue-900 border border-blue-100">
                                <span class="font-bold text-blue-600 mr-1">üîä √Çm:</span> ${k.ta.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-blue-700">$1</span>')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function showStrokeOrder(kanji) {
            const hex = kanji.charCodeAt(0).toString(16).padStart(5, '0');
            document.getElementById('stroke-modal').classList.remove('hidden');
            document.getElementById('stroke-modal-char').innerText = kanji;
            const animContainer = document.getElementById('stroke-animation-container');
            const gridContainer = document.getElementById('stroke-grid-container');
            animContainer.innerHTML = '<span class="text-xs text-gray-400">Agkarga...</span>';
            const response = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${hex}.svg`);
            const svgContent = await response.text();
            animContainer.innerHTML = svgContent;
            const mainSvg = animContainer.querySelector('svg');
            const paths = mainSvg.querySelectorAll('path');
            paths.forEach(p => { 
                const len = p.getTotalLength(); p.style.strokeDasharray = len; p.style.strokeDashoffset = len; 
                p.style.stroke = "#333"; p.style.strokeWidth = "4"; p.style.fill = "none";
            });
            currentStrokeSvg = mainSvg; replayStrokeAnimation();
            
            gridContainer.innerHTML = `<div class="flex flex-wrap gap-2 justify-center"></div>`;
            const wrapper = gridContainer.querySelector('div');
            for(let i=0; i<paths.length; i++) {
                const box = document.createElement('div');
                box.className = "w-10 h-10 bg-white border border-gray-200 relative stroke-grid-box flex items-center justify-center";
                const parser = new DOMParser();
                const svgClone = parser.parseFromString(svgContent, "image/svg+xml").querySelector('svg');
                svgClone.setAttribute('width', '100%'); svgClone.setAttribute('height', '100%');
                svgClone.querySelectorAll('path').forEach((p, idx) => {
                    p.style.fill="none";
                    if(idx < i) { p.style.stroke="#9ca3af"; p.style.strokeWidth="2"; }
                    else if(idx === i) { p.style.stroke="#000"; p.style.strokeWidth="4"; }
                    else p.style.display="none";
                });
                box.appendChild(svgClone); wrapper.appendChild(box);
            }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition = 'none'; p.style.strokeDashoffset = p.getTotalLength(); });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out ${delay}s`; p.style.strokeDashoffset = '0'; delay += 0.6; });
        }

        function closeStrokeModal() { document.getElementById('stroke-modal').classList.add('hidden'); }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text.replace(/-/g, ''));
                u.lang = 'ja-JP'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        // --- QUIZ LOGIC (Simplied for Hub) ---
        function startQuiz() { quizScore = 0; currentQuizIndex = 0; document.getElementById('score-display').innerText = '0'; loadQuestion(); }
        function loadQuestion() {
            const q = radicalsData[Math.floor(Math.random() * radicalsData.length)];
            currentQuizQ = q; document.getElementById('q-current').innerText = currentQuizIndex + 1;
            document.getElementById('quiz-kanji-display').innerText = q.char;
            const others = radicalsData.filter(x => x !== q).sort(() => 0.5 - Math.random()).slice(0, 3);
            const opts = [q, ...others].sort(() => 0.5 - Math.random());
            document.getElementById('options-area').innerHTML = opts.map(o => `<button onclick="checkAnswer('${o.char}')" class="bg-white border-2 border-gray-200 py-3 rounded-xl text-sm font-bold hover:border-sky-400 hover:bg-sky-50 transition shadow-sm">${o.h} (${o.v})</button>`).join('');
            document.getElementById('feedback-area').classList.add('hidden');
            document.getElementById('quiz-progress').style.width = `${(currentQuizIndex / 10) * 100}%`;
        }
        function checkAnswer(sel) {
            const ok = sel === currentQuizQ.char; const fb = document.getElementById('feedback-area');
            fb.classList.remove('hidden');
            if (ok) {
                quizScore += 10; document.getElementById('score-display').innerText = quizScore;
                document.getElementById('feedback-title').innerHTML = 'Ch√≠nh x√°c!';
                speak(currentQuizQ.char);
            } else {
                document.getElementById('feedback-title').innerHTML = 'Sai r·ªìi!';
            }
            document.getElementById('feedback-detail').innerText = `B·ªô: ${currentQuizQ.char} | ${currentQuizQ.h} (${currentQuizQ.v})`;
        }
        function nextQuestion() { currentQuizIndex++; if (currentQuizIndex >= 10) { alert(`Xong! ƒêi·ªÉm: ${quizScore}`); startQuiz(); } else loadQuestion(); }

        window.onload = () => { renderDashboard(); renderRadicals(radicalsData); };
    </script>
</body>
</html>
