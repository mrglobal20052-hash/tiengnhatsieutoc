<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 16: Mục đích & Bị động</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; overflow-y: auto; }
        .scroller::-webkit-scrollbar { width: 5px; height: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        .vocab-item { transition: all 0.2s; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; padding-left: 0.75rem; }
        
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .shadow-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .wrong-anim { animation: shake 0.3s ease-in-out; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .correct-anim { animation: pop 0.3s ease-in-out; }

        /* Stroke Order Styles */
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); pointer-events: none; }
        
        /* Hide stroke paths initially */
        #strokeAnimContainer svg path { opacity: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Ngày 16: Mục đích & Bị động</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2 whitespace-nowrap"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <!-- DESKTOP SIDEBAR -->
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-9 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm outline-none">
                </div>
            </div>
            <div id="vocabList" class="flex-1 scroller p-2 space-y-1"></div>
        </aside>

        <!-- MAIN CONTENT (LEARN MODE) -->
        <main id="learn-section" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center animate-fade-in">
                <!-- Flashcard -->
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60 transition-transform group-hover:scale-110 duration-700"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100">
                            <span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span>
                            <div class="w-px h-3 bg-gray-300"></div>
                            <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                        </div>
                        <div class="relative inline-block mb-2">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">測る</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết">
                                <i class="fas fa-pen-nib text-sm"></i>
                            </button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                            <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">はかる</span>
                            <span id="cardMeaning" class="text-lg text-gray-500 font-medium">Đo, cân</span>
                        </div>
                    </div>
                </div>

                <!-- Shadowing Sentences -->
                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1">
                        <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg text-sm"><i class="fas fa-comments"></i></div>
                        <h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3>
                    </div>
                    <div id="sentenceList" class="space-y-4"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400">
                        <i class="fas fa-comment-dots text-4xl mb-2 text-gray-300"></i>
                        <p class="text-sm">Chưa có hội thoại mẫu cho từ này.</p>
                        <p class="text-xs text-gray-300 mt-1">(Dữ liệu đang cập nhật)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- QUIZ MODE -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10 bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                            <div class="text-[10px] text-indigo-100 uppercase font-bold tracking-wider">Điểm số</div>
                            <div class="text-3xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8 relative">
                            <div class="text-xs text-gray-400 mb-2 uppercase font-bold tracking-widest">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 outline-none transition-all ja-text placeholder:text-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in shadow-inner">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-3 py-1 bg-white border border-indigo-100 rounded-lg ja-text shadow-sm"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200 border border-transparent hover:border-gray-300"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                <i class="fas fa-check"></i> Kiểm Tra
                            </button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">
                                Câu Tiếp Theo <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM BAR -->
        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2 active:scale-95 transition active:bg-indigo-700">
                <i class="fas fa-list-ul"></i> Danh Sách
            </button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 active:scale-95 transition">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- MODAL: GRAMMAR LIST -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-sm"><i class="fas fa-book"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3>
                        <p class="text-xs text-gray-500">Thư viện ngữ pháp Day 16 (N4 - N3)</p>
                    </div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg hover:bg-gray-700">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL: GRAMMAR DETAIL -->
    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3>
                </div>
                <button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4 shadow-sm">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code>
                </div>
                <div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-3 leading-relaxed"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: KANJI STROKE -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg cursor-pointer" onclick="replayStrokeAnimation()"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm z-10"><i class="fas fa-redo text-sm"></i></button>
                            <p class="text-[10px] text-gray-400 mt-2">Nhấn vào ô để chạy lại</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-left">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider text-center">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center"></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1 leading-none"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block mt-2" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1"><i class="fas fa-layer-group mr-1"></i> Bộ thủ (Thành phần)</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <!-- On/Kun -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayOn').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600 ja-text" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-300 group-hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center group cursor-pointer" onclick="document.getElementById('btnPlayKun').click()"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600 ja-text" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-300 group-hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <!-- Tips -->
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4>
                                    <p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <p class="text-sm text-orange-700" id="detailTipSound"></p>
                                </div>
                            </div>
                            <!-- Related Words -->
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-3 opacity-30"></i><p class="text-sm">Chưa có dữ liệu chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GRAMMAR REPO (N4 - N3) ---
        const grammarRepo = {
            "te_iru_habit": { title: "Thường xuyên (Thói quen)", formula: "Vて + います", desc: "N4: Diễn tả hành động lặp đi lặp lại như một thói quen.", ex: "毎朝、ジョギングをしています。" },
            "tame_ni": { title: "Để/Cho vì (Mục đích)", formula: "Vる/Nの + ために", desc: "N4: Chỉ mục đích của hành động.", ex: "健康のために運動します。" },
            "no_ni_use": { title: "Để (Công dụng)", formula: "Vる/N + のに + 使います...", desc: "N4: Chỉ mục đích sử dụng của vật/công cụ.", ex: "このはさみは花を切るのに使います。" },
            "mo_quantity": { title: "Những/Tận (Nhấn mạnh)", formula: "Số lượng + も", desc: "N4: Nhấn mạnh số lượng nhiều hơn bình thường.", ex: "駅まで1時間もかかりました。" },
            "passive": { title: "Thể bị động", formula: "Vられる", desc: "N4: Chủ ngữ chịu tác động của hành động.", ex: "先生に褒められました。" },
            "ni_yotte_passive": { title: "Bởi (Tác giả)", formula: "N + によって + V(bị động)", desc: "N3: Chỉ người phát minh, sáng tác, tạo ra (dùng trong câu bị động).", ex: "この絵はピカソによって描かれました。" },
            "tochuu_de": { title: "Giữa đường/Trong khi", formula: "Vる/Nの + 途中で", desc: "N4: Hành động xảy ra khi đang làm việc khác hoặc đang di chuyển.", ex: "帰る途中で雨が降りました。" },
            "wa_desu": { title: "Cấu trúc định danh", formula: "N1 は N2 です", desc: "N5: Khẳng định.", ex: "これは本です。" },
            "deshou": { title: "Có lẽ", formula: "V/Adj/N + でしょう", desc: "N4: Phỏng đoán.", ex: "明日は雨でしょう。" },
            "to_omou": { title: "Nghĩ rằng", formula: "～と思います", desc: "N4: Suy nghĩ cá nhân.", ex: "いいと思います。" },
            "te_iru": { title: "Đang/Trạng thái", formula: "Vている", desc: "N5/N4: Hành động đang diễn ra hoặc trạng thái.", ex: "知っています。" },
            "you_ni_suru": { title: "Cố gắng", formula: "Vる/ない + ようにする", desc: "N3: Nỗ lực thực hiện thói quen.", ex: "野菜を食べるようにしています。" },
            "you_ni_naru": { title: "Trở nên (Thay đổi khả năng)", formula: "Vる + ようになる", desc: "N4: Biểu thị sự thay đổi trạng thái.", ex: "泳げるようになりました。" },
            "te_oku": { title: "Làm sẵn", formula: "Vておく", desc: "N4: Chuẩn bị sẵn.", ex: "予約しておきます。" },
            "ta_form": { title: "Thể quá khứ ngắn", formula: "Vた", desc: "N5: Dùng trong văn nói thân mật.", ex: "食べた？" },
            "ka_embedded": { title: "Câu hỏi lồng", formula: "Từ để hỏi + V/Adj/N + か", desc: "N4: Lồng câu hỏi vào câu khác.", ex: "どこに行くか、わかりません。" },
            "to_conditional": { title: "Hễ...thì...", formula: "Vる + と", desc: "N4: Điều kiện tất yếu.", ex: "押すと開きます。" },
            "ba_hodo": { title: "Càng...càng...", formula: "Vば...Vほど...", desc: "N3: Mức độ tăng tiến.", ex: "勉強すればするほど上手になります。" },
            "ka_dou_ka": { title: "Có hay không", formula: "V/Adj/N + かどうか", desc: "N4: Câu hỏi lồng.", ex: "おいしいかどうかわかりません。" },
            "te_miru": { title: "Thử làm gì", formula: "Vて + みる", desc: "N4: Thử làm việc gì đó.", ex: "食べてみます。" }
        };

        // --- 2. VOCABULARY DATA (Day 16) ---
        const vocabData = [
            { "STT": 1, "Kanji": "測る", "Nghĩa": "Đo, cân", "Furigana": "はかる", "type": "verb", "conv": { "polite": "体重を測るために、毎日体重計に乗っています。", "pVi": "Để đo cân nặng, tôi đang đứng lên cân mỗi ngày.", "casual": "体重測るため、毎日体重計に乗ってる。", "cVi": "Ngày nào tớ cũng cân để kiểm tra cân nặng.", "gIds": ["tame_ni", "te_iru_habit"] } },
            { "STT": 2, "Kanji": "確かめる", "Nghĩa": "Xác nhận", "Furigana": "たしかめる", "type": "verb", "conv": { "polite": "情報を確かめるのに時間がかかります。", "pVi": "Mất thời gian để xác nhận thông tin.", "casual": "情報確かめるのに時間かかる。", "cVi": "Check thông tin tốn thời gian lắm.", "gIds": ["no_ni_use"] } },
            { "STT": 3, "Kanji": "似合う", "Nghĩa": "Hợp", "Furigana": "にあう", "type": "verb", "conv": { "polite": "この服は彼女に似合っていると思います。", "pVi": "Tôi nghĩ bộ quần áo này hợp với cô ấy.", "casual": "この服、彼女に似合ってると思う。", "cVi": "Bộ này hợp với cổ đấy.", "gIds": ["te_iru", "to_omou"] } },
            { "STT": 4, "Kanji": "出発する", "Nghĩa": "Xuất phát", "Furigana": "しゅっぱつする", "type": "verb", "conv": { "polite": "彼は朝早く出発するために、もう起きています。", "pVi": "Anh ấy đã dậy để xuất phát sớm vào buổi sáng.", "casual": "彼、朝早く出発するためにもう起きてる。", "cVi": "Hắn dậy rồi để đi sớm đấy.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 5, "Kanji": "到着する", "Nghĩa": "Đến nơi", "Furigana": "とうちゃくする", "type": "verb", "conv": { "polite": "駅に到着するのに1時間もかかりました。", "pVi": "Mất đến 1 tiếng để đến ga.", "casual": "駅到着するのに1時間もかかった。", "cVi": "Tốn tận 1 tiếng mới tới ga.", "gIds": ["no_ni_use", "mo_quantity"] } },
            { "STT": 6, "Kanji": "酔う", "Nghĩa": "Say", "Furigana": "よう", "type": "verb", "conv": { "polite": "お酒を飲みすぎると、酔ってしまいますよ。", "pVi": "Nếu uống quá nhiều rượu, bạn sẽ say đấy.", "casual": "酒飲みすぎると、酔っちゃうよ。", "cVi": "Uống nhiều là say đấy.", "gIds": ["to_conditional", "te_shimau"] } },
            { "STT": 7, "Kanji": "危険(な)", "Nghĩa": "Nguy hiểm", "Furigana": "きけん(な)", "type": "adj_na", "conv": { "polite": "危険な場所には行かないようにしています。", "pVi": "Tôi đang cố gắng không đi đến những nơi nguy hiểm.", "casual": "危険な場所には行かないようにしてる。", "cVi": "Tớ tránh mấy chỗ nguy hiểm.", "gIds": ["you_ni_suru"] } },
            { "STT": 8, "Kanji": "必要(な)", "Nghĩa": "Cần thiết", "Furigana": "ひつよう(な)", "type": "adj_na", "conv": { "polite": "これは生活に必要なものだと言われています。", "pVi": "Cái này được nói là vật cần thiết cho cuộc sống.", "casual": "これ、生活に必要なものだと言われてる。", "cVi": "Cái này là đồ thiết yếu đấy.", "gIds": ["to_iwareru"] } },
            { "STT": 9, "Kanji": "会議", "Nghĩa": "Hội nghị", "Furigana": "かいぎ", "type": "noun", "conv": { "polite": "会議は社長によって始められました。", "pVi": "Cuộc họp đã được bắt đầu bởi giám đốc.", "casual": "会議、社長によって始められた。", "cVi": "Giám đốc bắt đầu cuộc họp rồi.", "gIds": ["ni_yotte_passive"] } },
            { "STT": 10, "Kanji": "会場", "Nghĩa": "Hội trường", "Furigana": "かいじょう", "type": "noun", "conv": { "polite": "会場へ行く途中で、雨が降ってきました。", "pVi": "Trên đường đến hội trường, trời bắt đầu mưa.", "casual": "会場へ行く途中で、雨降ってきた。", "cVi": "Đang đi thì mưa.", "gIds": ["tochuu_de"] } },
            { "STT": 11, "Kanji": "二次会", "Nghĩa": "Tăng hai", "Furigana": "にじかい", "type": "noun", "conv": { "polite": "二次会に参加するために、準備しています。", "pVi": "Tôi đang chuẩn bị để tham gia tăng hai.", "casual": "二次会参加するため、準備してる。", "cVi": "Đang chuẩn bị đi tăng hai đây.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 12, "Kanji": "大会", "Nghĩa": "Đại hội", "Furigana": "たいかい", "type": "noun", "conv": { "polite": "大会で優勝するために、毎日練習しています。", "pVi": "Để vô địch đại hội, tôi đang luyện tập mỗi ngày.", "casual": "大会で優勝するため、毎日練習してる。", "cVi": "Ngày nào tớ cũng tập để vô địch.", "gIds": ["tame_ni", "te_iru_habit"] } },
            { "STT": 13, "Kanji": "表", "Nghĩa": "Mặt trước", "Furigana": "おもて", "type": "noun", "conv": { "polite": "表に名前が書いてあります。", "pVi": "Tên được viết ở mặt trước.", "casual": "表に名前書いてある。", "cVi": "Tên viết ở mặt trước kìa.", "gIds": ["te_aru"] } },
            { "STT": 14, "Kanji": "裏", "Nghĩa": "Mặt sau", "Furigana": "うら", "type": "noun", "conv": { "polite": "裏に何か書いてあるか、見ています。", "pVi": "Tôi đang xem mặt sau có viết gì không.", "casual": "裏になんか書いてあるか、見てる。", "cVi": "Đang xem mặt sau có gì không.", "gIds": ["ka_embedded", "te_iru"] } },
            { "STT": 15, "Kanji": "返事", "Nghĩa": "Hồi âm", "Furigana": "へんじ", "type": "noun", "conv": { "polite": "返事を書くのに時間がかかります。", "pVi": "Mất thời gian để viết thư trả lời.", "casual": "返事書くのに時間かかる。", "cVi": "Viết hồi âm tốn thời gian lắm.", "gIds": ["no_ni_use"] } },
            { "STT": 16, "Kanji": "米", "Nghĩa": "Gạo", "Furigana": "こめ", "type": "noun", "conv": { "polite": "米は日本でたくさん作られています。", "pVi": "Gạo được sản xuất rất nhiều ở Nhật Bản.", "casual": "米、日本でたくさん作られてる。", "cVi": "Gạo trồng nhiều ở Nhật lắm.", "gIds": ["passive"] } },
            { "STT": 17, "Kanji": "麦", "Nghĩa": "Lúa mạch", "Furigana": "むぎ", "type": "noun", "conv": { "polite": "麦はパンを作るのに使われます。", "pVi": "Lúa mạch được dùng để làm bánh mì.", "casual": "麦、パン作るのに使われる。", "cVi": "Mạch dùng làm bánh mì.", "gIds": ["no_ni_use", "passive"] } },
            { "STT": 18, "Kanji": "石油", "Nghĩa": "Dầu mỏ", "Furigana": "せきゆ", "type": "noun", "conv": { "polite": "石油はエネルギーを作るのに使われています。", "pVi": "Dầu mỏ đang được dùng để tạo ra năng lượng.", "casual": "石油、エネルギー作るのに使われてる。", "cVi": "Dầu dùng để tạo năng lượng.", "gIds": ["no_ni_use", "passive"] } },
            { "STT": 19, "Kanji": "原料", "Nghĩa": "Nguyên liệu", "Furigana": "げんりょう", "type": "noun", "conv": { "polite": "この製品はどんな原料によって作られていますか。", "pVi": "Sản phẩm này được làm từ loại nguyên liệu nào?", "casual": "これ、どんな原料によって作られてる？", "cVi": "Cái này làm từ gì thế?", "gIds": ["ni_yotte_passive"] } },
            { "STT": 20, "Kanji": "泥棒", "Nghĩa": "Kẻ trộm", "Furigana": "どろぼう", "type": "noun", "conv": { "polite": "泥棒は警察に捕まえられました。", "pVi": "Kẻ trộm đã bị cảnh sát bắt.", "casual": "泥棒、警察に捕まえられた。", "cVi": "Trộm bị tóm rồi.", "gIds": ["passive"] } },
            { "STT": 21, "Kanji": "警官", "Nghĩa": "Cảnh sát", "Furigana": "けいかん", "type": "noun", "conv": { "polite": "彼は警官になろうと努力しています。", "pVi": "Anh ấy đang nỗ lực để trở thành cảnh sát.", "casual": "彼、警官になろうと努力してる。", "cVi": "Hắn đang cố để làm cảnh sát.", "gIds": ["volitional", "to_omou"] } },
            { "STT": 22, "Kanji": "建築家", "Nghĩa": "Kiến trúc sư", "Furigana": "けんちくか", "type": "noun", "conv": { "polite": "このビルは有名な建築家によって設計されました。", "pVi": "Tòa nhà này được thiết kế bởi một kiến trúc sư nổi tiếng.", "casual": "このビル、有名な建築家によって設計された。", "cVi": "Tòa này do KTS nổi tiếng thiết kế đấy.", "gIds": ["ni_yotte_passive"] } },
            { "STT": 23, "Kanji": "科学者", "Nghĩa": "Nhà khoa học", "Furigana": "かがくしゃ", "type": "noun", "conv": { "polite": "科学者は新しい発見をするために、研究しています。", "pVi": "Nhà khoa học đang nghiên cứu để có những phát hiện mới.", "casual": "科学者、新しい発見するため研究してる。", "cVi": "Khoa học gia đang nghiên cứu để phát hiện cái mới.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 24, "Kanji": "世界中", "Nghĩa": "Khắp thế giới", "Furigana": "せかいじゅう", "type": "place", "conv": { "polite": "世界中で日本語が話せるようになっています。", "pVi": "Tiếng Nhật đang trở nên có thể nói được khắp thế giới.", "casual": "世界中で日本語話せるようになってる。", "cVi": "Tiếng Nhật giờ nói được khắp nơi rồi.", "gIds": ["you_ni_naru"] } },
            { "STT": 25, "Kanji": "~によって", "Nghĩa": "Bởi...", "Furigana": "によって", "type": "phrase", "conv": { "polite": "この歌は誰によって歌われていますか。", "pVi": "Bài hát này được hát bởi ai?", "casual": "この歌、誰によって歌われてる？", "cVi": "Bài này ai hát thế?", "gIds": ["ni_yotte_passive"] } },
            { "STT": 26, "Kanji": "埋め立てる", "Nghĩa": "Lấp (biển)", "Furigana": "うめたてる", "type": "verb", "conv": { "polite": "海を埋め立てるために、たくさんの土が使われています。", "pVi": "Rất nhiều đất đang được sử dụng để lấp biển.", "casual": "海埋め立てるため、たくさんの土使われてる。", "cVi": "Lấp biển tốn nhiều đất lắm.", "gIds": ["tame_ni", "passive"] } },
            { "STT": 27, "Kanji": "技術", "Nghĩa": "Kỹ thuật", "Furigana": "ぎじゅつ", "type": "noun", "conv": { "polite": "日本の技術は世界中で使われています。", "pVi": "Kỹ thuật của Nhật Bản đang được sử dụng trên toàn thế giới.", "casual": "日本の技術、世界中で使われてる。", "cVi": "Kỹ thuật Nhật dùng khắp thế giới.", "gIds": ["passive"] } },
            { "STT": 28, "Kanji": "土地", "Nghĩa": "Đất đai", "Furigana": "とち", "type": "noun", "conv": { "polite": "土地を買うために、お金を貯めています。", "pVi": "Tôi đang tiết kiệm tiền để mua đất.", "casual": "土地買うため、お金貯めてる。", "cVi": "Đang gom tiền mua đất.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 29, "Kanji": "騒音", "Nghĩa": "Tiếng ồn", "Furigana": "そうおん", "type": "noun", "conv": { "polite": "騒音は健康に悪いと言われています。", "pVi": "Tiếng ồn được nói là không tốt cho sức khỏe.", "casual": "騒音、健康に悪いと言われてる。", "cVi": "Thấy bảo tiếng ồn hại sức khỏe lắm.", "gIds": ["passive", "to_iwareru"] } },
            { "STT": 30, "Kanji": "使用する", "Nghĩa": "Sử dụng", "Furigana": "しようする", "type": "verb", "conv": { "polite": "この機械は誰でも使用できるようになっています。", "pVi": "Máy này đang trở nên có thể sử dụng được bởi bất kỳ ai.", "casual": "これ、誰でも使用できるようになってる。", "cVi": "Cái này giờ ai cũng dùng được.", "gIds": ["you_ni_naru"] } },
            { "STT": 31, "Kanji": "世間", "Nghĩa": "Thế gian", "Furigana": "せけん", "type": "noun", "conv": { "polite": "世間の話はあまり気にしないようにしています。", "pVi": "Tôi đang cố gắng không quá bận tâm đến chuyện thế gian.", "casual": "世間の話、あんま気にしないようにしてる。", "cVi": "Tớ chả để tâm chuyện thiên hạ.", "gIds": ["you_ni_suru"] } },
            { "STT": 32, "Kanji": "豪華(な)", "Nghĩa": "Sang trọng", "Furigana": "ごうか(な)", "type": "adj_na", "conv": { "polite": "豪華なホテルに泊まるために、お金を貯めています。", "pVi": "Tôi đang tiết kiệm tiền để ở khách sạn sang trọng.", "casual": "豪華なホテル泊まるため、お金貯めてる。", "cVi": "Đang dành tiền đi khách sạn xịn.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 33, "Kanji": "彫刻", "Nghĩa": "Điêu khắc", "Furigana": "ちょうこく", "type": "noun", "conv": { "polite": "彫刻は美しいものだと言われています。", "pVi": "Điêu khắc được nói là một thứ đẹp đẽ.", "casual": "彫刻、美しいものだと言われてる。", "cVi": "Nghe bảo điêu khắc đẹp lắm.", "gIds": ["passive"] } },
            { "STT": 34, "Kanji": "眠る", "Nghĩa": "Ngủ", "Furigana": "ねむる", "type": "verb", "conv": { "polite": "早く寝るようにしています。", "pVi": "Tôi đang cố gắng ngủ sớm.", "casual": "早く寝るようにしてる。", "cVi": "Tớ đang tập ngủ sớm.", "gIds": ["you_ni_suru"] } },
            { "STT": 35, "Kanji": "彫る", "Nghĩa": "Khắc", "Furigana": "ほる", "type": "verb", "conv": { "polite": "木を彫る練習をしています。", "pVi": "Tôi đang luyện tập khắc gỗ.", "casual": "木を彫る練習してる。", "cVi": "Đang tập khắc gỗ.", "gIds": ["te_iru"] } },
            { "STT": 36, "Kanji": "仲間", "Nghĩa": "Bạn bè", "Furigana": "なかま", "type": "noun", "conv": { "polite": "仲間と仲良くするために、努力しています。", "pVi": "Tôi đang nỗ lực để hòa thuận với bạn bè.", "casual": "仲間と仲良くするため、努力してる。", "cVi": "Đang cố thân với anh em hơn.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 37, "Kanji": "そのあと", "Nghĩa": "Sau đó", "Furigana": "そのあと", "type": "phrase", "conv": { "polite": "食事をしてから、そのあと散歩するようにしています。", "pVi": "Sau khi ăn, sau đó tôi đang cố gắng đi dạo.", "casual": "食事してから、そのあと散歩するようにしてる。", "cVi": "Ăn xong tớ hay đi dạo.", "gIds": ["you_ni_suru"] } },
            { "STT": 38, "Kanji": "一生懸命", "Nghĩa": "Chăm chỉ", "Furigana": "いっしょうけんめい", "type": "adverb", "conv": { "polite": "一生懸命勉強するために、毎日図書館に通っています。", "pVi": "Để học tập chăm chỉ, tôi đang đi đến thư viện mỗi ngày.", "casual": "一生懸命勉強するため、毎日図書館通ってる。", "cVi": "Ngày nào cũng lên thư viện cày.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 39, "Kanji": "鼠", "Nghĩa": "Con chuột", "Furigana": "ねずみ", "type": "noun", "conv": { "polite": "鼠は猫によって捕まえられました。", "pVi": "Con chuột đã bị mèo bắt.", "casual": "鼠、猫によって捕まえられた。", "cVi": "Chuột bị mèo tóm rồi.", "gIds": ["ni_yotte_passive"] } },
            { "STT": 40, "Kanji": "一匹もいない", "Nghĩa": "Không có con nào", "Furigana": "いっぴきもいない", "type": "phrase", "conv": { "polite": "この家には猫が一匹もいないと言われています。", "pVi": "Ngôi nhà này được nói là không có con mèo nào cả.", "casual": "この家、猫一匹もいないと言われてる。", "cVi": "Thấy bảo nhà này chả có con mèo nào.", "gIds": ["passive"] } },
            { "STT": 41, "Kanji": "育てる", "Nghĩa": "Nuôi dạy", "Furigana": "そだてる", "type": "verb", "conv": { "polite": "子供を育てるのに時間がかかります。", "pVi": "Mất thời gian để nuôi dạy con cái.", "casual": "子供育てるのに時間かかる。", "cVi": "Nuôi con tốn thời gian lắm.", "gIds": ["no_ni_use"] } },
            { "STT": 42, "Kanji": "かぎをかける", "Nghĩa": "Khóa cửa", "Furigana": "かぎをかける", "type": "verb", "conv": { "polite": "ドアに鍵をかけるのを忘れていました。", "pVi": "Tôi đã quên khóa cửa.", "casual": "ドアに鍵かけるの忘れてた。", "cVi": "Quên khóa cửa mất rồi.", "gIds": ["no_wa"] } },
            { "STT": 43, "Kanji": "死亡", "Nghĩa": "Tử vong", "Furigana": "しぼう", "type": "noun", "conv": { "polite": "死亡事故は減るようになっています。", "pVi": "Tai nạn tử vong đang trở nên giảm.", "casual": "死亡事故、減るようになってる。", "cVi": "Tai nạn chết người đang giảm dần.", "gIds": ["you_ni_naru"] } },
            { "STT": 44, "Kanji": "国籍", "Nghĩa": "Quốc tịch", "Furigana": "こくせき", "type": "noun", "conv": { "polite": "彼の国籍はどこか、まだ調べています。", "pVi": "Tôi vẫn đang tìm hiểu quốc tịch của anh ấy là gì.", "casual": "彼の国籍どこか、まだ調べてる。", "cVi": "Đang check xem quốc tịch hắn là gì.", "gIds": ["ka_embedded", "te_iru"] } },
            { "STT": 45, "Kanji": "東洋", "Nghĩa": "Phương Đông", "Furigana": "とうよう", "type": "noun", "conv": { "polite": "東洋の文化を学ぶために、日本に留学しています。", "pVi": "Để học văn hóa phương Đông, tôi đang du học ở Nhật Bản.", "casual": "東洋の文化学ぶため、日本に留学してる。", "cVi": "Đang du học Nhật để học văn hóa phương Đông.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 46, "Kanji": "西洋", "Nghĩa": "Phương Tây", "Furigana": "せいよう", "type": "noun", "conv": { "polite": "西洋の音楽は聞かないようにしています。", "pVi": "Tôi đang cố gắng không nghe nhạc phương Tây.", "casual": "西洋の音楽、聞かないようにしてる。", "cVi": "Tớ đang cai nhạc Tây.", "gIds": ["you_ni_suru"] } },
            { "STT": 47, "Kanji": "比べる", "Nghĩa": "So sánh", "Furigana": "くらべる", "type": "verb", "conv": { "polite": "日本とベトナムの生活を比べるのに時間がかかります。", "pVi": "Mất thời gian để so sánh cuộc sống ở Nhật và Việt Nam.", "casual": "日本とベトナムの生活比べるのに時間かかる。", "cVi": "So sánh cuộc sống Nhật Việt tốn thời gian phết.", "gIds": ["no_ni_use"] } },
            { "STT": 48, "Kanji": "文化", "Nghĩa": "Văn hóa", "Furigana": "ぶんか", "type": "noun", "conv": { "polite": "日本の文化は世界中で愛されています。", "pVi": "Văn hóa Nhật Bản đang được yêu thích trên toàn thế giới.", "casual": "日本の文化、世界中で愛されてる。", "cVi": "Văn hóa Nhật được chuộng khắp nơi.", "gIds": ["passive", "te_iru"] } },
            { "STT": 49, "Kanji": "国際", "Nghĩa": "Quốc tế", "Furigana": "こくさい", "type": "noun", "conv": { "polite": "国際会議は来週開かれると言われています。", "pVi": "Hội nghị quốc tế được nói là sẽ được tổ chức vào tuần tới.", "casual": "国際会議、来週開かれるって。", "cVi": "Thấy bảo tuần sau họp quốc tế.", "gIds": ["to_iwareru", "passive"] } },
            { "STT": 50, "Kanji": "支社", "Nghĩa": "Chi nhánh", "Furigana": "ししゃ", "type": "noun", "conv": { "polite": "支社は来年できる予定だと言われています。", "pVi": "Chi nhánh được nói là dự định sẽ được thành lập vào năm sau.", "casual": "支社、来年できる予定だって。", "cVi": "Nghe nói năm sau mở chi nhánh.", "gIds": ["to_iwareru"] } },
            { "STT": 51, "Kanji": "企業", "Nghĩa": "Doanh nghiệp", "Furigana": "きぎょう", "type": "noun", "conv": { "polite": "どんな企業で働きたいか、まだ考えています。", "pVi": "Tôi vẫn đang suy nghĩ muốn làm việc ở công ty nào.", "casual": "どんな企業で働きたいか、まだ考えてる。", "cVi": "Đang tính xem làm công ty nào.", "gIds": ["ka_embedded", "te_iru"] } },
            { "STT": 52, "Kanji": "発展", "Nghĩa": "Phát triển", "Furigana": "はってん", "type": "noun", "conv": { "polite": "経済を発展させるために、努力しています。", "pVi": "Tôi đang nỗ lực để phát triển kinh tế.", "casual": "経済発展させるため、努力してる。", "cVi": "Đang cày để phát triển kinh tế.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 53, "Kanji": "自然", "Nghĩa": "Tự nhiên", "Furigana": "しぜん", "type": "noun", "conv": { "polite": "自然の中で生活するために、田舎に引っ越しました。", "pVi": "Để sống trong thiên nhiên, tôi đã chuyển về nông thôn.", "casual": "自然の中で生活するため、田舎に引っ越した。", "cVi": "Về quê sống cho gần thiên nhiên.", "gIds": ["tame_ni", "ta_form"] } },
            { "STT": 54, "Kanji": "景色", "Nghĩa": "Phong cảnh", "Furigana": "けしき", "type": "noun", "conv": { "polite": "窓を開けると、美しい景色が見えます。", "pVi": "Mở cửa sổ ra là có thể nhìn thấy phong cảnh đẹp.", "casual": "窓開けると、美しい景色見える。", "cVi": "Mở cửa sổ là thấy cảnh đẹp.", "gIds": ["to_conditional", "potential"] } },
            { "STT": 55, "Kanji": "宗教", "Nghĩa": "Tôn giáo", "Furigana": "しゅうきょう", "type": "noun", "conv": { "polite": "どんな宗教を信じるか、まだ調べています。", "pVi": "Tôi vẫn đang tìm hiểu sẽ tin theo tôn giáo nào.", "casual": "どんな宗教信じるか、まだ調べてる。", "cVi": "Đang xem nên theo đạo nào.", "gIds": ["ka_embedded", "te_iru"] } },
            { "STT": 56, "Kanji": "愛", "Nghĩa": "Yêu", "Furigana": "あい", "type": "noun", "conv": { "polite": "家族を愛するために、毎日頑張っています。", "pVi": "Để yêu thương gia đình, tôi đang cố gắng mỗi ngày.", "casual": "家族愛するため、毎日頑張ってる。", "cVi": "Đang cố gắng mỗi ngày vì gia đình.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 57, "Kanji": "(が)届く", "Nghĩa": "Được gửi đến", "Furigana": "とどく", "type": "verb", "conv": { "polite": "手紙が届くのに3日もかかりました。", "pVi": "Mất đến 3 ngày để thư được gửi đến.", "casual": "手紙届くのに3日もかかった。", "cVi": "Mất tận 3 ngày thư mới tới.", "gIds": ["no_ni_use", "mo_quantity"] } },
            { "STT": 58, "Kanji": "届ける", "Nghĩa": "Chuyển đến", "Furigana": "とどける", "type": "verb", "conv": { "polite": "荷物を届けるのに時間がかかります。", "pVi": "Mất thời gian để chuyển hành lý.", "casual": "荷物届けるのに時間かかる。", "cVi": "Chuyển đồ tốn thời gian lắm.", "gIds": ["no_ni_use"] } },
            { "STT": 59, "Kanji": "掻く", "Nghĩa": "Gãi", "Furigana": "かく", "type": "verb", "conv": { "polite": "頭をかきながら、考えています。", "pVi": "Vừa gãi đầu vừa suy nghĩ.", "casual": "頭かきながら、考えてる。", "cVi": "Vừa gãi đầu vừa nghĩ.", "gIds": ["nagara", "te_iru"] } },
            { "STT": 60, "Kanji": "掴む", "Nghĩa": "Tóm", "Furigana": "つかむ", "type": "verb", "conv": { "polite": "チャンスを掴むために、努力しています。", "pVi": "Tôi đang nỗ lực để nắm bắt cơ hội.", "casual": "チャンス掴むため、努力してる。", "cVi": "Đang cố để nắm bắt cơ hội.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 61, "Kanji": "", "Nghĩa": "Ngạc nhiên", "Furigana": "びっくりする", "type": "verb", "conv": { "polite": "突然大きな音が聞こえて、びっくりしています。", "pVi": "Nghe thấy tiếng động lớn đột ngột, tôi đang giật mình.", "casual": "突然大きな音聞こえて、びっくりしてる。", "cVi": "Tự nhiên nghe tiếng lớn giật cả mình.", "gIds": ["te_iru"] } },
            { "STT": 62, "Kanji": "握る", "Nghĩa": "Nắm", "Furigana": "にぎる", "type": "verb", "conv": { "polite": "手を握って、話しています。", "pVi": "Tôi đang nắm tay và nói chuyện.", "casual": "手握って、話してる。", "cVi": "Đang nắm tay nói chuyện nè.", "gIds": ["te_iru"] } },
            { "STT": 63, "Kanji": "押さえる", "Nghĩa": "Giữ/Ôm", "Furigana": "おさえる", "type": "verb", "conv": { "polite": "お腹を押さえながら、歩いています。", "pVi": "Vừa ôm bụng vừa đi.", "casual": "お腹押さえながら、歩いてる。", "cVi": "Vừa ôm bụng vừa đi.", "gIds": ["nagara", "te_iru"] } },
            { "STT": 64, "Kanji": "(が)近づく", "Nghĩa": "Đến gần", "Furigana": "ちかづく", "type": "verb", "conv": { "polite": "駅に近づくのに時間がかかります。", "pVi": "Mất thời gian để đến gần ga.", "casual": "駅近づくのに時間かかる。", "cVi": "Đi đến ga lâu phết.", "gIds": ["no_ni_use"] } },
            { "STT": 65, "Kanji": "近づける", "Nghĩa": "Làm thân", "Furigana": "ちかづける", "type": "verb", "conv": { "polite": "友達と近づくために、たくさん話しています。", "pVi": "Để kết thân với bạn bè, tôi đang nói chuyện rất nhiều.", "casual": "友達と近づくため、たくさん話してる。", "cVi": "Đang nói chuyện nhiều để thân hơn.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 66, "Kanji": "知り合う", "Nghĩa": "Quen biết", "Furigana": "しりあう", "type": "verb", "conv": { "polite": "彼女と知り合うために、パーティーに参加しました。", "pVi": "Để quen biết cô ấy, tôi đã tham gia bữa tiệc.", "casual": "彼女と知り合うため、パーティーに参加した。", "cVi": "Đi tiệc để làm quen với cổ.", "gIds": ["tame_ni", "ta_form"] } },
            { "STT": 67, "Kanji": "不図", "Nghĩa": "Đột nhiên", "Furigana": "ふと", "type": "adverb", "conv": { "polite": "ふと昔の友達を思い出すことがあります。", "pVi": "Đôi khi tôi đột nhiên nhớ đến người bạn cũ.", "casual": "ふと昔の友達思い出すことある。", "cVi": "Thỉnh thoảng tự dưng nhớ bạn cũ.", "gIds": ["koto_ga_aru"] } },
            { "STT": 68, "Kanji": "合わせる", "Nghĩa": "Hợp sức", "Furigana": "あわせる", "type": "verb", "conv": { "polite": "みんなで力を合わせるために、話し合っています。", "pVi": "Để hợp sức, mọi người đang thảo luận.", "casual": "みんなで力合わせるため、話し合ってる。", "cVi": "Đang bàn bạc để chung sức.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 69, "Kanji": "(が)当たる", "Nghĩa": "Trúng", "Furigana": "あたる", "type": "verb", "conv": { "polite": "宝くじが当たるのに時間がかかります。", "pVi": "Mất thời gian để trúng xổ số.", "casual": "宝くじ当たるのに時間かかる。", "cVi": "Mãi mới trúng số.", "gIds": ["no_ni_use"] } },
            { "STT": 70, "Kanji": "当てる", "Nghĩa": "Đánh trúng", "Furigana": "あてる", "type": "verb", "conv": { "polite": "ボールを的に当てる練習をしています。", "pVi": "Tôi đang luyện tập đánh trúng bóng vào mục tiêu.", "casual": "ボール的に当てる練習してる。", "cVi": "Đang tập ném trúng đích.", "gIds": ["te_iru"] } },
            { "STT": 71, "Kanji": "比例", "Nghĩa": "Tỷ lệ", "Furigana": "ひれい", "type": "noun", "conv": { "polite": "これは比例関係にあると言われています。", "pVi": "Cái này được nói là có mối quan hệ tỷ lệ thuận.", "casual": "これ、比例関係にあると言われてる。", "cVi": "Cái này thấy bảo là tỷ lệ thuận.", "gIds": ["to_iwareru"] } },
            { "STT": 72, "Kanji": "似合う", "Nghĩa": "Hợp", "Furigana": "にあう", "type": "verb", "conv": { "polite": "この服はあなたに似合っていると思います。", "pVi": "Tôi nghĩ bộ quần áo này hợp với bạn.", "casual": "この服、あなたに似合ってると思う。", "cVi": "Bộ này hợp với cậu đấy.", "gIds": ["te_iru", "to_omou"] } },
            { "STT": 73, "Kanji": "似る", "Nghĩa": "Giống", "Furigana": "にる", "type": "verb", "conv": { "polite": "彼女は母親に似ていると言われています。", "pVi": "Cô ấy được nói là giống mẹ.", "casual": "彼女、母親に似てるって。", "cVi": "Mọi người bảo cổ giống mẹ.", "gIds": ["to_iwareru"] } },
            { "STT": 74, "Kanji": "似せる", "Nghĩa": "Bắt chước", "Furigana": "にせる", "type": "verb", "conv": { "polite": "彼の声に似せる練習をしています。", "pVi": "Tôi đang luyện tập bắt chước giọng anh ấy.", "casual": "彼の声に似せる練習してる。", "cVi": "Đang tập nhái giọng hắn.", "gIds": ["te_iru"] } },
            { "STT": 75, "Kanji": "(が)分かれる", "Nghĩa": "Được chia", "Furigana": "わかれる", "type": "verb", "conv": { "polite": "クラスは二つに分かれています。", "pVi": "Lớp đang được chia thành hai.", "casual": "クラス、二つに分かれてる。", "cVi": "Lớp đang chia đôi.", "gIds": ["te_iru"] } },
            { "STT": 76, "Kanji": "分ける", "Nghĩa": "Chia", "Furigana": "わける", "type": "verb", "conv": { "polite": "ケーキをみんなで分けています。", "pVi": "Tôi đang chia bánh kem cho mọi người.", "casual": "ケーキみんなで分けてる。", "cVi": "Đang chia bánh.", "gIds": ["te_iru"] } },
            { "STT": 77, "Kanji": "財産", "Nghĩa": "Tài sản", "Furigana": "ざいさん", "type": "noun", "conv": { "polite": "財産はたくさんあると言われています。", "pVi": "Tài sản được nói là có rất nhiều.", "casual": "財産たくさんあると言われてる。", "cVi": "Nghe đồn lắm tiền lắm.", "gIds": ["to_iwareru"] } },
            { "STT": 78, "Kanji": "足す", "Nghĩa": "Thêm vào", "Furigana": "たす", "type": "verb", "conv": { "polite": "塩を足すのに時間がかかります。", "pVi": "Mất thời gian để thêm muối.", "casual": "塩足すのに時間かかる。", "cVi": "Thêm muối lâu thế.", "gIds": ["no_ni_use"] } },
            { "STT": 79, "Kanji": "薄い", "Nghĩa": "Nhạt", "Furigana": "うすい", "type": "adj_i", "conv": { "polite": "このスープは味が薄いと言われています。", "pVi": "Món súp này được nói là vị nhạt.", "casual": "このスープ、味薄いって。", "cVi": "Súp này nghe bảo nhạt.", "gIds": ["to_iwareru"] } },
            { "STT": 80, "Kanji": "塩", "Nghĩa": "Muối", "Furigana": "しお", "type": "noun", "conv": { "polite": "塩は料理を作るのに必要です。", "pVi": "Muối cần thiết để nấu ăn.", "casual": "塩、料理作るのに必要。", "cVi": "Muối để nấu ăn mà.", "gIds": ["no_ni_use"] } },
            { "STT": 81, "Kanji": "引く", "Nghĩa": "Trừ", "Furigana": "ひく", "type": "verb", "conv": { "polite": "10から5を引くのに時間がかかります。", "pVi": "Mất thời gian để trừ 5 từ 10.", "casual": "10から5引くのに時間かかる。", "cVi": "Trừ 10 cho 5 mà lâu thế.", "gIds": ["no_ni_use"] } },
            { "STT": 82, "Kanji": "(が)増える", "Nghĩa": "Tăng lên", "Furigana": "ふえる", "type": "verb", "conv": { "polite": "人口が増えています。", "pVi": "Dân số đang tăng lên.", "casual": "人口増えてる。", "cVi": "Dân số đang tăng.", "gIds": ["te_iru"] } },
            { "STT": 83, "Kanji": "増やす", "Nghĩa": "Làm tăng", "Furigana": "ふやす", "type": "verb", "conv": { "polite": "お金を増やすために、努力しています。", "pVi": "Tôi đang nỗ lực để làm tăng tiền.", "casual": "お金増やすため、努力してる。", "cVi": "Đang cày để kiếm thêm tiền.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 84, "Kanji": "(が)減る", "Nghĩa": "Giảm", "Furigana": "へる", "type": "verb", "conv": { "polite": "人口が減っています。", "pVi": "Dân số đang giảm.", "casual": "人口減ってる。", "cVi": "Dân số đang giảm.", "gIds": ["te_iru"] } },
            { "STT": 85, "Kanji": "減らす", "Nghĩa": "Làm giảm", "Furigana": "へらす", "type": "verb", "conv": { "polite": "ゴミを減らすために、努力しています。", "pVi": "Tôi đang nỗ lực để làm giảm rác.", "casual": "ゴミ減らすため、努力してる。", "cVi": "Đang cố giảm rác thải.", "gIds": ["tame_ni", "te_iru"] } },
            { "STT": 86, "Kanji": "店長", "Nghĩa": "Cửa hàng trưởng", "Furigana": "てんちょう", "type": "noun", "conv": { "polite": "店長は忙しいと言われています。", "pVi": "Cửa hàng trưởng được nói là bận.", "casual": "店長、忙しいって。", "cVi": "Thấy bảo chủ tiệm bận lắm.", "gIds": ["to_iwareru"] } },
            { "STT": 87, "Kanji": "(が)返る", "Nghĩa": "Được trả lại", "Furigana": "かえる", "type": "verb", "conv": { "polite": "本は明日返ってくるのに時間がかかります。", "pVi": "Mất thời gian để sách được trả lại vào ngày mai.", "casual": "本、明日返ってくるのに時間かかる。", "cVi": "Mai sách mới về, lâu ghê.", "gIds": ["no_ni_use"] } }
        ];

        // --- 3. KANJI DETAILS (Tips & Mnemonics) ---
        const kanjiDetails = {
            "測": { hanviet: "TRẮC", mean: "Đo lường", on: "ソク", kun: "はか.る", radicals: "Thủy (氵) + Tắc (則)", tipImg: "Dùng quy tắc (則) đo nước (氵).", tipSoundOn: "Soku**tei** đo đạc.", tipSoundKun: "**Haka**ru đo.", words: [{w:"測ります (はかります)", m:"Đo/Cân"}] },
            "量": { hanviet: "LƯỢNG", mean: "Số lượng/Cân", on: "リョウ", kun: "はか.る", radicals: "Nhật (曰) + Nhất (一) + Lý (里)", tipImg: "Đo lường một (一) dặm (里) dưới nắng (曰).", tipSoundOn: "**Ryou** lượng.", tipSoundKun: "**Haka**ru cân.", words: [{w:"量ります (はかります)", m:"Cân"}] },
            "確": { hanviet: "XÁC", mean: "Chính xác", on: "カク", kun: "たし.か", radicals: "Thạch (石)", tipImg: "Hòn đá (石) cứng xác thực.", tipSoundOn: "**Kaku**nin xác nhận.", tipSoundKun: "**Tashi**kamesu xác nhận.", words: [{w:"確かめる (たしかめる)", m:"Xác nhận"}, {w:"正確 (せいかく)", m:"Chính xác"}] },
            "似": { hanviet: "TỰ", mean: "Giống", on: "ジ", kun: "に.る", radicals: "Nhân (亻)", tipImg: "Người dùng làm mẫu giống.", tipSoundOn: "Rui**ji** tương tự.", tipSoundKun: "**Ni**au hợp.", words: [{w:"似合います (にあいます)", m:"Hợp"}, {w:"似る (にる)", m:"Giống"}] },
            "酔": { hanviet: "TÚY", mean: "Say", on: "スイ", kun: "よ.う", radicals: "Dậu (酉)", tipImg: "Uống rượu (酉) tốt nghiệp (卒) là say.", tipSoundOn: "Ma**sui** gây mê.", tipSoundKun: "**Yo**u say.", words: [{w:"酔います (よいます)", m:"Say"}, {w:"二日酔い (ふつかよい)", m:"Say nguội"}] },
            "危": { hanviet: "NGUY", mean: "Nguy hiểm", on: "キ", kun: "あぶ.ない", radicals: "Tiết (卩)", tipImg: "Quỳ bên vách núi nguy hiểm.", tipSoundOn: "**Ki**ken nguy hiểm.", tipSoundKun: "**Abu**nai nguy.", words: [{w:"危険 (きけん)", m:"Nguy hiểm"}, {w:"危ない (あぶない)", m:"Nguy hiểm"}] },
            "険": { hanviet: "HIỂM", mean: "Hiểm trở", on: "ケン", kun: "けわ.しい", radicals: "Phụ (阝)", tipImg: "Gò đất (阝) hội (佥) tụ hiểm trở.", tipSoundOn: "Ki**ken** nguy hiểm.", tipSoundKun: "**Kewa**shii dốc.", words: [{w:"危険 (きけん)", m:"Nguy hiểm"}, {w:"保険 (ほけん)", m:"Bảo hiểm"}] },
            "油": { hanviet: "DU", mean: "Dầu", on: "ユ", kun: "あぶら", radicals: "Thủy (氵) + Do (由)", tipImg: "Nước từ do dầu.", tipSoundOn: "Seki**yu** dầu mỏ.", tipSoundKun: "**Abura** dầu.", words: [{w:"石油 (せきゆ)", m:"Dầu mỏ"}, {w:"油 (あぶら)", m:"Dầu"}] },
            "原": { hanviet: "NGUYÊN", mean: "Cánh đồng/Gốc", on: "ゲン", kun: "はら", radicals: "Hán (厂) + Tuyền (泉)", tipImg: "Suối (泉) chảy từ vách núi (厂) là nguồn.", tipSoundOn: "**Gen**ryou nguyên liệu.", tipSoundKun: "**Hara** cánh đồng.", words: [{w:"原料 (げんりょう)", m:"Nguyên liệu"}, {w:"野原 (のはら)", m:"Cánh đồng"}] },
            "料": { hanviet: "LIỆU", mean: "Nguyên liệu", on: "リョウ", kun: "", radicals: "Mễ (米) + Đấu (斗)", tipImg: "Gạo đong đấu làm liệu.", tipSoundOn: "Gen**ryou** nguyên liệu.", tipSoundKun: "", words: [{w:"原料 (げんりょう)", m:"Nguyên liệu"}, {w:"料理 (りょうり)", m:"Món ăn"}] },
            "泥": { hanviet: "NÊ", mean: "Bùn", on: "デイ", kun: "どろ", radicals: "Thủy (氵) + Ni (尼)", tipImg: "Nước (氵) hòa với đất thành bùn.", tipSoundOn: "**Dei** bùn.", tipSoundKun: "**Doro** bùn.", words: [{w:"泥棒 (どろぼう)", m:"Kẻ trộm"}, {w:"泥 (どろ)", m:"Bùn"}] },
            "棒": { hanviet: "BỔNG", mean: "Gậy", on: "ボウ", kun: "", radicals: "Mộc (木) + Phụng (奉)", tipImg: "Cây gậy gỗ (木) dâng lên (奉).", tipSoundOn: "Doro**bou** gậy.", tipSoundKun: "", words: [{w:"泥棒 (どろぼう)", m:"Kẻ trộm"}, {w:"鉄棒 (てつぼう)", m:"Xà đơn"}] },
            "警": { hanviet: "CẢNH", mean: "Cảnh báo", on: "ケイ", kun: "", radicals: "Ngôn (言) + Kính (敬)", tipImg: "Lời nói (言) kính (敬) trọng cảnh báo.", tipSoundOn: "**Kei**kan cảnh sát.", tipSoundKun: "", words: [{w:"警官 (けいかん)", m:"Cảnh sát"}, {w:"警告 (けいこく)", m:"Cảnh cáo"}] },
            "官": { hanviet: "QUAN", mean: "Quan chức", on: "カン", kun: "", radicals: "Miên (宀)", tipImg: "Quan đội mũ trong nhà.", tipSoundOn: "Kei**kan** quan.", tipSoundKun: "", words: [{w:"警官 (けいかん)", m:"Cảnh sát"}, {w:"外交官 (がいこうかん)", m:"Nhà ngoại giao"}] },
            "建": { hanviet: "KIẾN", mean: "Xây dựng", on: "ケン", kun: "た.てる", radicals: "Dẫn (廴) + Duật (聿)", tipImg: "Tay cầm bút (聿) vẽ bản đồ xây dựng.", tipSoundOn: "**Ken**chiku kiến trúc.", tipSoundKun: "**Ta**teru xây.", words: [{w:"建築家 (けんちくか)", m:"Kiến trúc sư"}, {w:"建物 (たてもの)", m:"Tòa nhà"}] },
            "築": { hanviet: "TRÚC", mean: "Kiến trúc", on: "チク", kun: "きず.く", radicals: "Trúc (竹) + Công (工) + Phàm (凡) + Mộc (木)", tipImg: "Dùng tre (竹) gỗ (木) xây kiến trúc.", tipSoundOn: "Ken**chiku** kiến trúc.", tipSoundKun: "**Kizu**ku xây dựng.", words: [{w:"建築家 (けんちくか)", m:"Kiến trúc sư"}] },
            "科": { hanviet: "KHOA", mean: "Khoa học", on: "カ", kun: "", radicals: "Hòa (禾) + Đấu (斗)", tipImg: "Cân đong lúa (禾) bằng đấu (斗) là khoa học.", tipSoundOn: "**Ka**gaku khoa học.", tipSoundKun: "", words: [{w:"科学者 (かがくしゃ)", m:"Nhà khoa học"}, {w:"教科書 (きょうかしょ)", m:"Sách giáo khoa"}] },
            "学": { hanviet: "HỌC", mean: "Học", on: "ガク", kun: "まな.ぶ", radicals: "Tử (子)", tipImg: "Đứa trẻ đội mũ đi học.", tipSoundOn: "Ka**gaku** khoa học.", tipSoundKun: "**Mana**bu học.", words: [{w:"科学者 (かがくしゃ)", m:"Nhà khoa học"}, {w:"学生 (がくせい)", m:"Học sinh"}] },
            "埋": { hanviet: "MAI", mean: "Chôn/Lấp", on: "マイ", kun: "う.める", radicals: "Thổ (土) + Lý (里)", tipImg: "Chôn dưới đất (土) trong làng (里).", tipSoundOn: "**Mai**sou mai táng.", tipSoundKun: "**U**me tateru lấp.", words: [{w:"埋め立てる (うめたてる)", m:"Lấp (biển)"}, {w:"埋まる (うまる)", m:"Bị lấp"}] },
            "立": { hanviet: "LẬP", mean: "Đứng", on: "リツ", kun: "た.つ", radicals: "Lập (立)", tipImg: "Người đứng trên mặt đất.", tipSoundOn: "Kou**ritsu** công lập.", tipSoundKun: "Ume**ta**teru lập.", words: [{w:"埋め立てる (うめたてる)", m:"Lấp"}, {w:"立ちます (たちます)", m:"Đứng"}] },
            "技": { hanviet: "KỸ", mean: "Kỹ thuật", on: "ギ", kun: "わざ", radicals: "Thủ (扌) + Chi (支)", tipImg: "Tay (扌) khéo léo chi (支) tiết.", tipSoundOn: "**Gi**jutsu kỹ thuật.", tipSoundKun: "**Waza** kỹ năng.", words: [{w:"技術 (ぎじゅつ)", m:"Kỹ thuật"}, {w:"技 (わざ)", m:"Chiêu thức"}] },
            "術": { hanviet: "THUẬT", mean: "Nghệ thuật", on: "ジュツ", kun: "", radicals: "Hành (行) + Thuật (朮)", tipImg: "Đi (彳) đường trồng cây (朮).", tipSoundOn: "Gi**jutsu** kỹ thuật.", tipSoundKun: "", words: [{w:"技術 (ぎじゅつ)", m:"Kỹ thuật"}, {w:"手術 (しゅじゅつ)", m:"Phẫu thuật"}] },
            "土": { hanviet: "THỔ", mean: "Đất", on: "ド", kun: "つち", radicals: "Thổ (土)", tipImg: "Cây mọc trên đất.", tipSoundOn: "**To**chi đất đai.", tipSoundKun: "**Tsuchi** đất.", words: [{w:"土地 (とち)", m:"Đất đai"}, {w:"土曜日 (どようび)", m:"Thứ bảy"}] },
            "地": { hanviet: "ĐỊA", mean: "Đất", on: "チ, ジ", kun: "", radicals: "Thổ (土) + Dã (也)", tipImg: "Đất (土) có bọ cạp (也).", tipSoundOn: "To**chi** đất đai.", tipSoundKun: "", words: [{w:"土地 (とち)", m:"Đất đai"}, {w:"地下 (ちか)", m:"Dưới đất"}] },
            "騒": { hanviet: "TAO", mean: "Ồn ào", on: "ソウ", kun: "さわ.ぐ", radicals: "Mã (馬) + Trùng (蚤)", tipImg: "Ngựa (馬) bị bọ chét (蚤) cắn làm ồn.", tipSoundOn: "**Sou**on tiếng ồn.", tipSoundKun: "**Sawa**gu làm ồn.", words: [{w:"騒音 (そうおん)", m:"Tiếng ồn"}, {w:"騒ぎます (さわぎます)", m:"Làm ồn"}] },
            "音": { hanviet: "ÂM", mean: "Âm thanh", on: "オン", kun: "おと", radicals: "Âm (音)", tipImg: "Đứng (立) nói ngày (日) tạo âm thanh.", tipSoundOn: "Sou**on** tiếng ồn.", tipSoundKun: "**Oto** âm thanh.", words: [{w:"騒音 (そうおん)", m:"Tiếng ồn"}, {w:"音楽 (おんがく)", m:"Âm nhạc"}] },
            "使": { hanviet: "SỬ", mean: "Sử dụng", on: "シ", kun: "つか.う", radicals: "Nhân (亻) + Lại (吏)", tipImg: "Người (亻) sai lại (吏) dịch.", tipSoundOn: "**Shi**you sử dụng.", tipSoundKun: "**Tsuka**u dùng.", words: [{w:"使用 (しよう)", m:"Sử dụng"}, {w:"使います (つかいます)", m:"Dùng"}] },
            "用": { hanviet: "DỤNG", mean: "Dùng", on: "ヨウ", kun: "もち.いる", radicals: "Dụng (用)", tipImg: "Cái hàng rào gỗ.", tipSoundOn: "Shi**you** sử dụng.", tipSoundKun: "**Mochi**iru dùng.", words: [{w:"使用 (しよう)", m:"Sử dụng"}, {w:"用意 (ようい)", m:"Chuẩn bị"}] },
            "豪": { hanviet: "HÀO", mean: "Hào hoa", on: "ゴウ", kun: "", radicals: "Thỉ (豕)", tipImg: "Con lợn (豕) đội mũ cao (高) hào hoa.", tipSoundOn: "**Gou**ka hào hoa.", tipSoundKun: "", words: [{w:"豪華 (ごうか)", m:"Sang trọng"}, {w:"富豪 (ふごう)", m:"Phú ông"}] },
            "華": { hanviet: "HOA", mean: "Hoa lệ", on: "カ", kun: "はな", radicals: "Thảo (艹)", tipImg: "Hoa (艹) nở rực rỡ.", tipSoundOn: "Gou**ka** hào hoa.", tipSoundKun: "**Hana**yakana hoa lệ.", words: [{w:"豪華 (ごうか)", m:"Sang trọng"}, {w:"中華 (ちゅうか)", m:"Trung Hoa"}] },
            "彫": { hanviet: "ĐIÊU", mean: "Điêu khắc", on: "チョウ", kun: "ほ.る", radicals: "Chu (周) + Sam (彡)", tipImg: "Dùng tóc (彡) điêu khắc chu (周) vi.", tipSoundOn: "**Chou**koku điêu khắc.", tipSoundKun: "**Ho**ru khắc.", words: [{w:"彫刻 (ちょうこく)", m:"Điêu khắc"}, {w:"彫ります (ほります)", m:"Khắc"}] },
            "刻": { hanviet: "KHẮC", mean: "Khắc", on: "コク", kun: "きざ.む", radicals: "Đao (刂) + Hợi (亥)", tipImg: "Dùng dao (刂) khắc con heo (亥).", tipSoundOn: "Chou**koku** điêu khắc.", tipSoundKun: "**Kiza**mu thái.", words: [{w:"彫刻 (ちょうこく)", m:"Điêu khắc"}, {w:"遅刻 (ちこく)", m:"Đến muộn"}] },
            "眠": { hanviet: "MIÊN", mean: "Ngủ", on: "ミン", kun: "ねむ.る", radicals: "Mục (目) + Dân (民)", tipImg: "Mắt (目) dân (民) chúng buồn ngủ.", tipSoundOn: "Sui**min** giấc ngủ.", tipSoundKun: "**Nemu**ru ngủ.", words: [{w:"眠ります (ねむります)", m:"Ngủ"}, {w:"眠い (ねむい)", m:"Buồn ngủ"}] },
            "仲": { hanviet: "TRỌNG", mean: "Quan hệ", on: "チュウ", kun: "なか", radicals: "Nhân (亻) + Trung (中)", tipImg: "Người (亻) đứng giữa (中) hòa giải.", tipSoundOn: "**Chuu**sai trọng tài.", tipSoundKun: "**Naka**ma đồng nghiệp.", words: [{w:"仲間 (なかま)", m:"Bạn bè/Đồng nghiệp"}, {w:"仲良し (なかよし)", m:"Thân thiết"}] },
            "鼠": { hanviet: "THỬ", mean: "Chuột", on: "ソ", kun: "ねずみ", radicals: "Thử (鼠)", tipImg: "Hình con chuột.", tipSoundOn: "**So**kei chuột bẹn.", tipSoundKun: "**Nezumi** chuột.", words: [{w:"鼠 (ねずみ)", m:"Con chuột"}] },
            "匹": { hanviet: "THẤT", mean: "Đếm con vật", on: "ヒツ", kun: "ひき", radicals: "Phủ (匚) + Nhân (儿)", tipImg: "Bốn (四) con vật trong chuồng.", tipSoundOn: "**Hitsu**teki đối thủ.", tipSoundKun: "Ip**piki** một con.", words: [{w:"一匹 (いっぴき)", m:"Một con"}] },
            "育": { hanviet: "DỤC", mean: "Nuôi dạy", on: "イク", kun: "そだ.てる", radicals: "Nhục (月)", tipImg: "Nuôi con lớn (亠) bằng thịt (月).", tipSoundOn: "Kyou**iku** giáo dục.", tipSoundKun: "**Soda**teru nuôi.", words: [{w:"育てます (そだてます)", m:"Nuôi dưỡng"}, {w:"教育 (きょういく)", m:"Giáo dục"}] },
            "亡": { hanviet: "VONG", mean: "Chết/Mất", on: "ボウ", kun: "な.くなる", radicals: "Đầu (亠)", tipImg: "Người chết đội nón.", tipSoundOn: "Shi**bou** tử vong.", tipSoundKun: "**Na**kunaru mất.", words: [{w:"死亡 (しぼう)", m:"Tử vong"}, {w:"亡くなります (なくなります)", m:"Mất/Qua đời"}] },
            "籍": { hanviet: "TỊCH", mean: "Hộ tịch", on: "セキ", kun: "", radicals: "Trúc (竹) + Tích (耤)", tipImg: "Sổ sách tre (竹) ghi tích (耤) cũ.", tipSoundOn: "Koku**seki** quốc tịch.", tipSoundKun: "", words: [{w:"国籍 (こくせき)", m:"Quốc tịch"}, {w:"戸籍 (こせき)", m:"Hộ khẩu"}] },
            "比": { hanviet: "TỶ", mean: "So sánh", on: "ヒ", kun: "くら.べる", radicals: "Tỷ (比)", tipImg: "Hai người đứng so sánh nhau.", tipSoundOn: "**Hi**kaku so sánh.", tipSoundKun: "**Kura**beru so sánh.", words: [{w:"比べます (くらべます)", m:"So sánh"}, {w:"比較 (ひかく)", m:"So sánh"}] },
            "際": { hanviet: "TẾ", mean: "Quốc tế/Dịp", on: "サイ", kun: "きわ", radicals: "Phụ (阝) + Tế (祭)", tipImg: "Gò đất (阝) làm lễ tế (祭).", tipSoundOn: "Koku**sai** quốc tế.", tipSoundKun: "**Kiwa** mép.", words: [{w:"国際 (こくさい)", m:"Quốc tế"}, {w:"交際 (こうさい)", m:"Giao du"}] },
            "支": { hanviet: "CHI", mean: "Chi nhánh/Hỗ trợ", on: "シ", kun: "ささ.える", radicals: "Chi (支)", tipImg: "Tay cầm cành cây.", tipSoundOn: "**Shi**sha chi nhánh.", tipSoundKun: "**Sasa**eru nâng đỡ.", words: [{w:"支社 (ししゃ)", m:"Chi nhánh"}, {w:"支店 (してん)", m:"Cửa hàng chi nhánh"}] },
            "企": { hanviet: "XÍ", mean: "Xí nghiệp", on: "キ", kun: "くわだ.てる", radicals: "Nhân (人) + Chỉ (止)", tipImg: "Người (人) dừng (止) lại lập kế hoạch.", tipSoundOn: "**Ki**gyou xí nghiệp.", tipSoundKun: "**Kuwada**teru lên kế hoạch.", words: [{w:"企業 (きぎょう)", m:"Doanh nghiệp"}, {w:"企画 (きかく)", m:"Kế hoạch"}] },
            "展": { hanviet: "TRIỂN", mean: "Triển khai", on: "テン", kun: "", radicals: "Thi (尸)", tipImg: "Mở rộng xác (尸) quần áo.", tipSoundOn: "Hat**ten** phát triển.", tipSoundKun: "", words: [{w:"発展 (はってん)", m:"Phát triển"}, {w:"展覧会 (てんらんかい)", m:"Triển lãm"}] },
            "景": { hanviet: "CẢNH", mean: "Phong cảnh", on: "ケイ", kun: "", radicals: "Nhật (日) + Kinh (京)", tipImg: "Mặt trời (日) chiếu kinh (京) đô.", tipSoundOn: "**Kei**shiki phong cảnh.", tipSoundKun: "", words: [{w:"景色 (けしき)", m:"Phong cảnh"}, {w:"景気 (けいき)", m:"Tình hình kinh tế"}] },
            "宗": { hanviet: "TÔNG", mean: "Tôn giáo", on: "シュウ", kun: "むね", radicals: "Miên (宀) + Thị (示)", tipImg: "Thờ cúng (示) trong nhà (宀).", tipSoundOn: "**Shuu**kyou tôn giáo.", tipSoundKun: "**Mune** tôn chỉ.", words: [{w:"宗教 (しゅうきょう)", m:"Tôn giáo"}] },
            "届": { hanviet: "GIỚI", mean: "Gửi đến", on: "カイ", kun: "とど.く", radicals: "Thi (尸) + Do (由)", tipImg: "Do (由) xác (尸) nhận gửi.", tipSoundOn: "To**do**ku gửi đến.", tipSoundKun: "**Todo**keru chuyển đến.", words: [{w:"届きます (とどきます)", m:"Được gửi đến"}, {w:"届けます (とどけます)", m:"Chuyển đến"}] },
            "掻": { hanviet: "TAO", mean: "Gãi", on: "ソウ", kun: "か.く", radicals: "Thủ (扌)", tipImg: "Tay (扌) gãi ngứa.", tipSoundOn: "**Ka**ku gãi.", tipSoundKun: "**Ka**ku gãi.", words: [{w:"掻きます (かきます)", m:"Gãi"}] },
            "掴": { hanviet: "QUẶC", mean: "Tóm/Nắm", on: "カク", kun: "つか.む", radicals: "Thủ (扌) + Quốc (国)", tipImg: "Tay (扌) nắm lấy đất nước (国).", tipSoundOn: "**Tsuka**mu nắm.", tipSoundKun: "**Tsuka**mu nắm bắt.", words: [{w:"掴みます (つかみます)", m:"Nắm bắt"}] },
            "握": { hanviet: "ÁC", mean: "Nắm tay", on: "アク", kun: "にぎ.る", radicals: "Thủ (扌) + Ốc (屋)", tipImg: "Tay (扌) nắm chặt mái nhà (屋).", tipSoundOn: "**Aku**shu bắt tay.", tipSoundKun: "**Nigi**ru nắm.", words: [{w:"握ります (にぎります)", m:"Nắm (tay)"}, {w:"握手 (あくしゅ)", m:"Bắt tay"}] },
            "近": { hanviet: "CẬN", mean: "Gần", on: "キン", kun: "ちか.い", radicals: "Xước (⻌) + Cân (斤)", tipImg: "Rìu (斤) đi (⻌) đến gần.", tipSoundOn: "**Kin**jo hàng xóm.", tipSoundKun: "**Chika**zuku đến gần.", words: [{w:"近づきます (ちかづきます)", m:"Đến gần"}, {w:"近い (ちかい)", m:"Gần"}] },
            "知": { hanviet: "TRI", mean: "Biết", on: "チ", kun: "し.る", radicals: "Thỉ (矢) + Khẩu (口)", tipImg: "Miệng (口) nói tên (矢) là biết.", tipSoundOn: "**Chi**shiki tri thức.", tipSoundKun: "**Shi**riau quen biết.", words: [{w:"知り合います (しりあいます)", m:"Quen biết"}, {w:"知ります (しります)", m:"Biết"}] },
            "不": { hanviet: "BẤT", mean: "Không", on: "フ", kun: "", radicals: "Nhất (一)", tipImg: "Rễ cây không mọc lên được.", tipSoundOn: "**Fu**to đột nhiên.", tipSoundKun: "", words: [{w:"不図 (ふと)", m:"Đột nhiên"}, {w:"不安 (ふあん)", m:"Bất an"}] },
            "例": { hanviet: "LỆ", mean: "Ví dụ", on: "レイ", kun: "たと.える", radicals: "Nhân (亻) + Liệt (列)", tipImg: "Người (亻) xếp hàng (列) làm ví dụ.", tipSoundOn: "Hi**rei** tỷ lệ.", tipSoundKun: "**Tato**eba ví dụ.", words: [{w:"比例 (ひれい)", m:"Tỷ lệ"}, {w:"例文 (れいぶん)", m:"Câu ví dụ"}] },
            "財": { hanviet: "TÀI", mean: "Tiền tài", on: "ザイ", kun: "", radicals: "Bối (貝) + Tài (才)", tipImg: "Tiền (貝) là tài (才) sản.", tipSoundOn: "**Zai**san tài sản.", tipSoundKun: "", words: [{w:"財産 (ざいさん)", m:"Tài sản"}, {w:"財布 (さいふ)", m:"Ví"}] },
            "足": { hanviet: "TÚC", mean: "Chân/Đủ", on: "ソク", kun: "あし, た.す", radicals: "Túc (足)", tipImg: "Hình cái chân.", tipSoundOn: "En**soku** dã ngoại.", tipSoundKun: "**Ta**su cộng/thêm.", words: [{w:"足します (たします)", m:"Thêm vào"}, {w:"足 (あし)", m:"Chân"}] },
            "薄": { hanviet: "BẠC", mean: "Mỏng/Nhạt", on: "ハク", kun: "うす.い", radicals: "Thảo (艹) + Phổ (溥)", tipImg: "Cỏ (艹) mọc mỏng ven nước.", tipSoundOn: "Haku**mei** bạc mệnh.", tipSoundKun: "**Usu**i nhạt.", words: [{w:"薄い (うすい)", m:"Nhạt/Mỏng"}] },
            "増": { hanviet: "TĂNG", mean: "Tăng lên", on: "ゾウ", kun: "ふ.える", radicals: "Thổ (土) + Tăng (曽)", tipImg: "Đất (土) từng (曽) tăng lên.", tipSoundOn: "**Zou**ka tăng gia.", tipSoundKun: "**Fu**eru tăng.", words: [{w:"増えます (ふえます)", m:"Tăng lên"}, {w:"増やします (ふやします)", m:"Làm tăng"}] },
            "減": { hanviet: "GIẢM", mean: "Giảm đi", on: "ゲン", kun: "へ.る", radicals: "Thủy (氵) + Hàm (咸)", tipImg: "Nước (氵) mặn (咸) giảm đi.", tipSoundOn: "**Gen**shou giảm thiểu.", tipSoundKun: "**He**ru giảm.", words: [{w:"減ります (へります)", m:"Giảm đi"}, {w:"減らします (へらします)", m:"Làm giảm"}] },
            "譲": { hanviet: "NHƯỢNG", mean: "Nhường", on: "ジョウ", kun: "ゆず.る", radicals: "Ngôn (言) + Tương (襄)", tipImg: "Lời nói (言) khiêm nhường (襄).", tipSoundOn: "**Jou**ho nhượng bộ.", tipSoundKun: "**Yuzu**ru nhường.", words: [{w:"譲ります (ゆずります)", m:"Nhường"}] },
            "助": { hanviet: "TRỢ", mean: "Giúp đỡ", on: "ジョ", kun: "たす.ける", radicals: "Lực (力) + Thả (且)", tipImg: "Dùng sức (力) và (且) giúp đỡ.", tipSoundOn: "**Jo**shu trợ thủ.", tipSoundKun: "**Tasu**keru giúp.", words: [{w:"助かります (たすかります)", m:"Được giúp"}, {w:"助けます (たすけます)", m:"Giúp đỡ"}] },
            "虐": { hanviet: "NGƯỢC", mean: "Ngược đãi", on: "ギャク", kun: "いじ.める", radicals: "Hổ (虍)", tipImg: "Hổ (虍) ngược đãi người.", tipSoundOn: "**Gyaku**tai ngược đãi.", tipSoundKun: "**Iji**meru bắt nạt.", words: [{w:"虐めます (いじめます)", m:"Bắt nạt"}] },
            "騙": { hanviet: "PHIẾN", mean: "Lừa gạt", on: "ヘン", kun: "だま.す", radicals: "Mã (馬) + Biển (扁)", tipImg: "Ngựa (馬) nhỏ (扁) lừa người.", tipSoundOn: "**Dama**su lừa.", tipSoundKun: "**Dama**su lừa gạt.", words: [{w:"騙します (だまします)", m:"Lừa gạt"}] },
            "神": { hanviet: "THẦN", mean: "Thần thánh", on: "シン", kun: "かみ", radicals: "Kỳ (礻) + Thân (申)", tipImg: "Thần (礻) nói (申).", tipSoundOn: "**Shin**kei thần kinh.", tipSoundKun: "**Mega**mi nữ thần.", words: [{w:"女神 (めがみ)", m:"Nữ thần"}, {w:"神社 (じんじゃ)", m:"Đền thờ"}] },
            "盗": { hanviet: "ĐẠO", mean: "Trộm cướp", on: "トウ", kun: "ぬす.む", radicals: "Mãnh (皿) + Thứ (次)", tipImg: "Lấy trộm đồ thứ (次) trong đĩa (皿).", tipSoundOn: "Gou**tou** cường đạo.", tipSoundKun: "**Nusu**mu ăn trộm.", words: [{w:"盗みます (ぬすみます)", m:"Ăn trộm"}] },
            "留": { hanviet: "LƯU", mean: "Lưu lại", on: "リュウ", kun: "と.める", radicals: "Điền (田) + Mâu (卯)", tipImg: "Ở lại ruộng (田).", tipSoundOn: "**Ru**su vắng nhà.", tipSoundKun: "**To**meru dừng.", words: [{w:"留守中 (るすちゅう)", m:"Khi vắng nhà"}, {w:"留学 (りゅうがく)", m:"Du học"}] },
            "守": { hanviet: "THỦ", mean: "Bảo vệ/Giữ", on: "シュ", kun: "まも.る", radicals: "Miên (宀) + Thốn (寸)", tipImg: "Trong nhà (宀) giữ tấc (寸) đất.", tipSoundOn: "Ru**su** vắng nhà.", tipSoundKun: "**Mamo**ru bảo vệ.", words: [{w:"留守 (るす)", m:"Vắng nhà"}, {w:"守ります (まもります)", m:"Tuân thủ"}] },
            "刺": { hanviet: "THÍCH", mean: "Đâm/Chọc", on: "シ", kun: "さ.す", radicals: "Đao (刂) + Thích (刺 - phần trái)", tipImg: "Dùng dao (刂) đâm.", tipSoundOn: "**Shi**geki kích thích.", tipSoundKun: "**Sa**su đâm/đốt.", words: [{w:"刺さります (ささります)", m:"Mắc/Hóc"}, {w:"刺します (さします)", m:"Đâm/Đốt"}] },
            "殺": { hanviet: "SÁT", mean: "Giết", on: "サツ", kun: "ころ.す", radicals: "Thù (殳) + Sát (杀)", tipImg: "Tay cầm thù (殳) giết.", tipSoundOn: "**Satsu**jin sát nhân.", tipSoundKun: "**Koro**su giết.", words: [{w:"殺します (ころします)", m:"Giết"}] },
            "振": { hanviet: "CHẤN", mean: "Vẫy/Rung", on: "シン", kun: "ふ.る", radicals: "Thủ (扌) + Thần (辰)", tipImg: "Tay (扌) làm chấn (辰) động.", tipSoundOn: "**Shin**dou chấn động.", tipSoundKun: "**Fu**ru vẫy.", words: [{w:"振ります (ふります)", m:"Vẫy tay"}] },
            "捲": { hanviet: "QUYỂN", mean: "Cuộn/Xắn", on: "ケン", kun: "めく.る", radicals: "Thủ (扌) + Quyển (卷)", tipImg: "Tay (扌) cuộn tròn (卷).", tipSoundOn: "**Ken** quyển.", tipSoundKun: "**Meku**ru xắn/lật.", words: [{w:"捲ります (めくります)", m:"Xắn/Lật"}] },
            "隠": { hanviet: "ẨN", mean: "Ẩn nấp", on: "イン", kun: "かく.す", radicals: "Phụ (阝)", tipImg: "Nấp sau gò đất (阝).", tipSoundOn: "**In**kyo ẩn cư.", tipSoundKun: "**Kaku**reru ẩn nấp.", words: [{w:"隠れます (かくれます)", m:"Ẩn nấp"}, {w:"隠します (かくします)", m:"Che giấu"}] }
        };

        // --- 4. APP LOGIC (Standard Day 1 Logic) ---
        let currentIndex = 0; 
        let currentQuizItem = null; 
        let score = 0; 
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', e => { 
                    const t = e.target.value.toLowerCase(); 
                    document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); 
                });
            }

            const quizInput = document.getElementById('quiz-input');
            if (quizInput) {
                quizInput.addEventListener('keypress', e => { if(e.key === 'Enter') checkAnswer(); });
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab !== 'learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab !== 'quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); 
            const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer rounded-lg mx-1 my-1" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth < 768) toggleDrawer();">
                    <div class="flex justify-between font-bold items-center">
                        <span class="text-gray-800 ja-text">${item.Kanji || item.Furigana}</span>
                        <span class="text-gray-300 text-xs font-mono">#${item.STT}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${item.Nghĩa}</div>
                </div>`).join('');
            if (listD) listD.innerHTML = html;
            if (listM) listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; 
            const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            
            const activeItem = document.querySelector(`.vocab-item[data-index="${idx}"]`);
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasKanji = word.Kanji && word.Kanji !== word.Furigana;
            document.getElementById('strokeBtn').classList.toggle('hidden', !hasKanji);
            
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); 
            cont.innerHTML = '';
            
            if(!word.conv) { 
                document.getElementById('emptyState').classList.remove('hidden'); 
                return; 
            }
            document.getElementById('emptyState').classList.add('hidden');
            
            const types = [
                { k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, 
                { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }
            ];
            
            types.forEach(t => {
                const grammarBtn = word.conv.gIds && word.conv.gIds.length > 0 
                    ? `<button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold px-2 py-1 rounded hover:bg-indigo-50 transition"><i class="fas fa-info-circle"></i> Ngữ pháp</button>`
                    : '';

                cont.innerHTML += `
                    <div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100">
                        <div class="flex justify-between border-b border-gray-100 pb-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div>
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">${t.l}</span>
                            </div>
                            ${grammarBtn}
                        </div>
                        <div class="flex justify-between items-start gap-3">
                            <div>
                                <div class="text-lg md:text-xl ja-text font-medium text-gray-800 mb-1 cursor-pointer hover:text-indigo-600 transition-colors" onclick="speakText('${word.conv[t.k]}')">${word.conv[t.k]}</div>
                                <div class="text-sm text-gray-500 italic">${t.m}</div>
                            </div>
                            <button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2 rounded-full hover:bg-${t.c}-50 transition-colors flex-shrink-0">
                                <i class="fas fa-volume-up text-xl"></i>
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); 
            const f = document.getElementById('dgFormula'); 
            const e = document.getElementById('dgExplanation');
            
            f.innerText = ids.map(id => grammarRepo[id] ? grammarRepo[id].formula : "N/A").join("  /  ");
            e.innerHTML = ids.map(id => {
                if (!grammarRepo[id]) return `<div class="text-red-500">Missing grammar: ${id}</div>`;
                return `
                <div class="pb-2 border-b border-gray-100 last:border-0">
                    <strong class="text-indigo-700 block mb-1">${grammarRepo[id].title} <span class="text-xs font-normal text-gray-400">(${grammarRepo[id].desc.split(':')[0]})</span></strong>
                    <p>${grammarRepo[id].desc.split(':').slice(1).join(':') || grammarRepo[id].desc}</p>
                    <p class="text-xs text-gray-400 mt-1 italic">Vd: ${grammarRepo[id].ex}</p>
                </div>`;
            }).join("");
            
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); 
            grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col justify-between hover:shadow-md transition cursor-pointer" onclick="speakText('${r.ex}')">
                        <div>
                            <div class="font-bold text-sm text-indigo-600 mb-1 flex items-center gap-2"><i class="fas fa-tag text-xs"></i> ${r.title}</div>
                            <code class="text-xs block bg-gray-50 p-1.5 rounded mb-2 border border-gray-200 font-mono text-gray-700">${r.formula}</code>
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">${r.desc}</p>
                        </div>
                        <div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2 mt-2">
                            <span class="text-[11px] font-medium text-indigo-800 ja-text truncate">${r.ex}</span>
                            <i class="fas fa-volume-up text-indigo-400 text-xs"></i>
                        </div>
                    </div>`;
            });
        }

        function showModal(id) { 
            const modal = document.getElementById(id);
            modal.classList.remove('hidden'); 
            setTimeout(() => { 
                document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); 
                document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); 
            }, 10); 
        }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); 
            const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); 
            if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        function openGrammarList() { showModal('grammarListModal'); }

        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; 
            const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g) || [];
            if(kanjis.length === 0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); 
            tabs.innerHTML = '';
            if(kanjis.length > 1) {
                kanjis.forEach(k => {
                    const b = document.createElement('button'); 
                    b.innerText = k;
                    b.className = `w-12 h-12 text-xl rounded-xl font-bold border transition ja-text ${k===target ? 'bg-pink-600 text-white border-pink-600 shadow-lg' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`;
                    b.onclick = () => showKanjiStroke(k); 
                    tabs.appendChild(b);
                });
            }
            showModal('strokeModal'); 
            await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; 
            const c = document.getElementById('kanjiDetailContent'); 
            const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText = k; 
                document.getElementById('detailHanViet').innerText = d.hanviet || '?';
                document.getElementById('detailMeaning').innerText = d.mean || ''; 
                document.getElementById('detailOn').innerText = d.on || '-'; 
                document.getElementById('detailKun').innerText = d.kun || '-';
                document.getElementById('detailRadicals').innerText = d.radicals || '...';
                
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML = fmt(d.tipImg || ''); 
                
                let soundContent = d.tipSound || '';
                if (!soundContent && (d.tipSoundOn || d.tipSoundKun)) {
                    soundContent = [d.tipSoundOn, d.tipSoundKun].filter(Boolean).join(' / ');
                }
                document.getElementById('detailTipSound').innerHTML = fmt(soundContent);
                
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); 
                wc.innerHTML = '';
                if(d.words) {
                    d.words.forEach(w => wc.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer border border-transparent hover:border-gray-200 transition" onclick="speakText('${w.w}')"><span class="text-lg font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500 font-medium">${w.m}</span></div>`);
                }
            } else { 
                c.classList.add('hidden'); e.classList.remove('hidden'); 
            }
            const anim = document.getElementById('strokeAnimContainer'); 
            const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<i class="fas fa-spinner fa-spin text-gray-300 text-2xl"></i>'; 
            grid.innerHTML = '';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;')); 
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                replayStrokeAnimation();
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); 
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); 
                    b.className = "w-16 h-16 stroke-grid-box flex items-center justify-center rounded bg-white shadow-sm";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; } 
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML = "<span class='text-xs text-red-400'>Lỗi tải nét viết</span>"; }
        }

        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth;
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len; p.style.strokeDashoffset = len; p.style.opacity = '1';
                setTimeout(() => { p.style.transition = `stroke-dashoffset 0.6s ease-in-out`; p.style.strokeDashoffset = '0'; }, delay * 1000);
                delay += 0.6;
            });
        }

        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(t); u.lang = 'ja-JP'; u.rate = 0.9; speechSynthesis.speak(u); } }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); } }

        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all inline-block";
            const inp = document.getElementById('quiz-input'); inp.value = ''; inp.disabled = false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuizItem = valid[Math.floor(Math.random() * valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuizItem.Kanji || currentQuizItem.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuizItem.Nghĩa;
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled = true; 
            const correct = inp.value.trim() === currentQuizItem.Furigana;
            const k = document.getElementById('quiz-kanji'); const fbTitle = document.getElementById('feedback-title'); const fbArea = document.getElementById('feedback-area');
            if(correct) { 
                score += 10; k.classList.add("text-green-600", "correct-anim"); 
                fbTitle.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i> Chính xác!</span>';
                fbArea.className = fbArea.className.replace("bg-red-50 border-red-200", "") + " bg-green-50 border-green-200";
                speakText(currentQuizItem.Furigana); 
            } else { 
                score = Math.max(0, score - 5); k.classList.add("text-red-500", "wrong-anim"); 
                fbTitle.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i> Sai rồi!</span>';
                fbArea.className = fbArea.className.replace("bg-green-50 border-green-200", "") + " bg-red-50 border-red-200";
            }
            document.getElementById('score-display').innerText = score; document.getElementById('correct-answer').innerText = currentQuizItem.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function playQuizAudio() { if(currentQuizItem) speakText(currentQuizItem.Furigana); }
        function prevWord() { if(currentIndex > 0) loadWord(currentIndex - 1); }
        function nextWord() { if(currentIndex < vocabData.length - 1) loadWord(currentIndex + 1); }

        window.speakCurrent = speakCurrent;
        window.switchTab = switchTab;
        window.openGrammarList = openGrammarList;
        window.openStrokeModal = openStrokeModal;
        window.replayStrokeAnimation = replayStrokeAnimation;
        window.speakText = speakText;
        window.toggleDrawer = toggleDrawer;
        window.nextQuestion = nextQuestion;
        window.checkAnswer = checkAnswer;
        window.playQuizAudio = playQuizAudio;
        window.prevWord = prevWord;
        window.nextWord = nextWord;
        window.loadWord = loadWord;
        window.openExplan = openExplan;
        window.closeModal = closeModal;
        window.showModal = showModal;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
