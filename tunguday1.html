<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 1: Đại từ & Tính từ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <style>
        /* Base Styles */
        body { 
            font-family: 'Nunito', 'Inter', sans-serif; 
            background-color: #f3f4f6; 
            height: 100vh; height: 100dvh; 
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Scrollbar */
        .scroller { -webkit-overflow-scrolling: touch; }
        .scroller::-webkit-scrollbar { width: 5px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

        /* Animations */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .correct-anim { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        .wrong-anim { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Components */
        .vocab-item.active { 
            background-color: #eef2ff; 
            border-left: 4px solid #4f46e5;
            color: #4338ca;
        }
        
        .shadow-card {
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s;
        }
        .shadow-card:active { transform: scale(0.98); }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tab-btn.active {
            background-color: white;
            color: #312e81;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .tab-btn { color: #a5b4fc; }
        .tab-btn:hover:not(.active) { color: white; }

        /* Custom Audio Button */
        .audio-btn:active { transform: scale(0.9); }

        /* Kanji Stroke Styles */
        .stroke-path {
            fill: none;
            stroke: #333;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .stroke-grid-box {
            border: 1px solid #e5e7eb;
            background-color: white;
            position: relative;
        }
        .stroke-grid-box::after {
            content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%;
            background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); z-index: 0;
        }
        .stroke-grid-box::before {
            content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px;
            background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); z-index: 0;
        }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <!-- HEADER -->
    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center space-x-3 cursor-pointer select-none w-full md:w-auto justify-between md:justify-start">
                    <div class="flex items-center gap-3" onclick="location.reload()">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Shadowing & Quiz - Ngày 1</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50">
                        <span id="headerProgress">1/89</span>
                    </div>
                </div>

                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition whitespace-nowrap flex items-center justify-center gap-2">
                            <i class="fas fa-book-open"></i> Học Từ
                        </button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition whitespace-nowrap flex items-center justify-center gap-2">
                            <i class="fas fa-keyboard"></i> Kiểm Tra
                        </button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition whitespace-nowrap flex items-center justify-center gap-2">
                            <i class="fas fa-scroll"></i> Cẩm Nang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="flex flex-1 overflow-hidden relative w-full">
        
        <!-- SECTION 1: LEARN (SHADOWING UI) -->
        <div id="learn-section" class="flex flex-1 w-full overflow-hidden absolute inset-0 fade-in">
            <!-- Sidebar (Desktop) -->
            <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
                <div class="p-4 border-b border-gray-100 bg-gray-50">
                    <div class="relative group">
                        <span class="material-symbols-rounded absolute left-3 top-2.5 text-gray-400 text-xl">search</span>
                        <input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full pl-10 pr-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm">
                    </div>
                </div>
                <div id="vocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
            </aside>

            <!-- Main Shadowing Content -->
            <main id="mainContent" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 md:pb-8 w-full scroll-smooth">
                <div class="max-w-3xl mx-auto flex flex-col items-center">
                    
                    <!-- Word Card -->
                    <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60"></div>
                        <div class="relative z-10 text-center">
                            <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100 shadow-sm">
                                <span id="wordType" class="text-[10px] font-bold uppercase tracking-wider text-indigo-500">WORD</span>
                                <div class="w-px h-3 bg-gray-300"></div>
                                <span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span>
                            </div>
                            
                            <div class="relative inline-block group">
                                <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 mb-2 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">これ</h2>
                                <!-- Visual hint for audio on hover (Desktop) -->
                                <div class="absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-indigo-300 pointer-events-none hidden md:block">
                                    <i class="fas fa-volume-up"></i>
                                </div>
                                <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden" title="Tập viết Kanji">
                                    <i class="fas fa-pen-nib text-sm"></i>
                                </button>
                            </div>

                            <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()">
                                <span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">これ</span>
                                <span id="cardMeaning" class="text-lg text-gray-500">Cái này</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sentence Contexts -->
                    <div class="w-full">
                        <div class="flex items-center gap-2 mb-4 px-1">
                            <div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg"><i class="fas fa-comments"></i></div>
                            <h3 class="font-bold text-gray-700 text-lg">Hội Thoại Thực Tế (Lịch sự & Thân mật)</h3>
                        </div>
                        <div id="sentenceList" class="space-y-4"></div>
                        <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300">
                            <i class="fas fa-comment-slash text-gray-300 text-4xl mb-2"></i>
                            <p class="text-sm text-gray-500">Từ này đặc biệt, chưa có mẫu hội thoại phù hợp.</p>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Mobile Navigation -->
            <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 md:pb-4 z-30 flex items-center justify-between gap-4 md:hidden shadow-lg border-t border-gray-200">
                <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 transition-colors"><i class="fas fa-chevron-left"></i></button>
                <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg shadow-indigo-200 active:bg-indigo-700 transition-colors gap-2"><i class="fas fa-list-ul"></i> Danh Sách</button>
                <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50 transition-colors"><i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- Desktop Floating Nav -->
            <div class="hidden md:flex fixed bottom-8 right-8 gap-3 z-30">
                 <button onclick="prevWord()" class="w-12 h-12 rounded-full bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-lg hover:bg-gray-50 transition-transform hover:-translate-y-1"><i class="fas fa-chevron-left"></i></button>
                 <button onclick="nextWord()" class="w-12 h-12 rounded-full bg-indigo-600 text-white flex items-center justify-center shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-transform hover:-translate-y-1"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <!-- SECTION 2: QUIZ -->
        <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 fade-in z-20">
            <div class="max-w-2xl mx-auto mt-4 md:mt-10">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-10 -mt-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2>
                            <p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p>
                        </div>
                        <div class="text-right relative z-10">
                            <div class="text-xs text-indigo-200 uppercase font-bold">Điểm số</div>
                            <div class="text-4xl font-bold font-mono" id="score-display">0</div>
                        </div>
                    </div>
                    <div class="p-6 md:p-10 text-center">
                        <div class="mb-8">
                            <div class="text-xs text-gray-400 mb-2 uppercase tracking-wide font-bold">Từ này đọc là gì?</div>
                            <div id="quiz-kanji" class="text-6xl md:text-7xl kanji-font font-bold text-gray-800 mb-4 transition-all"></div>
                            <div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div>
                        </div>
                        <div class="relative max-w-md mx-auto mb-8">
                            <input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 focus:outline-none transition-all kanji-font placeholder-gray-300" placeholder="nhập hiragana..." autocomplete="off">
                        </div>
                        <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in">
                            <div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div>
                            <div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">
                                Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-2 py-0.5 bg-indigo-50 rounded border border-indigo-100 ja-text"></span>
                                <button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200"><i class="fas fa-volume-up"></i></button>
                            </div>
                        </div>
                        <div>
                            <button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg shadow-indigo-200 transform transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto"><i class="fas fa-check"></i> Kiểm Tra</button>
                            <button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transform transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">Câu Tiếp Theo <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MOBILE DRAWER -->
    <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none md:hidden">
        <div id="drawerBackdrop" class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300" onclick="toggleDrawer()"></div>
        <div id="drawerContent" class="absolute inset-y-0 bottom-0 left-0 w-[85%] max-w-sm bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 flex flex-col pointer-events-auto">
            <div class="p-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2"><i class="fas fa-list text-indigo-600"></i> Danh Sách Từ</h3>
                <button onclick="toggleDrawer()" class="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-500 shadow-sm active:scale-95"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-3 border-b border-gray-100">
                <input type="text" id="mobileSearchInput" placeholder="Tìm nhanh..." class="w-full px-4 py-2.5 bg-gray-100 border-transparent rounded-xl text-sm focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all">
            </div>
            <div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
        </div>
    </div>

    <!-- GRAMMAR LIST MODAL (General Menu) -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="listBackdrop" onclick="closeModal('grammarListModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="listPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg"><i class="fas fa-book"></i></div>
                    <div><h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3><p class="text-xs text-gray-500">7 Mẫu câu trọng điểm (Ngày 1)</p></div>
                </div>
                <button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end">
                <button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 hover:bg-gray-900 text-white font-bold rounded-full text-sm transition-transform active:scale-95 shadow-lg">Đã Hiểu</button>
            </div>
        </div>
    </div>

    <!-- GRAMMAR DETAIL MODAL (Specific) -->
    <div id="detailModal" class="fixed inset-0 z-[70] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailBackdrop" onclick="closeModal('detailModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailPanel">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i id="modalIcon" class="fas fa-info-circle"></i></div>
                    <h3 class="text-lg font-bold text-gray-800" id="modalTitle">Chi tiết</h3>
                </div>
                <button onclick="closeModal('detailModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4">
                    <code class="text-lg font-bold text-indigo-700 font-mono" id="modalFormula"></code>
                </div>
                <p class="text-gray-600 text-sm mb-4 leading-relaxed" id="modalExplanation"></p>
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-100">
                    <div class="text-xs font-bold text-gray-400 uppercase mb-2">Ví dụ điển hình</div>
                    <div class="flex justify-between items-start gap-3">
                        <div>
                            <p class="ja-text font-medium text-gray-800 mb-1" id="modalExampleJa"></p>
                            <p class="text-xs text-gray-500 italic" id="modalExampleVi"></p>
                        </div>
                        <button id="modalPlayBtn" class="text-indigo-500 hover:text-indigo-700 p-1"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STROKE ORDER MODAL -->
    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl">
                <h3 class="text-lg font-bold text-pink-700 flex items-center gap-2">
                    <i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji
                </h3>
                <button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left: Writing -->
                    <div class="flex flex-col gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 text-center relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg"><span class="text-xs text-gray-400">Đang tải...</span></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm" title="Viết lại"><i class="fas fa-redo text-sm"></i></button>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                            <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider">Thứ tự từng nét</p>
                            <div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center lg:justify-start"></div>
                        </div>
                    </div>
                    <!-- Right: Info -->
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div>
                                    <h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1"></h2>
                                    <div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block" id="detailHanViet"></div>
                                </div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100"><span class="text-xs font-bold text-gray-400 uppercase block mb-1">On (Âm Nhật)</span><span class="text-lg font-bold text-indigo-600" id="detailOn"></span></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100"><span class="text-xs font-bold text-gray-400 uppercase block mb-1">Kun (Âm Hán)</span><span class="text-lg font-bold text-pink-600" id="detailKun"></span></div>
                            </div>
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100"><h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Mẹo nhớ hình ảnh</h4><p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p></div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100"><h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4><p class="text-sm text-orange-700 leading-relaxed" id="detailTipSound"></p></div>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4>
                                <div class="space-y-2" id="detailWords"></div>
                            </div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4">
                            <i class="fas fa-book-open text-gray-200 text-6xl mb-4"></i>
                            <p class="text-gray-400">Đang cập nhật thông tin chi tiết.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA: KANJI & VOCAB & GRAMMAR ---
        
        // KANJI DATABASE (Complete for Day 1 - 65 Entries)
        const kanjiDetails = {
            "何": { hanviet: "HÀ", mean: "Cái gì", on: "カ", kun: "なに, なん", tipImg: "Người (**亻**) đang gánh (**可**) cái gì đó?", tipSound: "**Na Ni** (**Nani**) là cái gì?", words: [{w:"何 (なに)", m:"Cái gì"}, {w:"何時 (なんじ)", m:"Mấy giờ"}] },
            "人": { hanviet: "NHÂN", mean: "Người", on: "ジン, ニン", kun: "ひと", tipImg: "Hình dáng con người đang bước đi.", tipSound: "**Hi Tô** (**Hito**) là 1 người.", words: [{w:"日本人 (にほんじん)", m:"Người Nhật"}, {w:"人 (ひと)", m:"Người"}] },
            "私": { hanviet: "TƯ", mean: "Tôi", on: "シ", kun: "わたし", tipImg: "Cây lúa (**禾**) là của riêng tư (**ム**).", tipSound: "**Wa Ta Si** (**Watashi**) là tôi.", words: [{w:"私 (わたし)", m:"Tôi"}, {w:"私立 (しりつ)", m:"Tư lập"}] },
            "方": { hanviet: "PHƯƠNG", mean: "Hướng, vị", on: "ホウ", kun: "かた", tipImg: "Hình ảnh lá cờ đang bay về một hướng.", tipSound: "**Kata** là vị (người).", words: [{w:"あの方 (あのかた)", m:"Vị kia"}, {w:"方法 (ほうほう)", m:"Phương pháp"}] },
            "外": { hanviet: "NGOẠI", mean: "Ngoài", on: "ガイ, ゲ", kun: "そと", tipImg: "Buổi tối (**夕**) đi bói (**卜**) ở ngoài đường.", tipSound: "**Gai** góc bên ngoài.", words: [{w:"外国人 (がいこくじん)", m:"Người nước ngoài"}, {w:"外 (そと)", m:"Bên ngoài"}] },
            "国": { hanviet: "QUỐC", mean: "Đất nước", on: "コク", kun: "くに", tipImg: "Vùng đất (**口**) có vua chúa (**玉**) cai trị.", tipSound: "**Co Cự** (**Koku**) là đất nước.", words: [{w:"国 (くに)", m:"Đất nước"}, {w:"外国 (がいこく)", m:"Nước ngoài"}] },
            "彼": { hanviet: "BỈ", mean: "Anh ấy", on: "ヒ", kun: "かれ", tipImg: "Người (**彳**) kia có lớp Da (**皮**) rất dày.", tipSound: "**Ca Rê** (**Kare**) là anh ấy.", words: [{w:"彼 (かれ)", m:"Anh ấy"}, {w:"彼女 (かのじょ)", m:"Cô ấy"}] },
            "女": { hanviet: "NỮ", mean: "Phụ nữ", on: "ジョ", kun: "おんな", tipImg: "Dáng người phụ nữ đang ngồi.", tipSound: "**Ôn Na** (**Onna**) là phụ nữ.", words: [{w:"女 (おんな)", m:"Phụ nữ"}, {w:"彼女 (かのじょ)", m:"Cô ấy"}] },
            "現": { hanviet: "HIỆN", mean: "Hiện tại", on: "ゲン", kun: "あらわ.れる", tipImg: "Vua (**王**) nhìn thấy (**見**) hiện thực.", tipSound: "**Ghen** (**Gen**) tỵ với hiện tại.", words: [{w:"現場 (げんば)", m:"Hiện trường"}, {w:"現在 (げんざい)", m:"Hiện tại"}] },
            "場": { hanviet: "TRƯỜNG", mean: "Nơi chốn", on: "ジョウ", kun: "ば", tipImg: "Vùng Đất (**土**) có mặt trời mọc (**昜**).", tipSound: "**Ba** mẹ ở công trường.", words: [{w:"場所 (ばしょ)", m:"Nơi chốn"}, {w:"会場 (かいじょう)", m:"Hội trường"}] },
            "部": { hanviet: "BỘ", mean: "Bộ phận", on: "ブ", kun: "", tipImg: "Đứng (**立**) ở Miệng (**口**) ấp (**阝**) là trưởng bộ phận.", tipSound: "**Bự** (**Bu**) là bộ phận lớn.", words: [{w:"部屋 (へや)", m:"Căn phòng"}, {w:"部長 (ぶちょう)", m:"Trưởng phòng"}] },
            "屋": { hanviet: "ỐC", mean: "Mái nhà", on: "オク", kun: "や", tipImg: "Xác chết (**尸**) tới (**至**) nhà xác.", tipSound: "**Ya**! Nhà kìa.", words: [{w:"部屋 (へや)", m:"Phòng"}, {w:"屋上 (おくじょう)", m:"Sân thượng"}] },
            "駅": { hanviet: "DỊCH", mean: "Nhà ga", on: "エキ", kun: "", tipImg: "Con Ngựa (**馬**) thồ hàng hoá (**尺**) tới ga.", tipSound: "**Ê Ki** (**Eki**) là nhà ga.", words: [{w:"駅 (えき)", m:"Nhà ga"}, {w:"駅員 (えきいん)", m:"Nhân viên nhà ga"}] },
            "市": { hanviet: "THỊ", mean: "Thành phố", on: "シ", kun: "いち", tipImg: "Cái nắp nồi (**亠**) và cái khăn (**巾**) bán ở chợ.", tipSound: "**Si** (**Shi**) là thành phố.", words: [{w:"市役所 (しやくしょ)", m:"Tòa thị chính"}, {w:"市場 (いちば)", m:"Chợ"}] },
            "役": { hanviet: "DỊCH", mean: "Vai trò, ích lợi", on: "ヤク", kun: "", tipImg: "Người (**彳**) cầm binh khí (**殳**) đi làm nghĩa vụ.", tipSound: "**Ya Cự** (**Yaku**) có ích.", words: [{w:"役所 (やくしょ)", m:"Văn phòng hành chính"}, {w:"役に立つ (やくにたつ)", m:"Có ích"}] },
            "所": { hanviet: "SỞ", mean: "Nơi chốn", on: "ショ", kun: "ところ", tipImg: "Cái cửa (**戸**) có cái rìu (**斤**) canh giữ.", tipSound: "**Tô Cô Rô** (**Tokoro**) là nơi chốn.", words: [{w:"場所 (ばしょ)", m:"Nơi chốn"}, {w:"台所 (だいどころ)", m:"Nhà bếp"}] },
            "学": { hanviet: "HỌC", mean: "Học", on: "ガク", kun: "まな.ぶ", tipImg: "Đứa trẻ (**子**) đội mũ ở trường học.", tipSound: "**Gà Cư** (**Gaku**) đi học.", words: [{w:"学校 (がっこう)", m:"Trường học"}, {w:"学生 (がくせい)", m:"Học sinh"}] },
            "校": { hanviet: "HIỆU", mean: "Trường học", on: "コウ", kun: "", tipImg: "Cây (**木**) giao (**交**) lưu ở trường.", tipSound: "**Cô** (**Kou**) giáo ở trường.", words: [{w:"学校 (がっこう)", m:"Trường học"}, {w:"校長 (こうちょう)", m:"Hiệu trưởng"}] },
            "会": { hanviet: "HỘI", mean: "Gặp gỡ", on: "カイ", kun: "あ.う", tipImg: "Hai người (**二**) gặp nhau nói chuyện dưới mái nhà.", tipSound: "**Cai** (**Kai**) quản hội nghị.", words: [{w:"会社 (かいしゃ)", m:"Công ty"}, {w:"会話 (かいわ)", m:"Hội thoại"}] },
            "社": { hanviet: "XÃ", mean: "Đền, công ty", on: "シャ", kun: "やしろ", tipImg: "Thần đất (**礻**) ở vùng đất (**土**) này.", tipSound: "**Xa** (**Sha**) xã.", words: [{w:"会社 (かいしゃ)", m:"Công ty"}, {w:"社会 (しゃかい)", m:"Xã hội"}] },
            "教": { hanviet: "GIÁO", mean: "Dạy", on: "キョウ", kun: "おし.える", tipImg: "Trẻ em (**子**) hiếu thảo (**孝**) bị đánh khẽ (**攵**) để dạy dỗ.", tipSound: "**Kiêu** (**Kyou**) ngạo cần được dạy.", words: [{w:"教室 (きょうしつ)", m:"Phòng học"}, {w:"教科書 (きょうかしょ)", m:"Sách giáo khoa"}] },
            "室": { hanviet: "THẤT", mean: "Phòng", on: "シツ", kun: "むろ", tipImg: "Dưới mái nhà (**宀**) đến (**至**) phòng ngủ.", tipSound: "**Si Trứ** (**Shitsu**) trong phòng.", words: [{w:"教室 (きょうしつ)", m:"Phòng học"}, {w:"会議室 (かいぎしつ)", m:"Phòng họp"}] },
            "冷": { hanviet: "LÃNH", mean: "Lạnh", on: "レイ", kun: "つめ.たい", tipImg: "Ra lệnh (**令**) đóng băng (**冫**) lạnh giá.", tipSound: "**Rê** (**Rei**) lạnh run.", words: [{w:"冷蔵庫 (れいぞうこ)", m:"Tủ lạnh"}, {w:"冷たい (つめたい)", m:"Lạnh (cảm giác)"}] },
            "蔵": { hanviet: "TÀNG", mean: "Kho, chứa", on: "ゾウ", kun: "くら", tipImg: "Cỏ (**艹**) mọc trên sườn núi (**厂**) che cái kho thần (**臣**) binh khí (**戈**).", tipSound: "**Dô** (**Zou**) kho cất đồ.", words: [{w:"冷蔵庫 (れいぞうこ)", m:"Tủ lạnh"}, {w:"貯蔵 (ちょぞう)", m:"Dự trữ"}] },
            "庫": { hanviet: "KHỐ", mean: "Kho", on: "コ, ク", kun: "くら", tipImg: "Xe (**車**) cất trong gara mái vòm (**广**).", tipSound: "**Cô** (**Ko**) cất xe vào kho.", words: [{w:"車庫 (しゃこ)", m:"Gara xe"}, {w:"金庫 (きんこ)", m:"Két sắt"}] },
            "上": { hanviet: "THƯỢNG", mean: "Trên", on: "ジョウ", kun: "うえ", tipImg: "Chỉ tay lên trên mặt đất.", tipSound: "**U ê** (**Ue**) là ở trên.", words: [{w:"上 (うえ)", m:"Trên"}, {w:"上手 (じょうず)", m:"Giỏi"}] },
            "下": { hanviet: "HẠ", mean: "Dưới", on: "カ, ゲ", kun: "した", tipImg: "Chỉ tay xuống dưới mặt đất.", tipSound: "**Si Ta** (**Shita**) là ở dưới.", words: [{w:"下 (した)", m:"Dưới"}, {w:"地下鉄 (ちかてつ)", m:"Tàu điện ngầm"}] },
            "前": { hanviet: "TIỀN", mean: "Trước", on: "ゼン", kun: "まえ", tipImg: "Cắt thịt (**月**) bằng dao (**刂**) bày ra phía trước.", tipSound: "**Ma E** (**Mae**) là phía trước.", words: [{w:"前 (まえ)", m:"Trước"}, {w:"午前 (ごぜん)", m:"Buổi sáng"}] },
            "後": { hanviet: "HẬU", mean: "Sau", on: "ゴ, コウ", kun: "うし.ろ, あと", tipImg: "Bước chân (**彳**) đi chậm tết dây (**幺**) lê bước (**夂**) tụt lại phía sau.", tipSound: "**Gô** (**Go**) về sau.", words: [{w:"後ろ (うしろ)", m:"Phía sau"}, {w:"午後 (ごご)", m:"Buổi chiều"}] },
            "右": { hanviet: "HỮU", mean: "Phải", on: "ウ, ユウ", kun: "みぎ", tipImg: "Tay (**𠂇**) đưa lên miệng (**口**) ăn tay phải.", tipSound: "**Mi Gi** (**Migi**) là bên phải.", words: [{w:"右 (みぎ)", m:"Phải"}, {w:"右折 (うせつ)", m:"Rẽ phải"}] },
            "左": { hanviet: "TẢ", mean: "Trái", on: "サ", kun: "ひだり", tipImg: "Tay (**𠂇**) cầm thước thợ (**工**) bên trái.", tipSound: "**Hi Đa Ri** (**Hidari**) là bên trái.", words: [{w:"左 (ひだり)", m:"Trái"}, {w:"左折 (させつ)", m:"Rẽ trái"}] },
            "頭": { hanviet: "ĐẦU", mean: "Đầu", on: "トウ", kun: "あたま", tipImg: "Hạt đậu (**豆**) bên phải cái đầu (**頁**).", tipSound: "**A Ta Ma** (**Atama**) là cái đầu.", words: [{w:"頭 (あたま)", m:"Đầu"}, {w:"頭痛 (ずつう)", m:"Đau đầu"}] },
            "髪": { hanviet: "PHÁT", mean: "Tóc", on: "ハツ", kun: "かみ", tipImg: "Tóc dài (**髟**) của người bạn (**友**).", tipSound: "**Ca Mi** (**Kami**) là tóc.", words: [{w:"髪 (かみ)", m:"Tóc"}, {w:"金髪 (きんぱつ)", m:"Tóc vàng"}] },
            "口": { hanviet: "KHẨU", mean: "Miệng", on: "コウ", kun: "くち", tipImg: "Hình cái miệng mở ra.", tipSound: "**Cu Chi** (**Kuchi**) là cái miệng.", words: [{w:"口 (くち)", m:"Miệng"}, {w:"人口 (じんこう)", m:"Dân số"}] },
            "目": { hanviet: "MỤC", mean: "Mắt", on: "モク", kun: "め", tipImg: "Hình con mắt có lòng đen.", tipSound: "**Mê** (**Me**) mẩn đôi mắt.", words: [{w:"目 (め)", m:"Mắt"}, {w:"目的 (もくてき)", m:"Mục đích"}] },
            "耳": { hanviet: "NHĨ", mean: "Tai", on: "ジ", kun: "みみ", tipImg: "Hình cái vành tai.", tipSound: "**Mi Mi** (**Mimi**) là tai.", words: [{w:"耳 (みみ)", m:"Tai"}, {w:"耳鼻科 (じびか)", m:"Khoa tai mũi họng"}] },
            "鼻": { hanviet: "TỊ", mean: "Mũi", on: "ビ", kun: "はな", tipImg: "Tự (**自**) mình cho (**田**) hai tay nâng (**廾**) mũi.", tipSound: "**Ha Na** (**Hana**) là mũi.", words: [{w:"鼻 (はな)", m:"Mũi"}, {w:"鼻水 (はなみず)", m:"Nước mũi"}] },
            "寒": { hanviet: "HÀN", mean: "Lạnh", on: "カン", kun: "さむ.い", tipImg: "Trong nhà (**宀**) vùi trong rơm rạ, dưới băng tuyết (**冫**) lạnh giá.", tipSound: "**Sa Mu** (**Samu**) lạnh quá.", words: [{w:"寒い (さむい)", m:"Lạnh"}, {w:"悪寒 (おかん)", m:"Sốt rét"}] },
            "暑": { hanviet: "THỬ", mean: "Nóng", on: "ショ", kun: "あつ.い", tipImg: "Mặt trời (**日**) chiếu vào Kẻ (**者**) đi đường nóng nực.", tipSound: "**A Tsư** (**Atsu**) nóng quá.", words: [{w:"暑い (あつい)", m:"Nóng"}, {w:"暑中 (しょちゅう)", m:"Giữa hè"}] },
            "暖": { hanviet: "NOÃN", mean: "Ấm áp", on: "ダン", kun: "あたた.かい", tipImg: "Mặt trời (**日**) sưởi ấm cho bạn (**爰**).", tipSound: "**A Ta Ta Cai** (**Atatakai**) ấm áp.", words: [{w:"暖かい (あたたかい)", m:"Ấm áp"}, {w:"暖房 (だんぼう)", m:"Lò sưởi"}] },
            "涼": { hanviet: "LƯƠNG", mean: "Mát mẻ", on: "リョウ", kun: "すず.しい", tipImg: "Nước (**氵**) ở kinh thành (**京**) rất mát.", tipSound: "**Su Zu Si** (**Suzushii**) mát mẻ.", words: [{w:"涼しい (すずしい)", m:"Mát mẻ"}, {w:"清涼 (せいりょう)", m:"Thanh lương"}] },
            "新": { hanviet: "TÂN", mean: "Mới", on: "シン", kun: "あたら.しい", tipImg: "Đứng (**立**) trên cây (**木**) dùng rìu (**斤**) đẽo cái mới.", tipSound: "**A Ta Ra Shi** (**Atarashii**) là mới.", words: [{w:"新しい (あたらしい)", m:"Mới"}, {w:"新聞 (しんぶん)", m:"Báo"}] },
            "古": { hanviet: "CỔ", mean: "Cũ", on: "コ", kun: "ふる.い", tipImg: "Mười (**十**) cái miệng (**口**) kể chuyện xưa.", tipSound: "**Phu Ru** (**Furu**) cũ kỹ.", words: [{w:"古い (ふるい)", m:"Cũ"}, {w:"中古 (ちゅうこ)", m:"Đồ cũ"}] },
            "長": { hanviet: "TRƯỜNG", mean: "Dài", on: "チョウ", kun: "なが.い", tipImg: "Tóc dài bay phấp phới.", tipSound: "**Na Gai** (**Nagai**) dài ngoằng.", words: [{w:"長い (ながい)", m:"Dài"}, {w:"社長 (しゃちょう)", m:"Giám đốc"}] },
            "短": { hanviet: "ĐOẢN", mean: "Ngắn", on: "タン", kun: "みじか.い", tipImg: "Mũi tên (**矢**) cắm vào hạt đậu (**豆**) ngắn ngủn.", tipSound: "**Mi Ji Cai** (**Mijikai**) ngắn quá.", words: [{w:"短い (みじかい)", m:"Ngắn"}, {w:"短気 (たんき)", m:"Nóng nảy"}] },
            "強": { hanviet: "CƯỜNG", mean: "Mạnh", on: "キョウ", kun: "つよ.い", tipImg: "Cây cung (**弓**) bắn con trùng (**虫**) rất mạnh.", tipSound: "**Tsu Yôi** (**Tsuyoi**) mạnh mẽ.", words: [{w:"強い (つよい)", m:"Mạnh"}, {w:"勉強 (べんきょう)", m:"Học tập"}] },
            "弱": { hanviet: "NHƯỢC", mean: "Yếu", on: "ジャク", kun: "よわ.い", tipImg: "Hai cây cung (**弓**) gãy lông vũ (**冫**) rụng tả tơi.", tipSound: "**Yo Wai** (**Yowai**) yếu đuối.", words: [{w:"弱い (よわい)", m:"Yếu"}, {w:"弱点 (じゃくてん)", m:"Điểm yếu"}] },
            "良": { hanviet: "LƯƠNG", mean: "Tốt", on: "リョウ", kun: "い.い, よ.い", tipImg: "Người con gái ăn một chút (**丶**) rễ cây (**艮**) là người lương thiện.", tipSound: "**Yôi** (**Yoi**) tốt.", words: [{w:"良い (いい)", m:"Tốt"}, {w:"不良 (ふりょう)", m:"Bất lương"}] },
            "悪": { hanviet: "ÁC", mean: "Xấu", on: "アク", kun: "わる.い", tipImg: "Tâm (**心**) nghĩ về châu Á (**亜**) làm điều ác.", tipSound: "**Wa Rui** (**Warui**) xấu xa.", words: [{w:"悪い (わるい)", m:"Xấu"}, {w:"悪人 (あくにん)", m:"Người xấu"}] },
            "好": { hanviet: "HẢO", mean: "Thích", on: "コウ", kun: "す.き", tipImg: "Phụ nữ (**女**) ôm con (**子**) là điều tốt đẹp nhất.", tipSound: "**Su Ki** (**Suki**) thích lắm.", words: [{w:"好き (すき)", m:"Thích"}, {w:"友好 (ゆうこう)", m:"Hữu hảo"}] },
            "嫌": { hanviet: "HIỀM", mean: "Ghét", on: "ケン", kun: "きら.い", tipImg: "Phụ nữ (**女**) kiêm (**兼**) việc nhà dễ sinh hiềm khích.", tipSound: "**Ki Rai** (**Kirai**) ghét bỏ.", words: [{w:"嫌い (きらい)", m:"Ghét"}, {w:"機嫌 (きげん)", m:"Tâm trạng"}] },
            "上": { hanviet: "THƯỢNG", mean: "Trên", on: "ジョウ", kun: "うえ", tipImg: "Tay chỉ lên trên.", tipSound: "**Ue** là trên.", words: [{w:"上手 (じょうず)", m:"Giỏi"}, {w:"屋上 (おくじょう)", m:"Sân thượng"}] },
            "手": { hanviet: "THỦ", mean: "Tay", on: "シュ", kun: "て", tipImg: "Hình bàn tay xoè ra.", tipSound: "**Tê** (**Te**) tay.", words: [{w:"手 (て)", m:"Tay"}, {w:"選手 (せんしゅ)", m:"Tuyển thủ"}] },
            "下": { hanviet: "HẠ", mean: "Dưới", on: "カ, ゲ", kun: "した", tipImg: "Tay chỉ xuống dưới.", tipSound: "**Shita** là dưới.", words: [{w:"下手 (へた)", m:"Kém"}, {w:"地下 (ちか)", m:"Dưới đất"}] },
            "便": { hanviet: "TIỆN", mean: "Tiện lợi", on: "ベン, ビン", kun: "たよ.り", tipImg: "Người (**亻**) canh (**更**) cửa rất tiện.", tipSound: "**Ben** trong từ Benri.", words: [{w:"便利 (べんり)", m:"Tiện lợi"}, {w:"郵便 (ゆうびん)", m:"Bưu điện"}] },
            "利": { hanviet: "LỢI", mean: "Lợi ích", on: "リ", kun: "き.く", tipImg: "Cây lúa (**禾**) cắt bằng dao (**刂**) thu lợi.", tipSound: "**Ri** trong Benri.", words: [{w:"便利 (べんり)", m:"Tiện lợi"}, {w:"利用 (りよう)", m:"Sử dụng"}] },
            "不": { hanviet: "BẤT", mean: "Không", on: "フ", kun: "", tipImg: "Cây mọc rễ xuống đất không nhổ lên được.", tipSound: "**Phư** (**Fu**) nhận.", words: [{w:"不便 (ふべん)", m:"Bất tiện"}, {w:"不安 (ふあん)", m:"Bất an"}] },
            "全": { hanviet: "TOÀN", mean: "Toàn bộ", on: "ゼン", kun: "まった.く", tipImg: "Vua (**王**) đứng dưới nón (**入**) cai quản toàn bộ.", tipSound: "**Zen** bộ.", words: [{w:"安全 (あんぜん)", m:"An toàn"}, {w:"全部 (ぜんぶ)", m:"Toàn bộ"}] },
            "忙": { hanviet: "MANG", mean: "Bận", on: "ボウ", kun: "いそが.しい", tipImg: "Tim (**忄**) chết (**亡**) vì quá bận.", tipSound: "**I So Ga** (**Isoga**) bận rộn.", words: [{w:"忙しい (いそがしい)", m:"Bận"}, {w:"多忙 (たぼう)", m:"Rất bận"}] },
            "易": { hanviet: "DỊ", mean: "Dễ", on: "エキ, イ", kun: "やさ.しい", tipImg: "Mặt trời (**日**) lặn đừng (**勿**) lo, mai lại mọc, dễ mà.", tipSound: "**Ya Sa** (**Yasa**) dễ dàng.", words: [{w:"易しい (やさしい)", m:"Dễ"}, {w:"貿易 (ぼうえき)", m:"Ngoại thương"}] },
            "難": { hanviet: "NAN", mean: "Khó", on: "ナン", kun: "むずか.しい", tipImg: "Chim (**隹**) bị Hán (**⻀**) tử bắt rất gian nan.", tipSound: "**Mu Zu** (**Muzu**) khó quá.", words: [{w:"難しい (むずかしい)", m:"Khó"}, {w:"困難 (こんなん)", m:"Khốn nạn/Khó khăn"}] },
            "危": { hanviet: "NGUY", mean: "Nguy hiểm", on: "キ", kun: "あぶ.ない", tipImg: "Người quỳ bên sườn núi (**厂**) rất nguy hiểm.", tipSound: "**A Bu** (**Abu**) nguy hiểm.", words: [{w:"危ない (あぶない)", m:"Nguy hiểm"}, {w:"危険 (きけん)", m:"Nguy hiểm"}] },
            "優": { hanviet: "ƯU", mean: "Ưu tú, hiền", on: "ユウ", kun: "やさ.しい", tipImg: "Người (**亻**) ưu tú biết lo âu (**憂**).", tipSound: "**Ya Sa** (**Yasa**) dịu dàng.", words: [{w:"優しい (やさしい)", m:"Hiền lành"}, {w:"優勝 (ゆうしょう)", m:"Vô địch"}] },
            "厳": { hanviet: "NGHIÊM", mean: "Nghiêm khắc", on: "ゲン", kun: "きび.しい", tipImg: "Dám (**敢**) nói nghiêm túc bên sườn núi (**厂**).", tipSound: "**Ki Bi** (**Kibi**) nghiêm khắc.", words: [{w:"厳しい (きびしい)", m:"Nghiêm khắc"}, {w:"厳重 (げんじゅう)", m:"Nghiêm trọng"}] },
            "大": { hanviet: "ĐẠI", mean: "Lớn", on: "ダイ", kun: "おお.きい", tipImg: "Người dang tay chân.", tipSound: "**Đai** to.", words: [{w:"大きい (おおきい)", m:"To"}, {w:"大学 (だいがく)", m:"Đại học"}] },
            "小": { hanviet: "TIỂU", mean: "Nhỏ", on: "ショウ", kun: "ちい.さい", tipImg: "Móc câu chia 3 phần nhỏ.", tipSound: "**Chi Sai** nhỏ.", words: [{w:"小さい (ちいさい)", m:"Nhỏ"}, {w:"小学校 (しょうがっこう)", m:"Tiểu học"}] },
            "広": { hanviet: "QUẢNG", mean: "Rộng", on: "コウ", kun: "ひろ.い", tipImg: "Cái nhà (**广**) riêng tư (**ム**) rất rộng.", tipSound: "**Hi Rô** (**Hiro**) rộng.", words: [{w:"広い (ひろい)", m:"Rộng"}, {w:"広告 (こうこく)", m:"Quảng cáo"}] },
            "狭": { hanviet: "HIỆP", mean: "Hẹp", on: "キョウ", kun: "せま.い", tipImg: "Con chó (**犭**) bị kẹp (**夹**) vào chỗ hẹp.", tipSound: "**Se Mai** (**Semai**) hẹp.", words: [{w:"狭い (せまい)", m:"Hẹp"}, {w:"狭義 (きょうぎ)", m:"Nghĩa hẹp"}] },
            "高": { hanviet: "CAO", mean: "Cao", on: "コウ", kun: "たか.い", tipImg: "Tòa tháp cao.", tipSound: "**Ta Cai** cao.", words: [{w:"高い (たかい)", m:"Cao/Đắt"}, {w:"高校 (こうこう)", m:"Cấp 3"}] },
            "安": { hanviet: "AN", mean: "Rẻ", on: "アン", kun: "やす.い", tipImg: "Phụ nữ trong nhà an toàn.", tipSound: "**Ya Su** rẻ.", words: [{w:"安い (やすい)", m:"Rẻ"}, {w:"安心 (あんしん)", m:"An tâm"}] },
            "低": { hanviet: "ĐÊ", mean: "Thấp", on: "テイ", kun: "ひく.い", tipImg: "Người (**亻**) cúi thấp chạm vào đáy (**氏**).", tipSound: "**Hi Cư** (**Hiku**) thấp.", words: [{w:"低い (ひくい)", m:"Thấp"}, {w:"低下 (ていか)", m:"Giảm xuống"}] },
            "面": { hanviet: "DIỆN", mean: "Mặt", on: "メン", kun: "おも", tipImg: "Gương mặt trong khung.", tipSound: "**Men** mặt.", words: [{w:"面白い (おもしろい)", m:"Thú vị"}, {w:"真面目 (まじめ)", m:"Nghiêm túc"}] },
            "白": { hanviet: "BẠCH", mean: "Trắng", on: "ハク", kun: "しろ", tipImg: "Mặt trời (**日**) có tia sáng trắng.", tipSound: "**Si Rô** (**Shiro**) trắng.", words: [{w:"面白い (おもしろい)", m:"Thú vị"}, {w:"白 (しろ)", m:"Màu trắng"}] },
            "詰": { hanviet: "CẬT", mean: "Nhét, bí", on: "キツ", kun: "つ.まる", tipImg: "Lời nói (**言**) tốt lành (**吉**) bị nhét lại.", tipSound: "**Tsu Ma** (**Tsuma**) chán ngắt.", words: [{w:"詰まらない (つまらない)", m:"Chán"}, {w:"缶詰 (かんづめ)", m:"Đồ hộp"}] },
            "美": { hanviet: "MỸ", mean: "Đẹp", on: "ビ", kun: "うつく.しい", tipImg: "Con Dê (**⺶**) To (**大**) là đẹp.", tipSound: "**Bi** là đẹp.", words: [{w:"美味しい (おいしい)", m:"Ngon"}, {w:"美人 (びじん)", m:"Người đẹp"}] },
            "味": { hanviet: "VỊ", mean: "Hương vị", on: "ミ", kun: "あじ", tipImg: "Miệng (**口**) nếm vị của cây chưa chín (**未**).", tipSound: "**Mi** trong oishii.", words: [{w:"美味しい (おいしい)", m:"Ngon"}, {w:"趣味 (しゅみ)", m:"Sở thích"}] },
            "旨": { hanviet: "CHỈ", mean: "Ngon, ý chỉ", on: "シ", kun: "うま.い", tipImg: "Cái thìa (**匕**) múc đồ ăn ngọt (**甘**) là ngon.", tipSound: "**U Mai** (**Umai**) ngon.", words: [{w:"旨い (うまい)", m:"Ngon"}, {w:"趣旨 (しゅし)", m:"Ý đồ"}] },
            "重": { hanviet: "TRỌNG", mean: "Nặng", on: "ジュウ", kun: "おも.い", tipImg: "Ngàn (**千**) ngôi làng (**里**) rất nặng.", tipSound: "**Ô Mô** (**Omo**) nặng.", words: [{w:"重い (おもい)", m:"Nặng"}, {w:"体重 (たいじゅう)", m:"Cân nặng"}] },
            "軽": { hanviet: "KHINH", mean: "Nhẹ", on: "ケイ", kun: "かる.い", tipImg: "Xe (**車**) chạy trên đất (**土**) nhẹ nhàng.", tipSound: "**Ca Rui** (**Karui**) nhẹ.", words: [{w:"軽い (かるい)", m:"Nhẹ"}, {w:"軽食 (けいしょく)", m:"Bữa ăn nhẹ"}] },
            "起": { hanviet: "KHỞI", mean: "Dậy", on: "キ", kun: "お.きる", tipImg: "Tẩu (**走**) thoát khỏi kỹ (**己**) viện để khởi nghiệp.", tipSound: "**Ô Ki** (**Oki**) dậy đi.", words: [{w:"起きます (おきます)", m:"Thức dậy"}, {w:"起立 (きりつ)", m:"Đứng lên"}] },
            "立": { hanviet: "LẬP", mean: "Đứng", on: "リツ", kun: "た.つ", tipImg: "Người đứng trên đất.", tipSound: "**Ta Tsu** (**Tatsu**) đứng.", words: [{w:"立ちます (たちみます)", m:"Đứng"}, {w:"国立 (こくりつ)", m:"Quốc lập"}] }
        };

        // --- GRAMMAR CONFIGURATION ---
        const grammarDefs = {
            amari: { 
                id: 'amari', label: 'Không... lắm', icon: 'thermometer-quarter', type: 'adj_i', 
                color: 'text-yellow-600', bg: 'bg-yellow-50',
                validFor: ['adj_i', 'adj_na', 'verb'], 
                formula: 'あまり + Vない / Aくない',
                meaning: 'Biểu thị mức độ không cao lắm (dùng với thể phủ định).',
                example: { ja: '今日はあまり暑くないです。', vi: 'Hôm nay không nóng lắm.' },
                gen: (w, f) => ({
                    polite: `あまり${f.neg_polite}。`,
                    politeVi: `Không ${w['Nghĩa tiếng Việt']} lắm.`,
                    casual: `あまり${f.neg_casual}。`,
                    casualVi: `Hổng ${w['Nghĩa tiếng Việt']} lắm đâu.`
                })
            },
            zenzen: { 
                id: 'zenzen', label: 'Hoàn toàn không', icon: 'times-circle', type: 'adj_i',
                color: 'text-red-600', bg: 'bg-red-50',
                validFor: ['adj_i', 'adj_na', 'verb'],
                formula: 'ぜんぜん + Vない / Aくない',
                meaning: 'Phủ định hoàn toàn mức độ hoặc sự việc.',
                example: { ja: '全然わかりません。', vi: 'Tôi hoàn toàn không hiểu.' },
                gen: (w, f) => ({
                    polite: `全然${f.neg_polite}。`,
                    politeVi: `Hoàn toàn không ${w['Nghĩa tiếng Việt']}.`,
                    casual: `全然${f.neg_casual}。`,
                    casualVi: `Chả ${w['Nghĩa tiếng Việt']} tí nào.`
                })
            },
            nakanaka: { 
                id: 'nakanaka', label: 'Mãi mà không', icon: 'history', type: 'verb',
                color: 'text-gray-600', bg: 'bg-gray-50',
                validFor: ['verb'],
                formula: 'なかなか + Vない',
                meaning: 'Diễn tả sự việc khó xảy ra hoặc mất nhiều thời gian hơn dự kiến.',
                example: { ja: 'バスがなかなか来ません。', vi: 'Xe buýt mãi mà không tới.' },
                gen: (w, f) => ({
                    polite: `なかなか${f.neg_polite}。`,
                    politeVi: `Mãi mà không ${w['Nghĩa tiếng Việt']}.`,
                    casual: `なかなか${f.neg_casual}ね。`,
                    casualVi: `Mãi chả ${w['Nghĩa tiếng Việt']} gì cả.`
                })
            },
            q_mo: {
                id: 'q_mo', label: 'Không... cả', icon: 'ban', type: 'q_word',
                color: 'text-slate-600', bg: 'bg-slate-100',
                validFor: ['q_word'], // who, what, where
                formula: 'Từ để hỏi + も + Vない',
                meaning: 'Phủ định toàn bộ phạm vi.',
                example: { ja: '誰もいません。', vi: 'Không có ai cả.' },
                gen: (w, f) => ({
                    polite: `${w.Furigana}も${f.neg_action_polite}。`,
                    politeVi: `Không ${f.action_vi} ${w['Nghĩa tiếng Việt'].toLowerCase()} cả.`,
                    casual: `${w.Furigana}も${f.neg_action_casual}。`,
                    casualVi: `Chả ${f.action_vi} ${w['Nghĩa tiếng Việt'].toLowerCase()} hết.`
                })
            },
            q_ka: {
                id: 'q_ka', label: '...nào đó', icon: 'question', type: 'q_word',
                color: 'text-indigo-600', bg: 'bg-indigo-50',
                validFor: ['q_word'],
                formula: 'Từ để hỏi + か',
                meaning: 'Biểu thị đối tượng không xác định (ai đó, cái gì đó, đâu đó).',
                example: { ja: '誰か来ましたか。', vi: 'Có ai đến không?' },
                gen: (w, f) => ({
                    polite: `${w.Furigana}か${f.action_polite}か。`,
                    politeVi: `Có ${f.action_vi} ${w['Nghĩa tiếng Việt'].toLowerCase()} đó không?`,
                    casual: `${w.Furigana}か${f.action_casual}？`,
                    casualVi: `Có ${f.action_vi} ${w['Nghĩa tiếng Việt'].toLowerCase()} đó hông?`
                })
            },
            dake: {
                id: 'dake', label: 'Chỉ (khẳng định)', icon: 'bullseye', type: 'noun',
                color: 'text-teal-600', bg: 'bg-teal-50',
                validFor: ['noun', 'object', 'food'],
                formula: 'N + だけ',
                meaning: 'Giới hạn phạm vi (chỉ có cái này, không có cái khác).',
                example: { ja: 'これだけください。', vi: 'Cho tôi chỉ cái này thôi.' },
                gen: (w, f) => ({
                    polite: `${w.Furigana}だけあります。`,
                    politeVi: `Chỉ có ${w['Nghĩa tiếng Việt']} thôi.`,
                    casual: `${w.Furigana}だけあるよ。`,
                    casualVi: `Có mỗi ${w['Nghĩa tiếng Việt']} à.`
                })
            },
            shika: {
                id: 'shika', label: 'Chỉ (phủ định)', icon: 'filter', type: 'noun',
                color: 'text-orange-600', bg: 'bg-orange-50',
                validFor: ['noun', 'object', 'food', 'person'],
                formula: 'N + しか + Vない',
                meaning: 'Nhấn mạnh sự ít ỏi, chỉ có... (ngoài ra không có gì khác).',
                example: { ja: 'これしかありません。', vi: 'Chỉ có mỗi cái này (không còn gì khác).' },
                gen: (w, f) => ({
                    polite: `${w.Furigana}しかありません。`,
                    politeVi: `Chỉ có mỗi ${w['Nghĩa tiếng Việt']} thôi.`,
                    casual: `${w.Furigana}しかない。`,
                    casualVi: `Có mỗi ${w['Nghĩa tiếng Việt']} thôi hà.`
                })
            }
        };

        // --- VOCABULARY DATA (Day 1 - 89 Words) ---
        const vocabData = [
            // Demonstratives (Kosoado) - type: noun/demonstrative
            { "STT":1, "Kanji":"", "Nghĩa tiếng Việt":"cái này", "Furigana":"これ", "type":"noun" },
            { "STT":2, "Kanji":"", "Nghĩa tiếng Việt":"cái đó", "Furigana":"それ", "type":"noun" },
            { "STT":3, "Kanji":"", "Nghĩa tiếng Việt":"cái kia", "Furigana":"あれ", "type":"noun" },
            { "STT":4, "Kanji":"何", "Nghĩa tiếng Việt":"cái gì", "Furigana":"なに", "type":"q_word", "action":"có" },
            { "STT":5, "Kanji":"", "Nghĩa tiếng Việt":"~này", "Furigana":"この", "type":"adj_pre" }, 
            { "STT":6, "Kanji":"", "Nghĩa tiếng Việt":"~đó", "Furigana":"その", "type":"adj_pre" },
            { "STT":7, "Kanji":"", "Nghĩa tiếng Việt":"~kia", "Furigana":"あの", "type":"adj_pre" },
            
            // People
            { "STT":8, "Kanji":"人", "Nghĩa tiếng Việt":"người", "Furigana":"ひと", "type":"noun" },
            { "STT":9, "Kanji":"あの人", "Nghĩa tiếng Việt":"người kia", "Furigana":"あのひと", "type":"noun" },
            { "STT":10, "Kanji":"あの方", "Nghĩa tiếng Việt":"vị kia", "Furigana":"あのかた", "type":"noun" },
            { "STT":11, "Kanji":"外国人", "Nghĩa tiếng Việt":"người nước ngoài", "Furigana":"がいこくじん", "type":"noun" },
            { "STT":12, "Kanji":"私", "Nghĩa tiếng Việt":"tôi", "Furigana":"わたし", "type":"noun" },
            { "STT":13, "Kanji":"", "Nghĩa tiếng Việt":"bạn", "Furigana":"あなた", "type":"noun" },
            { "STT":14, "Kanji":"私たち", "Nghĩa tiếng Việt":"chúng tôi", "Furigana":"わたしたち", "type":"noun" },
            { "STT":33, "Kanji":"彼", "Nghĩa tiếng Việt":"anh ấy", "Furigana":"かれ", "type":"noun" },
            { "STT":34, "Kanji":"彼女", "Nghĩa tiếng Việt":"cô ấy", "Furigana":"かのじょ", "type":"noun" },

            // Places
            { "STT":15, "Kanji":"", "Nghĩa tiếng Việt":"chỗ này", "Furigana":"ここ", "type":"place" },
            { "STT":16, "Kanji":"", "Nghĩa tiếng Việt":"chỗ đó", "Furigana":"そこ", "type":"place" },
            { "STT":17, "Kanji":"", "Nghĩa tiếng Việt":"chỗ kia", "Furigana":"あそこ", "type":"place" },
            { "STT":18, "Kanji":"", "Nghĩa tiếng Việt":"ở đâu", "Furigana":"どこ", "type":"q_word", "action":"đi" },
            { "STT":19, "Kanji":"", "Nghĩa tiếng Việt":"phía này", "Furigana":"こちら", "type":"place" },
            { "STT":20, "Kanji":"", "Nghĩa tiếng Việt":"phía đó", "Furigana":"そちら", "type":"place" },
            { "STT":21, "Kanji":"", "Nghĩa tiếng Việt":"phía kia", "Furigana":"あちら", "type":"place" },
            { "STT":22, "Kanji":"", "Nghĩa tiếng Việt":"phía nào", "Furigana":"どちら", "type":"q_word", "action":"đi" },
            { "STT":23, "Kanji":"現場", "Nghĩa tiếng Việt":"công trường", "Furigana":"げんば", "type":"place" },
            { "STT":24, "Kanji":"部屋", "Nghĩa tiếng Việt":"căn phòng", "Furigana":"へや", "type":"place" },
            { "STT":25, "Kanji":"駅", "Nghĩa tiếng Việt":"nhà ga", "Furigana":"えき", "type":"place" },
            { "STT":26, "Kanji":"市役所", "Nghĩa tiếng Việt":"toà thị chính", "Furigana":"しやくしょ", "type":"place" },
            { "STT":27, "Kanji":"", "Nghĩa tiếng Việt":"cửa hàng tiện lợi", "Furigana":"コンビニ", "type":"place" },
            { "STT":28, "Kanji":"学校", "Nghĩa tiếng Việt":"trường học", "Furigana":"がっこう", "type":"place" },
            { "STT":29, "Kanji":"会社", "Nghĩa tiếng Việt":"công ty", "Furigana":"かいしゃ", "type":"place" },
            { "STT":30, "Kanji":"教室", "Nghĩa tiếng Việt":"phòng học", "Furigana":"きょうしつ", "type":"place" },

            // Things
            { "STT":31, "Kanji":"冷蔵庫", "Nghĩa tiếng Việt":"tủ lạnh", "Furigana":"れいぞうこ", "type":"noun" },
            { "STT":32, "Kanji":"", "Nghĩa tiếng Việt":"giường", "Furigana":"ベッド", "type":"noun" },
            
            // Position
            { "STT":35, "Kanji":"上", "Nghĩa tiếng Việt":"trên", "Furigana":"うえ", "type":"noun" },
            { "STT":36, "Kanji":"下", "Nghĩa tiếng Việt":"dưới", "Furigana":"した", "type":"noun" },
            { "STT":37, "Kanji":"前", "Nghĩa tiếng Việt":"trước", "Furigana":"まえ", "type":"noun" },
            { "STT":38, "Kanji":"後ろ", "Nghĩa tiếng Việt":"sau", "Furigana":"うしろ", "type":"noun" },
            { "STT":39, "Kanji":"右", "Nghĩa tiếng Việt":"phải", "Furigana":"みぎ", "type":"noun" },
            { "STT":40, "Kanji":"左", "Nghĩa tiếng Việt":"trái", "Furigana":"ひだり", "type":"noun" },

            // Body Parts
            { "STT":41, "Kanji":"頭", "Nghĩa tiếng Việt":"đầu", "Furigana":"あたま", "type":"noun" },
            { "STT":42, "Kanji":"髪", "Nghĩa tiếng Việt":"tóc", "Furigana":"かみ", "type":"noun" },
            { "STT":43, "Kanji":"口", "Nghĩa tiếng Việt":"miệng", "Furigana":"くち", "type":"noun" },
            { "STT":44, "Kanji":"目", "Nghĩa tiếng Việt":"mắt", "Furigana":"め", "type":"noun" },
            { "STT":45, "Kanji":"耳", "Nghĩa tiếng Việt":"tai", "Furigana":"みみ", "type":"noun" },
            { "STT":46, "Kanji":"鼻", "Nghĩa tiếng Việt":"mũi", "Furigana":"はな", "type":"noun" },

            // Adjectives (i-adj)
            { "STT":47, "Kanji":"寒い", "Nghĩa tiếng Việt":"lạnh", "Furigana":"さむい", "type":"adj_i" },
            { "STT":48, "Kanji":"暑い", "Nghĩa tiếng Việt":"nóng", "Furigana":"あつい", "type":"adj_i" },
            { "STT":49, "Kanji":"暖かい", "Nghĩa tiếng Việt":"ấm áp", "Furigana":"あたたかい", "type":"adj_i" },
            { "STT":50, "Kanji":"涼しい", "Nghĩa tiếng Việt":"mát mẻ", "Furigana":"すずしい", "type":"adj_i" },
            { "STT":51, "Kanji":"新しい", "Nghĩa tiếng Việt":"mới", "Furigana":"あたらしい", "type":"adj_i" },
            { "STT":52, "Kanji":"古い", "Nghĩa tiếng Việt":"cũ", "Furigana":"ふるい", "type":"adj_i" },
            { "STT":53, "Kanji":"長い", "Nghĩa tiếng Việt":"dài", "Furigana":"ながい", "type":"adj_i" },
            { "STT":54, "Kanji":"短い", "Nghĩa tiếng Việt":"ngắn", "Furigana":"みじかい", "type":"adj_i" },
            { "STT":55, "Kanji":"強い", "Nghĩa tiếng Việt":"mạnh", "Furigana":"つよい", "type":"adj_i" },
            { "STT":56, "Kanji":"弱い", "Nghĩa tiếng Việt":"yếu", "Furigana":"よわい", "type":"adj_i" },
            { "STT":57, "Kanji":"良い", "Nghĩa tiếng Việt":"tốt", "Furigana":"いい", "type":"adj_i" },
            { "STT":58, "Kanji":"悪い", "Nghĩa tiếng Việt":"xấu", "Furigana":"わるい", "type":"adj_i" },
            { "STT":67, "Kanji":"易しい", "Nghĩa tiếng Việt":"dễ", "Furigana":"やさしい", "type":"adj_i" },
            { "STT":68, "Kanji":"難しい", "Nghĩa tiếng Việt":"khó", "Furigana":"むずかしい", "type":"adj_i" },
            { "STT":69, "Kanji":"危ない", "Nghĩa tiếng Việt":"nguy hiểm", "Furigana":"あぶない", "type":"adj_i" },
            { "STT":70, "Kanji":"優しい", "Nghĩa tiếng Việt":"hiền lành", "Furigana":"やさしい", "type":"adj_i" },
            { "STT":71, "Kanji":"厳しい", "Nghĩa tiếng Việt":"nghiêm khắc", "Furigana":"きびしい", "type":"adj_i" },
            { "STT":72, "Kanji":"大きい", "Nghĩa tiếng Việt":"to", "Furigana":"おおきい", "type":"adj_i" },
            { "STT":73, "Kanji":"小さい", "Nghĩa tiếng Việt":"nhỏ", "Furigana":"ちいさい", "type":"adj_i" },
            { "STT":74, "Kanji":"広い", "Nghĩa tiếng Việt":"rộng", "Furigana":"ひろい", "type":"adj_i" },
            { "STT":75, "Kanji":"狭い", "Nghĩa tiếng Việt":"hẹp", "Furigana":"せまい", "type":"adj_i" },
            { "STT":76, "Kanji":"高い", "Nghĩa tiếng Việt":"cao/đắt", "Furigana":"たかい", "type":"adj_i" },
            { "STT":77, "Kanji":"安い", "Nghĩa tiếng Việt":"rẻ", "Furigana":"やすい", "type":"adj_i" },
            { "STT":78, "Kanji":"低い", "Nghĩa tiếng Việt":"thấp", "Furigana":"ひくい", "type":"adj_i" },
            { "STT":79, "Kanji":"面白い", "Nghĩa tiếng Việt":"thú vị", "Furigana":"おもしろい", "type":"adj_i" },
            { "STT":80, "Kanji":"詰まらない", "Nghĩa tiếng Việt":"chán", "Furigana":"つまらない", "type":"adj_i" },
            { "STT":81, "Kanji":"美味しい", "Nghĩa tiếng Việt":"ngon", "Furigana":"おいしい", "type":"adj_i" },
            { "STT":82, "Kanji":"旨い", "Nghĩa tiếng Việt":"ngon/giỏi", "Furigana":"うまい", "type":"adj_i" },
            { "STT":83, "Kanji":"不味い", "Nghĩa tiếng Việt":"dở", "Furigana":"まずい", "type":"adj_i" },
            { "STT":84, "Kanji":"重い", "Nghĩa tiếng Việt":"nặng", "Furigana":"おもい", "type":"adj_i" },
            { "STT":85, "Kanji":"軽い", "Nghĩa tiếng Việt":"nhẹ", "Furigana":"かるい", "type":"adj_i" },
            { "STT":66, "Kanji":"忙しい", "Nghĩa tiếng Việt":"bận rộn", "Furigana":"いそがしい", "type":"adj_i" },

            // Adjectives (na-adj)
            { "STT":59, "Kanji":"好き(な)", "Nghĩa tiếng Việt":"thích", "Furigana":"すき", "type":"adj_na" },
            { "STT":60, "Kanji":"嫌い(な)", "Nghĩa tiếng Việt":"ghét", "Furigana":"きらい", "type":"adj_na" },
            { "STT":61, "Kanji":"上手(な)", "Nghĩa tiếng Việt":"giỏi", "Furigana":"じょうず", "type":"adj_na" },
            { "STT":62, "Kanji":"下手(な)", "Nghĩa tiếng Việt":"kém", "Furigana":"へた", "type":"adj_na" },
            { "STT":63, "Kanji":"便利(な)", "Nghĩa tiếng Việt":"tiện lợi", "Furigana":"べんり", "type":"adj_na" },
            { "STT":64, "Kanji":"不便(な)", "Nghĩa tiếng Việt":"bất tiện", "Furigana":"ふべん", "type":"adj_na" },
            { "STT":65, "Kanji":"安全(な)", "Nghĩa tiếng Việt":"an toàn", "Furigana":"あんぜん", "type":"adj_na" },

            // Verbs
            { "STT":86, "Kanji":"起きます", "Nghĩa tiếng Việt":"thức dậy", "Furigana":"おきます", "type":"verb" },
            { "STT":87, "Kanji":"立ちます", "Nghĩa tiếng Việt":"đứng", "Furigana":"たちます", "type":"verb" },
            
            // Dummy slots for safety as in original
            { "STT": 88, "Kanji": "", "Nghĩa tiếng Việt": "", "Furigana": "", "type": "noun" },
            { "STT": 89, "Kanji": "", "Nghĩa tiếng Việt": "", "Furigana": "", "type": "noun" }
        ].filter(i => i.Furigana); // Cleanup empty

        // --- CONJUGATION HELPERS ---
        function getAdjectiveForms(word) {
            if (word.type === 'adj_i') { return { neg_polite: word.Furigana.slice(0, -1) + 'くないです', neg_casual: word.Furigana.slice(0, -1) + 'くない' }; }
            else if (word.type === 'adj_na') { return { neg_polite: word.Furigana + 'じゃないです', neg_casual: word.Furigana + 'じゃない' }; }
            return null;
        }
        function getVerbForms(word) {
            if (word.Furigana === 'おきます') return { neg_polite: 'おきません', neg_casual: 'おきない' };
            if (word.Furigana === 'たちます') return { neg_polite: 'たちません', neg_casual: 'たたない' };
            return { neg_polite: 'ません', neg_casual: 'ない' };
        }
        function getQWordForms(word) {
            const actVi = word.action || 'làm';
            const sfxP = word.action==='đi' ? '(ikimasen)' : ''; const sfxC = word.action==='đi' ? '(ikanai)' : '';
            return { neg_action_polite: `いません ${sfxP}`, neg_action_casual: `いない ${sfxC}`, action_vi: actVi, action_polite: 'います', action_casual: 'いる' };
        }

        // --- APP LOGIC (Identical to V3.8) ---
        let currentIndex = 0; let currentQuiz = null; let score = 0; let currentStrokeSvg = null;

        function init() { renderList(); renderGrammarList(); loadWord(0); }
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab!=='learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab!=='quiz');
            if(tab === 'quiz') nextQuestion();
        }
        function renderList() {
            const listD = document.getElementById('vocabList'); const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 mb-1 rounded-xl cursor-pointer hover:bg-indigo-50 transition-colors border border-transparent ${i===0?'active':''}" 
                     data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth<768) toggleDrawer();">
                    <div class="flex justify-between items-center"><span class="font-bold text-gray-800 ja-text">${item.Kanji||item.Furigana}</span><span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded">#${item.STT}</span></div>
                    <div class="text-xs text-gray-500 truncate mt-0.5">${item['Nghĩa tiếng Việt']}</div>
                </div>`).join('');
            if(listD) listD.innerHTML = html; if(listM) listM.innerHTML = html;
        }
        function loadWord(idx) {
            currentIndex = idx; const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => { el.classList.remove('active'); el.classList.add('border-transparent'); });
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => { el.classList.add('active'); el.classList.remove('border-transparent'); });
            
            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            const wi = document.getElementById('wordIndex'); if(wi) wi.innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word['Nghĩa tiếng Việt'];
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            
            const hasK = word.Kanji && word.Kanji !== word.Furigana;
            const sb = document.getElementById('strokeBtn'); if(sb) sb.classList.toggle('hidden', !hasK);
            renderContexts(word);
        }
        function renderContexts(word) {
            const cont = document.getElementById('sentenceList'); const empty = document.getElementById('emptyState');
            cont.innerHTML = ''; let hasContext = false;
            Object.values(grammarDefs).forEach(rule => {
                if(!rule.validFor.includes(word.type)) return;
                let forms = {};
                if(word.type==='adj_i'||word.type==='adj_na') forms = getAdjectiveForms(word);
                else if(word.type==='verb') forms = getVerbForms(word);
                else if(word.type==='q_word') forms = getQWordForms(word);
                else forms = {};
                
                const data = rule.gen(word, forms);
                if(!data) return;
                hasContext = true;
                
                const card = document.createElement('div');
                card.className = "shadow-card bg-white rounded-2xl p-4 border border-gray-100";
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3 border-b border-gray-50 pb-2">
                        <div class="flex items-center gap-2"><div class="bg-indigo-50 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-${rule.icon}"></i></div><span class="text-xs font-bold text-gray-500 uppercase tracking-wide">${rule.label}</span></div>
                        <button onclick="openGrammarDetail('${rule.id}')" class="text-xs text-indigo-500 bg-indigo-50 hover:bg-indigo-100 px-2 py-1 rounded-full transition flex items-center gap-1"><i class="fas fa-book-open"></i> Ngữ pháp</button>
                    </div>
                    <div class="mb-3 pl-2 border-l-2 border-indigo-200">
                        <div class="flex justify-between items-start"><div><div class="text-base font-medium text-gray-800 ja-text">${data.polite}</div><div class="text-xs text-gray-500 italic">${data.politeVi}</div></div><button onclick="speakText('${data.polite}')" class="audio-btn text-indigo-400 hover:text-indigo-600 p-1"><i class="fas fa-volume-up"></i></button></div>
                    </div>
                    <div class="pl-2 border-l-2 border-pink-200">
                        <div class="flex justify-between items-start"><div><div class="flex items-center gap-2"><div class="text-base font-medium text-gray-800 ja-text">${data.casual}</div><span class="text-[10px] bg-pink-50 text-pink-600 px-1.5 rounded font-bold">Thân mật</span></div><div class="text-xs text-gray-500 italic">${data.casualVi}</div></div><button onclick="speakText('${data.casual}')" class="audio-btn text-pink-400 hover:text-pink-600 p-1"><i class="fas fa-volume-up"></i></button></div>
                    </div>`;
                cont.appendChild(card);
            });
            empty.classList.toggle('hidden', hasContext); empty.classList.toggle('flex', !hasContext);
        }
        
        // --- MODAL & STROKE LOGIC (Standardized) ---
        function renderGrammarList() {
            const grid = document.getElementById('grammarGrid'); grid.innerHTML = '';
            Object.values(grammarDefs).forEach(r => {
                grid.innerHTML += `<div class="bg-white rounded-xl border border-gray-100 p-4 shadow-sm hover:shadow-md transition cursor-pointer" onclick="closeModal('grammarListModal'); openGrammarDetail('${r.id}')"><div class="flex items-center gap-3 mb-2"><div class="w-8 h-8 rounded-full ${r.bg} ${r.color} flex items-center justify-center"><i class="fas fa-${r.icon} text-sm"></i></div><h4 class="font-bold text-gray-800 text-sm">${r.label}</h4></div><div class="bg-slate-50 rounded px-2 py-1 text-xs font-mono text-slate-600 mb-2 inline-block">${r.formula}</div><p class="text-xs text-gray-500 line-clamp-2">${r.meaning}</p></div>`;
            });
        }
        function openGrammarList() { showModal('grammarListModal'); }
        function openGrammarDetail(id) {
            const r = grammarDefs[id]; if(!r) return;
            document.getElementById('modalTitle').innerText = r.label; document.getElementById('modalIcon').className = `fas fa-${r.icon}`;
            document.getElementById('modalFormula').innerText = r.formula; document.getElementById('modalExplanation').innerText = r.meaning;
            document.getElementById('modalExampleJa').innerText = r.example.ja; document.getElementById('modalExampleVi').innerText = r.example.vi;
            document.getElementById('modalPlayBtn').onclick = () => speakText(r.example.ja);
            showModal('detailModal');
        }
        function showModal(id) {
            document.getElementById(id).classList.remove('hidden');
            setTimeout(() => { document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); }, 10);
        }
        function closeModal(id) {
            document.getElementById(id.replace('Modal','Backdrop')).classList.add('opacity-0');
            document.getElementById(id.replace('Modal','Panel')).classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200);
        }
        
        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g)||[];
            if(kanjis.length===0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); tabs.innerHTML = '';
            if(kanjis.length>1) kanjis.forEach(k => {
                const b = document.createElement('button'); b.innerText = k;
                b.className = `w-10 h-10 rounded-lg font-bold border transition ${k===target?'bg-pink-600 text-white':'bg-white text-gray-600'}`;
                b.onclick = () => showKanjiStroke(k); tabs.appendChild(b);
            });
            showModal('strokeModal'); await showKanjiStroke(target);
        }
        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        async function showKanjiStroke(k) {
            // Details
            const d = kanjiDetails[k]; const content = document.getElementById('kanjiDetailContent'); const empty = document.getElementById('kanjiDetailEmpty');
            if(d) {
                content.classList.remove('hidden'); empty.classList.add('hidden');
                document.getElementById('detailKanji').innerText=k; document.getElementById('detailHanViet').innerText=d.hanviet;
                document.getElementById('detailMeaning').innerText=d.mean; document.getElementById('detailOn').innerText=d.on; document.getElementById('detailKun').innerText=d.kun;
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML=fmt(d.tipImg); document.getElementById('detailTipSound').innerHTML=fmt(d.tipSound);
                const wc = document.getElementById('detailWords'); wc.innerHTML='';
                d.words.forEach(w => wc.innerHTML+=`<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer" onclick="speakText('${w.w.split(' ')[0]}')"><span class="text-sm font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500">${w.m}</span></div>`);
            } else { content.classList.add('hidden'); empty.classList.remove('hidden'); }
            
            // SVG
            const anim = document.getElementById('strokeAnimContainer'); const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '<span class="text-xs text-gray-400">Loading...</span>'; grid.innerHTML='';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svg = await r.text();
                anim.innerHTML = svg;
                const mainSvg = anim.querySelector('svg'); mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                const paths = mainSvg.querySelectorAll('path');
                paths.forEach(p => { p.style.stroke="#333"; p.style.strokeWidth="4"; p.style.fill="none"; p.style.strokeLinecap="round"; p.style.strokeLinejoin="round"; });
                replayStrokeAnimation();
                // Grid
                const parser = new DOMParser();
                paths.forEach((_, i) => {
                    const box = document.createElement('div'); box.className="w-16 h-16 bg-white border border-gray-200 relative stroke-grid-box flex items-center justify-center rounded";
                    const cloneDoc = parser.parseFromString(svg, "image/svg+xml"); const clone = cloneDoc.querySelector('svg');
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((p, idx) => {
                        p.style.fill="none"; p.style.strokeLinecap="round"; p.style.strokeLinejoin="round";
                        if(idx<i) { p.style.stroke="#e5e7eb"; p.style.strokeWidth="3"; }
                        else if(idx===i) { p.style.stroke="#db2777"; p.style.strokeWidth="4"; }
                        else p.style.display="none";
                    });
                    box.appendChild(clone); grid.appendChild(box);
                });
            } catch(e) { anim.innerHTML="<p class='text-xs text-red-500'>Error</p>"; }
        }
        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            paths.forEach(p => { p.style.transition='none'; p.style.strokeDasharray=p.getTotalLength(); p.style.strokeDashoffset=p.getTotalLength(); });
            void currentStrokeSvg.offsetWidth;
            let d = 0;
            paths.forEach(p => { p.style.transition=`stroke-dashoffset 0.8s ease-in-out ${d}s`; p.style.strokeDashoffset='0'; d+=0.8; });
        }

        // --- COMMON ---
        function speakText(t) { const u = new SpeechSynthesisUtterance(t); u.lang='ja-JP'; speechSynthesis.speak(u); }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function playQuizAudio() { if(currentQuiz) speakText(currentQuiz.Furigana); }
        function toggleDrawer() {
            const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop');
            if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); requestAnimationFrame(() => { c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); }); }
            else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(() => d.classList.add('pointer-events-none'), 300); }
        }
        
        // --- QUIZ ---
        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            const inp = document.getElementById('quiz-input'); inp.value=''; inp.disabled=false; inp.focus();
            currentQuiz = vocabData[Math.floor(Math.random()*vocabData.length)];
            document.getElementById('quiz-kanji').innerText = currentQuiz.Kanji || currentQuiz.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuiz['Nghĩa tiếng Việt'];
            document.getElementById('quiz-kanji').className = "text-6xl md:text-7xl kanji-font font-bold text-gray-800 mb-4 transition-all";
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled=true; const correct = inp.value.trim()===currentQuiz.Furigana;
            const k = document.getElementById('quiz-kanji'); const fb = document.getElementById('feedback-title');
            if(correct) { score+=10; k.className+=" text-green-600 correct-anim"; fb.innerHTML='<i class="fas fa-check-circle text-green-600 mr-2"></i> Chính xác!'; speakText(currentQuiz.Furigana); }
            else { score=Math.max(0,score-5); k.className+=" text-red-600 wrong-anim"; fb.innerHTML='<i class="fas fa-times-circle text-red-600 mr-2"></i> Sai rồi!'; }
            document.getElementById('score-display').innerText=score; document.getElementById('correct-answer').innerText=currentQuiz.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden'); document.getElementById('btn-next').focus();
        }

        // Listeners
        function nextWord() { if(currentIndex<vocabData.length-1) loadWord(currentIndex+1); }
        function prevWord() { if(currentIndex>0) loadWord(currentIndex-1); }
        document.getElementById('searchInput').addEventListener('input', e => { const t = e.target.value.toLowerCase(); document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); });
        document.getElementById('mobileSearchInput').addEventListener('input', e => { const t = e.target.value.toLowerCase(); document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); });
        document.getElementById('quiz-input').addEventListener('keypress', e => { if(e.key==='Enter') checkAnswer(); });

        init();
    </script>
</body>
</html>
