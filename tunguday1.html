<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AzaKanji Tango - Ngày 1: Đại từ & Tính từ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <style>
        body { font-family: 'Nunito', 'Inter', sans-serif; background-color: #f3f4f6; height: 100dvh; overflow: hidden; }
        .ja-text { font-family: 'Noto Sans JP', sans-serif; }
        .scroller { -webkit-overflow-scrolling: touch; }
        .scroller::-webkit-scrollbar { width: 5px; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .vocab-item.active { background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #4338ca; }
        .shadow-card { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        .tab-btn.active { background-color: white; color: #312e81; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .tab-btn { color: #a5b4fc; }
        .stroke-grid-box { border: 1px solid #e5e7eb; background-color: white; position: relative; }
        .stroke-grid-box::after { content: ''; position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: repeating-linear-gradient(to bottom, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); }
        .stroke-grid-box::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: repeating-linear-gradient(to right, #ddd 0, #ddd 4px, transparent 4px, transparent 8px); }
        
        /* Force hidden paths initially to prevent FOUC */
        #strokeAnimContainer svg path { opacity: 0; }
    </style>
</head>
<body class="flex flex-col text-slate-800">

    <header class="bg-indigo-700 text-white shadow-lg flex-none z-40 relative">
        <div class="container mx-auto px-4 py-2 md:py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-3 cursor-pointer select-none w-full md:w-auto justify-between" onclick="location.reload()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-torii-gate text-3xl text-white"></i>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold uppercase tracking-wider">AzaKanji Tango</h1>
                            <p class="text-[10px] md:text-xs text-indigo-200">Shadowing & Grammar - Ngày 1</p>
                        </div>
                    </div>
                    <div class="md:hidden text-xs font-semibold bg-indigo-800 px-3 py-1 rounded-full border border-indigo-500/50"><span id="headerProgress">1/87</span></div>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="flex bg-indigo-900/50 rounded-lg p-1 w-full md:w-auto overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('learn')" id="tab-learn" class="tab-btn active flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2"><i class="fas fa-book-open"></i> Học Từ</button>
                        <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2"><i class="fas fa-keyboard"></i> Kiểm Tra</button>
                        <div class="w-px bg-indigo-600 mx-1"></div>
                        <button onclick="openGrammarList()" class="tab-btn flex-1 md:flex-none px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center justify-center gap-2"><i class="fas fa-scroll"></i> Cẩm Nang</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative w-full">
        <aside class="hidden md:flex w-72 bg-white border-r border-gray-200 flex-col z-10">
            <div class="p-4 border-b border-gray-100 bg-gray-50"><input type="text" id="searchInput" placeholder="Tìm kiếm từ..." class="w-full px-4 py-2 bg-white border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 transition-all shadow-sm"></div>
            <div id="vocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div>
        </aside>

        <main id="mainContent" class="flex-1 overflow-y-auto scroller bg-slate-50 p-4 pb-28 w-full scroll-smooth">
            <div class="max-w-3xl mx-auto flex flex-col items-center">
                <div class="w-full bg-white rounded-2xl p-6 shadow-sm border border-gray-200 mb-6 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-indigo-50 to-pink-50 rounded-bl-full -mr-8 -mt-8 z-0 opacity-60"></div>
                    <div class="relative z-10 text-center">
                        <div class="inline-flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-full mb-4 border border-gray-100"><span id="wordType" class="text-[10px] font-bold uppercase text-indigo-500">WORD</span><div class="w-px h-3 bg-gray-300"></div><span class="text-[10px] text-gray-400 font-mono" id="wordIndex">#1</span></div>
                        <div class="relative inline-block">
                            <h2 id="cardKanji" class="text-5xl md:text-6xl font-bold text-gray-800 mb-2 ja-text tracking-tight cursor-pointer hover:text-indigo-700 transition-colors" onclick="speakCurrent()">見ます</h2>
                            <button id="strokeBtn" onclick="openStrokeModal()" class="absolute -right-10 top-2 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center shadow-sm hover:bg-pink-200 hover:scale-110 transition-all hidden"><i class="fas fa-pen-nib text-sm"></i></button>
                        </div>
                        <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="speakCurrent()"><span id="cardFurigana" class="text-xl text-indigo-600 font-medium ja-text">みます</span><span id="cardMeaning" class="text-lg text-gray-500">Xem, nhìn, trông</span></div>
                    </div>
                </div>

                <div class="w-full">
                    <div class="flex items-center gap-2 mb-4 px-1"><div class="bg-pink-100 text-pink-600 p-1.5 rounded-lg"><i class="fas fa-comments"></i></div><h3 class="font-bold text-gray-700 text-lg">Hội thoại đời sống</h3></div>
                    <div id="sentenceList" class="space-y-4"></div>
                    <div id="emptyState" class="hidden flex-col items-center justify-center p-8 text-center bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400"><i class="fas fa-comment-slash text-4xl mb-2"></i><p class="text-sm">Chưa có hội thoại cho từ này.</p></div>
                </div>
            </div>
        </main>

        <div class="fixed bottom-0 left-0 right-0 glass px-4 py-3 pb-6 z-30 flex items-center justify-between gap-4 md:hidden shadow-lg border-t border-gray-200">
            <button onclick="prevWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50"><i class="fas fa-chevron-left"></i></button>
            <button onclick="toggleDrawer()" class="flex-1 h-12 rounded-xl bg-indigo-600 text-white font-bold flex items-center justify-center shadow-lg gap-2"><i class="fas fa-list-ul"></i> Danh Sách</button>
            <button onclick="nextWord()" class="w-12 h-12 rounded-xl bg-white border border-gray-200 text-gray-600 flex items-center justify-center shadow-sm active:bg-gray-50"><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <div id="quiz-section" class="hidden flex-1 w-full overflow-y-auto scroller bg-slate-100 p-4 absolute inset-0 fade-in z-20">
        <div class="max-w-2xl mx-auto mt-4 md:mt-10">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white flex justify-between items-center relative">
                    <div class="relative z-10"><h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-graduation-cap"></i> Thử Thách</h2><p class="text-indigo-100 text-sm">Nhìn Kanji - Đoán Hiragana</p></div>
                    <div class="text-right relative z-10"><div class="text-xs text-indigo-200 uppercase font-bold">Điểm số</div><div class="text-4xl font-bold font-mono" id="score-display">0</div></div>
                </div>
                <div class="p-6 md:p-10 text-center">
                    <div class="mb-8"><div class="text-xs text-gray-400 mb-2 uppercase font-bold">Từ này đọc là gì?</div><div id="quiz-kanji" class="text-6xl ja-text font-bold text-gray-800 mb-4 transition-all"></div><div id="quiz-meaning" class="text-lg text-indigo-600 font-bold mb-2"></div></div>
                    <div class="relative max-w-md mx-auto mb-8"><input type="text" id="quiz-input" class="w-full text-center text-2xl p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 outline-none transition-all ja-text" placeholder="nhập hiragana..." autocomplete="off"></div>
                    <div id="feedback-area" class="hidden rounded-xl p-5 bg-gray-50 border border-gray-200 text-left mb-6 animate-fade-in"><div id="feedback-title" class="font-bold text-lg mb-2 flex items-center"></div><div class="text-gray-700 mb-3 flex items-center flex-wrap gap-2">Đáp án đúng: <span id="correct-answer" class="font-bold text-xl text-indigo-600 px-2 py-0.5 bg-indigo-50 rounded ja-text"></span><button onclick="playQuizAudio()" class="text-gray-400 hover:text-indigo-600 transition-colors w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-200"><i class="fas fa-volume-up"></i></button></div></div>
                    <div><button id="btn-check" onclick="checkAnswer()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto"><i class="fas fa-check"></i> Kiểm Tra</button><button id="btn-next" onclick="nextQuestion()" class="hidden w-full md:w-auto bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg transition active:scale-95 text-lg flex items-center justify-center gap-2 mx-auto">Câu Tiếp Theo <i class="fas fa-arrow-right"></i></button></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="grammarListModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4"><div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm transition-opacity opacity-0" id="grammarListBackdrop" onclick="closeModal('grammarListModal')"></div><div class="bg-white rounded-2xl w-full max-w-4xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[85vh]" id="grammarListPanel"><div class="p-5 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-2xl"><div class="flex items-center gap-3"><div class="bg-indigo-600 text-white p-2 rounded-lg"><i class="fas fa-book"></i></div><div><h3 class="text-xl font-bold text-gray-800">Cẩm Nang Ngữ Pháp</h3><p class="text-xs text-gray-500">Thư viện ngữ pháp Day 1</p></div></div><button onclick="closeModal('grammarListModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times text-xl"></i></button></div><div class="p-6 overflow-y-auto scroller bg-slate-50"><div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="grammarGrid"></div></div><div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl flex justify-end"><button onclick="closeModal('grammarListModal')" class="px-6 py-2 bg-gray-800 text-white font-bold rounded-full text-sm transition active:scale-95 shadow-lg">Đã Hiểu</button></div></div></div>

    <div id="detailGrammarModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4"><div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="detailGrammarBackdrop" onclick="closeModal('detailGrammarModal')"></div><div class="bg-white rounded-2xl w-full max-w-md relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col" id="detailGrammarPanel"><div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-2xl"><div class="flex items-center gap-2"><div class="bg-indigo-100 p-1.5 rounded-lg text-indigo-600"><i class="fas fa-info-circle"></i></div><h3 class="text-lg font-bold text-gray-800">Giải thích Ngữ pháp</h3></div><button onclick="closeModal('detailGrammarModal')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button></div><div class="p-6"><div class="bg-indigo-50 border border-indigo-100 rounded-xl p-3 text-center mb-4"><code class="text-lg font-bold text-indigo-700 font-mono" id="dgFormula"></code></div><div id="dgExplanation" class="text-gray-600 text-sm mb-4 space-y-2"></div></div></div></div>

    <div id="strokeModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-gray-900/80 backdrop-blur-sm transition-opacity opacity-0" id="strokeBackdrop" onclick="closeModal('strokeModal')"></div>
        <div class="bg-white rounded-2xl w-full max-w-5xl relative z-10 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="strokePanel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-pink-50 rounded-t-2xl"><h3 class="text-lg font-bold text-pink-700 flex items-center gap-2"><i class="fas fa-pen-nib"></i> Tập Viết & Chi Tiết Kanji</h3><button onclick="closeModal('strokeModal')" class="w-8 h-8 rounded-full hover:bg-white flex items-center justify-center text-gray-500 transition-colors"><i class="fas fa-times"></i></button></div>
            <div class="p-6 overflow-y-auto scroller bg-slate-50 flex-1">
                <div id="strokeTabs" class="flex justify-center gap-2 mb-6"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-6 text-center">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 relative">
                            <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Mô phỏng nét viết</p>
                            <div id="strokeAnimContainer" class="w-48 h-48 mx-auto bg-white border border-gray-300 relative stroke-grid-box flex items-center justify-center rounded-lg"></div>
                            <button onclick="replayStrokeAnimation()" class="absolute top-4 right-4 bg-pink-50 text-pink-600 w-8 h-8 rounded-full flex items-center justify-center hover:bg-pink-100 transition shadow-sm"><i class="fas fa-redo text-sm"></i></button>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200"><p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider">Thứ tự từng nét</p><div id="strokeGridContainer" class="flex flex-wrap gap-2 justify-center lg:justify-start"></div></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col h-full text-left">
                        <div id="kanjiDetailContent">
                            <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
                                <div><h2 id="detailKanji" class="text-6xl font-bold text-gray-800 ja-text mb-1"></h2><div class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded inline-block" id="detailHanViet"></div></div>
                                <div class="text-right"><div class="text-2xl font-bold text-gray-600 capitalize" id="detailMeaning"></div></div>
                            </div>
                            <!-- Radicals Breakdown -->
                            <div class="mb-4 bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                                <span class="text-xs font-bold text-indigo-500 uppercase block mb-1">Phân tích Bộ thủ</span>
                                <span class="text-sm font-medium text-indigo-900" id="detailRadicals">...</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">On</span><span class="text-lg font-bold text-indigo-600" id="detailOn"></span></div><button id="btnPlayOn" class="text-indigo-400 hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div>
                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 flex justify-between items-center"><div class="flex flex-col"><span class="text-xs font-bold text-gray-400 uppercase">Kun</span><span class="text-lg font-bold text-pink-600" id="detailKun"></span></div><button id="btnPlayKun" class="text-pink-400 hover:text-pink-600"><i class="fas fa-volume-up"></i></button></div>
                            </div>
                            <div class="space-y-4 mb-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100"><h4 class="text-sm font-bold text-green-800 mb-2 flex items-center gap-2"><i class="fas fa-image"></i> Ghi nhớ hình ảnh</h4><p class="text-sm text-green-700 leading-relaxed" id="detailTipImg"></p></div>
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                    <h4 class="text-sm font-bold text-orange-800 mb-2 flex items-center gap-2"><i class="fas fa-music"></i> Mẹo nhớ âm thanh</h4>
                                    <div class="space-y-2">
                                        <p class="text-sm text-orange-700"><span class="font-bold text-xs bg-orange-200 px-1 rounded text-orange-800 mr-1">ON</span> <span id="detailTipSoundOn"></span></p>
                                        <p class="text-sm text-orange-700"><span class="font-bold text-xs bg-pink-200 px-1 rounded text-pink-800 mr-1">KUN</span> <span id="detailTipSoundKun"></span></p>
                                    </div>
                                </div>
                            </div>
                            <div><h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Từ vựng liên quan</h4><div class="space-y-2" id="detailWords"></div></div>
                        </div>
                        <div id="kanjiDetailEmpty" class="hidden h-full flex flex-col items-center justify-center text-center p-4 text-gray-400"><i class="fas fa-book-open text-4xl mb-2"></i><p class="text-sm">Đang cập nhật chi tiết cho chữ Hán này.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="mobileDrawer" class="fixed inset-0 z-50 pointer-events-none md:hidden"><div id="drawerBackdrop" class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300" onclick="toggleDrawer()"></div><div id="drawerContent" class="absolute inset-y-0 bottom-0 left-0 w-[85%] max-w-sm bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 flex flex-col pointer-events-auto"><div class="p-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between"><h3 class="font-bold text-lg text-gray-800 flex items-center gap-2"><i class="fas fa-list text-indigo-600"></i> Danh Sách Từ</h3><button onclick="toggleDrawer()" class="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-500 shadow-sm active:scale-95"><i class="fas fa-times"></i></button></div><div class="p-3 border-b border-gray-100"><input type="text" id="mobileSearchInput" placeholder="Tìm nhanh..." class="w-full px-4 py-2.5 bg-gray-100 border-transparent rounded-xl text-sm focus:bg-white focus:ring-2 focus:ring-indigo-500 transition-all"></div><div id="mobileVocabList" class="flex-1 overflow-y-auto scroller p-2 space-y-1"></div></div></div>

    <script>
        const grammarRepo = {
            "te_kudasai": { title: "Yêu cầu lịch sự", formula: "Vてください", desc: "Dùng để nhờ vả, yêu cầu người khác làm gì đó một cách lịch sự.", ex: "これを見せてください。" },
            "wa_desu": { title: "Cấu trúc định danh", formula: "N1 は N2 です", desc: "Khẳng định chủ đề N1 là danh từ N2.", ex: "私は学生です。" },
            "wa_adj": { title: "Tính chất của chủ ngữ", formula: "N は A です", desc: "Mô tả tính chất, trạng thái của chủ ngữ.", ex: "この本は面白いです。" },
            "ga_nature": { title: "Chủ ngữ của tính từ", formula: "N が A", desc: "Trợ từ 'ga' đánh dấu đối tượng của tính từ chỉ năng lực, sở thích, trạng thái.", ex: "歌が下手です。" },
            "no_particle": { title: "Trợ từ sở hữu", formula: "N1 の N2", desc: "Chỉ sự sở hữu hoặc bổ nghĩa cho danh từ. N1 thuộc về N2.", ex: "私の本です。" },
            "amari_nai": { title: "Mức độ thấp (Không lắm)", formula: "あまり + Phủ định", desc: "Biểu thị tính chất hoặc hành động không cao lắm. Luôn đi kèm phủ định.", ex: "あまり暑くないです。" },
            "zenzen_nai": { title: "Phủ định hoàn toàn", formula: "全然 + Phủ định", desc: "Nhấn mạnh việc hoàn toàn không có hoặc không làm gì đó.", ex: "全然わかりません。" },
            "ka_selection": { title: "Lựa chọn (Hoặc)", formula: "N1 か N2", desc: "Kết nối 2 đối tượng để đưa ra sự lựa chọn.", ex: "ご飯かパンを食べます。" },
            "tai_desu": { title: "Mong muốn", formula: "V(bỏ masu) + たいです", desc: "Diễn tả ý muốn làm một việc gì đó của bản thân.", ex: "日本へ行きたいです。" },
            "nakanaka": { title: "Mãi mà không", formula: "なかなか + Vない", desc: "Diễn tả sự việc khó xảy ra hoặc mất thời gian hơn dự kiến.", ex: "バスがなかなか来ません。" },
            "dake": { title: "Giới hạn (Chỉ có)", formula: "N + だけ", desc: "Giới hạn phạm vi duy nhất vào đối tượng N.", ex: "日曜日だけ休みます。" },
            "shika_nai": { title: "Duy nhất (Tiêu cực)", formula: "N + しか + Vない", desc: "Nhấn mạnh sự ít ỏi, chỉ có N (ngoài ra không có gì khác).", ex: "これしかありません。" },
            "q_ka": { title: "Từ phiếm chỉ", formula: "Từ để hỏi + か", desc: "Biến từ để hỏi thành danh từ không xác định (ai đó, cái gì đó...).", ex: "誰かいますか。" },
            "adj_te": { title: "Nối tính từ", formula: "A(bỏ i) -> くて", desc: "Dùng để nối các tính từ đuôi i với nhau hoặc chỉ nguyên nhân.", ex: "広くていいですね。" },
            "ni_iru": { title: "Sự tồn tại (Người)", formula: "N + に います", desc: "Diễn tả việc có ai đó ở một địa điểm cụ thể.", ex: "部屋に誰かいます。" },
            "ni_aru": { title: "Sự tồn tại (Vật)", formula: "N + に あります", desc: "Diễn tả việc có đồ vật ở một địa điểm cụ thể.", ex: "机の上に本があります。" },
            "mashou_ka": { title: "Đề nghị giúp đỡ", formula: "Vましょうか", desc: "Dùng khi muốn giúp đỡ đối phương việc gì đó.", ex: "持ちましょうか。" }
        };

        const vocabData = [
            { STT:1, Kanji:"", Nghĩa:"cái này", Furigana:"これ", type:"noun", conv: { polite: "これを見せてください。", pVi: "Xin hãy cho tôi xem cái này.", casual: "これ、見せて！", cVi: "Cho xem cái này đi!", gIds: ["te_kudasai"] }},
            { STT:2, Kanji:"", Nghĩa:"cái đó", Furigana:"それ", type:"noun", conv: { polite: "それは誰の時計ですか。", pVi: "Cái đó là đồng hồ của ai vậy?", casual: "それ、だれの時計？", cVi: "Đồng hồ của ai đấy?", gIds: ["no_particle", "wa_desu"] }},
            { STT:3, Kanji:"", Nghĩa:"cái kia", Furigana:"あれ", type:"noun", conv: { polite: "あれはあまり好きじゃないです。", pVi: "Cái kia tôi không thích lắm.", casual: "あれ、あんまり好きじゃない。", cVi: "Cái đó không khoái lắm.", gIds: ["amari_nai", "ga_nature"] }},
            { STT:4, Kanji:"何", Nghĩa:"cái gì", Furigana:"なに", type:"q_word", conv: { polite: "何か飲みませんか。", pVi: "Bạn có muốn uống cái gì đó không?", casual: "何か飲む？", cVi: "Uống gì hông?", gIds: ["q_ka"] }},
            { STT:5, Kanji:"", Nghĩa:"~này", Furigana:"この", type:"adj_pre", conv: { polite: "この本は私の本です。", pVi: "Quyển sách này là sách của tôi.", casual: "この本、私のだよ。", cVi: "Quyển này của mình.", gIds: ["no_particle", "wa_desu"] }},
            { STT:6, Kanji:"", Nghĩa:"~đó", Furigana:"その", type:"adj_pre", conv: { polite: "そのカバン、いいですね。", pVi: "Cái cặp đó đẹp nhỉ.", casual: "そのカバン、いいね！", cVi: "Cặp đó ngon đấy!", gIds: ["wa_adj"] }},
            { STT:7, Kanji:"", Nghĩa:"~kia", Furigana:"あの", type:"adj_pre", conv: { polite: "あの人は誰ですか。", pVi: "Người kia là ai vậy?", casual: "あの人、だれ？", cVi: "Ai kia thế?", gIds: ["wa_desu"] }},
            { STT:8, Kanji:"人", Nghĩa:"người", Furigana:"ひと", type:"noun", conv: { polite: "人が全然いませんね。", pVi: "Hoàn toàn không có một bóng người nào nhỉ.", casual: "人、ぜんぜんいないね。", cVi: "Chả thấy ma nào hết.", gIds: ["zenzen_nai", "ni_iru"] }},
            { STT:9, Kanji:"あの人", Nghĩa:"người kia", Furigana:"あのひと", type:"noun", conv: { polite: "あの人は優しい人です。", pVi: "Người kia là một người hiền lành.", casual: "あの人、やさしいね。", cVi: "Người đó hiền nhỉ.", gIds: ["wa_adj"] }},
            { STT:10, Kanji:"あの方", Nghĩa:"vị kia", Furigana:"あのかた", type:"noun", conv: { polite: "あの方はとても有名です。", pVi: "Vị kia rất là nổi tiếng.", casual: "あの方、有名だよ。", cVi: "Vị đó nổi tiếng lắm đấy.", gIds: ["wa_adj"] }},
            { STT:11, Kanji:"外国人", Nghĩa:"người nước ngoài", Furigana:"がいこくじん", type:"noun", conv: { polite: "外国人はあまりいません。", pVi: "Không có nhiều người nước ngoài lắm.", casual: "外国人、あんまりいないね。", cVi: "Người nước ngoài chả thấy mấy nhỉ.", gIds: ["amari_nai", "ni_iru"] }},
            { STT:12, Kanji:"私", Nghĩa:"tôi", Furigana:"わたし", type:"noun", conv: { polite: "私は日本へ行きたいです。", pVi: "Tôi muốn đi Nhật Bản.", casual: "日本、行きたいな。", cVi: "Muốn đi Nhật quá đi.", gIds: ["tai_desu"] }},
            { STT:13, Kanji:"", Nghĩa:"bạn", Furigana:"あなた", type:"noun", conv: { polite: "あなたは学生ですか。", pVi: "Bạn là học sinh phải không?", casual: "学生なの？", cVi: "Đi học hả?", gIds: ["wa_desu"] }},
            { STT:14, Kanji:"私たち", Nghĩa:"chúng tôi", Furigana:"わたしたち", type:"noun", conv: { polite: "私たちは日本語を勉強します。", pVi: "Chúng tôi học tiếng Nhật.", casual: "うちら、日本語勉強中！", cVi: "Bọn mình đang cày tiếng Nhật!", gIds: ["wa_desu"] }},
            { STT:15, Kanji:"", Nghĩa:"chỗ này", Furigana:"ここ", type:"place", conv: { polite: "ここは静かですね。", pVi: "Chỗ này yên tĩnh nhỉ.", casual: "ここ、しずかだね。", cVi: "Chỗ này im ắng thật.", gIds: ["wa_adj"] }},
            { STT:16, Kanji:"", Nghĩa:"chỗ đó", Furigana:"そこ", type:"place", conv: { polite: "そこに座ってください。", pVi: "Xin mời ngồi vào chỗ đó.", casual: "そこに座って。", cVi: "Ngồi đó đi.", gIds: ["te_kudasai"] }},
            { STT:17, Kanji:"", Nghĩa:"chỗ kia", Furigana:"あそこ", type:"place", conv: { polite: "あそこに何がありますか。", pVi: "Ở chỗ kia có cái gì thế?", casual: "あそこ、何がある？", cVi: "Đằng kia có gì vậy?", gIds: ["ni_aru", "q_ka"] }},
            { STT:18, Kanji:"", Nghĩa:"ở đâu", Furigana:"どこ", type:"q_word", conv: { polite: "どこかへ行きましたか。", pVi: "Bạn có đã đi đâu đó không?", casual: "どこか行った？", cVi: "Đi đâu chơi hông?", gIds: ["q_ka"] }},
            { STT:19, Kanji:"", Nghĩa:"phía này", Furigana:"こちら", type:"place", conv: { polite: "こちらへどうぞ。", pVi: "Mời đi lối này ạ.", casual: "こっち、おいで。", cVi: "Lại đây nè.", gIds: ["te_kudasai"] }},
            { STT:20, Kanji:"", Nghĩa:"phía đó", Furigana:"そちら", type:"place", conv: { polite: "そちらはどうですか。", pVi: "Phía đó thì như thế nào ạ?", casual: "そっちはどう？", cVi: "Bên đó sao rồi?", gIds: ["wa_desu"] }},
            { STT:21, Kanji:"", Nghĩa:"phía kia", Furigana:"あちら", type:"place", conv: { polite: "あちらにトイレがあります。", pVi: "Phòng vệ sinh ở phía kia ạ.", casual: "あっち、トイレだよ。", cVi: "Vệ sinh ở đằng kia kìa.", gIds: ["ni_aru"] }},
            { STT:22, Kanji:"", Nghĩa:"phía nào", Furigana:"どちら", type:"q_word", conv: { polite: "どちらにしますか。", pVi: "Bạn sẽ chọn phía nào/cái nào ạ?", casual: "どっちにする？", cVi: "Chọn cái nào?", gIds: ["wa_desu"] }},
            { STT:23, Kanji:"現場", Nghĩa:"công trường", Furigana:"げんば", type:"place", conv: { polite: "現場はとても忙しいです。", pVi: "Công trường đang rất bận rộn.", casual: "現場, めっちゃ忙しい！", cVi: "Công trường bận túi bụi!", gIds: ["wa_adj"] }},
            { STT:24, Kanji:"部屋", Nghĩa:"căn phòng", Furigana:"へや", type:"place", conv: { polite: "部屋にテレビだけあります。", pVi: "Trong phòng chỉ có mỗi cái tivi thôi.", casual: "部屋、テレビしかない。", cVi: "Phòng có mỗi cái tivi.", gIds: ["dake", "shika_nai"] }},
            { STT:25, Kanji:"駅", Nghĩa:"nhà ga", Furigana:"えき", type:"place", conv: { polite: "駅まで歩きましょうか。", pVi: "Chúng ta cùng đi bộ ra ga nhé?", casual: "駅まで歩こうか。", cVi: "Đi bộ ra ga nha?", gIds: ["mashou_ka"] }},
            { STT:26, Kanji:"市役所", Nghĩa:"toà thị chính", Furigana:"しやくしょ", type:"place", conv: { polite: "市役所はあちらです。", pVi: "Toà thị chính ở đằng kia ạ.", casual: "市役所、あっちだよ。", cVi: "Toà thị chính đằng kia.", gIds: ["wa_desu"] }},
            { STT:27, Kanji:"", Nghĩa:"cửa hàng tiện lợi", Furigana:"コンビニ", type:"place", conv: { polite: "コンビニへ行ってきます。", pVi: "Tôi đi cửa hàng tiện lợi rồi về ngay.", casual: "コンビニ行ってくる！", cVi: "Đi mua đồ ở tiện lợi tí!", gIds: ["wa_desu"] }},
            { STT:28, Kanji:"学校", Nghĩa:"trường học", Furigana:"がっこう", type:"place", conv: { polite: "学校はなかなか始まりません。", pVi: "Trường học mãi mà không bắt đầu.", casual: "学校、なかなか始まらないね。", cVi: "Trường mãi chả thấy bắt đầu gì.", gIds: ["nakanaka"] }},
            { STT:29, Kanji:"会社", Nghĩa:"công ty", Furigana:"かいしゃ", type:"place", conv: { polite: "会社までバスで行きます。", pVi: "Tôi đi đến công ty bằng xe buýt.", casual: "会社、バスで行く。", cVi: "Đi làm bằng xe buýt.", gIds: ["wa_desu"] }},
            { STT:30, Kanji:"教室", Nghĩa:"phòng học", Furigana:"きょうしつ", type:"place", conv: { polite: "教室に誰かいますか。", pVi: "Có ai trong phòng học không?", casual: "教室、だれかいる？", cVi: "Phòng học có ai hông?", gIds: ["q_ka", "ni_iru"] }},
            { STT:31, Kanji:"冷蔵庫", Nghĩa:"tủ lạnh", Furigana:"れいぞうこ", type:"noun", conv: { polite: "冷蔵庫の中に何もありません。", pVi: "Trong tủ lạnh không có cái gì cả.", casual: "冷蔵庫、何もないね。", cVi: "Tủ lạnh trống trơn hà.", gIds: ["zenzen_nai", "ni_aru"] }},
            { STT:32, Kanji:"", Nghĩa:"giường", Furigana:"ベッド", type:"noun", conv: { polite: "新しいベッドを買いました。", pVi: "Tôi đã mua một chiếc giường mới.", casual: "新しいベッド、買ったよ！", cVi: "Mới tậu cái giường mới nè!", gIds: ["wa_desu"] }},
            { STT:33, Kanji:"彼", Nghĩa:"anh ấy", Furigana:"かれ", type:"noun", conv: { polite: "彼は学生です。", pVi: "Anh ấy là học sinh.", casual: "かれ、学生だよ。", cVi: "Hắn là học sinh.", gIds: ["wa_desu"] }},
            { STT:34, Kanji:"彼女", Nghĩa:"cô ấy", Furigana:"かのじょ", type:"noun", conv: { polite: "彼女は綺麗ですね。", pVi: "Cô ấy đẹp nhỉ.", casual: "かのじょ、きれいだね。", cVi: "Cô ấy xinh phết.", gIds: ["wa_adj"] }},
            { STT:35, Kanji:"上", Nghĩa:"trên", Furigana:"うえ", type:"noun", conv: { polite: "机の上に本があります。", pVi: "Có quyển sách ở trên bàn.", casual: "机の上、本あるよ。", cVi: "Trên bàn có sách kìa.", gIds: ["ni_aru"] }},
            { STT:36, Kanji:"下", Nghĩa:"dưới", Furigana:"した", type:"noun", conv: { polite: "椅子の下に猫がいます。", pVi: "Có con mèo ở dưới ghế.", casual: "椅子の下、猫いる！", cVi: "Dưới ghế có mèo nè!", gIds: ["ni_iru"] }},
            { STT:37, Kanji:"前", Nghĩa:"trước", Furigana:"まえ", type:"noun", conv: { polite: "駅の前で待ちましょう。", pVi: "Chúng ta hãy đợi ở trước nhà ga nhé.", casual: "駅の前で待ってるね。", cVi: "Đợi ở trước ga nha.", gIds: ["te_kudasai"] }},
            { STT:38, Kanji:"後ろ", Nghĩa:"sau", Furigana:"うしろ", type:"noun", conv: { polite: "私の後ろに誰かいますか。", pVi: "Có ai ở đằng sau tôi không?", casual: "後ろにだれかいる？", cVi: "Sau lưng có ai hông?", gIds: ["q_ka", "ni_iru"] }},
            { STT:39, Kanji:"右", Nghĩa:"phải", Furigana:"みぎ", type:"noun", conv: { polite: "右に曲がってください。", pVi: "Xin hãy rẽ phải.", casual: "右に曲がって。", cVi: "Rẽ phải đi.", gIds: ["te_kudasai"] }},
            { STT:40, Kanji:"左", Nghĩa:"trái", Furigana:"ひだり", type:"noun", conv: { polite: "左側は少し不便です。", pVi: "Phía bên trái hơi bất tiện một chút.", casual: "左側、ちょっと不便だね。", cVi: "Bên trái hơi khó đi nhỉ.", gIds: ["amari_nai", "wa_adj"] }},
            { STT:41, Kanji:"頭", Nghĩa:"đầu", Furigana:"あたま", type:"noun", conv: { polite: "頭が少し痛いです。", pVi: "Tôi hơi đau đầu một chút.", casual: "頭、ちょっと痛い。", cVi: "Đau đầu quá.", gIds: ["ga_nature"] }},
            { STT:42, Kanji:"髪", Nghĩa:"tóc", Furigana:"かみ", type:"noun", conv: { polite: "髪がなかなか伸びません。", pVi: "Tóc mãi mà không dài ra.", casual: "髪、なかなか伸びないな。", cVi: "Tóc lâu dài thật đấy.", gIds: ["nakanaka"] }},
            { STT:43, Kanji:"口", Nghĩa:"miệng", Furigana:"くち", type:"noun", conv: { polite: "口を大きく開けてください。", pVi: "Xin hãy há miệng to ra.", casual: "口、大きく開けて！", cVi: "Há miệng to ra nào!", gIds: ["te_kudasai"] }},
            { STT:44, Kanji:"目", Nghĩa:"mắt", Furigana:"め", type:"noun", conv: { polite: "目にゴミが入りました。", pVi: "Bị bụi bay vào mắt rồi.", casual: "目、なんか入った。", cVi: "Mắt bị dính gì rồi.", gIds: ["wa_desu"] }},
            { STT:45, Kanji:"耳", Nghĩa:"tai", Furigana:"みみ", type:"noun", conv: { polite: "耳が全然聞こえません。", pVi: "Hoàn toàn không nghe thấy gì cả.", casual: "耳、ぜんぜん聞こえない。", cVi: "Tai chả nghe thấy gì.", gIds: ["zenzen_nai"] }},
            { STT:46, Kanji:"鼻", Nghĩa:"mũi", Furigana:"はな", type:"noun", conv: { polite: "鼻が少し高いですね。", pVi: "Mũi của bạn hơi cao nhỉ.", casual: "鼻、ちょっと高いね。", cVi: "Mũi cao phết nhỉ.", gIds: ["wa_adj"] }},
            { STT:47, Kanji:"寒い", Nghĩa:"lạnh", Furigana:"さむい", type:"adj_i", conv: { polite: "今日はあまり寒くないですね。", pVi: "Hôm nay không lạnh lắm nhỉ.", casual: "今日、あんまり寒くないね。", cVi: "Hôm nay chả lạnh mấy.", gIds: ["amari_nai"] }},
            { STT:48, Kanji:"暑い", Nghĩa:"nóng", Furigana:"あつい", type:"adj_i", conv: { polite: "全然暑くないです。", pVi: "Hoàn toàn không nóng chút nào.", casual: "ぜんぜん暑くないよ。", cVi: "Nóng gì đâu, chả nóng tí nào.", gIds: ["zenzen_nai"] }},
            { STT:49, Kanji:"暖かい", Nghĩa:"ấm áp", Furigana:"あたたかい", type:"adj_i", conv: { polite: "今日は暖かいですね。", pVi: "Hôm nay ấm áp nhỉ.", casual: "今日、あったかいね。", cVi: "Hôm nay ấm phết.", gIds: ["wa_adj"] }},
            { STT:50, Kanji:"涼しい", Nghĩa:"mát mẻ", Furigana:"すずしい", type:"adj_i", conv: { polite: "夕方は涼しくなります。", pVi: "Buổi chiều tối sẽ trở nên mát mẻ.", casual: "夕方、すずしくなるよ。", cVi: "Chiều tối mát lắm đấy.", gIds: ["wa_adj"] }},
            { STT:51, Kanji:"新しい", Nghĩa:"mới", Furigana:"あたらしい", type:"adj_i", conv: { polite: "新しいスマホを買いたいです。", pVi: "Tôi muốn mua điện thoại mới.", casual: "新しいスマホ、ほしい！", cVi: "Thèm con smartphone mới quá!", gIds: ["tai_desu"] }},
            { STT:52, Kanji:"古い", Nghĩa:"cũ", Furigana:"ふるい", type:"adj_i", conv: { polite: "このカメラは古いですが、いいです。", pVi: "Cái máy ảnh này cũ nhưng mà tốt.", casual: "これ古いけど、いいよ！", cVi: "Cũ tí thôi nhưng xịn lắm.", gIds: ["wa_adj"] }},
            { STT:53, Kanji:"長い", Nghĩa:"dài", Furigana:"ながい", type:"adj_i", conv: { polite: "夏休みは長いですね。", pVi: "Kỳ nghỉ hè dài nhỉ.", casual: "夏休み、ながいね！", cVi: "Nghỉ hè dài sướng nhỉ!", gIds: ["wa_adj"] }},
            { STT:54, Kanji:"短い", Nghĩa:"ngắn", Furigana:"みじかい", type:"adj_i", conv: { polite: "このスカートは少し短いですね。", pVi: "Cái váy này hơi ngắn một chút nhỉ.", casual: "これ、ちょっと短くない？", cVi: "Cái này hơi bị ngắn đó nha?", gIds: ["wa_adj"] }},
            { STT:55, Kanji:"強い", Nghĩa:"mạnh", Furigana:"つよい", type:"adj_i", conv: { polite: "彼はとても強いですね。", pVi: "Anh ấy mạnh thật đấy.", casual: "彼、めっちゃ強いよ！", cVi: "Ông đó khoẻ kinh!", gIds: ["wa_adj"] }},
            { STT:56, Kanji:"弱い", Nghĩa:"yếu", Furigana:"よわい", type:"adj_i", conv: { polite: "お酒に弱いんです。", pVi: "Tôi uống rượu kém lắm (yếu).", casual: "お酒、よわいんだよね。", cVi: "Tửu lượng mình kém lắm.", gIds: ["ga_nature"] }},
            { STT:57, Kanji:"良い", Nghĩa:"tốt", Furigana:"いい", type:"adj_i", conv: { polite: "天気がいいですね。", pVi: "Thời tiết đẹp quá nhỉ.", casual: "天気、いいね！", cVi: "Trời đẹp nhỉ!", gIds: ["wa_adj"] }},
            { STT:58, Kanji:"悪い", Nghĩa:"xấu", Furigana:"わるい", type:"adj_i", conv: { polite: "気分が少し悪いです。", pVi: "Trong người tôi hơi khó chịu.", casual: "気分、ちょっと悪い。", cVi: "Người hơi mệt.", gIds: ["ga_nature"] }},
            { STT:59, Kanji:"好き(な)", Nghĩa:"thích", Furigana:"すき", type:"adj_na", conv: { polite: "日本料理が好きです。", pVi: "Tôi thích món ăn Nhật Bản.", casual: "日本料理、すき！", cVi: "Khoái đồ Nhật lắm!", gIds: ["ga_nature"] }},
            { STT:60, Kanji:"嫌い(な)", Nghĩa:"ghét", Furigana:"きらい", type:"adj_na", conv: { polite: "納豆はあまり好きじゃないです。", pVi: "Tôi không thích Natto lắm.", casual: "納豆、きらいなんだよね。", cVi: "Ghét Natto cực.", gIds: ["amari_nai", "ga_nature"] }},
            { STT:61, Kanji:"上手(な)", Nghĩa:"giỏi", Furigana:"じょうず", type:"adj_na", conv: { polite: "日本語が上手ですね。", pVi: "Tiếng Nhật của bạn giỏi quá nhỉ.", casual: "日本語、上手だね！", cVi: "Tiếng Nhật đỉnh phết!", gIds: ["ga_nature"] }},
            { STT:62, Kanji:"下手(な)", Nghĩa:"kém", Furigana:"へた", type:"adj_na", conv: { polite: "歌が下手なんです。", pVi: "Tôi hát dở lắm.", casual: "歌、へたなんだよね。", cVi: "Hát hò như đấm vào tai.", gIds: ["ga_nature"] }},
            { STT:63, Kanji:"便利(な)", Nghĩa:"tiện lợi", Furigana:"べんり", type:"adj_na", conv: { polite: "このアプリはとても便利です。", pVi: "Ứng dụng này rất tiện lợi.", casual: "これ、めっちゃ便利！", cVi: "Cái này tiện vãi!", gIds: ["wa_adj"] }},
            { STT:64, Kanji:"不便(な)", Nghĩa:"bất tiện", Furigana:"ふべん", type:"adj_na", conv: { polite: "ここは少し不便ですね。", pVi: "Ở đây hơi bất tiện nhỉ.", casual: "ここ、不便だね。", cVi: "Chỗ này bất tiện thật.", gIds: ["wa_adj"] }},
            { STT:65, Kanji:"安全(な)", Nghĩa:"an toàn", Furigana:"あんぜん", type:"adj_na", conv: { polite: "日本は安全な国です。", pVi: "Nhật Bản là một đất nước an toàn.", casual: "日本、安全だよ。", cVi: "Nhật an toàn lắm.", gIds: ["wa_desu"] }},
            { STT:66, Kanji:"忙しい", Nghĩa:"bận rộn", Furigana:"いそがしい", type:"adj_i", conv: { polite: "今日は仕事が忙しいです。", pVi: "Hôm nay công việc bận rộn.", casual: "今日、いそがしい！", cVi: "Nay bận quá!", gIds: ["wa_adj"] }},
            { STT:67, Kanji:"易しい", Nghĩa:"dễ", Furigana:"やさしい", type:"adj_i", conv: { polite: "このテストは易しいです。", pVi: "Bài kiểm tra này dễ.", casual: "このテスト、かんたん！", cVi: "Bài này dễ ợt!", gIds: ["wa_adj"] }},
            { STT:68, Kanji:"難しい", Nghĩa:"khó", Furigana:"むずかしい", type:"adj_i", conv: { polite: "日本語はあまり難しくないです。", pVi: "Tiếng Nhật không khó lắm đâu.", casual: "日本語、あんまり難しくないよ。", cVi: "Tiếng Nhật chả khó mấy.", gIds: ["amari_nai"] }},
            { STT:69, Kanji:"危ない", Nghĩa:"nguy hiểm", Furigana:"あぶない", type:"adj_i", conv: { polite: "ここは危ないですから、注意してください。", pVi: "Vì chỗ này nguy hiểm nên hãy chú ý.", casual: "ここ危ないよ、気をつけて！", cVi: "Nguy hiểm đấy, cẩn thận!", gIds: ["te_kudasai"] }},
            { STT:70, Kanji:"優しい", Nghĩa:"hiền lành", Furigana:"やさしい", type:"adj_i", conv: { polite: "お母さんは優しい人です。", pVi: "Mẹ tôi là người hiền hậu.", casual: "お母さん、やさしいね。", cVi: "Mẹ hiền nhỉ.", gIds: ["wa_desu"] }},
            { STT:71, Kanji:"厳しい", Nghĩa:"nghiêm khắc", Furigana:"きびしい", type:"adj_i", conv: { polite: "先生は厳しいですか。", pVi: "Giáo viên có nghiêm khắc không?", casual: "先生、きびしい？", cVi: "Thầy có ác không?", gIds: ["wa_adj"] }},
            { STT:72, Kanji:"大きい", Nghĩa:"to", Furigana:"おおきい", type:"adj_i", conv: { polite: "大きいカバンが欲しいです。", pVi: "Tôi muốn một cái túi xách to.", casual: "大きいカバン、ほしいな。", cVi: "Muốn cái túi to to cơ.", gIds: ["ga_nature"] }},
            { STT:73, Kanji:"小さい", Nghĩa:"nhỏ", Furigana:"ちいさい", type:"adj_i", conv: { polite: "小さい子供がいます。", pVi: "Có đứa trẻ nhỏ.", casual: "小さい子、いるね。", cVi: "Có nhóc con kìa.", gIds: ["ni_iru"] }},
            { STT:74, Kanji:"広い", Nghĩa:"rộng", Furigana:"ひろい", type:"adj_i", conv: { polite: "この部屋は広くていいですね。", pVi: "Căn phòng này rộng rãi thích nhỉ.", casual: "この部屋、広くていいね！", cVi: "Phòng này rộng và thích nhỉ!", gIds: ["adj_te"] }},
            { STT:75, Kanji:"狭い", Nghĩa:"hẹp", Furigana:"せまい", type:"adj_i", conv: { polite: "道が少し狭いですね。", pVi: "Con đường hơi hẹp nhỉ.", casual: "道、ちょっとせまいね。", cVi: "Đường hơi hẹp.", gIds: ["wa_adj"] }},
            { STT:76, Kanji:"高い", Nghĩa:"cao/đắt", Furigana:"たかい", "type":"adj_i", conv: { polite: "背が高いですね。", pVi: "Dáng bạn cao nhỉ.", casual: "背、たかいね！", cVi: "Cao thế!", gIds: ["ga_nature"] }},
            { STT:77, Kanji:"安い", Nghĩa:"rẻ", Furigana:"やすい", type:"adj_i", conv: { polite: "安いのしかありません。", pVi: "Chỉ có loại rẻ tiền thôi.", casual: "安いのしかないよ。", cVi: "Còn mỗi đồ rẻ thôi.", gIds: ["shika_nai"] }},
            { STT:78, Kanji:"低い", Nghĩa:"thấp", Furigana:"ひくい", type:"adj_i", conv: { polite: "声が低いですね。", pVi: "Giọng của bạn trầm (thấp) nhỉ.", casual: "声、ひくいね。", cVi: "Giọng trầm nhỉ.", gIds: ["ga_nature"] }},
            { STT:79, Kanji:"面白い", Nghĩa:"thú vị", Furigana:"おもしろい", type:"adj_i", conv: { polite: "この本は面白いですよ。", pVi: "Quyển sách này hay lắm đấy.", casual: "これ、おもしろいよ！", cVi: "Cái này hay nè!", gIds: ["wa_adj"] }},
            { STT:80, Kanji:"詰まらない", Nghĩa:"chán", Furigana:"つまらない", type:"adj_i", conv: { polite: "映画は少し詰まらなかったです。", pVi: "Bộ phim hơi chán một chút.", casual: "映画、つまんなかった。", cVi: "Phim chán phèo.", gIds: ["wa_adj"] }},
            { STT:81, Kanji:"美味しい", Nghĩa:"ngon", Furigana:"おいしい", type:"adj_i", conv: { polite: "とても美味しいです。", pVi: "Ngon tuyệt vời.", casual: "めっちゃ美味しい！", cVi: "Ngon xỉu!", gIds: ["wa_adj"] }},
            { STT:82, Kanji:"旨い", Nghĩa:"ngon/giỏi", Furigana:"うまい", type:"adj_i", conv: { polite: "料理が旨いですね。", pVi: "Bạn nấu ăn ngon thật.", casual: "これ、うまい！", cVi: "Ngon!", gIds: ["ga_nature"] }},
            { STT:83, Kanji:"不味い", Nghĩa:"dở", Furigana:"まずい", type:"adj_i", conv: { polite: "全然不味くないです。", pVi: "Chẳng dở chút nào đâu.", casual: "ぜんぜん不味くないよ。", cVi: "Chả dở đâu.", gIds: ["zenzen_nai"] }},
            { STT:84, Kanji:"重い", Nghĩa:"nặng", Furigana:"おもい", type:"adj_i", conv: { polite: "この荷物はとても重いです。", pVi: "Hành lý này nặng quá.", casual: "これ、おもーい！", cVi: "Nặng kinh!", gIds: ["wa_adj"] }},
            { STT:85, Kanji:"軽い", Nghĩa:"nhẹ", Furigana:"かるい", type:"adj_i", conv: { polite: "カバンが軽いですね。", pVi: "Cái cặp nhẹ nhỉ.", casual: "カバン、かるいね。", cVi: "Cặp nhẹ thế.", gIds: ["wa_adj"] }},
            { STT:86, Kanji:"起きます", Nghĩa:"thức dậy", Furigana:"おきます", type:"verb", conv: { polite: "いつも何時に起きますか。", pVi: "Bạn thường thức dậy lúc mấy giờ?", casual: "何時に起きてるの？", cVi: "Thường mấy giờ dậy?", gIds: ["wa_desu"] }},
            { STT:87, Kanji:"立ちます", Nghĩa:"đứng", Furigana:"たちます", type:"verb", conv: { polite: "そこに立たないでください。", pVi: "Xin đừng đứng ở chỗ đó.", casual: "そこに立たないで。", cVi: "Đừng đứng đấy.", gIds: ["te_kudasai"] }}
        ];

        // --- 3. KANJI DATABASE ---
        const kanjiDetails = {
            "何": { hanviet: "HÀ", mean: "Cái gì", on: "カ", kun: "なに, なん", radicals: "Nhân (亻) + Khả (可)", tipImg: "Người gánh vật gì?", tipSoundOn: "**Ca** hát.", tipSoundKun: "**Na Ni** là gì?", words: [{w:"何",m:"Cái gì"},{w:"何時",m:"Mấy giờ"}] },
            "人": { hanviet: "NHÂN", mean: "Người", on: "ジン, ニン", kun: "ひと", radicals: "Nhân (人)", tipImg: "Hình người đi.", tipSoundOn: "**Jin** trong Ninja.", tipSoundKun: "**Hito** một người.", words: [{w:"日本人",m:"Người Nhật"}] },
            "私": { hanviet: "TƯ", mean: "Tôi", on: "シ", kun: "わたし", radicals: "Hòa (禾) + Tư (厶)", tipImg: "Lúa riêng tôi.", tipSoundOn: "**Si** mê.", tipSoundKun: "**Watashi** tôi.", words: [{w:"私",m:"Tôi"}] },
            "方": { hanviet: "PHƯƠNG", mean: "Hướng", on: "ホウ", kun: "かた", radicals: "Phương (方)", tipImg: "Cờ bay.", tipSoundOn: "**Hô** phương hướng.", tipSoundKun: "**Kata** vị.", words: [{w:"あの方",m:"Vị kia"}] },
            "外": { hanviet: "NGOẠI", mean: "Ngoài", on: "ガイ", kun: "そと", radicals: "Tịch (夕) + Bốc (卜)", tipImg: "Bói buổi tối.", tipSoundOn: "**Gai** góc.", tipSoundKun: "**Soto** ngoài.", words: [{w:"外国",m:"Nước ngoài"}] },
            "国": { hanviet: "QUỐC", mean: "Nước", on: "コク", kun: "くに", radicals: "Vi (囗) + Ngọc (玉)", tipImg: "Vùng đất vua cai trị.", tipSoundOn: "**Koku** quốc.", tipSoundKun: "**Kuni** nước.", words: [{w:"中国",m:"TQ"}] },
            "達": { hanviet: "ĐẠT", mean: "Đạt đến", on: "タツ", kun: "", radicals: "Xước (⻌) + Thổ (土) + Dương (羊)", tipImg: "Con dê đi đạt mục đích.", tipSoundOn: "**Tatsu** đạt.", tipSoundKun: "", words: [{w:"私たち",m:"Chúng tôi"}] },
            "現": { hanviet: "HIỆN", mean: "Hiện tại", on: "ゲン", kun: "あらわ.れる", radicals: "Vương (王) + Kiến (見)", tipImg: "Vua nhìn hiện thực.", tipSoundOn: "**Gen** hiện.", tipSoundKun: "**Arawareru** xuất hiện.", words: [{w:"現場",m:"Hiện trường"}] },
            "場": { hanviet: "TRƯỜNG", mean: "Nơi chốn", on: "ジョウ", kun: "ば", radicals: "Thổ (土) + Dương (昜)", tipImg: "Đất có mặt trời.", tipSoundOn: "**Jou** trường.", tipSoundKun: "**Ba** nơi.", words: [{w:"場所",m:"Nơi chốn"}] },
            "部": { hanviet: "BỘ", mean: "Bộ phận", on: "ブ", kun: "", radicals: "Lập (立) + Khẩu (口) + Ấp (阝)", tipImg: "Đứng ở miệng ấp.", tipSoundOn: "**Bu** bộ.", tipSoundKun: "", words: [{w:"部屋",m:"Phòng"}] },
            "屋": { hanviet: "ỐC", mean: "Nhà", on: "オク", kun: "や", radicals: "Thi (尸) + Chí (至)", tipImg: "Xác chết tới nhà.", tipSoundOn: "**Oku** ốc.", tipSoundKun: "**Ya** nhà.", words: [{w:"部屋",m:"Phòng"}] },
            "駅": { hanviet: "DỊCH", mean: "Ga", on: "エキ", kun: "", radicals: "Mã (馬) + Xích (尺)", tipImg: "Ngựa thồ hàng.", tipSoundOn: "**Eki** ga.", tipSoundKun: "", words: [{w:"駅",m:"Ga"}] },
            "市": { hanviet: "THỊ", mean: "Thành phố", on: "シ", kun: "いち", radicals: "Đầu (亠) + Cân (巾)", tipImg: "Nắp khăn chợ.", tipSoundOn: "**Shi** thị.", tipSoundKun: "**Ichi** chợ.", words: [{w:"市場",m:"Chợ"}] },
            "役": { hanviet: "DỊCH", mean: "Vai trò", on: "ヤク", kun: "", radicals: "Xích (彳) + Thù (殳)", tipImg: "Người làm việc.", tipSoundOn: "**Yaku** dịch.", tipSoundKun: "", words: [{w:"役所",m:"Văn phòng"}] },
            "所": { hanviet: "SỞ", mean: "Nơi", on: "ショ", kun: "ところ", radicals: "Hộ (戸) + Cân (斤)", tipImg: "Cửa có rìu.", tipSoundOn: "**Sho** sở.", tipSoundKun: "**Tokoro** nơi.", words: [{w:"台所",m:"Bếp"}] },
            "学": { hanviet: "HỌC", mean: "Học", on: "ガク", kun: "まな.ぶ", radicals: "Tử (子)", tipImg: "Trẻ đội mũ học.", tipSoundOn: "**Gaku** học.", tipSoundKun: "**Manabu** học.", words: [{w:"学校",m:"Trường học"}] },
            "校": { hanviet: "HIỆU", mean: "Trường", on: "コウ", kun: "", radicals: "Mộc (木) + Giao (交)", tipImg: "Giao lưu ở trường.", tipSoundOn: "**Kou** hiệu.", tipSoundKun: "", words: [{w:"学校",m:"Trường học"}] },
            "会": { hanviet: "HỘI", mean: "Gặp", on: "カイ", kun: "あ.う", radicals: "Nhân (人) + Nhị (二) + Khư (厶)", tipImg: "Gặp dưới mái nhà.", tipSoundOn: "**Kai** hội.", tipSoundKun: "**Au** gặp.", words: [{w:"会社",m:"Công ty"}] },
            "社": { hanviet: "XÃ", mean: "Xã hội", on: "シャ", kun: "やしろ", radicals: "Kỳ (礻) + Thổ (土)", tipImg: "Thần đất.", tipSoundOn: "**Sha** xã.", tipSoundKun: "**Yashiro** đền.", words: [{w:"会社",m:"Công ty"}] },
            "教": { hanviet: "GIÁO", mean: "Dạy", on: "キョウ", kun: "おし.える", radicals: "Hiếu (孝) + Phộc (攵)", tipImg: "Dạy trẻ.", tipSoundOn: "**Kyou** giáo.", tipSoundKun: "**Oshieru** dạy.", words: [{w:"教室",m:"Lớp học"}] },
            "室": { hanviet: "THẤT", mean: "Phòng", on: "シツ", kun: "むろ", radicals: "Miên (宀) + Chí (至)", tipImg: "Vào phòng ngủ.", tipSoundOn: "**Shitsu** thất.", tipSoundKun: "**Muro** hầm.", words: [{w:"教室",m:"Lớp học"}] },
            "冷": { hanviet: "LÃNH", mean: "Lạnh", on: "レイ", kun: "つめ.たい", radicals: "Băng (冫) + Lệnh (令)", tipImg: "Lệnh đóng băng.", tipSoundOn: "**Rei** lạnh.", tipSoundKun: "**Tsumetai** lạnh.", words: [{w:"冷蔵庫",m:"Tủ lạnh"}] },
            "蔵": { hanviet: "TÀNG", mean: "Kho", on: "ゾウ", kun: "くら", radicals: "Thảo (艹) + Tường (爿) + Thần (臣) + Qua (戈)", tipImg: "Kho trong cỏ.", tipSoundOn: "**Zou** tàng.", tipSoundKun: "**Kura** kho.", words: [{w:"冷蔵庫",m:"Tủ lạnh"}] },
            "庫": { hanviet: "KHỐ", mean: "Kho", on: "コ", kun: "くら", radicals: "Nghiễm (广) + Xa (車)", tipImg: "Xe trong kho.", tipSoundOn: "**Ko** khố.", tipSoundKun: "**Kura** kho.", words: [{w:"金庫",m:"Két sắt"}] },
            "上": { hanviet: "THƯỢNG", mean: "Trên", on: "ジョウ", kun: "うえ", radicals: "Nhất (一) + Bốc (卜)", tipImg: "Chỉ lên.", tipSoundOn: "**Jou** thượng.", tipSoundKun: "**Ue** trên.", words: [{w:"上",m:"Trên"}] },
            "下": { hanviet: "HẠ", mean: "Dưới", on: "カ", kun: "した", radicals: "Nhất (一) + Bốc (卜)", tipImg: "Chỉ xuống.", tipSoundOn: "**Ka** hạ.", tipSoundKun: "**Shita** dưới.", words: [{w:"下",m:"Dưới"}] },
            "前": { hanviet: "TIỀN", mean: "Trước", on: "ゼン", kun: "まえ", radicals: "Đao (刂)", tipImg: "Cắt thịt trước.", tipSoundOn: "**Zen** tiền.", tipSoundKun: "**Mae** trước.", words: [{w:"前",m:"Trước"}] },
            "後": { hanviet: "HẬU", mean: "Sau", on: "ゴ", kun: "うし.ろ", radicals: "Xích (彳) + Yêu (幺) + Truy (夂)", tipImg: "Đi chậm sau.", tipSoundOn: "**Go** hậu.", tipSoundKun: "**Ushiro** sau.", words: [{w:"後ろ",m:"Sau"}] },
            "右": { hanviet: "HỮU", mean: "Phải", on: "ウ", kun: "みぎ", radicals: "Khẩu (口) + Hựu (又)", tipImg: "Tay ăn.", tipSoundOn: "**U** hữu.", tipSoundKun: "**Migi** phải.", words: [{w:"右",m:"Phải"}] },
            "左": { hanviet: "TẢ", mean: "Trái", on: "サ", kun: "ひだり", radicals: "Công (工) + Hựu (又)", tipImg: "Tay thước.", tipSoundOn: "**Sa** tả.", tipSoundKun: "**Hidari** trái.", words: [{w:"左",m:"Trái"}] },
            "頭": { hanviet: "ĐẦU", mean: "Đầu", on: "トウ", kun: "あたま", radicals: "Đậu (豆) + Hiệt (頁)", tipImg: "Đậu bên đầu.", tipSoundOn: "**Tou** đầu.", tipSoundKun: "**Atama** đầu.", words: [{w:"頭",m:"Đầu"}] },
            "髪": { hanviet: "PHÁT", mean: "Tóc", on: "ハツ", kun: "かみ", radicals: "Tiêu (髟) + Hữu (友)", tipImg: "Tóc dài.", tipSoundOn: "**Hatsu** phát.", tipSoundKun: "**Kami** tóc.", words: [{w:"髪",m:"Tóc"}] },
            "口": { hanviet: "KHẨU", mean: "Miệng", on: "コウ", kun: "くち", radicals: "Khẩu (口)", tipImg: "Miệng mở.", tipSoundOn: "**Kou** khẩu.", tipSoundKun: "**Kuchi** miệng.", words: [{w:"口",m:"Miệng"}] },
            "目": { hanviet: "MỤC", mean: "Mắt", on: "モク", kun: "め", radicals: "Mục (目)", tipImg: "Con mắt.", tipSoundOn: "**Moku** mục.", tipSoundKun: "**Me** mắt.", words: [{w:"目",m:"Mắt"}] },
            "耳": { hanviet: "NHĨ", mean: "Tai", on: "ジ", kun: "みみ", radicals: "Nhĩ (耳)", tipImg: "Vành tai.", tipSoundOn: "**Ji** nhĩ.", tipSoundKun: "**Mimi** tai.", words: [{w:"耳",m:"Tai"}] },
            "鼻": { hanviet: "TỊ", mean: "Mũi", on: "ビ", kun: "はな", radicals: "Tự (自) + Điền (田)", tipImg: "Tự nâng mũi.", tipSoundOn: "**Bi** tị.", tipSoundKun: "**Hana** mũi.", words: [{w:"鼻",m:"Mũi"}] },
            "寒": { hanviet: "HÀN", mean: "Lạnh", on: "カン", kun: "さむ.い", radicals: "Miên (宀) + Băng (冫)", tipImg: "Nhà băng.", tipSoundOn: "**Kan** hàn.", tipSoundKun: "**Samui** lạnh.", words: [{w:"寒い",m:"Lạnh"}] },
            "暑": { hanviet: "THỬ", mean: "Nóng", on: "ショ", kun: "あつ.い", radicals: "Nhật (日) + Giả (者)", tipImg: "Nắng chiếu.", tipSoundOn: "**Sho** thử.", tipSoundKun: "**Atsui** nóng.", words: [{w:"暑い",m:"Nóng"}] },
            "暖": { hanviet: "NOÃN", mean: "Ấm", on: "ダン", kun: "あたた.かい", radicals: "Nhật (日) + Viên (爰)", tipImg: "Nắng ấm.", tipSoundOn: "**Dan** noãn.", tipSoundKun: "**Atatakai** ấm.", words: [{w:"暖かい",m:"Ấm"}] },
            "涼": { hanviet: "LƯƠNG", mean: "Mát", on: "リョウ", kun: "すず.しい", radicals: "Thủy (氵) + Kinh (京)", tipImg: "Nước kinh đô.", tipSoundOn: "**Ryou** lương.", tipSoundKun: "**Suzushii** mát.", words: [{w:"涼しい",m:"Mát"}] },
            "新": { hanviet: "TÂN", mean: "Mới", on: "シン", kun: "あたら.しい", radicals: "Lập (立) + Mộc (木) + Cân (斤)", tipImg: "Rìu đẽo mới.", tipSoundOn: "**Shin** tân.", tipSoundKun: "**Atarashii** mới.", words: [{w:"新しい",m:"Mới"}] },
            "古": { hanviet: "CỔ", mean: "Cũ", on: "コ", kun: "ふる.い", radicals: "Thập (十) + Khẩu (口)", tipImg: "Mười miệng kể.", tipSoundOn: "**Ko** cổ.", tipSoundKun: "**Furui** cũ.", words: [{w:"古い",m:"Cũ"}] },
            "長": { hanviet: "TRƯỜNG", mean: "Dài", on: "チョウ", kun: "なが.い", radicals: "Trường (長)", tipImg: "Tóc dài.", tipSoundOn: "**Chou** trường.", tipSoundKun: "**Nagai** dài.", words: [{w:"長い",m:"Dài"}] },
            "短": { hanviet: "ĐOẢN", mean: "Ngắn", on: "タン", kun: "みじか.い", radicals: "Thỉ (矢) + Đậu (豆)", tipImg: "Mũi tên ngắn.", tipSoundOn: "**Tan** đoản.", tipSoundKun: "**Mijikai** ngắn.", words: [{w:"短い",m:"Ngắn"}] },
            "強": { hanviet: "CƯỜNG", mean: "Mạnh", on: "キョウ", kun: "つよ.い", radicals: "Cung (弓) + Trùng (虫)", tipImg: "Cung mạnh.", tipSoundOn: "**Kyou** cường.", tipSoundKun: "**Tsuyoi** mạnh.", words: [{w:"強い",m:"Mạnh"}] },
            "弱": { hanviet: "NHƯỢC", mean: "Yếu", on: "ジャク", kun: "よわ.い", radicals: "Cung (弓) + Vũ (冫)", tipImg: "Cung gãy.", tipSoundOn: "**Jaku** nhược.", tipSoundKun: "**Yowai** yếu.", words: [{w:"弱い",m:"Yếu"}] },
            "良": { hanviet: "LƯƠNG", mean: "Tốt", on: "リョウ", kun: "い.い", radicals: "Cấn (艮)", tipImg: "Người tốt.", tipSoundOn: "**Ryou** lương.", tipSoundKun: "**Ii** tốt.", words: [{w:"良い",m:"Tốt"}] },
            "悪": { hanviet: "ÁC", mean: "Xấu", on: "アク", kun: "わる.い", radicals: "Á (亜) + Tâm (心)", tipImg: "Tim ác.", tipSoundOn: "**Aku** ác.", tipSoundKun: "**Warui** xấu.", words: [{w:"悪い",m:"Xấu"}] },
            "好": { hanviet: "HẢO", mean: "Thích", on: "コウ", kun: "す.き", radicals: "Nữ (女) + Tử (子)", tipImg: "Mẹ con tốt.", tipSoundOn: "**Kou** hảo.", tipSoundKun: "**Suki** thích.", words: [{w:"好き",m:"Thích"}] },
            "嫌": { hanviet: "HIỀM", mean: "Ghét", on: "ケン", kun: "きら.い", radicals: "Nữ (女) + Kiêm (兼)", tipImg: "Phụ nữ ghét.", tipSoundOn: "**Ken** hiềm.", tipSoundKun: "**Kirai** ghét.", words: [{w:"嫌い",m:"Ghét"}] },
            "手": { hanviet: "THỦ", mean: "Tay", on: "シュ", kun: "て", radicals: "Thủ (手)", tipImg: "Bàn tay.", tipSoundOn: "**Shu** thủ.", tipSoundKun: "**Te** tay.", words: [{w:"上手",m:"Giỏi"}] },
            "便": { hanviet: "TIỆN", mean: "Tiện", on: "ベン", kun: "", radicals: "Nhân (亻) + Canh (更)", tipImg: "Người canh tiện.", tipSoundOn: "**Ben** tiện.", tipSoundKun: "", words: [{w:"便利",m:"Tiện lợi"}] },
            "利": { hanviet: "LỢI", mean: "Lợi", on: "リ", kun: "", radicals: "Hòa (禾) + Đao (刂)", tipImg: "Lúa lợi.", tipSoundOn: "**Ri** lợi.", tipSoundKun: "", words: [{w:"便利",m:"Tiện lợi"}] },
            "不": { hanviet: "BẤT", mean: "Không", on: "フ", kun: "", radicals: "Nhất (一)", tipImg: "Rễ cây.", tipSoundOn: "**Fu** bất.", tipSoundKun: "", words: [{w:"不便",m:"Bất tiện"}] },
            "全": { hanviet: "TOÀN", mean: "Toàn bộ", on: "ゼン", kun: "", radicals: "Nhập (入) + Vương (王)", tipImg: "Vua cai quản.", tipSoundOn: "**Zen** toàn.", tipSoundKun: "", words: [{w:"全然",m:"Hoàn toàn"}] },
            "安": { hanviet: "AN", mean: "Rẻ", on: "アン", kun: "やす.い", radicals: "Miên (宀) + Nữ (女)", tipImg: "Nữ trong nhà.", tipSoundOn: "**An** an.", tipSoundKun: "**Yasui** rẻ.", words: [{w:"安い",m:"Rẻ"}] },
            "忙": { hanviet: "MANG", mean: "Bận", on: "ボウ", kun: "いそが.しい", radicals: "Tâm (忄) + Vong (亡)", tipImg: "Tim chết.", tipSoundOn: "**Bou** mang.", tipSoundKun: "**Isogashii** bận.", words: [{w:"忙しい",m:"Bận"}] },
            "易": { hanviet: "DỊ", mean: "Dễ", on: "イ", kun: "やさ.しい", radicals: "Nhật (日) + Vật (勿)", tipImg: "Mặt trời mọc.", tipSoundOn: "**I** dị.", tipSoundKun: "**Yasashii** dễ.", words: [{w:"易しい",m:"Dễ"}] },
            "難": { hanviet: "NAN", mean: "Khó", on: "ナン", kun: "むずか.しい", radicals: "Hán (⻀) + Chuy (隹)", tipImg: "Chim bị bắt.", tipSoundOn: "**Nan** nan.", tipSoundKun: "**Muzukashii** khó.", words: [{w:"難しい",m:"Khó"}] },
            "危": { hanviet: "NGUY", mean: "Nguy hiểm", on: "キ", kun: "あぶ.ない", radicals: "Tiết (卩) + Hán (厂)", tipImg: "Quỳ sườn núi.", tipSoundOn: "**Ki** nguy.", tipSoundKun: "**Abunai** nguy.", words: [{w:"危ない",m:"Nguy hiểm"}] },
            "優": { hanviet: "ƯU", mean: "Ưu tú", on: "ユウ", kun: "やさ.しい", radicals: "Nhân (亻) + Ưu (憂)", tipImg: "Người ưu tú.", tipSoundOn: "**Yuu** ưu.", tipSoundKun: "**Yasashii** hiền.", words: [{w:"優しい",m:"Hiền"}] },
            "厳": { hanviet: "NGHIÊM", mean: "Nghiêm", on: "ゲン", kun: "きび.しい", radicals: "Cảm (敢) + Hán (厂)", tipImg: "Dám nghiêm túc.", tipSoundOn: "**Gen** nghiêm.", tipSoundKun: "**Kibishii** nghiêm.", words: [{w:"厳しい",m:"Nghiêm khắc"}] },
            "大": { hanviet: "ĐẠI", mean: "To", on: "ダイ", kun: "おお.きい", radicals: "Đại (大)", tipImg: "Dang tay.", tipSoundOn: "**Dai** đại.", tipSoundKun: "**Ookii** to.", words: [{w:"大きい",m:"To"}] },
            "小": { hanviet: "TIỂU", mean: "Nhỏ", on: "ショウ", kun: "ちい.さい", radicals: "Tiểu (小)", tipImg: "Móc câu.", tipSoundOn: "**Shou** tiểu.", tipSoundKun: "**Chiisai** nhỏ.", words: [{w:"小さい",m:"Nhỏ"}] },
            "広": { hanviet: "QUẢNG", mean: "Rộng", on: "コウ", kun: "ひろ.い", tipImg: "Nhà rộng.", tipSoundOn: "**Kou** quảng.", tipSoundKun: "**Hiroi** rộng.", words: [{w:"広い",m:"Rộng"}] },
            "狭": { hanviet: "HIỆP", mean: "Hẹp", on: "キョウ", kun: "せま.い", radicals: "Khuyển (犭) + Giáp (夹)", tipImg: "Chó bị kẹp.", tipSoundOn: "**Kyou** hiệp.", tipSoundKun: "**Semai** hẹp.", words: [{w:"狭い",m:"Hẹp"}] },
            "高": { hanviet: "CAO", mean: "Cao", on: "コウ", kun: "たか.い", radicals: "Cao (高)", tipImg: "Tòa tháp.", tipSoundOn: "**Kou** cao.", tipSoundKun: "**Takai** cao.", words: [{w:"高い",m:"Cao"}] },
            "低": { hanviet: "ĐÊ", mean: "Thấp", on: "テイ", kun: "ひく.い", radicals: "Nhân (亻) + Để (氐)", tipImg: "Người cúi.", tipSoundOn: "**Tei** đê.", tipSoundKun: "**Hikui** thấp.", words: [{w:"低い",m:"Thấp"}] },
            "面": { hanviet: "DIỆN", mean: "Mặt", on: "メン", kun: "", radicals: "Diện (面)", tipImg: "Gương mặt.", tipSoundOn: "**Men** diện.", tipSoundKun: "", words: [{w:"面白い",m:"Thú vị"}] },
            "白": { hanviet: "BẠCH", mean: "Trắng", on: "ハク", kun: "しろ", radicals: "Bạch (白)", tipImg: "Mặt trời trắng.", tipSoundOn: "**Haku** bạch.", tipSoundKun: "**Shiro** trắng.", words: [{w:"面白い",m:"Thú vị"}] },
            "詰": { hanviet: "CẬT", mean: "Bí", on: "キツ", kun: "つ.まる", radicals: "Ngôn (言) + Cát (吉)", tipImg: "Lời nói bí.", tipSoundOn: "**Kitsu** cật.", tipSoundKun: "**Tsumaru** bí.", words: [{w:"詰まらない",m:"Chán"}] },
            "美": { hanviet: "MỸ", mean: "Đẹp", on: "ビ", kun: "うつく.しい", radicals: "Dương (⺶) + Đại (大)", tipImg: "Dê to đẹp.", tipSoundOn: "**Bi** mỹ.", tipSoundKun: "**Utsukushii** đẹp.", words: [{w:"美味しい",m:"Ngon"}] },
            "味": { hanviet: "VỊ", mean: "Vị", on: "ミ", kun: "あじ", radicals: "Khẩu (口) + Vị (未)", tipImg: "Miệng nếm.", tipSoundOn: "**Mi** vị.", tipSoundKun: "**Aji** vị.", words: [{w:"美味しい",m:"Ngon"}] },
            "旨": { hanviet: "CHỈ", mean: "Ngon", on: "シ", kun: "うま.い", radicals: "Chỉ (匕) + Cam (甘)", tipImg: "Thìa múc đồ ngọt.", tipSoundOn: "**Shi** chỉ.", tipSoundKun: "**Umai** ngon.", words: [{w:"旨い",m:"Ngon"}] },
            "重": { hanviet: "TRỌNG", mean: "Nặng", on: "ジュウ", kun: "おも.い", radicals: "Thiên (千) + Lý (里)", tipImg: "Ngàn làng.", tipSoundOn: "**Juu** trọng.", tipSoundKun: "**Omoi** nặng.", words: [{w:"重い",m:"Nặng"}] },
            "軽": { hanviet: "KHINH", mean: "Nhẹ", on: "ケイ", kun: "かる.い", radicals: "Xa (車)", tipImg: "Xe nhẹ.", tipSoundOn: "**Kei** khinh.", tipSoundKun: "**Karui** nhẹ.", words: [{w:"軽い",m:"Nhẹ"}] },
            "起": { hanviet: "KHỞI", mean: "Dậy", on: "キ", kun: "お.きる", radicals: "Tẩu (走) + Kỷ (己)", tipImg: "Khởi nghiệp.", tipSoundOn: "**Ki** khởi.", tipSoundKun: "**Okiru** dậy.", words: [{w:"起きます",m:"Thức dậy"}] },
            "立": { hanviet: "LẬP", mean: "Đứng", on: "リツ", kun: "た.つ", radicals: "Lập (立)", tipImg: "Đứng thẳng.", tipSoundOn: "**Ritsu** lập.", tipSoundKun: "**Tatsu** đứng.", words: [{w:"立ちます",m:"Đứng"}] }
        };

        // --- 4. APP LOGIC ---
        let currentStrokeSvg = null;

        function init() {
            renderList();
            renderGrammarMenu();
            loadWord(0);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.getElementById('learn-section').classList.toggle('hidden', tab!=='learn');
            document.getElementById('quiz-section').classList.toggle('hidden', tab!=='quiz');
            if(tab === 'quiz') nextQuestion();
        }

        function renderList() {
            const listD = document.getElementById('vocabList'); const listM = document.getElementById('mobileVocabList');
            const html = vocabData.map((item, i) => `
                <div class="vocab-item p-3 border-b hover:bg-gray-50 cursor-pointer" data-index="${i}" onclick="loadWord(${i}); if(window.innerWidth<768) toggleDrawer();">
                    <div class="flex justify-between font-bold"><span>${item.Kanji||item.Furigana}</span><span class="text-gray-300 text-xs">#${item.STT}</span></div>
                    <div class="text-xs text-gray-500">${item.Nghĩa}</div>
                </div>`).join('');
            listD.innerHTML = html; listM.innerHTML = html;
        }

        function loadWord(idx) {
            currentIndex = idx; const word = vocabData[idx];
            document.querySelectorAll('.vocab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll(`.vocab-item[data-index="${idx}"]`).forEach(el => el.classList.add('active'));
            document.getElementById('headerProgress').innerText = `${idx+1}/${vocabData.length}`;
            document.getElementById('wordIndex').innerText = `#${word.STT}`;
            document.getElementById('cardKanji').innerText = word.Kanji || word.Furigana;
            document.getElementById('cardFurigana').innerText = word.Furigana;
            document.getElementById('cardMeaning').innerText = word.Nghĩa;
            document.getElementById('wordType').innerText = word.type.toUpperCase();
            document.getElementById('strokeBtn').classList.toggle('hidden', !(word.Kanji && word.Kanji !== word.Furigana));
            renderShadowing(word);
        }

        function renderShadowing(word) {
            const cont = document.getElementById('sentenceList'); cont.innerHTML = '';
            if(!word.conv) { document.getElementById('emptyState').classList.remove('hidden'); return; }
            document.getElementById('emptyState').classList.add('hidden');
            const tps = [{ k:'polite', l:'Lịch sự', m:word.conv.pVi, i:'user-tie', c:'indigo' }, { k:'casual', l:'Thân mật', m:word.conv.cVi, i:'comments', c:'pink' }];
            tps.forEach(t => {
                cont.innerHTML += `<div class="shadow-card bg-white rounded-2xl p-4 border border-gray-100"><div class="flex justify-between border-b pb-2 mb-3"><div class="flex gap-2 items-center"><div class="bg-${t.c}-50 p-1.5 rounded text-${t.c}-600"><i class="fas fa-${t.i}"></i></div><span class="text-xs font-bold text-gray-400 uppercase">${t.l}</span></div><button onclick="openExplan('${word.conv.gIds.join(',')}')" class="text-xs text-indigo-500 hover:underline"><i class="fas fa-info-circle"></i> Giải thích</button></div><div class="flex justify-between items-start"><div><div class="text-xl ja-text font-medium">${word.conv[t.k]}</div><div class="text-sm text-gray-500 italic">${t.m}</div></div><button onclick="speakText('${word.conv[t.k]}')" class="audio-btn text-${t.c}-400 hover:text-${t.c}-600 p-2"><i class="fas fa-volume-up text-xl"></i></button></div></div>`;
            });
        }

        function openExplan(idsStr) {
            const ids = idsStr.split(','); const f = document.getElementById('dgFormula'); const e = document.getElementById('dgExplanation');
            f.innerText = ids.map(id => grammarRepo[id].formula).join(" / ");
            e.innerHTML = ids.map(id => `<div><strong>${grammarRepo[id].title}:</strong> ${grammarRepo[id].desc}</div>`).join("");
            showModal('detailGrammarModal');
        }

        function renderGrammarMenu() {
            const grid = document.getElementById('grammarGrid'); grid.innerHTML = '';
            Object.keys(grammarRepo).forEach(key => {
                const r = grammarRepo[key];
                grid.innerHTML += `<div class="bg-white p-4 rounded-xl border flex flex-col justify-between"><div><div class="font-bold text-sm text-indigo-600 mb-1">${r.title}</div><code class="text-xs block bg-gray-50 p-1 mb-2 border border-gray-200">${r.formula}</code><p class="text-xs text-gray-500 mb-2">${r.desc}</p></div><div class="bg-indigo-50 p-2 rounded flex justify-between items-center gap-2"><span class="text-[11px] font-medium text-indigo-800 ja-text">${r.ex}</span><button onclick="speakText('${r.ex}')" class="text-indigo-400 hover:text-indigo-600"><i class="fas fa-volume-up"></i></button></div></div>`;
            });
        }

        function openGrammarList() { showModal('grammarListModal'); }
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); setTimeout(() => { document.getElementById(id.replace('Modal','Backdrop')).classList.remove('opacity-0'); document.getElementById(id.replace('Modal','Panel')).classList.remove('opacity-0', 'scale-95'); }, 10); }
        function closeModal(id) { 
            const b = document.getElementById(id.replace('Modal','Backdrop')); const p = document.getElementById(id.replace('Modal','Panel'));
            if(b) b.classList.add('opacity-0'); if(p) p.classList.add('opacity-0', 'scale-95');
            setTimeout(() => document.getElementById(id).classList.add('hidden'), 200); 
        }
        
        async function openStrokeModal(char) {
            const word = vocabData[currentIndex]; const kanjis = word.Kanji.match(/[\u4e00-\u9faf]/g)||[];
            if(kanjis.length===0) return;
            const target = char || kanjis[0];
            const tabs = document.getElementById('strokeTabs'); tabs.innerHTML = '';
            if(kanjis.length>1) kanjis.forEach(k => {
                const b = document.createElement('button'); b.innerText = k;
                b.className = `w-10 h-10 rounded-lg font-bold border transition ${k===target?'bg-pink-600 text-white':'bg-white text-gray-600'}`;
                b.onclick = () => showKanjiStroke(k); tabs.appendChild(b);
            });
            showModal('strokeModal'); await showKanjiStroke(target);
        }

        async function showKanjiStroke(k) {
            const d = kanjiDetails[k]; const c = document.getElementById('kanjiDetailContent'); const e = document.getElementById('kanjiDetailEmpty');
            if(d) {
                c.classList.remove('hidden'); e.classList.add('hidden');
                document.getElementById('detailKanji').innerText=k; document.getElementById('detailHanViet').innerText=d.hanviet;
                document.getElementById('detailMeaning').innerText=d.mean; document.getElementById('detailOn').innerText=d.on; document.getElementById('detailKun').innerText=d.kun;
                document.getElementById('detailRadicals').innerText=d.radicals || '...';
                const fmt = s => s.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold text-gray-900">$1</span>');
                document.getElementById('detailTipImg').innerHTML=fmt(d.tipImg); 
                document.getElementById('detailTipSoundOn').innerHTML=fmt(d.tipSoundOn || '...'); 
                document.getElementById('detailTipSoundKun').innerHTML=fmt(d.tipSoundKun || '...');
                document.getElementById('btnPlayOn').onclick = () => speakText(d.on);
                document.getElementById('btnPlayKun').onclick = () => speakText(d.kun);

                const wc = document.getElementById('detailWords'); wc.innerHTML='';
                d.words.forEach(w => wc.innerHTML+=`<div class="flex justify-between items-center bg-gray-50 p-2 rounded hover:bg-gray-100 cursor-pointer" onclick="speakText('${w.w}')"><span class="text-sm font-bold text-indigo-700 ja-text">${w.w}</span><span class="text-xs text-gray-500">${w.m}</span></div>`);
            } else { c.classList.add('hidden'); e.classList.remove('hidden'); }
            
            const anim = document.getElementById('strokeAnimContainer'); const grid = document.getElementById('strokeGridContainer');
            anim.innerHTML = '...'; grid.innerHTML='';
            try {
                const r = await fetch(`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${getKanjiHex(k)}.svg`);
                if(!r.ok) throw new Error();
                const svgText = await r.text();
                
                // Parse and HIDE all paths immediately
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgText, "image/svg+xml");
                doc.querySelectorAll('path').forEach(p => { 
                    p.setAttribute('style', 'opacity:0; stroke:#333; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round;'); 
                });
                
                // Insert hidden SVG
                anim.innerHTML = new XMLSerializer().serializeToString(doc.documentElement);
                const mainSvg = anim.querySelector('svg');
                mainSvg.setAttribute('width','100%'); mainSvg.setAttribute('height','100%');
                currentStrokeSvg = mainSvg;
                
                // Trigger animation (reveals paths one by one)
                replayStrokeAnimation();

                // Generate Grid
                const cleanDoc = parser.parseFromString(svgText, "image/svg+xml"); // Clean copy for grid
                cleanDoc.querySelectorAll('path').forEach((p, i) => {
                    const b = document.createElement('div'); b.className="w-16 h-16 stroke-grid-box flex items-center justify-center rounded";
                    const clone = cleanDoc.documentElement.cloneNode(true);
                    clone.setAttribute('width','100%'); clone.setAttribute('height','100%');
                    clone.querySelectorAll('path').forEach((pp, idx) => {
                        pp.style.fill="none"; pp.style.strokeLinecap="round"; pp.style.strokeLinejoin="round";
                        if(idx<i) { pp.style.stroke="#e5e7eb"; pp.style.strokeWidth="3"; }
                        else if(idx===i) { pp.style.stroke="#db2777"; pp.style.strokeWidth="4"; }
                        else pp.style.display="none";
                    });
                    b.appendChild(clone); grid.appendChild(b);
                });
            } catch(e) { anim.innerHTML="Error"; }
        }
        function replayStrokeAnimation() {
            if(!currentStrokeSvg) return;
            const paths = currentStrokeSvg.querySelectorAll('path');
            // Hide all first
            paths.forEach(p => { p.style.transition='none'; p.style.opacity='0'; });
            void currentStrokeSvg.offsetWidth; // force reflow
            
            let delay = 0;
            paths.forEach(p => {
                const len = p.getTotalLength();
                p.style.strokeDasharray = len;
                p.style.strokeDashoffset = len;
                p.style.opacity = '1'; // Show element but stroke is hidden by dashoffset
                // Animate stroke
                setTimeout(() => {
                    p.style.transition = `stroke-dashoffset 0.8s ease-in-out`;
                    p.style.strokeDashoffset = '0';
                }, delay * 1000);
                delay += 0.8;
            });
        }
        function getKanjiHex(k) { return k.charCodeAt(0).toString(16).padStart(5, '0'); }
        function speakText(t) { const u = new SpeechSynthesisUtterance(t); u.lang='ja-JP'; speechSynthesis.speak(u); }
        function speakCurrent() { speakText(vocabData[currentIndex].Furigana); }
        function toggleDrawer() { const d = document.getElementById('mobileDrawer'); const c = document.getElementById('drawerContent'); const b = document.getElementById('drawerBackdrop'); if(d.classList.contains('pointer-events-none')) { d.classList.remove('pointer-events-none'); c.classList.remove('-translate-x-full'); b.classList.remove('opacity-0'); } else { c.classList.add('-translate-x-full'); b.classList.add('opacity-0'); setTimeout(()=>d.classList.add('pointer-events-none'), 300); } }
        function playQuizAudio() { if(currentQuiz) speakText(currentQuiz.Furigana); }
        
        let currentQuiz = null;
        function nextQuestion() {
            document.getElementById('feedback-area').classList.add('hidden'); document.getElementById('btn-check').classList.remove('hidden'); document.getElementById('btn-next').classList.add('hidden');
            const inp = document.getElementById('quiz-input'); inp.value=''; inp.disabled=false; inp.focus();
            const valid = vocabData.filter(v => v.Furigana !== "...");
            currentQuiz = valid[Math.floor(Math.random()*valid.length)];
            document.getElementById('quiz-kanji').innerText = currentQuiz.Kanji || currentQuiz.Furigana;
            document.getElementById('quiz-meaning').innerText = currentQuiz.Nghĩa;
            document.getElementById('quiz-kanji').className = "text-6xl ja-text font-bold text-gray-800 mb-4 transition-all";
        }
        function checkAnswer() {
            const inp = document.getElementById('quiz-input'); if(!inp.value.trim()) return;
            inp.disabled=true; const correct = inp.value.trim() === currentQuiz.Furigana;
            const k = document.getElementById('quiz-kanji'); const fb = document.getElementById('feedback-title');
            if(correct) { score+=10; k.className+=" text-green-600 correct-anim"; fb.innerHTML='<i class="fas fa-check-circle mr-2"></i> Chính xác!'; speakText(currentQuiz.Furigana); }
            else { score=Math.max(0,score-5); k.className+=" text-red-600 wrong-anim"; fb.innerHTML='<i class="fas fa-times-circle mr-2"></i> Sai rồi!'; }
            document.getElementById('score-display').innerText=score; document.getElementById('correct-answer').innerText=currentQuiz.Furigana;
            document.getElementById('feedback-area').classList.remove('hidden'); document.getElementById('btn-check').classList.add('hidden'); document.getElementById('btn-next').classList.remove('hidden');
        }
        function prevWord() { if(currentIndex>0) loadWord(currentIndex-1); }
        function nextWord() { if(currentIndex<vocabData.length-1) loadWord(currentIndex+1); }

        document.getElementById('searchInput').addEventListener('input', e => { const t = e.target.value.toLowerCase(); document.querySelectorAll('.vocab-item').forEach(el => el.style.display = el.innerText.toLowerCase().includes(t) ? 'block' : 'none'); });
        document.getElementById('quiz-input').addEventListener('keypress', e => { if(e.key==='Enter') checkAnswer(); });

        window.onload = init;
    </script>
</body>
</html>
