<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AzaKanji - H·ªôi Tho·∫°i & Ng·ªØ Ph√°p (Day 15)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #f3f4f6; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Ruby Text Styling */
        ruby rt { font-size: 0.6em; color: #64748b; user-select: none; }
        .hide-furigana ruby rt { visibility: hidden; }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* Highlight classes for Typing */
        .correct-char { color: #16a34a; font-weight: bold; }
        .incorrect-char { color: #dc2626; text-decoration: underline; font-weight: bold; }
        .correct-input { border-color: #22c55e !important; background-color: #f0fdf4 !important; }
        .wrong-input { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        
        /* Tab Transitions */
        .tab-btn { transition: all 0.3s ease; }
        .tab-active { background-color: #0284c7; color: white; shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-inactive { background-color: #f3f4f6; color: #4b5563; }
        .tab-inactive:hover { background-color: #e5e7eb; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-sky-700 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                    <i class="fas fa-torii-gate text-3xl text-yellow-300"></i>
                    <div>
                        <h1 class="text-xl font-bold uppercase tracking-wider">AzaKanji Kaiwa</h1>
                        <p class="text-xs text-sky-200">H·ªçc H·ªôi Tho·∫°i & Ng·ªØ Ph√°p (Day 15)</p>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="flex bg-sky-800 rounded-lg p-1 text-sm overflow-x-auto">
                    <button id="btn-toggle-furigana" class="px-3 py-1.5 rounded transition hover:bg-sky-600 text-white flex items-center whitespace-nowrap">
                        <i class="fas fa-eye mr-2"></i> Furigana
                    </button>
                    <button id="btn-toggle-romaji" class="px-3 py-1.5 rounded transition hover:bg-sky-600 text-white flex items-center ml-1 whitespace-nowrap">
                        <i class="fas fa-font mr-2"></i> Romaji
                    </button>
                    <button id="btn-toggle-vi" class="px-3 py-1.5 rounded transition bg-white text-sky-800 font-bold ml-1 flex items-center whitespace-nowrap">
                        <i class="fas fa-language mr-2"></i> Ti·∫øng Vi·ªát
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 flex-grow space-y-8" id="app">
        
        <!-- 1. Conversation Section -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100">
            <div class="bg-sky-50 px-6 py-4 border-b border-sky-100">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <h2 class="text-xl font-bold text-sky-800"><i class="fas fa-comments mr-2"></i>H·ªôi Tho·∫°i: N·ªó L·ª±c H·ªçc T·∫≠p</h2>
                    
                    <!-- Mode Tabs -->
                    <div class="flex bg-white rounded-lg p-1 shadow-sm border border-gray-200">
                        <button onclick="switchMode('polite')" id="tab-polite" class="tab-btn tab-active px-4 py-1.5 rounded-md text-sm font-bold">
                            L·ªãch s·ª±
                        </button>
                        <button onclick="switchMode('casual')" id="tab-casual" class="tab-btn tab-inactive px-4 py-1.5 rounded-md text-sm font-bold ml-1">
                            Th√¥ng th∆∞·ªùng
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="p-6 space-y-6" id="conversation-container">
                <!-- Dialogue injected by JS -->
            </div>
        </section>

        <!-- 2. Reading Section -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100">
            <div class="bg-orange-50 px-6 py-4 border-b border-orange-100">
                <h2 class="text-xl font-bold text-orange-800"><i class="fas fa-book-open mr-2"></i>B√†i ƒê·ªçc: ∆Ø·ªõc M∆° & C√¥ng Ngh·ªá</h2>
            </div>
            <div class="p-6">
                <div class="bg-orange-50/30 p-5 rounded-xl border border-orange-100 leading-loose text-lg kanji-font mb-2" id="reading-text">
                    <!-- Reading content injected -->
                </div>
                <div class="text-gray-500 text-sm mb-4 italic hidden romaji-text" id="reading-romaji"></div>
                <div class="text-gray-700 text-sm mb-4 hidden vi-trans border-t border-orange-100 pt-2" id="reading-vi"></div>
                
                <!-- Reading Practice Area -->
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <h4 class="text-sm font-bold text-gray-500 mb-2 uppercase"><i class="fas fa-keyboard mr-1"></i> Luy·ªán g√µ l·∫°i b√†i ƒë·ªçc:</h4>
                    <textarea id="reading-input" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-200 bg-gray-50 text-base kanji-font h-32" placeholder="G√µ l·∫°i n·ªôi dung b√†i ƒë·ªçc b·∫±ng ti·∫øng Nh·∫≠t v√†o ƒë√¢y..."></textarea>
                    <div id="reading-feedback" class="text-sm mt-2 min-h-[1.5rem]"></div>
                </div>
            </div>
        </section>

        <!-- 3. Grammar Section -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100">
            <div class="bg-purple-50 px-6 py-4 border-b border-purple-100">
                <h2 class="text-xl font-bold text-purple-800"><i class="fas fa-star mr-2"></i>6 ƒêi·ªÉm Ng·ªØ Ph√°p Quan Tr·ªçng</h2>
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4" id="grammar-container">
                <!-- Grammar points injected -->
            </div>
        </section>

        <!-- 4. Vocabulary Cards -->
        <section class="fade-in">
            <div class="flex items-center justify-between mb-4 px-2">
                <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-tags mr-2 text-sky-600"></i>T·ª´ V·ª±ng & M·∫πo Nh·ªõ</h2>
                <span class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full shadow-sm">Ph∆∞∆°ng ph√°p AzaKanji</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="vocab-container">
                <!-- Vocab cards injected -->
            </div>
        </section>

        <!-- 5. Quiz Section (10 QUESTIONS) -->
        <section class="bg-white rounded-2xl shadow-md overflow-hidden fade-in border border-gray-100 mb-12">
            <div class="bg-emerald-50 px-6 py-4 border-b border-emerald-100 flex justify-between items-center">
                <h2 class="text-xl font-bold text-emerald-800"><i class="fas fa-question-circle mr-2"></i>B√†i T·∫≠p Th·ª±c H√†nh (10 C√¢u)</h2>
                <span class="text-sm bg-emerald-200 text-emerald-800 px-3 py-1 rounded-full font-bold" id="quiz-score">0/10</span>
            </div>
            <div class="p-6 space-y-6" id="quiz-container">
                <!-- Quiz items injected -->
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 text-center">
                <button onclick="checkQuiz()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-8 rounded-full shadow-lg transform transition active:scale-95">
                    N·ªôp B√†i
                </button>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 AzaKanji Kaiwa. H·ªçc ti·∫øng Nh·∫≠t qua ng·ªØ c·∫£nh th·ª±c t·∫ø.</p>
        </div>
    </footer>

    <script>
        // --- DATA ---
        const lessonData = {
            conversation: {
                polite: [
                    { role: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åï„Çì„ÄÅÊúÄËøë[„Åï„ÅÑ„Åç„Çì]Êó•Êú¨Ë™û[„Å´„Åª„Çì„Åî]„ÅÆÂãâÂº∑[„Åπ„Çì„Åç„Çá„ÅÜ]„ÅØ„Å©„ÅÜ„Åß„Åô„Åã„ÄÇ", romaji: "Suzuki-san, saikin Nihongo no benkyou wa dou desu ka.", vi: "Anh Suzuki, g·∫ßn ƒë√¢y vi·ªác h·ªçc ti·∫øng Nh·∫≠t c·ªßa anh th·∫ø n√†o r·ªìi?" },
                    { role: "Suzuki", jp: "ÂãâÂº∑[„Åπ„Çì„Åç„Çá„ÅÜ]„Åô„Çå„Å∞„Åô„Çã„Åª„Å©„ÄÅÈõ£[„ÇÄ„Åö„Åã]„Åó„Åè„Å™„Çä„Åæ„Åô„ÄÇ„Åß„ÇÇ„ÄÅË©±[„ÅØ„Å™]„Åõ„Çã„Çà„ÅÜ„Å´„Å™„Çã„Å®„ÄÅÊ•Ω[„Åü„ÅÆ]„Åó„ÅÑ„Åß„Åô„ÄÇ", romaji: "Benkyou sureba suru hodo, muzukashiku narimasu. Demo, hanaseru you ni naru to, tanoshii desu.", vi: "C√†ng h·ªçc th√¨ l·∫°i c√†ng tr·ªü n√™n kh√≥. Nh∆∞ng khi b·∫Øt ƒë·∫ßu c√≥ th·ªÉ n√≥i ƒë∆∞·ª£c th√¨ r·∫•t vui." },
                    { role: "Tanaka", jp: "„Åù„ÅÜ„Åß„Åô„Å≠„ÄÇÊØéÊó•[„Åæ„ÅÑ„Å´„Å°]Á∑¥Áøí[„Çå„Çì„Åó„ÇÖ„ÅÜ]„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô„Åã„ÄÇ", romaji: "Sou desu ne. Mainichi renshuu suru you ni shite imasu ka.", vi: "ƒê√∫ng v·∫≠y nh·ªâ. Anh c√≥ ƒëang c·ªë g·∫Øng luy·ªán t·∫≠p m·ªói ng√†y kh√¥ng?" },
                    { role: "Suzuki", jp: "„ÅØ„ÅÑ„ÄÅÊØéÊó•[„Åæ„ÅÑ„Å´„Å°]„Éã„É•„Éº„Çπ„ÇíË™≠[„Çà]„Çì„Åß„Åø„Åæ„Åô„ÄÇÊº¢Â≠ó[„Åã„Çì„Åò]„ÅåË™≠[„Çà]„ÇÅ„Å™„Åè„Å™„Çä„Åæ„Åó„Åü„Åã„Çâ„ÄÇ", romaji: "Hai, mainichi nyuusu o yonde mimasu. Kanji ga yomenaku narimashita kara.", vi: "V√¢ng, t√¥i th·ª≠ ƒë·ªçc tin t·ª©c m·ªói ng√†y. V√¨ t√¥i ƒë√£ tr·ªü n√™n kh√¥ng th·ªÉ ƒë·ªçc ƒë∆∞·ª£c ch·ªØ H√°n n·ªØa." },
                    { role: "Tanaka", jp: "„Åô„Åî„ÅÑ„Åß„Åô„Å≠„ÄÇ„Åì„ÅÆÊúç[„Åµ„Åè]„Åå‰ººÂêà[„Å´„ÅÇ]„ÅÜ„Åã„Å©„ÅÜ„Åã„ÄÅÁùÄ[„Åç]„Å¶„Åø„Å¶„ÇÇ„ÅÑ„ÅÑ„Åß„Åô„Åã„ÄÇ", romaji: "Sugoi desu ne. Kono fuku ga niau ka dou ka, kite mite mo ii desu ka.", vi: "Tuy·ªát v·ªùi nh·ªâ. B·ªô ƒë·ªì n√†y c√≥ h·ª£p kh√¥ng, t√¥i m·∫∑c th·ª≠ xem ƒë∆∞·ª£c ch·ª©?" },
                    { role: "Suzuki", jp: "„Åà„Åà„ÄÅ„Å©„ÅÜ„Åû„ÄÇË©¶[„Åü„ÇÅ]„Åó„Å¶„Åø„Å™„ÅÑ„Å®„ÄÅÂàÜ[„Çè]„Åã„Çä„Åæ„Åõ„Çì„Åã„Çâ„Å≠„ÄÇ", romaji: "Ee, douzo. Tameshite minai to, wakarimasen kara ne.", vi: "V√¢ng, xin m·ªùi. N·∫øu kh√¥ng th·ª≠ th√¨ l√†m sao bi·∫øt ƒë∆∞·ª£c, nh·ªâ." }
                ],
                casual: [
                    { role: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åè„Çì„ÄÅÊúÄËøë[„Åï„ÅÑ„Åç„Çì]Êó•Êú¨Ë™û[„Å´„Åª„Çì„Åî]„ÅÆÂãâÂº∑[„Åπ„Çì„Åç„Çá„ÅÜ]„ÄÅ„Å©„ÅÜÔºü", romaji: "Suzuki-kun, saikin Nihongo no benkyou, dou?", vi: "Suzuki, d·∫°o n√†y h·ªçc ti·∫øng Nh·∫≠t sao r·ªìi?" },
                    { role: "Suzuki", jp: "ÂãâÂº∑[„Åπ„Çì„Åç„Çá„ÅÜ]„Åô„Çå„Å∞„Åô„Çã„Åª„Å©„ÄÅÈõ£[„ÇÄ„Åö„Åã]„Åó„Åè„Å™„Çã„Çà„ÄÇ„Åß„ÇÇ„ÄÅË©±[„ÅØ„Å™]„Åõ„Çã„Çà„ÅÜ„Å´„Å™„Çã„Å®„ÄÅÊ•Ω[„Åü„ÅÆ]„Åó„ÅÑ„Çì„Å†„ÄÇ", romaji: "Benkyou sureba suru hodo, muzukashiku naru yo. Demo, hanaseru you ni naru to, tanoshii n da.", vi: "C√†ng h·ªçc c√†ng th·∫•y kh√≥. Nh∆∞ng m√† l√∫c n√≥i ƒë∆∞·ª£c r·ªìi th√¨ vui l·∫Øm." },
                    { role: "Tanaka", jp: "„Å†„Çà„Å≠„ÄÇÊØéÊó•[„Åæ„ÅÑ„Å´„Å°]Á∑¥Áøí[„Çå„Çì„Åó„ÇÖ„ÅÜ]„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÇãÔºü", romaji: "Da yo ne. Mainichi renshuu suru you ni shiteru?", vi: "C√¥ng nh·∫≠n. C·∫≠u c√≥ c·ªë luy·ªán t·∫≠p m·ªói ng√†y kh√¥ng?" },
                    { role: "Suzuki", jp: "„ÅÜ„Çì„ÄÅÊØéÊó•[„Åæ„ÅÑ„Å´„Å°]„Éã„É•„Éº„Çπ„ÇíË™≠[„Çà]„Çì„Åß„Åø„Çã„Çì„Å†„ÄÇÊº¢Â≠ó[„Åã„Çì„Åò]„ÅåË™≠[„Çà]„ÇÅ„Å™„Åè„Å™„Å£„Åü„Åã„Çâ„ÄÇ", romaji: "Un, mainichi nyuusu o yonde mirun da. Kanji ga yomenaku natta kara.", vi: "·ª™, t·ªõ th·ª≠ ƒë·ªçc tin t·ª©c m·ªói ng√†y. V√¨ t·ªõ kh√¥ng c√≤n ƒë·ªçc ƒë∆∞·ª£c ch·ªØ H√°n n·ªØa." },
                    { role: "Tanaka", jp: "„Åô„Åî„ÅÑ„Åò„ÇÉ„Çì„ÄÇ„Åì„ÅÆÊúç[„Åµ„Åè]„ÄÅ‰ººÂêà[„Å´„ÅÇ]„ÅÜ„Åã„Å©„ÅÜ„Åã„ÄÅÁùÄ[„Åç]„Å¶„Åø„Å¶„ÅÑ„ÅÑÔºü", romaji: "Sugoi jan. Kono fuku, niau ka dou ka, kite mite ii?", vi: "Gh√™ v·∫≠y. B·ªô n√†y c√≥ h·ª£p kh√¥ng, m·∫∑c th·ª≠ ƒë∆∞·ª£c kh√¥ng?" },
                    { role: "Suzuki", jp: "„ÅÜ„Çì„ÄÅ„ÅÑ„ÅÑ„Çà„ÄÇË©¶[„Åü„ÇÅ]„Åó„Å¶„Åø„Å™„ÅÑ„Å®„ÄÅÂàÜ[„Çè]„Åã„Çì„Å™„ÅÑ„Åó„Å≠„ÄÇ", romaji: "Un, ii yo. Tameshite minai to, wakannai shi ne.", vi: "·ª™, ƒë∆∞·ª£c ch·ª©. Kh√¥ng th·ª≠ sao bi·∫øt ƒë∆∞·ª£c." }
                ]
            },
            reading: {
                jp: "ÁßÅ[„Çè„Åü„Åó]„ÅØÁßëÂ≠¶ËÄÖ[„Åã„Åå„Åè„Åó„ÇÉ]„Å´„Å™„Çå„Çã„Åã„Å©„ÅÜ„Åã„ÄÅ„Åæ„Å†ÂàÜ[„Çè]„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Åß„ÇÇ„ÄÅÂ§¢[„ÇÜ„ÇÅ]„ÇíÂè∂[„Åã„Å™]„Åà„Çã„Åü„ÇÅ„Å´„ÄÅÊØéÊó•[„Åæ„ÅÑ„Å´„Å°]‰∏ÄÁîüÊá∏ÂëΩ[„ÅÑ„Å£„Åó„Çá„ÅÜ„Åë„Çì„ÇÅ„ÅÑ]ÂãâÂº∑[„Åπ„Çì„Åç„Çá„ÅÜ]„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊäÄË°ì[„Åé„Åò„ÇÖ„Å§]„ÅØÈÄ≤[„Åô„Åô]„ÇÅ„Å∞ÈÄ≤[„Åô„Åô]„ÇÄ„Åª„Å©„ÄÅ‰∏ñÁïå[„Åõ„Åã„ÅÑ]„ÅØ‰æøÂà©[„Åπ„Çì„Çä]„Å´„Å™„Çä„Åæ„Åô„ÄÇÁßÅ„ÇÇ„ÅÑ„Å§„Åã„ÄÅ‰∏ñÁïå‰∏≠[„Åõ„Åã„ÅÑ„Åò„ÇÖ„ÅÜ]„ÅÆ‰∫∫„ÄÖ[„Å≤„Å®„Å≥„Å®]„ÅÆÂΩπ[„ÇÑ„Åè]„Å´Á´ã[„Åü]„Å§„Åì„Å®„Åå„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åü„ÅÑ„Åß„Åô„ÄÇ„Åì„ÅÆÊúç[„Åµ„Åè]„ÇíÁùÄ[„Åç]„Å¶„Åø„Å¶„ÄÅËá™ÂàÜ[„Åò„Å∂„Çì]„Å´‰ººÂêà[„Å´„ÅÇ]„ÅÜ„Åã„Å©„ÅÜ„ÅãÁ¢∫[„Åü„Åó]„Åã„ÇÅ„Å¶„Åø„Åæ„Åô„ÄÇ",
                romaji: "Watashi wa kagakusha ni nareru ka dou ka, mada wakarimasen. Demo, yume o kanaeru tame ni, mainichi isshoukenmei benkyou suru you ni shite imasu. Gijutsu wa susumeba susumu hodo, sekai wa benri ni narimasu. Watashi mo itsuka, sekaijuu no hitobito no yaku ni tatsu koto ga dekiru you ni naritai desu. Kono fuku o kite mite, jibun ni niau ka dou ka tashikamete mimasu.",
                vi: "T√¥i v·∫´n ch∆∞a bi·∫øt li·ªáu m√¨nh c√≥ th·ªÉ tr·ªü th√†nh m·ªôt nh√† khoa h·ªçc hay kh√¥ng. Nh∆∞ng ƒë·ªÉ th·ª±c hi·ªán ∆∞·ªõc m∆°, t√¥i ƒëang c·ªë g·∫Øng h·ªçc h√†nh chƒÉm ch·ªâ m·ªói ng√†y. C√¥ng ngh·ªá c√†ng ph√°t tri·ªÉn, th·∫ø gi·ªõi c√†ng tr·ªü n√™n ti·ªán l·ª£i. T√¥i c≈©ng mu·ªën m·ªôt ng√†y n√†o ƒë√≥ c√≥ th·ªÉ tr·ªü n√™n c√≥ √≠ch cho m·ªçi ng∆∞·ªùi tr√™n to√†n th·∫ø gi·ªõi. T√¥i s·∫Ω th·ª≠ m·∫∑c b·ªô ƒë·ªì n√†y ƒë·ªÉ xem n√≥ c√≥ h·ª£p v·ªõi m√¨nh kh√¥ng."
            },
            grammar: [
                { rule: "ÔΩû„Å∞ÔΩû„Åª„Å© (C√†ng... c√†ng...)", mean: "M·ª©c ƒë·ªô tƒÉng ti·∫øn c·ªßa v·∫ø sau ph·ª• thu·ªôc v·∫ø tr∆∞·ªõc", ex: "ÂãâÂº∑[„Åπ„Çì„Åç„Çá„ÅÜ]„Åô„Çå„Å∞„Åô„Çã„Åª„Å©Èù¢ÁôΩ[„Åä„ÇÇ„Åó„Çç]„ÅÑ", vi: "C√†ng h·ªçc c√†ng th·∫•y th√∫ v·ªã" },
                { rule: "ÔΩû„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô (Tr·ªü n√™n c√≥ th·ªÉ)", mean: "S·ª± thay ƒë·ªïi tr·∫°ng th√°i nƒÉng l·ª±c", ex: "„Éî„Ç¢„Éé„ÅåÂºæ[„Å≤]„Åë„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü", vi: "T√¥i ƒë√£ ch∆°i ƒë∆∞·ª£c piano" },
                { rule: "ÔΩû„Å™„Åè„Å™„Çä„Åæ„Åô (Tr·ªü n√™n kh√¥ng th·ªÉ)", mean: "M·∫•t ƒëi kh·∫£ nƒÉng ho·∫∑c tr·∫°ng th√°i n√†o ƒë√≥", ex: "ÈÄü[„ÅØ„ÇÑ]„ÅèËµ∞[„ÅØ„Åó]„Çå„Å™„Åè„Å™„Çä„Åæ„Åó„Åü", vi: "T√¥i kh√¥ng c√≤n ch·∫°y nhanh ƒë∆∞·ª£c n·ªØa" },
                { rule: "ÔΩû„Çà„ÅÜ„Å´„Åó„Åæ„Åô (C·ªë g·∫Øng)", mean: "N·ªó l·ª±c l√†m/kh√¥ng l√†m g√¨ ƒë√≥ ƒë·ªÅu ƒë·∫∑n", ex: "ÈáéËèú[„ÇÑ„Åï„ÅÑ]„ÇíÈ£ü[„Åü]„Åπ„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô", vi: "T√¥i c·ªë g·∫Øng ƒÉn rau" },
                { rule: "ÔΩû„Åã / ÔΩû„Åã„Å©„ÅÜ„Åã (...hay kh√¥ng)", mean: "C√¢u h·ªèi gi√°n ti·∫øp l·ªìng trong c√¢u", ex: "Ë°å[„ÅÑ]„Åë„Çã„Åã„Å©„ÅÜ„ÅãÂàÜ[„Çè]„Åã„Çä„Åæ„Åõ„Çì", vi: "T√¥i kh√¥ng bi·∫øt c√≥ ƒëi ƒë∆∞·ª£c hay kh√¥ng" },
                { rule: "V„Å¶„Åø„Åæ„Åô (Th·ª≠ l√†m)", mean: "L√†m th·ª≠ xem k·∫øt qu·∫£ th·∫ø n√†o", ex: "‰∏ÄÂ∫¶[„ÅÑ„Å°„Å©]È£ü[„Åü]„Åπ„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ", vi: "H√£y ƒÉn th·ª≠ m·ªôt l·∫ßn xem" }
            ],
            vocab: [
                { k: "ÂãâÂº∑", h: "„Åπ„Çì„Åç„Çá„ÅÜ", m: "H·ªçc t·∫≠p", hv: "MI·ªÑN C∆Ø·ªúNG", ti: "D√πng s·ª©c L·ª±c (**Âäõ**) ƒë·ªÉ Mi·ªÖn (**ÂÖç**) c∆∞·ª°ng h·ªçc.", ta: "**B·ªÅn** (Ben) b·ªâ h·ªçc ·ªü Tokyo (**kyou**)." },
                { k: "Á∑¥Áøí", h: "„Çå„Çì„Åó„ÇÖ„ÅÜ", m: "Luy·ªán t·∫≠p", hv: "LUY·ªÜN T·∫¨P", ti: "D√πng s·ª£i t∆° (**Á≥∏**) ƒë·ªÉ Luy·ªán (**Á∑¥**) t·∫≠p cho ƒë√¥i c√°nh (**ÁæΩ**).", ta: "**R√®n** (Ren) luy·ªán **su** (shuu) su·ªët ng√†y." },
                { k: "Êº¢Â≠ó", h: "„Åã„Çì„Åò", m: "H√°n t·ª±", hv: "H√ÅN T·ª∞", ti: "Ch·ªØ (**Â≠ó**) c·ªßa nh√† H√°n (**Êº¢**) ·ªü d∆∞·ªõi m√°i nh√†.", ta: "**Can** (Kan) ƒë·∫£m vi·∫øt **G√¨** (ji)." },
                { k: "Êúç", h: "„Åµ„Åè", m: "Qu·∫ßn √°o", hv: "PH·ª§C", ti: "TrƒÉng (**Êúà**) soi ng∆∞·ªùi qu·ª≥ Ph·ª•c (**Âç©**) m·∫∑c qu·∫ßn √°o.", ta: "**H·∫°nh ph√∫c** (Fuku) khi c√≥ qu·∫ßn √°o ƒë·∫πp." },
                { k: "‰ººÂêà„ÅÜ", h: "„Å´„ÅÇ„ÅÜ", m: "H·ª£p", hv: "T·ª∞ H·ª¢P", ti: "Ng∆∞·ªùi (**‰∫ª**) T·ª± (**‰ª•**) th·∫•y m√¨nh H·ª£p (**Âêà**) nhau.", ta: "**N√≠** (Ni) **√¢u** (au) y·∫øm nh√¨n r·∫•t h·ª£p." },
                { k: "ÁßëÂ≠¶ËÄÖ", h: "„Åã„Åå„Åè„Åó„ÇÉ", m: "Nh√† khoa h·ªçc", hv: "KHOA H·ªåC GI·∫¢", ti: "Ng∆∞·ªùi (**ËÄÖ**) h·ªçc (**Â≠¶**) v·ªÅ l√∫a (**Á¶æ**) m·ªôt c√°ch khoa h·ªçc.", ta: "**Ca** (Ka) **g·∫°** (ga) **c·ª©** (ku) **xa** (sha) l√°nh nh√† khoa h·ªçc." },
                { k: "Â§¢", h: "„ÇÜ„ÇÅ", m: "Gi·∫•c m∆°", hv: "M·ªòNG", ti: "Chi·ªÅu t·ªëi (**Â§ï**) n·∫±m d∆∞·ªõi c·ªè (**Ëâπ**) m·∫Øt (**ÁΩí**) m∆° m·ªông.", ta: "**You** (Yu) **m√™** (me) ng·ªß n√™n m∆°." },
                { k: "Âè∂„Åà„Çã", h: "„Åã„Å™„Åà„Çã", m: "Th·ª±c hi·ªán (∆∞·ªõc m∆°)", hv: "DI·ªÜP", ti: "M∆∞·ªùi (**ÂçÅ**) c√°i mi·ªáng (**Âè£**) c√πng c·∫ßu nguy·ªán.", ta: "**Ca** (Ka) **n√†** (na) **·∫ø** (e) **r≈©** (ru) mu·ªën th·ª±c hi·ªán ∆∞·ªõc m∆°." },
                { k: "ÊäÄË°ì", h: "„Åé„Åò„ÇÖ„Å§", m: "K·ªπ thu·∫≠t", hv: "K·ª∏ THU·∫¨T", ti: "Tay (**Êâå**) c·∫ßm c√†nh chi (**ÊîØ**) l√†m thu·∫≠t (**Ë°ì**) to√°n.", ta: "**Ghi** (Gi) **ch√∫t** (jutsu) k·ªπ thu·∫≠t." },
                { k: "ÈÄ≤„ÇÄ", h: "„Åô„Åô„ÇÄ", m: "Ti·∫øn b·ªô/ƒêi l√™n", hv: "TI·∫æN", ti: "Con chim (**Èöπ**) ƒëi (**‚ªå**) v·ªÅ ph√≠a tr∆∞·ªõc.", ta: "**Su su** (Susu) **m·ª´** (mu) ti·∫øn l√™n." },
                { k: "‰∏ñÁïå", h: "„Åõ„Åã„ÅÑ", m: "Th·∫ø gi·ªõi", hv: "TH·∫æ GI·ªöI", ti: "Th·∫ø (**‰∏ñ**) gian trong gi·ªõi (**Áïå**) h·∫°n ru·ªông ƒë·∫•t.", ta: "**Xe** (Se) **cai** (kai) th·∫ßu c·∫£ th·∫ø gi·ªõi." },
                { k: "ÂΩπ", h: "„ÇÑ„Åè", m: "C√≥ √≠ch/Vai tr√≤", hv: "D·ªäCH", ti: "ƒêi (**ÂΩ≥**) c·∫ßm binh kh√≠ (**ÊÆ≥**) l√†m chi·∫øn d·ªãch.", ta: "**D·∫°** (Ya) **c·ª•** (ku) r·∫•t c√≥ √≠ch." },
                { k: "Á¢∫„Åã„ÇÅ„Çã", h: "„Åü„Åó„Åã„ÇÅ„Çã", m: "X√°c nh·∫≠n", hv: "X√ÅC", ti: "ƒê√° (**Áü≥**) v√† nh√† (**ÂÆÄ**) chim (**Èöπ**) r·∫•t Ch√≠nh x√°c.", ta: "**Ta** (Ta) **si** (shi) **ca** (ka) **m√™** (me) **r≈©** (ru) c·∫ßn x√°c nh·∫≠n." }
            ],
            quiz: [
                { q: "Cu·ªën s√°ch n√†y c√†ng ƒë·ªçc c√†ng th·∫•y th√∫ v·ªã (ÔΩû„Å∞ÔΩû„Åª„Å©)", a: ["Ë™≠„ÇÅ„Å∞Ë™≠„ÇÄ„Åª„Å©", "Ë™≠„Çì„ÅßË™≠„ÇÄ„Åª„Å©", "Ë™≠„Çì„Å†„ÇâË™≠„ÇÄ„Åª„Å©"], correct: 0 },
                { q: "T√¥i ƒëang c·ªë g·∫Øng v·∫≠n ƒë·ªông m·ªói ng√†y (ÔΩû„Çà„ÅÜ„Å´„Åó„Åæ„Åô)", a: ["ÈÅãÂãï„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô", "ÈÅãÂãï„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô", "ÈÅãÂãï„Åô„Çã„Çà„ÅÜ„Åß„Åô"], correct: 1 },
                { q: "H√£y cho t√¥i bi·∫øt anh ·∫•y c√≥ ƒë·∫øn hay kh√¥ng (ÔΩû„Åã„Å©„ÅÜ„Åã)", a: ["Êù•„Çã„Åã", "Êù•„Çã„Åã„Å©„ÅÜ„Åã", "Êù•„Çã„Å®"], correct: 1 },
                { q: "T√¥i mu·ªën th·ª≠ m·∫∑c b·ªô ƒë·ªì n√†y (V„Å¶„Åø„Åæ„Åô)", a: ["ÁùÄ„Å¶„Åø„Åü„ÅÑ„Åß„Åô", "ÁùÄ„Å¶„Åª„Åó„ÅÑ„Åß„Åô", "ÁùÄ„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô"], correct: 0 },
                { q: "V√¨ gi√† ƒëi n√™n m·∫Øt t√¥i tr·ªü n√™n kh√¥ng nh√¨n r√µ (ÔΩû„Å™„Åè„Å™„Çä„Åæ„Åô)", a: ["Ë¶ã„Åà„Å™„Åè„Å™„Çä„Åæ„Åó„Åü", "Ë¶ã„Åà„Å™„ÅÑ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô", "Ë¶ã„Åà„Å¶„ÅÑ„Åæ„Åõ„Çì"], correct: 0 },
                { q: "T√¥i ƒë√£ c√≥ th·ªÉ b∆°i ƒë∆∞·ª£c r·ªìi (ÔΩû„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô - Kh·∫£ nƒÉng)", a: ["Ê≥≥„Åê„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü", "Ê≥≥„Åí„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü", "Ê≥≥„ÅÑ„Åß„ÅÑ„Åæ„Åô"], correct: 1 },
                { q: "C√¥ng ngh·ªá c√†ng ph√°t tri·ªÉn th√¨ ƒë·ªùi s·ªëng c√†ng ti·ªán l·ª£i", a: ["ÈÄ≤„ÇÅ„Å∞ÈÄ≤„ÇÄ„Åª„Å©", "ÈÄ≤„Çì„Å†„ÇâÈÄ≤„ÇÄ„Åª„Å©", "ÈÄ≤„Çì„ÅßÈÄ≤„ÇÄ„Åª„Å©"], correct: 0 },
                { q: "T√¥i v·∫´n ch∆∞a bi·∫øt li·ªáu ng√†y mai tr·ªùi c√≥ m∆∞a hay kh√¥ng", a: ["Èôç„Çã„ÅãÈôç„Çâ„Å™„ÅÑ„Åã", "Èôç„Çã„Åã„Å©„ÅÜ„Åã", "Èôç„Çã„Å®"], correct: 1 },
                { q: "H√£y th·ª≠ ƒëi Nh·∫≠t m·ªôt l·∫ßn xem sao", a: ["Ë°å„Å£„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ", "Ë°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ", "Ë°å„Åè„Çà„ÅÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ"], correct: 0 },
                { q: "T·ª´ v·ª±ng: 'Nh√† khoa h·ªçc' ƒë·ªçc l√† g√¨?", a: ["„Åã„Åå„Åè„Åó„ÇÉ", "„ÅÑ„Åó„ÇÉ", "„Åå„Åè„Åó„ÇÉ"], correct: 0 }
            ]
        };

        // --- STATE ---
        let currentMode = 'polite';
        let showFurigana = true;
        let showRomaji = false;
        let showVi = true;

        // --- UTILS ---
        const parseFurigana = (text) => text.replace(/([^\[\]]+)\[(.+?)\]/g, '<ruby>$1<rt>$2</rt></ruby>');
        const cleanText = (text) => text.replace(/\[.*?\]/g, '');

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(cleanText(text));
                u.lang = 'ja-JP'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        function checkTyping(input, correctText, feedbackDiv) {
            const userText = input.value;
            const targetText = cleanText(correctText);
            let html = '';
            
            for (let i = 0; i < userText.length; i++) {
                if (i >= targetText.length) {
                    html += `<span class="incorrect-char">${userText[i]}</span>`;
                } else if (userText[i] === targetText[i]) {
                    html += `<span class="correct-char">${userText[i]}</span>`;
                } else {
                    html += `<span class="incorrect-char">${userText[i]}</span>`;
                }
            }
            feedbackDiv.innerHTML = html;
            
            if (userText === targetText) {
                input.classList.add('correct-input');
                input.classList.remove('wrong-input');
                feedbackDiv.innerHTML += ' <span class="text-green-600 ml-2 font-bold text-xs"><i class="fas fa-check-circle"></i> Ch√≠nh x√°c!</span>';
            } else if (userText.length > 0) {
                input.classList.add('wrong-input');
                input.classList.remove('correct-input');
            } else {
                input.classList.remove('correct-input', 'wrong-input');
            }
        }

        // --- RENDER FUNCTIONS ---
        function renderConversation() {
            const container = document.getElementById('conversation-container');
            const lines = lessonData.conversation[currentMode];
            container.innerHTML = lines.map((line) => `
                <div class="flex gap-4 fade-in ${line.role === 'Tanaka' ? '' : 'flex-row-reverse'}">
                    <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center font-bold text-white shadow-md ${line.role === 'Tanaka' ? 'bg-blue-500' : 'bg-green-500'}">
                        ${line.role[0]}
                    </div>
                    <div class="flex-1 max-w-[90%]">
                        <div class="text-xs text-gray-500 mb-1 ${line.role === 'Tanaka' ? 'text-left' : 'text-right'}">${line.role}</div>
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-200 relative group transition hover:shadow-md ${line.role === 'Tanaka' ? 'rounded-tl-none' : 'rounded-tr-none bg-green-50'}">
                            <p class="text-lg text-gray-800 kanji-font leading-relaxed mb-1">${parseFurigana(line.jp)}</p>
                            <p class="text-sm text-gray-500 romaji-text hidden italic mb-1">${line.romaji}</p>
                            <p class="text-sm text-gray-500 vi-trans border-t border-gray-100 pt-2 mt-2">${line.vi}</p>
                            <button onclick="speak('${line.jp}')" class="absolute top-2 right-2 text-gray-300 hover:text-sky-600 transition"><i class="fas fa-volume-up"></i></button>
                            <div class="mt-3 pt-2 border-t border-gray-100">
                                <input type="text" class="w-full text-sm p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-200 transition bg-gray-50 placeholder-gray-300" placeholder="Nghe v√† g√µ l·∫°i c√¢u tr√™n..." oninput="checkTyping(this, '${line.jp}', this.nextElementSibling)">
                                <div class="h-5 mt-1 text-sm pl-1 kanji-font"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            updateUI();
        }

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('tab-polite').className = mode === 'polite' ? "tab-btn tab-active px-4 py-1.5 rounded-md text-sm font-bold" : "tab-btn tab-inactive px-4 py-1.5 rounded-md text-sm font-bold ml-1";
            document.getElementById('tab-casual').className = mode === 'casual' ? "tab-btn tab-active px-4 py-1.5 rounded-md text-sm font-bold ml-1" : "tab-btn tab-inactive px-4 py-1.5 rounded-md text-sm font-bold ml-1";
            renderConversation();
        }

        function renderReading() {
            document.getElementById('reading-text').innerHTML = parseFurigana(lessonData.reading.jp);
            document.getElementById('reading-romaji').innerText = lessonData.reading.romaji;
            document.getElementById('reading-vi').innerText = lessonData.reading.vi;
            const input = document.getElementById('reading-input');
            const feedback = document.getElementById('reading-feedback');
            input.oninput = () => checkTyping(input, lessonData.reading.jp, feedback);
            
            if(!document.getElementById('reading-play-btn')) {
                const btn = document.createElement('button');
                btn.id = 'reading-play-btn';
                btn.className = "mt-4 text-orange-500 hover:text-orange-700 font-bold flex items-center text-sm transition";
                btn.innerHTML = '<i class="fas fa-volume-up mr-2"></i> Nghe b√†i ƒë·ªçc';
                btn.onclick = () => speak(lessonData.reading.jp);
                document.getElementById('reading-text').parentNode.insertBefore(btn, document.getElementById('reading-text').nextSibling);
            }
        }

        function renderGrammar() {
            const container = document.getElementById('grammar-container');
            container.innerHTML = lessonData.grammar.map(g => `
                <div class="bg-white p-5 rounded-xl border border-purple-100 shadow-sm hover:border-purple-300 transition group">
                    <h3 class="font-bold text-purple-700 mb-1 text-lg flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>${g.rule}</h3>
                    <p class="text-gray-600 text-sm mb-3 pl-4">${g.mean}</p>
                    <div class="bg-purple-50 p-3 rounded-lg text-sm text-gray-700 kanji-font relative pl-4">
                        <i class="fas fa-quote-left text-purple-200 absolute top-1 left-1 text-xs"></i>${parseFurigana(g.ex)}
                        <p class="text-xs text-purple-600 mt-1 italic">${g.vi}</p>
                        <button onclick="speak('${g.ex}')" class="absolute top-2 right-2 text-purple-300 hover:text-purple-600 transition opacity-0 group-hover:opacity-100"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function renderVocab() {
            const container = document.getElementById('vocab-container');
            container.innerHTML = lessonData.vocab.map(v => `
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 card-hover flex flex-col relative group transition-all duration-300 hover:border-sky-300">
                    <div class="flex justify-between items-start mb-3">
                        <div><div class="text-3xl font-bold text-gray-800 kanji-font mb-1">${v.k}</div><div class="text-sm text-gray-500">${v.h}</div></div>
                        <div class="text-xs font-bold text-white bg-gray-400 px-2 py-1 rounded shadow-sm">${v.hv}</div>
                    </div>
                    <div class="text-sky-700 font-bold text-lg mb-3 border-b border-gray-100 pb-2">${v.m}</div>
                    <div class="space-y-2 text-sm text-gray-600 flex-grow">
                        <div class="bg-orange-50 p-2 rounded border border-orange-100"><span class="font-bold text-orange-600">üñºÔ∏è H√¨nh:</span> ${v.ti.replace(/\*\*(.*?)\*\*/g, '<span class="text-red-600 font-bold">$1</span>')}</div>
                        <div class="bg-blue-50 p-2 rounded border border-blue-100"><span class="font-bold text-blue-600">üîä √Çm:</span> ${v.ta.replace(/\*\*(.*?)\*\*/g, '<span class="text-indigo-600 font-bold">$1</span>')}</div>
                    </div>
                    <button onclick="speak('${v.k}')" class="absolute top-3 right-3 text-gray-300 hover:text-sky-500 opacity-0 group-hover:opacity-100 transition bg-white rounded-full w-8 h-8 shadow flex items-center justify-center"><i class="fas fa-volume-up"></i></button>
                </div>
            `).join('');
        }

        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = lessonData.quiz.map((q, idx) => `
                <div class="quiz-item border-b border-gray-100 pb-4 last:border-0">
                    <p class="font-bold text-gray-800 mb-3"><span class="text-emerald-600 mr-2">C√¢u ${idx + 1}:</span> ${parseFurigana(q.q)}</p>
                    <div class="space-y-2">
                        ${q.type === 'audio' 
                            ? `<button class="speak-btn mb-2 flex items-center text-sky-600 font-bold" onclick="speak('${q.jp}')"><i class="fas fa-volume-up mr-2"></i> Nghe c√¢u h·ªèi</button>
                               <input type="text" class="w-full p-2 border rounded" placeholder="Nh·∫≠p c√¢u b·∫°n nghe ƒë∆∞·ª£c..." data-idx="${idx}">`
                            : q.a.map((opt, optIdx) => `
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition quiz-option" data-q="${idx}">
                                    <input type="radio" name="q${idx}" value="${optIdx}" class="mr-3 text-emerald-600 focus:ring-emerald-500">
                                    <span class="kanji-font">${parseFurigana(opt)}</span>
                                </label>`).join('')
                        }
                    </div>
                    <div class="quiz-feedback hidden mt-3 p-3 rounded-lg text-sm" id="feedback-${idx}"></div>
                </div>
            `).join('');
            document.getElementById('quiz-score').innerText = `0/${lessonData.quiz.length}`;
        }

        function checkQuiz() {
            let score = 0;
            lessonData.quiz.forEach((q, idx) => {
                const feedbackEl = document.getElementById(`feedback-${idx}`);
                feedbackEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
                
                if (q.type === 'audio') {
                    const input = document.querySelector(`input[data-idx="${idx}"]`);
                    if (input.value.trim() === cleanText(q.jp)) {
                        score++;
                        feedbackEl.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Ch√≠nh x√°c!`;
                        feedbackEl.classList.add('bg-green-100', 'text-green-800');
                    } else {
                        feedbackEl.innerHTML = `<i class="fas fa-times-circle mr-2"></i> Sai r·ªìi. ƒê√°p √°n: <strong>${q.jp}</strong>`;
                        feedbackEl.classList.add('bg-red-100', 'text-red-800');
                    }
                } else {
                    const selected = document.querySelector(`input[name="q${idx}"]:checked`);
                    if (selected) {
                        const val = parseInt(selected.value);
                        if (val === q.correct) {
                            score++;
                            feedbackEl.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Ch√≠nh x√°c!`;
                            feedbackEl.classList.add('bg-green-100', 'text-green-800');
                        } else {
                            feedbackEl.innerHTML = `<i class="fas fa-times-circle mr-2"></i> Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: <strong>${q.a[q.correct]}</strong>`;
                            feedbackEl.classList.add('bg-red-100', 'text-red-800');
                        }
                    } else {
                        feedbackEl.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i> B·∫°n ch∆∞a ch·ªçn ƒë√°p √°n.`;
                        feedbackEl.classList.add('bg-yellow-100', 'text-yellow-800');
                    }
                }
            });
            document.getElementById('quiz-score').innerText = `${score}/${lessonData.quiz.length}`;
        }

        // --- CONTROLS ---
        function updateUI() {
            document.querySelectorAll('rt').forEach(rt => rt.style.visibility = showFurigana ? 'visible' : 'hidden');
            document.getElementById('btn-toggle-furigana').className = showFurigana ? "px-3 py-1.5 rounded transition bg-sky-600 text-white flex items-center shadow" : "px-3 py-1.5 rounded transition bg-gray-200 text-gray-600 flex items-center";
            
            document.querySelectorAll('.romaji-text').forEach(el => el.classList.toggle('hidden', !showRomaji));
            document.getElementById('btn-toggle-romaji').className = showRomaji ? "px-3 py-1.5 rounded transition bg-sky-600 text-white flex items-center shadow ml-1" : "px-3 py-1.5 rounded transition bg-gray-200 text-gray-600 flex items-center ml-1";
            
            document.querySelectorAll('.vi-trans').forEach(p => p.style.display = showVi ? 'block' : 'none');
            document.getElementById('btn-toggle-vi').className = showVi ? "px-3 py-1.5 rounded transition bg-white text-sky-800 font-bold ml-1 flex items-center border border-sky-200 shadow-sm" : "px-3 py-1.5 rounded transition bg-gray-200 text-gray-500 font-bold ml-1 flex items-center";
        }

        document.getElementById('btn-toggle-furigana').onclick = () => { showFurigana = !showFurigana; updateUI(); };
        document.getElementById('btn-toggle-romaji').onclick = () => { showRomaji = !showRomaji; updateUI(); };
        document.getElementById('btn-toggle-vi').onclick = () => { showVi = !showVi; updateUI(); };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderConversation();
            renderReading();
            renderGrammar();
            renderVocab();
            renderQuiz();
            updateUI();
        });
    </script>
</body>
</html>
