<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Ti·∫øng Nh·∫≠t Si√™u T·ªëc - Ng√†y 23</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .jp-font {
            font-family: 'Noto Sans JP', sans-serif;
        }
        ruby rt {
            font-size: 0.7em;
            font-weight: 500;
            user-select: none;
        }
        .hide-furigana ruby rt {
            visibility: hidden;
        }
        .transition-height {
            transition: max-height 0.5s ease-in-out;
        }
        .correct-char { color: #16a34a; }
        .incorrect-char { color: #dc2626; text-decoration: underline; }
        
        /* --- NEW STYLES FOR UPGRADES --- */
        /* Progress Bar */
        .progress-bar-container {
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: #22c55e; /* green-500 */
            transition: width 0.5s ease-in-out;
        }
        /* Fade transition for conversation */
        .content-fade {
            transition: opacity 0.3s ease-in-out;
        }
        .fading-out {
            opacity: 0;
        }
        /* Quiz feedback icons */
        .feedback-icon {
            display: inline-block;
            margin-right: 0.5rem;
            font-weight: bold;
        }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-sky-700 jp-font" id="main-title"></h1>
            <p class="text-gray-500 mt-2">B√†i h·ªçc v·ªÅ l√Ω do, t∆∞∆°ng ph·∫£n v√† ƒë·ªÅ xu·∫•t.</p>
        </header>

        <!-- Progress Bar Section -->
        <div class="mb-8">
            <h3 class="font-bold text-center mb-2">Ti·∫øn ƒë·ªô b√†i h·ªçc</h3>
            <div class="progress-bar-container w-full h-4">
                <div id="lesson-progress-bar" class="progress-bar h-full text-xs text-white text-center" style="width: 0%;"></div>
            </div>
        </div>

        <main class="space-y-8">
            <!-- Settings Panel -->
            <div class="bg-white p-4 rounded-xl shadow-md border border-gray-200">
                <h3 class="font-bold text-lg mb-3 text-gray-700">B·∫£ng ƒëi·ªÅu khi·ªÉn</h3>
                <div class="flex flex-wrap gap-4">
                    <button id="toggle-furigana" class="toggle-btn">B·∫≠t Furigana</button>
                    <button id="toggle-romaji" class="toggle-btn">Hi·ªán Romaji</button>
                    <button id="toggle-vietnamese" class="toggle-btn">Hi·ªán Ti·∫øng Vi·ªát</button>
                </div>
            </div>

            <!-- Conversation Section -->
            <section id="conversation-section" class="lesson-section"></section>

            <!-- Reading Section -->
            <section id="reading-section" class="lesson-section"></section>

            <!-- Grammar Section -->
            <section id="grammar-section" class="lesson-section"></section>
            
            <!-- Quiz Section -->
            <section id="quiz-section" class="lesson-section"></section>
        </main>

        <footer class="text-center mt-12 text-gray-400 text-sm">
            <p>Copyright by AzaCan, 2025</p>
        </footer>
    </div>

    <script>
        // --- DATA FOR DAY 23 ---
        const day23Data = {
            title: "Ng√†y 23: T∆∞∆°ng ph·∫£n v√† ƒê·ªÅ xu·∫•t",
            conversation: {
                id: 'conversation',
                title: "‰ªäÊó•„ÅÆ‰ºöË©± (H·ªôi tho·∫°i trong ng√†y)",
                context: "B·ªëi c·∫£nh: Tanaka v√† Suzuki n√≥i v·ªÅ t√≠nh c√°ch c·ªßa m·ªôt ng∆∞·ªùi b·∫°n chung.",
                modes: {
                    polite: {
                        name: "Th·ªÉ l·ªãch s·ª± (‰∏ÅÂØßÂΩ¢)",
                        dialogue: [
                            { speaker: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åï„Çì„ÄÅÂ±±Áî∞[„ÇÑ„Åæ„Å†]„Åï„Çì„ÅØÊú¨ÂΩì[„Åª„Çì„Å®„ÅÜ]„Å´Á©çÊ•µÁöÑ[„Åõ„Å£„Åç„Çá„Åè„Å¶„Åç]„Åß„Åô„Å≠„ÄÇ", romaji: "Suzuki-san, Yamada-san wa hontou ni sekkyokuteki desu ne.", vi: "Anh Suzuki, anh Yamada th·∫≠t s·ª± r·∫•t t√≠ch c·ª±c nh·ªâ." },
                            { speaker: "Suzuki", jp: "„Åà„Åà„ÄÇÂΩº[„Åã„Çå]„ÅØÁ©çÊ•µÁöÑ[„Åõ„Å£„Åç„Çá„Åè„Å¶„Åç]„Å™‰∏ÄÊñπ[„ÅÑ„Å£„ÅΩ„ÅÜ]„Åß„ÄÅÂ∞ë[„Åô„Åì]„Åó„Åõ„Å£„Åã„Å°„Å™„Å®„Åì„Çç„Åå„ÅÇ„Çä„Åæ„Åô„Å≠„ÄÇ", romaji: "Ee. Kare wa sekkyokuteki na ippou de, sukoshi sekkachi na tokoro ga arimasu ne.", vi: "V√¢ng. Anh ·∫•y t√≠ch c·ª±c nh∆∞ng ƒë·ªìng th·ªùi c≈©ng c√≥ ch√∫t n√≥ng v·ªôi." },
                            { speaker: "Tanaka", jp: "Á¢∫[„Åü„Åó]„Åã„Å´„ÄÇ‰ªï‰∫ã[„Åó„Åî„Å®]„ÅåÂ§ßÂ§â[„Åü„ÅÑ„Å∏„Çì]„Å™„ÅÆ„Å†„Åã„Çâ„ÄÅÂ∞ë[„Åô„Åì]„Åó‰ºë[„ÇÑ„Åô]„Çì„Å†„Çâ„Å©„ÅÜ„Åß„Åô„Åã„Å®ÊèêÊ°à[„Å¶„ÅÑ„ÅÇ„Çì]„Åó„Åæ„Åó„Åü„ÄÇ", romaji: "Tashika ni. Shigoto ga taihen na no dakara, sukoshi yasundara dou desu ka to teian shimashita.", vi: "Ch·∫Øc ch·∫Øn r·ªìi. V√¨ c√¥ng vi·ªác v·∫•t v·∫£ n√™n t√¥i ƒë√£ ƒë·ªÅ ngh·ªã anh ·∫•y th·ª≠ ngh·ªâ ng∆°i m·ªôt ch√∫t xem sao." },
                            { speaker: "Suzuki", jp: "„ÅÑ„ÅÑ„Åß„Åô„Å≠„ÄÇÂΩº[„Åã„Çå]„ÅØÊàëÊÖ¢Âº∑[„Åå„Åæ„Çì„Å•„Çà]„ÅÑÂèçÈù¢[„ÅØ„Çì„ÇÅ„Çì]„ÄÅÁÑ°ÁêÜ[„ÇÄ„Çä]„Çí„Åó„Åô„Åé„Çã„Å®„Åì„Çç„Åå„ÅÇ„Çä„Åæ„Åô„Åã„Çâ„ÄÇ", romaji: "Ii desu ne. Kare wa gamanzuyoi hanmen, muri o shisugiru tokoro ga arimasu kara.", vi: "Hay ƒë√≥. V√¨ anh ·∫•y gi·ªèi ch·ªãu ƒë·ª±ng nh∆∞ng m·∫∑t kh√°c l·∫°i hay l√†m vi·ªác qu√° s·ª©c." },
                            { speaker: "Tanaka", jp: "ÂÖÑ[„ÅÇ„Å´]„ÅØÂΩº[„Åã„Çå]„Å´ÂØæ[„Åü„ÅÑ]„Åó„Å¶„ÄÅÂºü[„Åä„Å®„ÅÜ„Å®]„ÅØ„Å®„Å¶„ÇÇÊ∂àÊ•µÁöÑ[„Åó„Çá„ÅÜ„Åç„Çá„Åè„Å¶„Åç]„Åß„Åô„ÄÇ", romaji: "Ani wa kare ni taishite, otouto wa totemo shoukyokuteki desu.", vi: "Tr√°i ng∆∞·ª£c v·ªõi anh ·∫•y, em trai t√¥i l·∫°i r·∫•t ti√™u c·ª±c." },
                            { speaker: "Suzuki", jp: "‰∫∫[„Å≤„Å®]„ÅØ„Åù„Çå„Åû„Çå„Åß„Åô„Å≠„ÄÇ„ÇÇ„ÅóÂΩº[„Åã„Çå]„ÅåÁñ≤[„Å§„Åã]„Çå„Å¶„ÅÑ„Çã„ÅÆ„Å™„Çâ„ÄÅÊâã‰ºù[„Å¶„Å§„Å†]„Å£„Å¶„ÅÇ„Åí„Åü„Çâ„Å©„ÅÜ„Åß„Åô„Åã„ÄÇ", romaji: "Hito wa sorezore desu ne. Moshi kare ga tsukarete iru no nara, tetsudatte agetara dou desu ka.", vi: "M·ªói ng∆∞·ªùi m·ªói kh√°c nh·ªâ. N·∫øu anh ·∫•y m·ªát, sao anh kh√¥ng th·ª≠ gi√∫p m·ªôt tay?" }
                        ]
                    },
                    casual: {
                        name: "Th·ªÉ th√¥ng th∆∞·ªùng (ÊôÆÈÄöÂΩ¢)",
                        dialogue: [
                            { speaker: "Tanaka", jp: "Èà¥Êú®[„Åô„Åö„Åç]„Åè„Çì„ÄÅÂ±±Áî∞[„ÇÑ„Åæ„Å†]„Åè„Çì„Å£„Å¶Êú¨ÂΩì[„Åª„Çì„Å®„ÅÜ]„Å´Á©çÊ•µÁöÑ[„Åõ„Å£„Åç„Çá„Åè„Å¶„Åç]„Å†„Çà„Å≠„ÄÇ", romaji: "Suzuki-kun, Yamada-kun tte hontou ni sekkyokuteki da yo ne.", vi: "Suzuki n√†y, Yamada th·∫≠t s·ª± r·∫•t t√≠ch c·ª±c nh·ªâ." },
                            { speaker: "Suzuki", jp: "„ÅÜ„Çì„ÄÇÂΩº[„Åã„Çå]„ÅØÁ©çÊ•µÁöÑ[„Åõ„Å£„Åç„Çá„Åè„Å¶„Åç]„Å™‰∏ÄÊñπ[„ÅÑ„Å£„ÅΩ„ÅÜ]„Åß„ÄÅ„Å°„Çá„Å£„Å®„Åõ„Å£„Åã„Å°„Å†„Åë„Å©„Å≠„ÄÇ", romaji: "Un. Kare wa sekkyokuteki na ippou de, chotto sekkachi da kedo ne.", vi: "·ª™. C·∫≠u ·∫•y t√≠ch c·ª±c nh∆∞ng m√† c≈©ng h∆°i n√≥ng v·ªôi." },
                            { speaker: "Tanaka", jp: "Á¢∫[„Åü„Åó]„Åã„Å´„ÄÇ‰ªï‰∫ã[„Åó„Åî„Å®]„ÅåÂ§ßÂ§â[„Åü„ÅÑ„Å∏„Çì]„Å™„Çì„Å†„Åã„Çâ„ÄÅÂ∞ë[„Åô„Åì]„Åó‰ºë[„ÇÑ„Åô]„Çì„Å†„Çâ„Å©„ÅÜ„Åã„Å£„Å¶Ë®Ä[„ÅÑ]„Å£„Å¶„Åø„Åü„Çì„Å†„ÄÇ", romaji: "Tashika ni. Shigoto ga taihen nanda kara, sukoshi yasundara dou ka tte itte mitan da.", vi: "ƒê√∫ng v·∫≠y. V√¨ c√¥ng vi·ªác v·∫•t v·∫£ n√™n t·ªõ ƒë√£ th·ª≠ b·∫£o c·∫≠u ·∫•y ngh·ªâ ng∆°i m·ªôt ch√∫t xem sao." },
                            { speaker: "Suzuki", jp: "„ÅÑ„ÅÑ„Å≠„ÄÇÂΩº[„Åã„Çå]„ÄÅÊàëÊÖ¢Âº∑[„Åå„Åæ„Çì„Å•„Çà]„ÅÑÂèçÈù¢[„ÅØ„Çì„ÇÅ„Çì]„ÄÅÁÑ°ÁêÜ[„ÇÄ„Çä]„Åó„Åô„Åé„Çã„Å®„Åì„Çç„Åå„ÅÇ„Çã„Åã„Çâ„Åï„ÄÇ", romaji: "Ii ne. Kare, gamanzuyoi hanmen, muri shisugiru tokoro ga aru kara sa.", vi: "Hay ƒë√≥. C·∫≠u ·∫•y gi·ªèi ch·ªãu ƒë·ª±ng nh∆∞ng m√† l·∫°i hay c·ªë qu√°." },
                            { speaker: "Tanaka", jp: "„ÅÜ„Å°„ÅÆÂÖÑË≤¥[„ÅÇ„Å´„Åç]„Å®„ÅØÊ≠£ÂèçÂØæ[„Åõ„ÅÑ„ÅØ„Çì„Åü„ÅÑ]„Å†„Å™„ÄÇÂÖÑË≤¥[„ÅÇ„Å´„Åç]„ÅØÂΩº[„Åã„Çå]„Å´ÂØæ[„Åü„ÅÑ]„Åó„Å¶„ÄÅÂºü[„Åä„Å®„ÅÜ„Å®]„ÅØ„Åô„Åî„ÅèÊ∂àÊ•µÁöÑ[„Åó„Çá„ÅÜ„Åç„Çá„Åè„Å¶„Åç]„Å™„Çì„Å†„ÄÇ", romaji: "Uchi no aniki to wa seihantai da na. Aniki wa kare ni taishite, otouto wa sugoku shoukyokuteki nanda.", vi: "Tr√°i ng∆∞·ª£c h·∫≥n v·ªõi anh trai t·ªõ. Anh trai t·ªõ ƒë·ªëi l·∫≠p v·ªõi c·∫≠u ·∫•y, c√≤n em trai th√¨ c·ª±c k·ª≥ ti√™u c·ª±c." },
                            { speaker: "Suzuki", jp: "‰∫∫[„Å≤„Å®]„Åù„Çå„Åû„Çå„Å†„Å≠„ÄÇ„ÇÇ„ÅóÂΩº[„Åã„Çå]„ÅåÁñ≤[„Å§„Åã]„Çå„Å¶„Çã„Å™„Çâ„ÄÅÊâã‰ºù[„Å¶„Å§„Å†]„Å£„Å¶„ÅÇ„Åí„Åü„Çâ„Å©„ÅÜÔºü", romaji: "Hito sorezore da ne. Moshi kare ga tsukareteru nara, tetsudatte agetara dou?", vi: "M·ªói ng∆∞·ªùi m·ªói t√≠nh. N·∫øu c·∫≠u ·∫•y m·ªát th√¨ gi√∫p m·ªôt tay xem sao?" }
                        ]
                    }
                }
            },
            reading: {
                id: 'reading',
                title: "‰ªäÊó•„ÅÆË™≠„ÅøÁâ© (B√†i ƒë·ªçc ng·∫Øn)",
                content: {
                    jp: "ÁßÅ[„Çè„Åü„Åó]„ÅÆ‰ªï‰∫ã[„Åó„Åî„Å®]„ÅØÂ§è[„Å™„Å§]„ÅØÈùûÂ∏∏[„Å≤„Åò„Çá„ÅÜ]„Å´Âøô[„ÅÑ„Åù„Åå]„Åó„ÅÑ‰∏ÄÊñπ[„ÅÑ„Å£„ÅΩ„ÅÜ]„ÄÅÂÜ¨[„Åµ„ÇÜ]„ÅØÊöá[„Å≤„Åæ]„Å´„Å™„Çä„Åæ„Åô„ÄÇÂøô[„ÅÑ„Åù„Åå]„Åó„ÅÑ„ÅÆ„ÅØÂ§ßÂ§â[„Åü„ÅÑ„Å∏„Çì]„Å™ÂèçÈù¢[„ÅØ„Çì„ÇÅ„Çì]„ÄÅ„ÇÑ„Çä„Åå„ÅÑ„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆ‰ºöÁ§æ[„Åã„ÅÑ„Åó„ÇÉ]„ÅØÁµ¶Êñô[„Åç„ÇÖ„ÅÜ„Çä„Çá„ÅÜ]„Åå„ÅÑ„ÅÑ„ÅÆ„Å´ÂØæ[„Åü„ÅÑ]„Åó„Å¶„ÄÅÊÆãÊ•≠[„Åñ„Çì„Åé„Çá„ÅÜ]„ÅåÂ§ö[„Åä„Åä]„ÅÑ„Åß„Åô„ÄÇ‰Ωì[„Åã„Çâ„Å†]„ÅÆ„Åì„Å®„ÅåÂøÉÈÖç[„Åó„Çì„Å±„ÅÑ]„Å™„Çâ„ÄÅ‰∏ÄÂ∫¶[„ÅÑ„Å°„Å©]ÂÅ•Â∫∑Ë®∫Êñ≠[„Åë„Çì„Åì„ÅÜ„Åó„Çì„Å†„Çì]„ÇíÂèó[„ÅÜ]„Åë„Åü„Çâ„Å©„ÅÜ„Åß„Åó„Çá„ÅÜ„Åã„ÄÇÂÅ•Â∫∑[„Åë„Çì„Åì„ÅÜ]„Å™„ÅÆ„Å†„Åã„Çâ„ÄÅÂøÉÈÖç[„Åó„Çì„Å±„ÅÑ]„Å™„ÅÑ„Å®ÂåªËÄÖ[„ÅÑ„Åó„ÇÉ]„ÅØË®Ä[„ÅÑ]„ÅÑ„Åæ„Åô„Åå„ÄÅÁÑ°ÁêÜ[„ÇÄ„Çä]„ÅØÁ¶ÅÁâ©[„Åç„Çì„ÇÇ„Å§]„Åß„Åô„ÄÇ",
                    romaji: "Watashi no shigoto wa natsu wa hijou ni isogashii ippou, fuyu wa hima ni narimasu. Isogashii no wa taihen na hanmen, yarigai mo arimasu. Kono kaisha wa kyuuryou ga ii no ni taishite, zangyou ga ooi desu. Karada no koto ga shinpai nara, ichido kenkou shindan o uketara dou deshou ka. Kenkou na no dakara, shinpai nai to isha wa iimasu ga, muri wa kinmotsu desu.",
                    vi: "C√¥ng vi·ªác c·ªßa t√¥i m√πa h√® th√¨ c·ª±c k·ª≥ b·∫≠n r·ªôn, tr√°i l·∫°i m√πa ƒë√¥ng th√¨ r·∫£nh r·ªói. B·∫≠n r·ªôn tuy v·∫•t v·∫£ nh∆∞ng m·∫∑t kh√°c c≈©ng r·∫•t ƒë√°ng l√†m. C√¥ng ty n√†y l∆∞∆°ng cao nh∆∞ng ng∆∞·ª£c l·∫°i tƒÉng ca l·∫°i nhi·ªÅu. N·∫øu lo l·∫Øng cho s·ª©c kh·ªèe, sao b·∫°n kh√¥ng th·ª≠ ƒëi kh√°m s·ª©c kh·ªèe m·ªôt l·∫ßn? B√°c sƒ© n√≥i r·∫±ng v√¨ b·∫°n kh·ªèe m·∫°nh n√™n kh√¥ng c√≥ g√¨ ph·∫£i lo l·∫Øng, nh∆∞ng l√†m vi·ªác qu√° s·ª©c l√† ƒëi·ªÅu c·∫•m k·ªµ."
                }
            },
            grammar: {
                id: 'grammar',
                title: "‰ªäÊó•„ÅÆÊñáÊ≥ï (T·ªïng h·ª£p ng·ªØ ph√°p)",
                points: [
                    { rule: "ÔΩû„ÅÆ„Å†„Åã„Çâ", meaning: "B·ªüi v√¨... (l√Ω do, bi·ªán b·∫°ch)", formula: "Th·ªÉ th√¥ng th∆∞·ªùng + „ÅÆ„Å†„Åã„Çâ", example: "„Åù„Çì„Å™„Å´È£ü[„Åü]„Åπ„Åü„ÅÑ„ÅÆ„Å™„Çâ„ÄÅÈ£ü[„Åü]„Åπ„Åü„Çâ„Å©„ÅÜ„Åß„Åô„Åã„ÄÇ", example_vi: "N·∫øu m√† mu·ªën ƒÉn ƒë·∫øn th·∫ø th√¨ sao kh√¥ng ƒÉn th·ª≠ ƒëi?" },
                    { rule: "ÔΩû„Å´ÂØæ„Åó„Å¶", meaning: "ƒê·ªëi v·ªõi / Tr√°i ng∆∞·ª£c v·ªõi", formula: "N / Th·ªÉ th√¥ng th∆∞·ªùng + „ÅÆ + „Å´ÂØæ„Åó„Å¶", example: "Áà∂[„Å°„Å°]„ÅåËÉå[„Åõ]„ÅåÈ´ò[„Åü„Åã]„ÅÑ„ÅÆ„Å´ÂØæ[„Åü„ÅÑ]„Åó„Å¶„ÄÅÊØç[„ÅØ„ÅØ]„ÅØËÉå[„Åõ]„Åå‰Ωé[„Å≤„Åè]„ÅÑ„Åß„Åô„ÄÇ", example_vi: "Tr√°i v·ªõi b·ªë t√¥i cao, m·∫π t√¥i l·∫°i th·∫•p." },
                    { rule: "ÔΩûÂèçÈù¢", meaning: "M·∫∑t kh√°c, ng∆∞·ª£c l·∫°i", formula: "Th·ªÉ th√¥ng th∆∞·ªùng + ÂèçÈù¢", example: "„Åì„ÅÆËñ¨[„Åè„Åô„Çä]„ÅØ„Çà„ÅèÂäπ[„Åç]„ÅèÂèçÈù¢[„ÅØ„Çì„ÇÅ„Çì]„ÄÅÂâØ‰ΩúÁî®[„Åµ„Åè„Åï„Çà„ÅÜ]„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ", example_vi: "Thu·ªëc n√†y t√°c d·ª•ng t·ªët nh∆∞ng m·∫∑t kh√°c l·∫°i c√≥ t√°c d·ª•ng ph·ª•." },
                    { rule: "ÔΩû‰∏ÄÊñπÔºà„ÅßÔºâ", meaning: "M·ªôt m·∫∑t th√¨..., m·∫∑t kh√°c th√¨...", formula: "Th·ªÉ th√¥ng th∆∞·ªùng + ‰∏ÄÊñπÔºà„ÅßÔºâ", example: "‰ºöË≠∞[„Åã„ÅÑ„Åé]„Åß„ÅØËá™ÂàÜ[„Åò„Å∂„Çì]„ÅÆÊÑèË¶ã[„ÅÑ„Åë„Çì]„ÇíË®Ä[„ÅÑ]„ÅÜ‰∏ÄÊñπ[„ÅÑ„Å£„ÅΩ„ÅÜ]„Åß„ÄÅ‰∫∫[„Å≤„Å®]„ÅÆË©±[„ÅØ„Å™„Åó]„ÇÇ„Çà„ÅèËÅû[„Åç]„Åç„Åæ„Åô„ÄÇ", example_vi: "Trong cu·ªôc h·ªçp, m·ªôt m·∫∑t t√¥i n√≥i √Ω ki·∫øn c·ªßa m√¨nh, m·∫∑t kh√°c t√¥i c≈©ng l·∫Øng nghe c√¢u chuy·ªán c·ªßa ng∆∞·ªùi kh√°c." },
                    { rule: "ÔΩû„Å™„Çâ", meaning: "N·∫øu l√†... (ƒë∆∞a ra l·ªùi khuy√™n, ƒë·ªÅ ngh·ªã)", formula: "Th·ªÉ th√¥ng th∆∞·ªùng + „Å™„Çâ", example: "Êó•Êú¨[„Å´„Åª„Çì]„Å∏Ë°å[„ÅÑ]„Åè„Å™„Çâ„ÄÅ‰∫¨ÈÉΩ[„Åç„Çá„ÅÜ„Å®]„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„Çà„ÄÇ", example_vi: "N·∫øu ƒëi Nh·∫≠t th√¨ t√¥i g·ª£i √Ω b·∫°n n√™n ƒë·∫øn Kyoto." },
                    { rule: "ÔΩû„Åü„Çâ„Å©„ÅÜ„Åã", meaning: "Th·ª≠... xem sao?", formula: "V„Åü„Çâ + „Å©„ÅÜ„Åã", example: "Áñ≤[„Å§„Åã]„Çå„Å¶„ÅÑ„Çã„Å™„Çâ„ÄÅÂ∞ë[„Åô„Åì]„Åó‰ºë[„ÇÑ„Åô]„Çì„Å†„Çâ„Å©„ÅÜ„Åß„Åô„Åã„ÄÇ", example_vi: "N·∫øu m·ªát th√¨ sao kh√¥ng ngh·ªâ ng∆°i m·ªôt ch√∫t?" }
                ]
            },
            quiz: {
                id: 'quiz',
                title: "Á∑¥Áøí„Å®„ÉÜ„Çπ„Éà (Luy·ªán t·∫≠p & Ki·ªÉm tra)",
                questions: [
                    { type: "mcq", question: "ÂÖÑ[„ÅÇ„Å´]„ÅØÂ§ñÂêëÁöÑ[„Åå„ÅÑ„Åì„ÅÜ„Å¶„Åç]„Å™„ÅÆÔºà___Ôºâ„ÄÅÁßÅ[„Çè„Åü„Åó]„ÅØÂÜÖÂêëÁöÑ[„Å™„ÅÑ„Åì„ÅÜ„Å¶„Åç]„Åß„Åô„ÄÇ", options: ["„Å†„Åã„Çâ", "„Å´ÂØæ„Åó„Å¶", "ÂèçÈù¢"], answer: "„Å´ÂØæ„Åó„Å¶" },
                    { type: "fill", question: "„Åì„ÅÆ„ÅÇ„Åü„Çä„ÅØÈùô[„Åó„Åö]„Åã„Å™Ôºà___Ôºâ„ÄÅË≤∑[„Åã]„ÅÑÁâ©[„ÇÇ„ÅÆ]„Å´‰∏ç‰æø[„Åµ„Åπ„Çì]„Åß„Åô„ÄÇ", answer: "ÂèçÈù¢" },
                    { type: "mcq", question: "„Åù„Çì„Å™„Å´Â•Ω[„Åô]„Åç„Å™Ôºà___Ôºâ„ÄÅÂëäÁôΩ[„Åì„Åè„ÅØ„Åè]„Åó„Åü„Çâ„Å©„ÅÜ„Åß„Åô„Åã„ÄÇ", options: ["„Å™„Çâ", "„ÅÆ„Å´", "„Åã„Çâ"], answer: "„Å™„Çâ" },
                    { type: "audio", jp: "„Åì„ÅÆËñ¨„ÅØ„Çà„ÅèÂäπ„ÅèÂèçÈù¢„ÄÅÂâØ‰ΩúÁî®„Åå„ÅÇ„Çã„ÄÇ", question: "Nghe v√† g√µ l·∫°i c√¢u b·∫°n v·ª´a nghe:" }
                ]
            }
        };

        // --- STATE MANAGEMENT & SETTINGS ---
        let settings = {
            hideFurigana: false,
            showRomaji: false,
            showVietnamese: false
        };

        let progress = {
            conversation: false,
            reading: false,
            grammar: false,
            quiz: false
        };

        function saveSettings() {
            localStorage.setItem('jpAppSettings_day23', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('jpAppSettings_day23');
            if (saved) {
                settings = JSON.parse(saved);
            }
        }

        function applySettings() {
            // Buttons
            updateToggleButtonUI('toggle-furigana', !settings.hideFurigana, '·∫®n Furigana', 'Hi·ªán Furigana');
            updateToggleButtonUI('toggle-romaji', settings.showRomaji, '·∫®n Romaji', 'Hi·ªán Romaji');
            updateToggleButtonUI('toggle-vietnamese', settings.showVietnamese, '·∫®n Ti·∫øng Vi·ªát', 'Hi·ªán Ti·∫øng Vi·ªát');
            
            // Content
            document.getElementById('app').classList.toggle('hide-furigana', settings.hideFurigana);
            document.querySelectorAll('.romaji-text').forEach(el => el.classList.toggle('hidden', !settings.showRomaji));
            document.querySelectorAll('.vi-text').forEach(el => el.classList.toggle('hidden', !settings.showVietnamese));
        }

        function updateToggleButtonUI(buttonId, isActive, activeText, inactiveText) {
            const button = document.getElementById(buttonId);
            button.textContent = isActive ? activeText : inactiveText;
            button.classList.toggle('bg-sky-500', isActive);
            button.classList.toggle('text-white', isActive);
            button.classList.toggle('bg-gray-200', !isActive);
            button.classList.toggle('text-gray-700', !isActive);
        }

        // --- PROGRESS ---
        function updateProgress(sectionId) {
            if (progress.hasOwnProperty(sectionId) && !progress[sectionId]) {
                progress[sectionId] = true;
                updateProgressBar();
            }
        }

        function updateProgressBar() {
            const completed = Object.values(progress).filter(Boolean).length;
            const total = Object.keys(progress).length;
            const percentage = (completed / total) * 100;
            const bar = document.getElementById('lesson-progress-bar');
            bar.style.width = `${percentage}%`;
            bar.textContent = `${Math.round(percentage)}%`;
        }


        // --- UTILITY FUNCTIONS ---
        function parseFurigana(text) {
            return text.replace(/([^\[\]]+)\[(.+?)\]/g, '<ruby>$1<rt>$2</rt></ruby>');
        }

        function speak(text) {
            speechSynthesis.cancel(); // Stop any previous speech
            const cleanText = text.replace(/\[.*?\]/g, '');
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }

        // --- RENDER FUNCTIONS ---
        function renderConversation() {
            const section = document.getElementById('conversation-section');
            const data = day23Data.conversation;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-1 jp-font">${data.title}</h2>
                    <p class="text-gray-500 mb-4">${data.context}</p>
                    <div class="flex items-center justify-center space-x-2 mb-6 p-1 bg-gray-100 rounded-full">
                        <button id="convo-mode-polite" class="convo-mode-btn flex-1 py-2 px-4 rounded-full bg-sky-600 text-white shadow">Th·ªÉ l·ªãch s·ª±</button>
                        <button id="convo-mode-casual" class="convo-mode-btn flex-1 py-2 px-4 rounded-full">Th·ªÉ th√¥ng th∆∞·ªùng</button>
                    </div>
                    <div id="conversation-content" class="space-y-4 content-fade"></div>
                </div>
            `;
            renderDialogue('polite');
            updateProgress(data.id);
        }
        
        function renderDialogue(mode) {
            const container = document.getElementById('conversation-content');
            const dialogue = day23Data.conversation.modes[mode].dialogue;

            container.innerHTML = dialogue.map((line) => `
                <div class="dialogue-line p-4 rounded-lg bg-gray-50 border">
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 rounded-full ${line.speaker === 'Tanaka' ? 'bg-sky-100' : 'bg-emerald-100'} flex items-center justify-center font-bold text-sky-800">${line.speaker.charAt(0)}</div>
                        <div class="flex-1">
                            <p class="font-bold text-gray-800">${line.speaker}</p>
                            <p class="jp-font text-lg mt-1 leading-relaxed">${parseFurigana(line.jp)}</p>
                            <p class="romaji-text text-sm text-gray-500 mt-1">${line.romaji}</p>
                            <p class="vi-text text-sm text-emerald-700 mt-1">${line.vi}</p>
                            <div class="mt-3 flex items-center space-x-3">
                                <button class="speak-btn" data-text="${line.jp}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                </button>
                                <div class="w-full">
                                    <input type="text" class="typing-input w-full p-2 border rounded-md bg-white text-base" data-correct="${line.jp.replace(/\[.*?\]/g, '')}" placeholder="Luy·ªán g√µ ·ªü ƒë√¢y...">
                                    <div class="typing-feedback text-xs mt-1 h-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            attachEventListenersToRenderedContent(container);
            applySettings();
        }

        function renderReading() {
            const section = document.getElementById('reading-section');
            const data = day23Data.reading;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-2 jp-font">${data.title}</h2>
                    <div class="reading-content p-4 rounded-lg bg-gray-50 border">
                        <p class="jp-font text-lg leading-relaxed">${parseFurigana(data.content.jp)}</p>
                        <p class="romaji-text text-sm text-gray-500 mt-2">${data.content.romaji}</p>
                        <p class="vi-text text-sm text-emerald-700 mt-2">${data.content.vi}</p>
                        <div class="mt-4 flex items-center space-x-3">
                             <button class="speak-btn" data-text="${data.content.jp}">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                             </button>
                             <div class="w-full">
                                 <input type="text" class="typing-input w-full p-2 border rounded-md bg-white text-base" data-correct="${data.content.jp.replace(/\[.*?\]/g, '')}" placeholder="Luy·ªán g√µ ·ªü ƒë√¢y...">
                                 <div class="typing-feedback text-xs mt-1 h-4"></div>
                             </div>
                        </div>
                    </div>
                </div>
            `;
            attachEventListenersToRenderedContent(section);
            updateProgress(data.id);
        }

        function renderGrammar() {
            const section = document.getElementById('grammar-section');
            const data = day23Data.grammar;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 jp-font">${data.title}</h2>
                    <div class="space-y-3">
                        ${data.points.map((point) => `
                            <div class="grammar-point border border-gray-200 rounded-lg overflow-hidden">
                                <button class="grammar-toggle w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100">
                                    <span class="font-bold text-sky-800 jp-font text-lg">${point.rule}</span>
                                    <svg class="w-5 h-5 transform transition-transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                                <div class="grammar-details max-h-0 overflow-hidden transition-height">
                                    <div class="p-4 border-t border-gray-200">
                                        <p><strong>√ù nghƒ©a:</strong> ${point.meaning}</p>
                                        <p><strong>C√¥ng th·ª©c:</strong> <code class="bg-gray-200 text-red-600 px-1 rounded">${point.formula}</code></p>
                                        <div class="mt-2 p-3 bg-sky-50 rounded-md">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="jp-font">${parseFurigana(point.example)}</p>
                                                    <p class="vi-text text-sm text-emerald-700 mt-1">${point.example_vi}</p>
                                                </div>
                                                <button class="speak-btn" data-text="${point.example}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            attachEventListenersToRenderedContent(section);
            updateProgress(data.id);
        }

        function renderQuiz() {
            const section = document.getElementById('quiz-section');
            const data = day23Data.quiz;
            section.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 jp-font">${data.title}</h2>
                    <div id="quiz-content" class="space-y-6">
                        ${data.questions.map((q, index) => {
                            if (q.type === 'mcq') {
                                return `
                                    <div class="quiz-question" data-answer="${q.answer}">
                                        <p class="mb-2 jp-font">${index + 1}. ${parseFurigana(q.question)}</p>
                                        <div class="flex flex-col space-y-2">
                                            ${q.options.map(opt => `<button class="mcq-option text-left p-3 border rounded-lg hover:bg-gray-100">${opt}</button>`).join('')}
                                        </div>
                                        <div class="feedback mt-2 text-sm h-5"></div>
                                    </div>
                                `;
                            }
                            if (q.type === 'fill') {
                                return `
                                    <div class="quiz-question" data-answer="${q.answer}">
                                        <p class="mb-2 jp-font">${index + 1}. ${parseFurigana(q.question)}</p>
                                        <input type="text" class="fill-input w-full p-2 border rounded-md">
                                        <div class="feedback mt-2 text-sm h-5"></div>
                                    </div>
                                `;
                            }
                            if (q.type === 'audio') {
                                return `
                                    <div class="quiz-question" data-answer="${q.jp.replace(/\[.*?\]/g, '')}">
                                        <p class="mb-2 jp-font">${index + 1}. ${q.question}</p>
                                        <button class="speak-btn mb-2 flex items-center" data-text="${q.jp}">
                                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-sky-600"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                           <span class="ml-2">Nghe</span>
                                        </button>
                                        <input type="text" class="fill-input w-full p-2 border rounded-md">
                                        <div class="feedback mt-2 text-sm h-5"></div>
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>
                    <button id="check-quiz-btn" class="mt-6 w-full bg-emerald-600 text-white font-bold py-3 rounded-lg hover:bg-emerald-700 transition-colors">Ki·ªÉm tra ƒë√°p √°n</button>
                    <div id="quiz-result" class="mt-4 text-center font-bold"></div>
                </div>
            `;
            attachEventListenersToRenderedContent(section);
        }

        // --- EVENT LISTENERS ---
        function attachEventListenersToRenderedContent(container) {
            container.querySelectorAll('.speak-btn').forEach(btn => {
                btn.onclick = () => speak(btn.dataset.text);
            });

            container.querySelectorAll('.typing-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const correctText = e.target.dataset.correct;
                    const userText = e.target.value;
                    const feedbackContainer = e.target.nextElementSibling;
                    let styledText = '';
                    for (let i = 0; i < userText.length; i++) {
                        styledText += `<span class="${userText[i] === correctText[i] ? 'correct-char' : 'incorrect-char'}">${userText[i]}</span>`;
                    }
                    feedbackContainer.innerHTML = styledText;
                    if (userText === correctText) {
                        feedbackContainer.innerHTML = '<span class="text-green-600 font-bold">Ch√≠nh x√°c! üéâ</span>';
                    }
                });
            });
            
            container.querySelectorAll('.grammar-toggle').forEach(button => {
                button.addEventListener('click', () => {
                    const details = button.nextElementSibling;
                    const icon = button.querySelector('svg');
                    if (details.style.maxHeight && details.style.maxHeight !== '0px') {
                        details.style.maxHeight = '0px';
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        details.style.maxHeight = details.scrollHeight + 'px';
                        icon.style.transform = 'rotate(180deg)';
                    }
                });
            });
        }

        function setupGlobalEventListeners() {
            document.getElementById('toggle-furigana').addEventListener('click', () => {
                settings.hideFurigana = !settings.hideFurigana;
                saveSettings();
                applySettings();
            });
            document.getElementById('toggle-romaji').addEventListener('click', () => {
                settings.showRomaji = !settings.showRomaji;
                saveSettings();
                applySettings();
            });
            document.getElementById('toggle-vietnamese').addEventListener('click', () => {
                settings.showVietnamese = !settings.showVietnamese;
                saveSettings();
                applySettings();
            });

            document.getElementById('convo-mode-polite').addEventListener('click', (e) => {
                const container = document.getElementById('conversation-content');
                container.classList.add('fading-out');
                setTimeout(() => {
                    renderDialogue('polite');
                    container.classList.remove('fading-out');
                    e.target.classList.add('bg-sky-600', 'text-white', 'shadow');
                    document.getElementById('convo-mode-casual').classList.remove('bg-sky-600', 'text-white', 'shadow');
                }, 300);
            });
            document.getElementById('convo-mode-casual').addEventListener('click', (e) => {
                const container = document.getElementById('conversation-content');
                container.classList.add('fading-out');
                setTimeout(() => {
                    renderDialogue('casual');
                    container.classList.remove('fading-out');
                    e.target.classList.add('bg-sky-600', 'text-white', 'shadow');
                    document.getElementById('convo-mode-polite').classList.remove('bg-sky-600', 'text-white', 'shadow');
                }, 300);
            });
            
            document.getElementById('check-quiz-btn').addEventListener('click', () => {
                const questions = document.querySelectorAll('.quiz-question');
                let score = 0;
                questions.forEach(q => {
                    const answer = q.dataset.answer;
                    const feedback = q.querySelector('.feedback');
                    let isCorrect = false;

                    const selectedOption = q.querySelector('.mcq-option.bg-sky-200');
                    if (selectedOption) {
                        isCorrect = selectedOption.textContent === answer;
                        selectedOption.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                    }
                    
                    const input = q.querySelector('.fill-input');
                    if (input) {
                        isCorrect = input.value.trim() === answer;
                        input.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                    }

                    if (isCorrect) {
                        score++;
                        feedback.innerHTML = `<span class="feedback-icon feedback-correct">‚úîÔ∏è</span><span class="text-green-600 font-bold">ƒê√∫ng!</span>`;
                    } else {
                        feedback.innerHTML = `<span class="feedback-icon feedback-incorrect">‚ùå</span><span class="text-red-600 font-bold">Sai! ƒê√°p √°n ƒë√∫ng l√†: ${answer}</span>`;
                    }
                });
                
                document.getElementById('quiz-result').innerHTML = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${score}/${questions.length} c√¢u!`;
                updateProgress(day23Data.quiz.id);
            });
            
            document.querySelectorAll('.mcq-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    opt.parentElement.querySelectorAll('.mcq-option').forEach(sibling => {
                        sibling.classList.remove('bg-sky-200', 'border-sky-500');
                    });
                    opt.classList.add('bg-sky-200', 'border-sky-500');
                });
            });
        }
        
        // --- INITIALIZATION ---
        function init() {
            document.getElementById('main-title').textContent = day23Data.title;
            loadSettings();
            renderConversation();
            renderReading();
            renderGrammar();
            renderQuiz();
            setupGlobalEventListeners();
            applySettings();
            updateProgressBar();
        }

        window.onload = init;
    </script>
</body>
</html>
